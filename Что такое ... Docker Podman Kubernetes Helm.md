##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

—á—Ç–æ —Ç–∞–∫–æ–µ docker, podman, kebernetes, helm

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–í–æ—Ç –∫—Ä–∞—Ç–∫–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Ä–º–∏–Ω–∞:

### **1\. Docker**

–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, –ø–æ–∑–≤–æ–ª—è—é—â–∞—è —Å–æ–∑–¥–∞–≤–∞—Ç—å, —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è—Ç—å –∏ –∑–∞–ø—É—Å–∫–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã. –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ Docker:

-   **–û–±—Ä–∞–∑—ã (Images)** ‚Äî —à–∞–±–ª–æ–Ω—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤.
    
-   **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (Containers)** ‚Äî –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ä–µ–¥—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.
    
-   **–†–µ–µ—Å—Ç—Ä –æ–±—Ä–∞–∑–æ–≤ (Docker Hub)** ‚Äî —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –æ–±–º–µ–Ω–∞ –æ–±—Ä–∞–∑–∞–º–∏.
    
-   **–°–µ—Ç–µ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏** ‚Äî —Å–≤—è–∑—ã–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –¥—Ä—É–≥ —Å –¥—Ä—É–≥–æ–º –∏ –≤–Ω–µ—à–Ω–∏–º–∏ —Å–µ—Ç—è–º–∏.
    
-   **–¢–æ–ºa (Volumes)** ‚Äî –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤.
    

___

### **2\. Podman**

–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ Docker, —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏–∏ –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–µ–º–æ–Ω–∞ (–±–µ–∑ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å–µ—Ä–≤–µ—Ä–∞). –û—Å–Ω–æ–≤–Ω—ã–µ –æ—Ç–ª–∏—á–∏—è –æ—Ç Docker:

-   **–ë–µ–∑ –¥–µ–º–æ–Ω–∞** ‚Äî –ø—Ä–æ—Ü–µ—Å—Å—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é.
    
-   **Rootless —Ä–µ–∂–∏–º** ‚Äî –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –±–µ–∑ –ø—Ä–∞–≤ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
    
-   **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** ‚Äî –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ Docker –∫–æ–º–∞–Ω–¥ —Ä–∞–±–æ—Ç–∞—é—Ç –∏ –≤ Podman.
    
-   **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ Pod'–æ–≤** ‚Äî –≥—Ä—É–ø–ø –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤, –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã—Ö –æ–¥–Ω–æ–π —Å–µ—Ç—å—é –∏ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ–º –∏–º–µ–Ω.
    

___

### **3\. Kubernetes (K8s)**

–°–∏—Å—Ç–µ–º–∞ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤, —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è, –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω—ã–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏. –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

-   **Pods** ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –µ–¥–∏–Ω–∏—Ü–∞ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è, –æ–¥–∏–Ω –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤, —Ä–∞–±–æ—Ç–∞—é—â–∏—Ö –≤–º–µ—Å—Ç–µ.
    
-   **Services** ‚Äî –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–µ IP-–∞–¥—Ä–µ—Å–∞ –¥–ª—è Pod'–æ–≤.
    
-   **Ingress** ‚Äî –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –≤–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ Pods.
    
-   **Deployments** ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∏ –≤–µ—Ä—Å–∏—è–º–∏ Pod'–æ–≤.
    
-   **Namespaces** ‚Äî –ª–æ–≥–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ –∫–ª–∞—Å—Ç–µ—Ä–∞.
    

___

### **4\. Helm**

–ü–∞–∫–µ—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –¥–ª—è Kubernetes, —É–ø—Ä–æ—â–∞—é—â–∏–π —É—Å—Ç–∞–Ω–æ–≤–∫—É, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏. –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:

-   **Charts** ‚Äî –ø–∞–∫–µ—Ç—ã Kubernetes YAML-–º–∞–Ω–∏—Ñ–µ—Å—Ç–æ–≤ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.
    
-   **Values** ‚Äî —Ñ–∞–π–ª—ã —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π –¥–ª—è —à–∞–±–ª–æ–Ω–æ–≤.
    
-   **Releases** ‚Äî —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–µ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã Chart'–æ–≤.
    
-   **Rollback** ‚Äî –æ—Ç–∫–∞—Ç –¥–æ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏–π.
    

___

–•–æ—á–µ—à—å –ø–æ–∫–∞–∑–∞—Ç—å, –∫–∞–∫ –º–æ–∂–Ω–æ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –∏—Ö –≤ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–µ CI/CD –¥–ª—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è? üôÇ

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–ö–æ–Ω–µ—á–Ω–æ! –í–æ—Ç –æ–±—ä–µ–¥–∏–Ω—ë–Ω–Ω–æ–µ –∏ –∫–æ–º–ø–∞–∫—Ç–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö —á–µ—Ç—ã—Ä—ë—Ö —Ç–µ—Ä–º–∏–Ω–æ–≤ ‚Äî Docker, Podman, Kubernetes –∏ Helm:

___

### **Docker**

–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è, —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –∏ –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ ‚Äî –ª—ë–≥–∫–∏—Ö –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—Ä–µ–¥ –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π. –ü–æ–∑–≤–æ–ª—è–µ—Ç —É–ø–∞–∫–æ–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–æ –≤—Å–µ–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏ –≤ –æ–±—Ä–∞–∑ (image), –∫–æ—Ç–æ—Ä—ã–π –ø–æ—Ç–æ–º –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä. Docker –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–µ–º–æ–Ω (—Å–µ—Ä–≤–∏—Å), –∫–æ—Ç–æ—Ä—ã–π —É–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏.

**–û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–Ω—è—Ç–∏—è:**

-   **–û–±—Ä–∞–∑—ã (Images)** ‚Äî —à–∞–±–ª–æ–Ω—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤.
    
-   **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (Containers)** ‚Äî –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ –∏–∑ –æ–±—Ä–∞–∑–æ–≤ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã.
    
-   **–¢–æ–º–∞ (Volumes)** ‚Äî –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö.
    
-   **Docker Hub** ‚Äî –æ–±–ª–∞—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –æ–±—Ä–∞–∑–æ–≤.
    

___

### **Podman**

–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ Docker, –∫–æ—Ç–æ—Ä–∞—è –Ω–µ —Ç—Ä–µ–±—É–µ—Ç —Ñ–æ–Ω–æ–≤–æ–≥–æ –¥–µ–º–æ–Ω–∞ –∏ –º–æ–∂–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –±–µ–∑ –ø—Ä–∞–≤ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (rootless). –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –∫–æ–º–∞–Ω–¥–∞–º–∏ Docker –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–æ–Ω—Ü–µ–ø—Ü–∏—é pod ‚Äî –≥—Ä—É–ø–ø—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤, –æ–±—ä–µ–¥–∏–Ω—ë–Ω–Ω—ã—Ö –æ–±—â–µ–π —Å–µ—Ç—å—é –∏ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ–º –∏–º—ë–Ω, —á—Ç–æ —É–¥–æ–±–Ω–æ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–≤—è–∑–∞–Ω–Ω—ã–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏.

___

### **Kubernetes (K8s)**

–°–∏—Å—Ç–µ–º–∞ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è, –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö. –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –∫–ª–∞—Å—Ç–µ—Ä–µ –∏–∑ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤.

**–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**

-   **Pods** ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –µ–¥–∏–Ω–∏—Ü–∞, –æ–¥–∏–Ω –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤, –∑–∞–ø—É—â–µ–Ω–Ω—ã—Ö –≤–º–µ—Å—Ç–µ.
    
-   **Deployments** ‚Äî –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É—é—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ Pods.
    
-   **Services** ‚Äî –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ Pods (–ø–æ—Å—Ç–æ—è–Ω–Ω—ã–µ IP/–∏–º–µ–Ω–∞).
    
-   **Ingress** ‚Äî –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –≤–Ω–µ—à–Ω–µ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞ –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º –≤–Ω—É—Ç—Ä–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞.
    
-   **Namespaces** ‚Äî –ª–æ–≥–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ –∫–ª–∞—Å—Ç–µ—Ä–∞.
    

___

### **Helm**

–ü–∞–∫–µ—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –¥–ª—è Kubernetes, –∫–æ—Ç–æ—Ä—ã–π —É–ø—Ä–æ—â–∞–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫—É, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏ –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ. –ü–æ–∑–≤–æ–ª—è–µ—Ç —É–ø–∞–∫–æ–≤—ã–≤–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ Kubernetes-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤ —É–¥–æ–±–Ω—ã–µ **Charts** ‚Äî —à–∞–±–ª–æ–Ω—ã —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ (values).

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**

-   –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –≤ Kubernetes.
    
-   –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏—è–º–∏ –∏ –æ—Ç–∫–∞—Ç—ã (rollback).
    
-   –£–¥–æ–±—Å—Ç–≤–æ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏ —à–∞–±–ª–æ–Ω–∏–∑–∞—Ü–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π.
    

___

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, –º–æ–≥—É –ø–æ–º–æ—á—å —Å–æ—Å—Ç–∞–≤–∏—Ç—å –ø—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä, –∫–∞–∫ —Å –ø–æ–º–æ—â—å—é Docker –∏–ª–∏ Podman —Å–æ–±—Ä–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, –∞ –ø–æ—Ç–æ–º —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –µ–≥–æ –≤ Kubernetes —á–µ—Ä–µ–∑ Helm!

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

—á—Ç–æ —Ç–∞–∫–æ–µ CI\\CD –∏ –∫–∞–∫ –µ–≥–æ –Ω–∞—Å—Ç—Ä–∏–∞–≤–∞—Ç—å –≤ git

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å! –î–∞–≤–∞–π —Ä–∞–∑–±–µ—Ä—ë–º:

___

## –ß—Ç–æ —Ç–∞–∫–æ–µ CI/CD?

**CI/CD** ‚Äî —ç—Ç–æ –Ω–∞–±–æ—Ä –ø—Ä–∞–∫—Ç–∏–∫ –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –¥–æ—Å—Ç–∞–≤–∫–∏ –ü–û:

-   **CI (Continuous Integration)** ‚Äî –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–æ–¥–∞ –æ—Ç —Ä–∞–∑–Ω—ã—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –≤ –æ–±—â–∏–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π, —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º –∑–∞–ø—É—Å–∫–æ–º —Å–±–æ—Ä–æ–∫ –∏ —Ç–µ—Å—Ç–æ–≤.
    
-   **CD (Continuous Delivery / Continuous Deployment)** ‚Äî –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –∏–ª–∏ –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ. –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞ –Ω–∞ —Ä–∞–∑–Ω—ã–µ —Å—Ä–µ–¥—ã (—Ç–µ—Å—Ç–æ–≤–∞—è, staging, production).
    

–¢–æ –µ—Å—Ç—å CI/CD –ø–æ–∑–≤–æ–ª—è–µ—Ç –±—ã—Å—Ç—Ä–µ–µ –∏ –Ω–∞–¥–µ–∂–Ω–µ–µ –≤—ã–ø—É—Å–∫–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, —Å–Ω–∏–∂–∞—è –æ—à–∏–±–∫–∏ –∏ —Ä—É—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏.

___

## –ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å CI/CD –≤ Git?

–ï—Å–ª–∏ —É —Ç–µ–±—è –ø—Ä–æ–µ–∫—Ç –≤ GitHub, GitLab –∏–ª–∏ –¥—Ä—É–≥–æ–º Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏, –æ–±—ã—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –∏–ª–∏ —Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏:

### –ü—Ä–∏–º–µ—Ä –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ CI/CD —Å GitHub Actions (GitHub)

1.  –í –∫–æ—Ä–Ω–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è —Å–æ–∑–¥–∞—ë—Ç—Å—è –ø–∞–ø–∫–∞ `.github/workflows/`.
    
2.  –í –Ω–µ–π ‚Äî YAML-—Ñ–∞–π–ª —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º pipeline (workflow), –Ω–∞–ø—Ä–∏–º–µ—Ä `ci-cd.yml`.
    
3.  –í —ç—Ç–æ–º —Ñ–∞–π–ª–µ –∑–∞–¥–∞—é—Ç—Å—è —Ç—Ä–∏–≥–≥–µ—Ä—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, push –≤ main –∏–ª–∏ pull request), —à–∞–≥–∏ —Å–±–æ—Ä–∫–∏, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –¥–µ–ø–ª–æ—è.
    

–ü—Ä–∏–º–µ—Ä –ø—Ä–æ—Å—Ç–æ–≥–æ workflow –¥–ª—è Python-–ø—Ä–æ–µ–∫—Ç–∞:

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>name:</span></span><span> </span><span><span>CI</span></span><span>

</span><span><span>on:</span></span><span>
  </span><span><span>push:</span></span><span>
    </span><span><span>branches:</span></span><span>
      </span><span><span>-</span></span><span> </span><span><span>main</span></span><span>
  </span><span><span>pull_request:</span></span><span>
    </span><span><span>branches:</span></span><span>
      </span><span><span>-</span></span><span> </span><span><span>main</span></span><span>

</span><span><span>jobs:</span></span><span>
  </span><span><span>build:</span></span><span>
    </span><span><span>runs-on:</span></span><span> </span><span><span>ubuntu-latest</span></span><span>

    </span><span><span>steps:</span></span><span>
      </span><span><span>-</span></span><span> </span><span><span>uses:</span></span><span> </span><span><span>actions/checkout@v3</span></span><span>
      
      </span><span><span>-</span></span><span> </span><span><span>name:</span></span><span> </span><span><span>Set</span></span><span> </span><span><span>up</span></span><span> </span><span><span>Python</span></span><span>
        </span><span><span>uses:</span></span><span> </span><span><span>actions/setup-python@v4</span></span><span>
        </span><span><span>with:</span></span><span>
          </span><span><span>python-version:</span></span><span> </span><span><span>'3.10'</span></span><span>
      
      </span><span><span>-</span></span><span> </span><span><span>name:</span></span><span> </span><span><span>Install</span></span><span> </span><span><span>dependencies</span></span><span>
        </span><span><span>run:</span></span><span> </span><span><span>pip</span></span><span> </span><span><span>install</span></span><span> </span><span><span>-r</span></span><span> </span><span><span>requirements.txt</span></span><span>
      
      </span><span><span>-</span></span><span> </span><span><span>name:</span></span><span> </span><span><span>Run</span></span><span> </span><span><span>tests</span></span><span>
        </span><span><span>run:</span></span><span> </span><span><span>pytest</span></span><span>
</span></span></code></p></div>
```

### –ß—Ç–æ –¥–∞–ª—å—à–µ?

-   –ï—Å–ª–∏ —Ç–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏ ‚Äî –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —à–∞–≥–∏ –¥–µ–ø–ª–æ—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞ —Å–µ—Ä–≤–µ—Ä, –≤ Docker, Kubernetes –∏ —Ç.–ø.)
    
-   –ú–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (Slack, –ø–æ—á—Ç–∞) –æ —Å—Ç–∞—Ç—É—Å–∞—Ö —Å–±–æ—Ä–∫–∏
    
-   –ú–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–∞–∑–Ω—ã–µ workflow –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –≤–µ—Ç–æ–∫
    

___

### –î–ª—è GitLab CI/CD

–í –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è —Ñ–∞–π–ª `.gitlab-ci.yml`, –≥–¥–µ –ø–∏—à–µ—Ç—Å—è –æ–ø–∏—Å–∞–Ω–∏–µ pipeline ‚Äî –ø–æ—Ö–æ–∂–∏–π –ø—Ä–∏–Ω—Ü–∏–ø, –Ω–æ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π –¥–ª—è GitLab.

___

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, –º–æ–≥—É –ø–æ–º–æ—á—å —Å–æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø—Ä–∏–º–µ—Ä –¥–ª—è —Ç–≤–æ–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –∏–ª–∏ –æ–±—ä—è—Å–Ω–∏—Ç—å, –∫–∞–∫ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ Docker/Kubernetes.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

###### ChatGPT —Å–∫–∞–∑–∞–ª:

**Staging** ‚Äî —ç—Ç–æ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–∞—è —Å—Ä–µ–¥–∞ –º–µ–∂–¥—É —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–æ–π (development) –∏ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–æ–º (production).

___

### **–ó–∞—á–µ–º –Ω—É–∂–Ω–∞ staging-—Å—Ä–µ–¥–∞?**

1.  **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ —Ä–µ–ª–∏–∑–æ–º** ‚Äî –∏–º–∏—Ç–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ —É—Å–ª–æ–≤–∏—è—Ö, –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–Ω—ã—Ö –∫ —Ä–µ–∞–ª—å–Ω–æ–π —Å—Ä–µ–¥–µ.
    
2.  **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–≤—ã—Ö —Ñ–∏—á, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –ø–µ—Ä–µ–¥ –≤—ã–∫–ª–∞–¥–∫–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º.
    
3.  **–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫** ‚Äî –≤—ã—è–≤–ª–µ–Ω–∏–µ –±–∞–≥–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥–ª–∏ –±—ã—Ç—å –ø—Ä–æ–ø—É—â–µ–Ω—ã –Ω–∞ —ç—Ç–∞–ø–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.
    
4.  **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** ‚Äî —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –∏ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–∫–ª–∏–∫–∞.
    
5.  **–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π** ‚Äî –º–µ—Å—Ç–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –∑–∞–∫–∞–∑—á–∏–∫–æ–º –∏–ª–∏ –∫–æ–º–∞–Ω–¥–æ–π QA –ø–µ—Ä–µ–¥ –≤—ã–ø—É—Å–∫–æ–º.
    

___

### **–ö–∞–∫ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –¥—Ä—É–≥–∏—Ö —Å—Ä–µ–¥:**

| **–°—Ä–µ–¥–∞** | **–¶–µ–ª—å** | **–î–æ—Å—Ç—É–ø** | **–†–∏—Å–∫–∏** |
| --- | --- | --- | --- |
| Development | –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç | –¢–æ–ª—å–∫–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ | –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ |
| Staging | –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–æ–º | –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏, —Ç–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫–∏, –∏–Ω–æ–≥–¥–∞ –∑–∞–∫–∞–∑—á–∏–∫–∏ | –°—Ä–µ–¥–Ω–∏–µ |
| Production | –†–∞–±–æ—á–∞—è —Å—Ä–µ–¥–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π | –ö–æ–Ω–µ—á–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ |

___

### **–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ CI/CD:**

–ü—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ CI/CD (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ GitHub Actions, GitLab CI –∏–ª–∏ Jenkins) —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç staging –∫–∞–∫ –æ–¥–∏–Ω –∏–∑ —ç—Ç–∞–ø–æ–≤ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è:

1.  –ò–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–π –≤–µ—Ç–∫–∏ (`main`, `master`) —Å–Ω–∞—á–∞–ª–∞ –¥–µ–ø–ª–æ—è—Ç—Å—è –Ω–∞ staging.
    
2.  –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∏–ª–∏ —Ä—É—á–Ω–æ–π –¥–µ–ø–ª–æ–π –≤ production.
    

___

–•–æ—á–µ—à—å, —è –ø–æ–∫–∞–∂—É, –∫–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ staging —Å Docker –∏ Kubernetes? üòä

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–¥–∞–π —Å—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ docker, podman, kebernetes, helm

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–í–æ—Ç —Å—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ **Docker**, **Podman**, **Kubernetes** –∏ **Helm**:

___

| **–ü–∞—Ä–∞–º–µ—Ç—Ä** | **Docker** | **Podman** | **Kubernetes (K8s)** | **Helm** |
| --- | --- | --- | --- | --- |
| **–û—Å–Ω–æ–≤–Ω–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ** | –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π | –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, —Å–æ–≤–º–µ—Å—Ç–∏–º–∞ —Å Docker | –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ | –ü–∞–∫–µ—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –¥–ª—è Kubernetes |
| **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** | –ö–ª–∏–µ–Ω—Ç-—Å–µ—Ä–≤–µ—Ä, —Ç—Ä–µ–±—É–µ—Ç—Å—è Docker Daemon | –ë–µ–∑ –¥–µ–º–æ–Ω–∞ (Daemonless), –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è runC –∏–ª–∏ crun | –ú–∞—Å—Ç–µ—Ä-–Ω–æ–¥—ã –∏ –≤–æ—Ä–∫–µ—Ä-–Ω–æ–¥—ã, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ | –ù–∞–¥—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞–¥ K8s –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —á–∞—Ä—Ç–∞–º–∏ |
| **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ pod-–æ–≤** | –ù–µ—Ç, –æ–¥–∏–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä | –î–∞, —á–µ—Ä–µ–∑ "pods" | –î–∞, –æ—Å–Ω–æ–≤–Ω–∞—è —Å—É—â–Ω–æ—Å—Ç—å | –†–∞–±–æ—Ç–∞–µ—Ç —Å pods —á–µ—Ä–µ–∑ K8s |
| **–°–µ—Ç–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏** | –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π overlay, bridge, host | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ CNI, —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å Docker network | –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Å–µ—Ç—å —Å —Å–µ—Ä–≤–∏—Å–∞–º–∏ –∏ ingress | –£–ø—Ä–∞–≤–ª—è–µ—Ç —Å–µ—Ç—å—é —á–µ—Ä–µ–∑ –º–∞–Ω–∏—Ñ–µ—Å—Ç—ã K8s |
| **–ò–∑–æ–ª—è—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤** | cgroups, namespaces | cgroups, namespaces, –±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∞—è –∏–∑–æ–ª—è—Ü–∏—è –≤ rootless —Ä–µ–∂–∏–º–µ | –ü–æ–ª–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞–º–∏ –∏–º—ë–Ω | –ó–∞–≤–∏—Å–∏—Ç –æ—Ç K8s |
| **–•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö** | –¢–æ–ºa (Volumes), bind mounts | –¢–æ–ºa (Volumes), bind mounts | PV, PVC, storage classes | –£–ø—Ä–∞–≤–ª—è–µ—Ç storage —á–µ—Ä–µ–∑ K8s –º–∞–Ω–∏—Ñ–µ—Å—Ç—ã |
| **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** | –¢—Ä–µ–±—É–µ—Ç root –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –¥–µ–º–æ–Ω–∞ | –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç rootless –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã | RBAC, Network Policies | –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ K8s |
| **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏** | Docker CLI | Podman CLI, —Å–æ–≤–º–µ—Å—Ç–∏–º —Å Docker CLI | Kubectl, K8s API | helm, helmfile, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ CI/CD |
| **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è** | Docker Compose, Swarm | Podman Compose (—ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–æ) | –ü–æ–ª–Ω–æ–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏—è–º–∏ –∏ rollback |
| **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∞ –æ–¥–Ω–∏–º —Ö–æ—Å—Ç–æ–º | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∞ –æ–¥–Ω–∏–º —Ö–æ—Å—Ç–æ–º | –í—ã—Å–æ–∫–∞—è, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã–µ –∫–ª–∞—Å—Ç–µ—Ä—ã | –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å K8s |
| **–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã** | Docker Compose, Docker Swarm | Buildah, Skopeo | ArgoCD, Helm, Istio | Helm, Kustomize, ArgoCD |
| **–û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è** | –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –æ–¥–∏–Ω–æ—á–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è | –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞, edge-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è | –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã, –≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è | –®–∞–±–ª–æ–Ω–∏–∑–∞—Ü–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ª–æ–∂–Ω—ã–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏ |

___

### **–û—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞–∑–ª–∏—á–∏—è:**

-   **Docker** ‚Äî –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –ø—Ä–æ—Å—Ç–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è.
    
-   **Podman** ‚Äî –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ Docker –±–µ–∑ –¥–µ–º–æ–Ω–∞, –±–æ–ª—å—à–µ –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å.
    
-   **Kubernetes** ‚Äî –º–æ—â–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏ –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ.
    
-   **Helm** ‚Äî –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–ª–æ–∂–Ω—ã–º–∏, –º–Ω–æ–≥–æ–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω—ã–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏ –≤ Kubernetes.
    

___

–•–æ—á–µ—à—å, —è –ø–æ–º–æ–≥—É –≤—ã–±—Ä–∞—Ç—å, —á—Ç–æ –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è —Ç–≤–æ–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ FastAPI —Å Kafka –∏ Avro? –ò–ª–∏, –º–æ–∂–µ—Ç –±—ã—Ç—å, –ø–æ–∫–∞–∑–∞—Ç—å, –∫–∞–∫ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Ö –≤–º–µ—Å—Ç–µ –¥–ª—è CI/CD? üòä

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–¥–∞–≤–∞–π –ø—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä, –∫–∞–∫ —Å –ø–æ–º–æ—â—å—é Docker –∏–ª–∏ Podman —Å–æ–±—Ä–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, –∞ –ø–æ—Ç–æ–º —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –µ–≥–æ –≤ Kubernetes —á–µ—Ä–µ–∑ Helm

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–î–∞–≤–∞–π —Å–¥–µ–ª–∞–µ–º –ø—Ä–æ—Å—Ç–æ–π –ø—Ä–æ–µ–∫—Ç –Ω–∞ **FastAPI**, —Å–æ–±–µ—Ä—ë–º –µ–≥–æ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å **Docker** –∏–ª–∏ **Podman**, –∞ –ø–æ—Ç–æ–º —Ä–∞–∑–≤–µ—Ä–Ω—ë–º –≤ **Kubernetes** —Å –ø–æ–º–æ—â—å—é **Helm**. –Ø –ø–æ–∫–∞–∂—É –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª, —á—Ç–æ–±—ã –±—ã–ª–æ –ø–æ–Ω—è—Ç–Ω–æ, –∫–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç.

___

### **1\. –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ–≥–æ FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**

–°–æ–∑–¥–∞–π –ø–∞–ø–∫—É –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä, **fastapi-app** –∏ –¥–æ–±–∞–≤—å —Å–ª–µ–¥—É—é—â–∏–µ —Ñ–∞–π–ª—ã:

**`app/main.py`**

```
<div><p>python</p><p><code id="code-lang-python"><span><span><span>from</span></span><span> fastapi </span><span><span>import</span></span><span> FastAPI

app = FastAPI()

</span><span><span>@app.get(<span><span>"/"</span></span></span></span><span>)
</span><span><span>async</span></span><span> </span><span><span>def</span></span><span> </span><span><span>root</span></span><span>():
    </span><span><span>return</span></span><span> {</span><span><span>"message"</span></span><span>: </span><span><span>"Hello, Kubernetes with Helm!"</span></span><span>}
</span></span></code></p></div>
```

**`requirements.txt`**

```
<div><p>ini</p><p><code><span><span><span>fastapi</span></span><span>==</span><span><span>0.103</span></span><span>.</span><span><span>2</span></span><span>
</span><span><span>uvicorn</span></span><span>==</span><span><span>0.23</span></span><span>.</span><span><span>2</span></span><span>
</span></span></code></p></div>
```

___

### **2\. –°–æ–∑–¥–∞–Ω–∏–µ Dockerfile**

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª **`Dockerfile`** –¥–ª—è —Å–±–æ—Ä–∫–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:

```
<div><p>dockerfile</p><p><code id="code-lang-dockerfile"><span># –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑ Python
FROM python:3.11-slim

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–±–æ—á—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
WORKDIR /app

# –ö–æ–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY app/ app/

# –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]
</span></code></p></div>
```

___

### **3\. –°–±–æ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞**

**–° Docker:**

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>docker build -t fastapi-app:latest .
</span></span></code></p></div>
```

**–° Podman:**

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>podman build -t fastapi-app:latest .
</span></span></code></p></div>
```

___

### **4\. –õ–æ–∫–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞**

–ó–∞–ø—É—Å—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ª–æ–∫–∞–ª—å–Ω–æ, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç:

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>docker run -d -p 8000:8000 fastapi-app:latest
</span></span></code></p></div>
```

–ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ: [http://localhost:8000](http://localhost:8000/)  
–û–Ω–æ –¥–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å:

```
<div><p>json</p><p><code id="code-lang-json"><span><span><span>{</span></span><span><span>"message"</span></span><span><span>:</span></span><span> </span><span><span>"Hello, Kubernetes with Helm!"</span></span><span><span>}</span></span><span>
</span></span></code></p></div>
```

___

### **5\. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ Helm-—á–∞—Ä—Ç–∞**

–°–æ–∑–¥–∞–π Helm-—á–∞—Ä—Ç –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è:

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>helm create fastapi-chart
</span></span></code></p></div>
```

–ò–∑–º–µ–Ω–∏–º –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Ñ–∞–π–ª—ã:

**`fastapi-chart/values.yaml`**

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>image:</span></span><span>
  </span><span><span>repository:</span></span><span> </span><span><span>fastapi-app</span></span><span>
  </span><span><span>tag:</span></span><span> </span><span><span>latest</span></span><span>
  </span><span><span>pullPolicy:</span></span><span> </span><span><span>IfNotPresent</span></span><span>

</span><span><span>service:</span></span><span>
  </span><span><span>type:</span></span><span> </span><span><span>NodePort</span></span><span>
  </span><span><span>port:</span></span><span> </span><span><span>8000</span></span><span>
  </span><span><span>nodePort:</span></span><span> </span><span><span>30080</span></span><span>

</span><span><span>replicaCount:</span></span><span> </span><span><span>2</span></span><span>
</span></span></code></p></div>
```

___

### **6\. –°–æ–∑–¥–∞–Ω–∏–µ Docker-–æ–±—Ä–∞–∑–∞ –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –≤ DockerHub (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)**

1.  –í–æ–π–¥–∏ –≤ DockerHub:
    

2.  –ó–∞–¥–∞–π –∏–º—è –æ–±—Ä–∞–∑–∞ –¥–ª—è DockerHub:
    

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>docker tag fastapi-app:latest your-username/fastapi-app:latest
</span></span></code></p></div>
```

3.  –ó–∞–≥—Ä—É–∑–∏—Ç—å –æ–±—Ä–∞–∑ –≤ DockerHub:
    

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>docker push your-username/fastapi-app:latest
</span></span></code></p></div>
```

___

### **7\. –î–µ–ø–ª–æ–π –≤ Kubernetes —á–µ—Ä–µ–∑ Helm**

–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Minikube (–µ—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∫–ª–∞—Å—Ç–µ—Ä):

–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —á–∞—Ä—Ç–æ–≤:

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>helm install fastapi-app ./fastapi-chart
</span></span></code></p></div>
```

–ü—Ä–æ–≤–µ—Ä–∫–∞:

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>kubectl get pods
kubectl get svc
</span></span></code></p></div>
```

___

### **8\. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞**

–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å Minikube:

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>minikube service fastapi-app
</span></span></code></p></div>
```

–ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é:

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>curl http://&lt;Minikube_IP&gt;:30080
</span></span></code></p></div>
```

___

–•–æ—á–µ—à—å, —è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –ø–æ–∫–∞–∂—É, –∫–∞–∫ —Å–¥–µ–ª–∞—Ç—å –æ—Ç–∫–∞—Ç—ã (rollback) –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ Helm? üòä

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

###### ChatGPT —Å–∫–∞–∑–∞–ª:

**dbt (Data Build Tool)** ‚Äî —ç—Ç–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–Ω–∞–ª–∏—Ç–∏–∫–∞–º –∏ –∏–Ω–∂–µ–Ω–µ—Ä–∞–º –¥–∞–Ω–Ω—ã—Ö –ø–∏—Å–∞—Ç—å, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å SQL-—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø—Ä—è–º–æ –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, **PostgreSQL**, **Snowflake**, **BigQuery**, **ClickHouse**, **Redshift**).

___

### **–û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ dbt:**

1.  **SQL-–º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ:**
    
    -   –ü–∏—à–µ—à—å SQL –∫–∞–∫ –æ–±—ã—á–Ω—ã–µ —Ñ–∞–π–ª—ã `.sql`, –∞ dbt –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—ã, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã.
        
    -   –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Jinja2-—à–∞–±–ª–æ–Ω—ã –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ SQL.
        
    -   –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π —á–µ—Ä–µ–∑ `ref()`.
        
2.  **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö:**
    
    -   –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö (—É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å, –Ω–µ–Ω—É–ª–µ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è, –¥–∏–∞–ø–∞–∑–æ–Ω—ã –∑–Ω–∞—á–µ–Ω–∏–π).
        
    -   –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ç–µ—Å—Ç—ã.
        
3.  **–°–æ–∑–¥–∞–Ω–∏–µ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ö–µ–º:**
    
    -   –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –∏ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –≤ —Ü–µ–ª–µ–≤–æ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.
        
4.  **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
    
    -   –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ–ø–∏—Å–∞–Ω–∏–π –º–æ–¥–µ–ª–µ–π –∏ —Ç–µ—Å—Ç–æ–≤.
        
    -   –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö —Å—Ö–µ–º –¥–∞–Ω–Ω—ã—Ö.
        
5.  **–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å:**
    
    -   –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –ø–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –º–µ–∂–¥—É –º–æ–¥–µ–ª—è–º–∏.
        
    -   –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞.
        
6.  **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ CI/CD:**
    
    -   –õ–µ–≥–∫–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å GitHub Actions, GitLab CI, Airflow –∏ –¥—Ä—É–≥–∏–º–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏.
        

___

### **–ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã dbt-–ø—Ä–æ–µ–∫—Ç–∞:**

```
<div><p>pgsql</p><p><code><span><span>my_dbt_project/
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ staging/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ users.</span><span><span>sql</span></span><span>
‚îÇ   ‚îî‚îÄ‚îÄ marts/
‚îÇ       ‚îî‚îÄ‚îÄ analytics.</span><span><span>sql</span></span><span>
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îî‚îÄ‚îÄ unique_user_id.</span><span><span>sql</span></span><span>
‚îú‚îÄ‚îÄ macros/
‚îÇ   ‚îî‚îÄ‚îÄ custom_macro.</span><span><span>sql</span></span><span>
‚îú‚îÄ‚îÄ dbt_project.yml
‚îî‚îÄ‚îÄ profiles.yml
</span></span></code></p></div>
```

___

### **–ü—Ä–∏–º–µ—Ä –º–æ–¥–µ–ª–∏ (models/staging/users.sql):**

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span><span>with</span></span><span> raw_users </span><span><span>as</span></span><span> (
    </span><span><span>select</span></span><span>
        id,
        name,
        created_at
    </span><span><span>from</span></span><span> raw.users
)

</span><span><span>select</span></span><span>
    id,
    name,
    date_trunc(</span><span><span>'day'</span></span><span>, created_at) </span><span><span>as</span></span><span> created_date
</span><span><span>from</span></span><span> raw_users
</span></span></code></p></div>
```

___

### **–ü–ª—é—Å—ã dbt:**

-   –ü—Ä–æ—Å—Ç–æ—Ç–∞ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–±—ã—á–Ω—ã–π SQL.
    
-   –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å ‚Äî –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –∏ –∏–∑–º–µ–Ω—è—Ç—å –º–æ–¥–µ–ª–∏.
    
-   –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å ‚Äî –≤—Å—è –ª–æ–≥–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ.
    
-   –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–∞–Ω–Ω—ã—Ö.
    
-   –õ–µ–≥–∫–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Git –∏ CI/CD.
    

___

### **–ú–∏–Ω—É—Å—ã dbt:**

-   –ù–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö ETL-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤ —Å –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è–º–∏ –≤–Ω–µ SQL.
    
-   –¢—Ä–µ–±—É–µ—Ç –∑–Ω–∞–Ω–∏–π SQL –∏ Jinja.
    
-   –ú–æ–≥—É—Ç –±—ã—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –Ω–∞ –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–∞—Ö –¥–∞–Ω–Ω—ã—Ö.
    

___

–•–æ—á–µ—à—å –ø–æ–∫–∞–∑–∞—Ç—å, –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å dbt –¥–ª—è –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ ClickHouse? üòä

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

###### ChatGPT —Å–∫–∞–∑–∞–ª:

**Jinja** ‚Äî —ç—Ç–æ –º–æ—â–Ω—ã–π –∏ –≥–∏–±–∫–∏–π —à–∞–±–ª–æ–Ω–∏–∑–∞—Ç–æ—Ä –¥–ª—è Python, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö HTML-—Å—Ç—Ä–∞–Ω–∏—Ü, —Ñ–∞–π–ª–æ–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –∏ SQL-–∑–∞–ø—Ä–æ—Å–æ–≤. –û–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—Å—Ç–∞–≤–ª—è—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –≤—ã–ø–æ–ª–Ω—è—Ç—å —Ü–∏–∫–ª—ã, —É—Å–ª–æ–≤–∏—è –∏ –¥–∞–∂–µ –ø–æ–¥–∫–ª—é—á–∞—Ç—å –º–∞–∫—Ä–æ—Å—ã –≤ —à–∞–±–ª–æ–Ω–∞—Ö.

___

### **–û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ Jinja:**

1.  **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:**
    
    -   –í—Å—Ç–∞–≤–∫–∞ –∑–Ω–∞—á–µ–Ω–∏–π –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ —à–∞–±–ª–æ–Ω:
        
    
    -   –†–µ–∑—É–ª—å—Ç–∞—Ç (–µ—Å–ª–∏ **name = "Alice"**):
        
    
2.  **–£—Å–ª–æ–≤–∏—è:**
    
    ```
    <div><p>jinja</p><p><code id="code-lang-jinja"><span>{% if is_admin %}
        Welcome, admin!
    {% else %}
        Welcome, guest!
    {% endif %}
    </span></code></p></div>
    ```
    
3.  **–¶–∏–∫–ª—ã:**
    
    ```
    <div><p>jinja</p><p><code id="code-lang-jinja"><span>{% for item in items %}
        - {{ item }}
    {% endfor %}
    </span></code></p></div>
    ```
    
4.  **–§–∏–ª—å—Ç—Ä—ã:**
    
    ```
    <div><p>jinja</p><p><code id="code-lang-jinja"><span>{{ price | round(2) }}
    {{ name | upper }}
    {{ message | replace("world", "Jinja") }}
    </span></code></p></div>
    ```
    
5.  **–ú–∞–∫—Ä–æ—Å—ã (—Ñ—É–Ω–∫—Ü–∏–∏):**
    
    ```
    <div><p>jinja</p><p><code id="code-lang-jinja"><span>{% macro greet(name) %}
        Hello, {{ name }}!
    {% endmacro %}
    
    {{ greet("Alice") }}
    </span></code></p></div>
    ```
    
6.  **–í–∫–ª—é—á–µ–Ω–∏–µ –¥—Ä—É–≥–∏—Ö —à–∞–±–ª–æ–Ω–æ–≤:**
    
    ```
    <div><p>jinja</p><p><code id="code-lang-jinja"><span>{% include "header.html" %}
    {% include "footer.html" %}
    </span></code></p></div>
    ```
    
7.  **–†–∞–±–æ—Ç–∞ —Å–æ —Å–ª–æ–≤–∞—Ä—è–º–∏ –∏ —Å–ø–∏—Å–∫–∞–º–∏:**
    
    ```
    <div><p>jinja</p><p><code id="code-lang-jinja"><span>{{ user.get("name", "Unknown") }}
    </span></code></p></div>
    ```
    

___

### **–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Jinja —Å dbt:**

**–ú–æ–¥–µ–ª—å (`models/example.sql`):**

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span><span>select</span></span><span>
    user_id,
    created_at,
    {{ dbt_utils.current_timestamp() }} </span><span><span>as</span></span><span> processed_at
</span><span><span>from</span></span><span> {{ </span><span><span>ref</span></span><span>(</span><span><span>'users'</span></span><span>) }}
</span></span></code></p></div>
```

–ó–¥–µ—Å—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–∞–∫—Ä–æ—Å `dbt_utils.current_timestamp()`, –∫–æ—Ç–æ—Ä—ã–π –≤—Å—Ç–∞–≤–ª—è–µ—Ç —Ç–µ–∫—É—â—É—é –º–µ—Ç–∫—É –≤—Ä–µ–º–µ–Ω–∏.

___

### **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Jinja –≤ Python:**

```
<div><p>python</p><p><code id="code-lang-python"><span><span><span>from</span></span><span> jinja2 </span><span><span>import</span></span><span> Template

template = Template(</span><span><span>"Hello, {{ name }}!"</span></span><span>)
result = template.render(name=</span><span><span>"Alice"</span></span><span>)
</span><span><span>print</span></span><span>(result)
</span></span></code></p></div>
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

___

### **–ü–ª—é—Å—ã Jinja:**

-   –í—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
    
-   –ü—Ä–æ—Å—Ç–æ—Ç–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Python
    
-   –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–ª–æ–∂–Ω—ã—Ö –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–π (—Ü–∏–∫–ª—ã, —É—Å–ª–æ–≤–∏—è, –º–∞–∫—Ä–æ—Å—ã)
    
-   –ß–∏—Å—Ç—ã–π –∏ —á–∏—Ç–∞–µ–º—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
    

___

–•–æ—á–µ—à—å –ø–æ–∫–∞–∑–∞—Ç—å, –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Jinja –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–ª–æ–∂–Ω—ã—Ö SQL-–∑–∞–ø—Ä–æ—Å–æ–≤ –≤ dbt –¥–ª—è ClickHouse? üòä

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

###### ChatGPT —Å–∫–∞–∑–∞–ª:

### **SSL (Secure Sockets Layer)**

**SSL** ‚Äî —ç—Ç–æ –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ç–æ–∫–æ–ª, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –º–µ–∂–¥—É –∫–ª–∏–µ–Ω—Ç–æ–º –∏ —Å–µ—Ä–≤–µ—Ä–æ–º —á–µ—Ä–µ–∑ –ò–Ω—Ç–µ—Ä–Ω–µ—Ç. –°–µ–π—á–∞—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –µ–≥–æ —É—Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è ‚Äî **TLS (Transport Layer Security)**, –Ω–æ —Ç–µ—Ä–º–∏–Ω SSL –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è.

___

#### **–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ SSL/TLS:**

1.  **–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö** ‚Äî –∑–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö –æ—Ç –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞ –∏ —á—Ç–µ–Ω–∏—è —Ç—Ä–µ—Ç—å–∏–º–∏ –ª–∏—Ü–∞–º–∏.
    
2.  **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Å–µ—Ä–≤–µ—Ä–∞** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–∞ —Å –ø–æ–º–æ—â—å—é —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤.
    
3.  **–¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –ø–µ—Ä–µ–¥–∞—á–∏.
    

___

#### **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç SSL/TLS:**

-   –ö–ª–∏–µ–Ω—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –∑–∞—â–∏—â—ë–Ω–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å —Å–µ—Ä–≤–µ—Ä–æ–º.
    
-   –°–µ—Ä–≤–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–≤–æ–π SSL-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤–∫–ª—é—á–∞–µ—Ç –æ—Ç–∫—Ä—ã—Ç—ã–π –∫–ª—é—á.
    
-   –ö–ª–∏–µ–Ω—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–∞ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ —Ü–µ–Ω—Ç—Ä—ã —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (CA).
    
-   –ö–ª–∏–µ–Ω—Ç –∏ —Å–µ—Ä–≤–µ—Ä —Å–æ–≥–ª–∞—Å–æ–≤—ã–≤–∞—é—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è (–∞–ª–≥–æ—Ä–∏—Ç–º—ã, –∫–ª—é—á–∏).
    
-   –î–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ.
    

___

#### **–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è SSL:**

-   HTTPS (–∑–∞—â–∏—â–µ–Ω–Ω—ã–π HTTP)
    
-   –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–∞–º –¥–∞–Ω–Ω—ã—Ö (PostgreSQL, MySQL)
    
-   VPN-—Ç—É–Ω–Ω–µ–ª–∏
    

___

### **SSH (Secure Shell)**

**SSH** ‚Äî —Å–µ—Ç–µ–≤–æ–π –ø—Ä–æ—Ç–æ–∫–æ–ª –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —É–¥–∞–ª—ë–Ω–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞–º–∏ –∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, –∞ —Ç–∞–∫–∂–µ –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö. –û–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É —á–µ—Ä–µ–∑ –∑–∞—â–∏—â—ë–Ω–Ω—ã–π –∫–∞–Ω–∞–ª.

___

#### **–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ SSH:**

1.  **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** (–ø–æ –ø–∞—Ä–æ–ª—é, –ø—É–±–ª–∏—á–Ω–æ–º—É –∫–ª—é—á—É, —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—É).
    
2.  **–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞** –¥–ª—è –∑–∞—â–∏—Ç—ã –¥–∞–Ω–Ω—ã—Ö.
    
3.  **–ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ä—Ç–æ–≤** (tunneling) –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.
    
4.  **–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ —Ñ–∞–π–ª–æ–≤** (SCP, SFTP).
    
5.  **–¢–æ–Ω–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞** (—á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏ –∫–ª—é—á–∏).
    

___

#### **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç SSH:**

-   –ö–ª–∏–µ–Ω—Ç –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å —Å–µ—Ä–≤–µ—Ä–æ–º.
    
-   –°–µ—Ä–≤–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–≤–æ–π –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á.
    
-   –ö–ª–∏–µ–Ω—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —ç—Ç–æ—Ç –∫–ª—é—á (known\_hosts).
    
-   –ö–ª–∏–µ–Ω—Ç –∏ —Å–µ—Ä–≤–µ—Ä –¥–æ–≥–æ–≤–∞—Ä–∏–≤–∞—é—Ç—Å—è –æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è.
    
-   –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–≤–æ–∏ —É—á—ë—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–ø–∞—Ä–æ–ª—å –∏–ª–∏ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á).
    
-   –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è, –¥–∞–Ω–Ω—ã–µ —à–∏—Ñ—Ä—É—é—Ç—Å—è.
    

___

#### **–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è SSH:**

-   –£–¥–∞–ª—ë–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞–º–∏ (Linux, macOS)
    
-   –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ —Ñ–∞–π–ª–æ–≤ (SCP, SFTP)
    
-   –¢—É–Ω–Ω–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, PostgreSQL)
    
-   –î–æ—Å—Ç—É–ø –∫ Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º ([git@github.com](mailto:git@github.com))
    

___

–•–æ—á–µ—à—å, –ø–æ–∫–∞–∂—É, –∫–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å SSH-–∫–ª—é—á–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ—Ä–≤–µ—Ä—É –∏–ª–∏ –∫–∞–∫ –∑–∞—â–∏—Ç–∏—Ç—å —Å–≤–æ–π FastAPI —Å–µ—Ä–≤–∏—Å —Å –ø–æ–º–æ—â—å—é SSL? üòä

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

###### ChatGPT —Å–∫–∞–∑–∞–ª:

**FastAPI** ‚Äî —ç—Ç–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π, –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è API –Ω–∞ Python, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ **Starlette** (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫) –∏ **Pydantic** (–≤–∞–ª–∏–¥–∞—Ç–æ—Ä –¥–∞–Ω–Ω—ã—Ö).

___

### **–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ FastAPI:**

1.  **–í—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
    
    -   –û—Å–Ω–æ–≤–∞–Ω –Ω–∞ **ASGI** –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **uvicorn**, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –µ–≥–æ –æ–¥–Ω–∏–º –∏–∑ —Å–∞–º—ã—Ö –±—ã—Å—Ç—Ä—ã—Ö —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–≤ –Ω–∞ Python.
        
    -   –°–æ–ø–æ—Å—Ç–∞–≤–∏–º –ø–æ —Å–∫–æ—Ä–æ—Å—Ç–∏ —Å **Node.js** –∏ **Go**.
        
2.  **–ü—Ä–æ—Å—Ç–æ—Ç–∞ –∏ –ª–∞–∫–æ–Ω–∏—á–Ω–æ—Å—Ç—å:**
    
    -   –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ —Ç–∏–ø–æ–≤ Python (type hints), —á—Ç–æ —É–ø—Ä–æ—â–∞–µ—Ç –Ω–∞–ø–∏—Å–∞–Ω–∏–µ –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –∫–æ–¥–∞.
        
3.  **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
    
    -   –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –≤ —Ñ–æ—Ä–º–∞—Ç–µ OpenAPI (Swagger) –∏ ReDoc –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
        
4.  **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö:**
    
    -   –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Pydantic –¥–ª—è —Å—Ç—Ä–æ–≥–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ —Å—Ö–µ–º.
        
5.  **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞:**
    
    -   –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π (`async def`), —á—Ç–æ –ø–æ–≤—ã—à–∞–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å.
        
6.  **–õ–µ–≥–∫–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**
    
    -   –ü–æ–¥–¥–µ—Ä–∂–∫–∞ OAuth2, JWT, WebSockets, CORS, GraphQL –∏ –¥—Ä—É–≥–∏—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π.
        

___

### **–ü—Ä–∏–º–µ—Ä –ø—Ä–æ—Å—Ç–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è FastAPI:**

**`main.py`**

```
<div><p>python</p><p><code id="code-lang-python"><span><span><span>from</span></span><span> fastapi </span><span><span>import</span></span><span> FastAPI

app = FastAPI()

</span><span><span>@app.get(<span><span>"/"</span></span></span></span><span>)
</span><span><span>async</span></span><span> </span><span><span>def</span></span><span> </span><span><span>read_root</span></span><span>():
    </span><span><span>return</span></span><span> {</span><span><span>"message"</span></span><span>: </span><span><span>"Hello, FastAPI!"</span></span><span>}

</span><span><span>@app.get(<span><span>"/items/{item_id}"</span></span></span></span><span>)
</span><span><span>async</span></span><span> </span><span><span>def</span></span><span> </span><span><span>read_item</span></span><span>(</span><span><span>item_id: <span>int</span></span></span><span>, q: </span><span><span>str</span></span><span> = </span><span><span>None</span></span><span>):
    </span><span><span>return</span></span><span> {</span><span><span>"item_id"</span></span><span>: item_id, </span><span><span>"query"</span></span><span>: q}
</span></span></code></p></div>
```

–ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>uvicorn main:app --reload
</span></span></code></p></div>
```

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å–∞–º:

-   Swagger UI: [http://localhost:8000/docs](http://localhost:8000/docs)
    
-   ReDoc: [http://localhost:8000/redoc](http://localhost:8000/redoc)
    

___

### **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ FastAPI:**

-   –°–æ–∑–¥–∞–Ω–∏–µ REST API
    
-   –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã
    
-   Backend –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö –∏ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
    
-   ML-—Å–µ—Ä–≤–∏—Å—ã –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –º–æ–¥–µ–ª–µ–π –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è
    
-   –†–µ–∞–ª–∏–∑–∞—Ü–∏—è WebSocket-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
    

___

–•–æ—á–µ—à—å –ø–æ–∫–∞–∑–∞—Ç—å, –∫–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é, –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å Kafka –¥–ª—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã? üòä

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–Ω–µ –ø–æ–Ω—è–ª –∫–∞–∫ —ç—Ç–æ –∑–∞–ø—É—Å–∫–∞—Ç—å

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–ß—Ç–æ–±—ã –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ—Å—Ç–æ–π FastAPI –ø—Ä–æ–µ–∫—Ç, –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —à–∞–≥–æ–≤. –í–æ—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:

___

### **1\. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è**

–°–æ–∑–¥–∞–π –ø–∞–ø–∫—É –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä:

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span><span>mkdir</span></span><span> my_fastapi_app
</span><span><span>cd</span></span><span> my_fastapi_app
</span></span></code></p></div>
```

–°–æ–∑–¥–∞–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):

–ê–∫—Ç–∏–≤–∏—Ä—É–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:

-   **Windows:**
    

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>.\venv\Scripts\activate
</span></span></code></p></div>
```

-   **Linux / macOS:**
    

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span><span>source</span></span><span> venv/bin/activate
</span></span></code></p></div>
```

___

### **2\. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ FastAPI –∏ Uvicorn**

–£—Å—Ç–∞–Ω–æ–≤–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–∫–µ—Ç—ã:

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>pip install fastapi uvicorn
</span></span></code></p></div>
```

___

### **3\. –°–æ–∑–¥–∞–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª **`main.py`** —Å –ø—Ä–æ—Å—Ç—ã–º –∫–æ–¥–æ–º:

```
<div><p>python</p><p><code id="code-lang-python"><span><span><span>from</span></span><span> fastapi </span><span><span>import</span></span><span> FastAPI

app = FastAPI()

</span><span><span>@app.get(<span><span>"/"</span></span></span></span><span>)
</span><span><span>async</span></span><span> </span><span><span>def</span></span><span> </span><span><span>read_root</span></span><span>():
    </span><span><span>return</span></span><span> {</span><span><span>"message"</span></span><span>: </span><span><span>"Hello, FastAPI!"</span></span><span>}

</span><span><span>@app.get(<span><span>"/items/{item_id}"</span></span></span></span><span>)
</span><span><span>async</span></span><span> </span><span><span>def</span></span><span> </span><span><span>read_item</span></span><span>(</span><span><span>item_id: <span>int</span></span></span><span>, q: </span><span><span>str</span></span><span> = </span><span><span>None</span></span><span>):
    </span><span><span>return</span></span><span> {</span><span><span>"item_id"</span></span><span>: item_id, </span><span><span>"query"</span></span><span>: q}
</span></span></code></p></div>
```

___

### **4\. –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**

–¢–µ–ø–µ—Ä—å –∑–∞–ø—É—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å –ø–æ–º–æ—â—å—é **Uvicorn**:

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>uvicorn main:app --reload
</span></span></code></p></div>
```

___

### **5\. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã**

–¢–µ–ø–µ—Ä—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É: [http://localhost:8000](http://localhost:8000/)

-   **–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞:** [http://localhost:8000](http://localhost:8000/)
    
-   **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Swagger:** [http://localhost:8000/docs](http://localhost:8000/docs)
    
-   **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è ReDoc:** [http://localhost:8000/redoc](http://localhost:8000/redoc)
    

___

### **6\. –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤:**

-   –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (GET):
    

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>curl http://localhost:8000/
</span></span></code></p></div>
```

-   –ó–∞–ø—Ä–æ—Å —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ (GET):
    

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>curl </span><span><span>"http://localhost:8000/items/123?q=test"</span></span><span>
</span></span></code></p></div>
```

–†–µ–∑—É–ª—å—Ç–∞—Ç –±—É–¥–µ—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫–∏–º:

```
<div><p>json</p><p><code id="code-lang-json"><span><span><span>{</span></span><span><span>"item_id"</span></span><span><span>:</span></span><span> </span><span><span>123</span></span><span><span>,</span></span><span> </span><span><span>"query"</span></span><span><span>:</span></span><span> </span><span><span>"test"</span></span><span><span>}</span></span><span>
</span></span></code></p></div>
```

___

–•–æ—á–µ—à—å, —è –ø–æ–∫–∞–∂—É, –∫–∞–∫ —Å–æ–±—Ä–∞—Ç—å —ç—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏–ª–∏ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –µ–≥–æ –≤ Kubernetes —á–µ—Ä–µ–∑ Helm? üòä

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

—Ä–∞—Å—Å–∫–∞–∂–∏ —á—Ç–æ —Ç–∞–∫–æ–µ Swagger, ReDoc: –∏ –∫–∞–∫ –∏–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ —ç—Ç–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ

###### ChatGPT —Å–∫–∞–∑–∞–ª:

### **–ß—Ç–æ —Ç–∞–∫–æ–µ Swagger –∏ ReDoc?**

**Swagger** –∏ **ReDoc** ‚Äî —ç—Ç–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ API-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–π **OpenAPI** (—Ä–∞–Ω–µ–µ –∏–∑–≤–µ—Å—Ç–Ω–æ–≥–æ –∫–∞–∫ Swagger).

___

#### **Swagger UI:**

-   –ü—Ä–µ–≤—Ä–∞—â–∞–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—é OpenAPI –≤ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é.
    
-   –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø—Ä—è–º–æ –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞.
    
-   –û—Ç–ª–∏—á–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∏–∑—É—á–µ–Ω–∏—è API.
    

#### **ReDoc:**

-   –ë–æ–ª–µ–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∏ —Å—Ç–∏–ª—å–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.
    
-   –§–æ–∫—É—Å–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —á–∏—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–ª–æ–∂–Ω—ã–µ API.
    
-   –õ–µ–≥—á–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –¥–ª—è –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.
    

___

### **–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Swagger –∏ ReDoc –≤ FastAPI:**

FastAPI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –≤ –æ–±–æ–∏—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö:

1.  **Swagger UI:**
    
    -   –î–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: [http://localhost:8000/docs](http://localhost:8000/docs)
        
    -   –ò—Å–ø–æ–ª—å–∑—É–µ—Ç **Swagger UI** –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.
        
2.  **ReDoc:**
    
    -   –î–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: [http://localhost:8000/redoc](http://localhost:8000/redoc)
        
    -   –ò—Å–ø–æ–ª—å–∑—É–µ—Ç **ReDoc** –¥–ª—è –±–æ–ª–µ–µ —á–∏—Å—Ç–æ–≥–æ –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.
        

___

### **–ü—Ä–∏–º–µ—Ä –ø—Ä–æ—Å—Ç–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π:**

**`main.py`**

```
<div><p>python</p><p><code id="code-lang-python"><span><span><span>from</span></span><span> fastapi </span><span><span>import</span></span><span> FastAPI

app = FastAPI(
    title=</span><span><span>"My FastAPI App"</span></span><span>,
    description=</span><span><span>"–ü—Ä–∏–º–µ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π Swagger –∏ ReDoc"</span></span><span>,
    version=</span><span><span>"1.0.0"</span></span><span>
)

</span><span><span>@app.get(<span><span>"/"</span></span></span></span><span>, summary=</span><span><span>"–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞"</span></span><span>)
</span><span><span>async</span></span><span> </span><span><span>def</span></span><span> </span><span><span>read_root</span></span><span>():
    <span>"""
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.
    """</span>
    </span><span><span>return</span></span><span> {</span><span><span>"message"</span></span><span>: </span><span><span>"Hello, FastAPI!"</span></span><span>}

</span><span><span>@app.get(<span><span>"/items/{item_id}"</span></span></span></span><span>, summary=</span><span><span>"–ü–æ–ª—É—á–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç"</span></span><span>)
</span><span><span>async</span></span><span> </span><span><span>def</span></span><span> </span><span><span>read_item</span></span><span>(</span><span><span>item_id: <span>int</span></span></span><span>, q: </span><span><span>str</span></span><span> = </span><span><span>None</span></span><span>):
    <span>"""
    –ü–æ–ª—É—á–∞–µ—Ç —ç–ª–µ–º–µ–Ω—Ç –ø–æ ID.

    - **item_id**: –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —ç–ª–µ–º–µ–Ω—Ç–∞  
    - **q**: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä –∑–∞–ø—Ä–æ—Å–∞  
    """</span>
    </span><span><span>return</span></span><span> {</span><span><span>"item_id"</span></span><span>: item_id, </span><span><span>"query"</span></span><span>: q}
</span></span></code></p></div>
```

___

### **–ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:**

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>uvicorn main:app --reload
</span></span></code></p></div>
```

–¢–µ–ø–µ—Ä—å —Ç—ã —É–≤–∏–¥–∏—à—å:

-   Swagger UI: [http://localhost:8000/docs](http://localhost:8000/docs)
    
-   ReDoc: [http://localhost:8000/redoc](http://localhost:8000/redoc)
    

___

### **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –∏ –æ–ø–∏—Å–∞–Ω–∏–π:**

-   **–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:** `title="My FastAPI App"`
    
-   **–û–ø–∏—Å–∞–Ω–∏–µ:** `description="–ü—Ä–∏–º–µ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π"`
    
-   **–í–µ—Ä—Å–∏—è:** `version="1.0.0"`
    
-   **–¢–µ–≥–∏:**
    

```
<div><p>python</p><p><code id="code-lang-python"><span><span><span>@app.get(<span><span>"/users/"</span></span></span></span><span>, tags=[</span><span><span>"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏"</span></span><span>])
</span><span><span>async</span></span><span> </span><span><span>def</span></span><span> </span><span><span>get_users</span></span><span>():
    </span><span><span>return</span></span><span> [{</span><span><span>"name"</span></span><span>: </span><span><span>"Alice"</span></span><span>}, {</span><span><span>"name"</span></span><span>: </span><span><span>"Bob"</span></span><span>}]
</span></span></code></p></div>
```

___

### **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –º–µ—Ç–æ–¥–æ–≤:**

–¢—ã –º–æ–∂–µ—à—å –æ–ø–∏—Å–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤:

```
<div><p>python</p><p><code id="code-lang-python"><span><span><span>from</span></span><span> fastapi </span><span><span>import</span></span><span> FastAPI, Path, Query

app = FastAPI()

</span><span><span>@app.get(<span><span>"/items/{item_id}"</span></span></span></span><span>)
</span><span><span>async</span></span><span> </span><span><span>def</span></span><span> </span><span><span>read_item</span></span><span>(<span>
    item_id: </span></span><span><span>int</span></span><span> = Path(</span><span><span>..., title=<span>"ID —ç–ª–µ–º–µ–Ω—Ç–∞"</span></span></span><span>, ge=</span><span><span>1</span></span><span>),
    q: </span><span><span>str</span></span><span> = Query(</span><span><span><span>None</span></span></span><span>, max_length=</span><span><span>50</span></span><span>, title=</span><span><span>"–°—Ç—Ä–æ–∫–∞ –ø–æ–∏—Å–∫–∞"</span></span><span>)
):
    </span><span><span>return</span></span><span> {</span><span><span>"item_id"</span></span><span>: item_id, </span><span><span>"q"</span></span><span>: q}
</span></span></code></p></div>
```

___

### **–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**

-   –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ OAuth2
    
-   –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–æ–≤
    
-   –ú–∞—Ä—à—Ä—É—Ç—ã —Å –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏ —Å—Ö–µ–º–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö
    
-   –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Pydantic –º–æ–¥–µ–ª–µ–π –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–Ω—ã—Ö
    

___

–•–æ—á–µ—à—å –ø–æ–∫–∞–∑–∞—Ç—å, –∫–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –∏–ª–∏ –∫–∞—Å—Ç–æ–º–Ω—ã–µ —Å—Ö–µ–º—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π? üòä

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

###### ChatGPT —Å–∫–∞–∑–∞–ª:

**Apache Druid** ‚Äî —ç—Ç–æ –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–∞—è, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏. Druid —Å–æ—á–µ—Ç–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ OLAP-—Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –∏ –ø–æ—Ç–æ–∫–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –µ–≥–æ –æ—Ç–ª–∏—á–Ω—ã–º –≤—ã–±–æ—Ä–æ–º –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ —Å–æ–±—ã—Ç–∏–π, –ª–æ–≥–æ–≤ –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤.

___

### **–û—Å–Ω–æ–≤–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ Apache Druid:**

1.  **–í—ã—Å–æ–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤:**
    
    -   –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–ª–æ–Ω–æ—á–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –∞–≥—Ä–µ–≥–∞—Ü–∏–∏.
        
    -   –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –≤—ã–±–æ—Ä–æ–∫.
        
2.  **–†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è:**
    
    -   –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏.
        
    -   –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å Kafka –∏ Apache Pulsar –¥–ª—è –ø–æ—Ç–æ–∫–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏.
        
3.  **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:**
    
    -   –õ–µ–≥–∫–æ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ.
        
    -   –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö.
        
4.  **–ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
    
    -   –†–∞–∑–¥–µ–ª—è–µ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –Ω–∞ ingestion, storage, –∏ query processing –¥–ª—è –ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.
        
5.  **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –∞–Ω–∞–ª–∏–∑:**
    
    -   –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç OLAP-–∑–∞–ø—Ä–æ—Å—ã, drill-down –∏ slice-and-dice –∞–Ω–∞–ª–∏–∑.
        
6.  **–ì–∏–±–∫–æ—Å—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏—è:**
    
    -   –î–∞–Ω–Ω—ã–µ –º–æ–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –≤ –ø–∞–º—è—Ç–∏, –Ω–∞ SSD –∏–ª–∏ –Ω–∞ HDD –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π.
        
7.  **–ú–Ω–æ–≥–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã:**
    
    -   –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç bitmap, inverted –∏ roaring bitmap –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –ø–æ–∏—Å–∫–∞.
        

___

### **–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã Apache Druid:**

-   **Broker:** –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Ö–æ–¥—è—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç –∏—Ö –∫ —Å–µ–≥–º–µ–Ω—Ç–∞–º –¥–∞–Ω–Ω—ã—Ö.
    
-   **Historical:** –•—Ä–∞–Ω–∏—Ç –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç —Å–µ–≥–º–µ–Ω—Ç—ã –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö.
    
-   **MiddleManager:** –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–¥–∞—á–∞–º–∏ ingestion.
    
-   **Coordinator:** –£–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º —Å–µ–≥–º–µ–Ω—Ç–æ–≤ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É Historical –Ω–æ–¥–∞–º–∏.
    
-   **Overlord:** –£–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–¥–∞—á–∞–º–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö (ingestion).
    
-   **Router:** –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∫ —Ä–∞–∑–ª–∏—á–Ω—ã–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º –∫–ª–∞—Å—Ç–µ—Ä–∞.
    

___

### **–ü–æ—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ Druid:**

1.  **Ingestion:**
    
    -   –î–∞–Ω–Ω—ã–µ –ø–æ—Å—Ç—É–ø–∞—é—Ç –∏–∑ Kafka, Kinesis, HDFS, S3 –∏–ª–∏ –¥—Ä—É–≥–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤.
        
    -   MiddleManager —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Å–µ–≥–º–µ–Ω—Ç—ã –¥–∞–Ω–Ω—ã—Ö.
        
    -   –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ—â–∞—é—Ç—Å—è –≤ Historical –Ω–æ–¥—ã.
        
2.  **–•—Ä–∞–Ω–µ–Ω–∏–µ:**
    
    -   –î–∞–Ω–Ω—ã–µ —Ä–∞–∑–±–∏–≤–∞—é—Ç—Å—è –Ω–∞ —Å–µ–≥–º–µ–Ω—Ç—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏.
        
    -   –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–æ–ª–æ–Ω–æ—á–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è.
        
3.  **–ó–∞–ø—Ä–æ—Å—ã:**
    
    -   Broker –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∏ –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –∏—Ö –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ Historical –Ω–æ–¥—ã.
        
    -   –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è SQL, JSON –∏ Druid Native Query.
        

___

### **–ü—Ä–∏–º–µ—Ä –ø—Ä–æ—Å—Ç–æ–≥–æ SQL-–∑–∞–ø—Ä–æ—Å–∞ –≤ Druid:**

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span><span>SELECT</span></span><span>
  user_id,
  </span><span><span>COUNT</span></span><span>(</span><span><span>*</span></span><span>) </span><span><span>AS</span></span><span> page_views,
  </span><span><span>SUM</span></span><span>(revenue) </span><span><span>AS</span></span><span> total_revenue
</span><span><span>FROM</span></span><span>
  events
</span><span><span>WHERE</span></span><span>
  event_date </span><span><span>BETWEEN</span></span><span> </span><span><span>'2025-05-01'</span></span><span> </span><span><span>AND</span></span><span> </span><span><span>'2025-05-15'</span></span><span>
</span><span><span>GROUP</span></span><span> </span><span><span>BY</span></span><span>
  user_id
</span><span><span>ORDER</span></span><span> </span><span><span>BY</span></span><span>
  total_revenue </span><span><span>DESC</span></span><span>
LIMIT </span><span><span>10</span></span><span>;
</span></span></code></p></div>
```

___

### **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Druid:**

-   –í—ã—Å–æ–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤
    
-   –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
    
-   –ì–∏–±–∫–∞—è —Å—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö
    
-   –†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
    
-   –ù–∏–∑–∫–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ —á—Ç–µ–Ω–∏—è
    

### **–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏ Druid:**

-   –°–ª–æ–∂–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–ª–∞—Å—Ç–µ—Ä–∞
    
-   –í—ã—Å–æ–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø–∞–º—è—Ç–∏
    
-   –¢—Ä–µ–±—É–µ—Ç –ø–ª–æ—Ç–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Kafka –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
    

___

–•–æ—á–µ—à—å –ø–æ–∫–∞–∑–∞—Ç—å, –∫–∞–∫ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –∫–ª–∞—Å—Ç–µ—Ä Druid —Å –ø–æ–º–æ—â—å—é Docker –∏–ª–∏ Kubernetes? –ò–ª–∏, –º–æ–∂–µ—Ç –±—ã—Ç—å, –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ —Å —Ç–≤–æ–∏–º –ø—Ä–æ–µ–∫—Ç–æ–º –Ω–∞ FastAPI –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏? üòä

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

###### ChatGPT —Å–∫–∞–∑–∞–ª:

**Apache Drill** ‚Äî —ç—Ç–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∞—è –º–Ω–æ–∂–µ—Å—Ç–≤–æ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤, –≤–∫–ª—é—á–∞—è —Ñ–∞–π–ª–æ–≤—ã–µ —Å–∏—Å—Ç–µ–º—ã, —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –æ–±–ª–∞—á–Ω—ã–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –∏ NoSQL. Drill –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –∑–∞–ø—Ä–æ—Å—ã SQL –±–µ–∑ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π —Å—Ö–µ–º—ã –¥–∞–Ω–Ω—ã—Ö, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –µ–≥–æ –æ—á–µ–Ω—å –≥–∏–±–∫–∏–º –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ–ª—É—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –∏ –Ω–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.

___

### **–û—Å–Ω–æ–≤–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ Apache Drill:**

1.  **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö:**
    
    -   Hadoop (HDFS)
        
    -   Amazon S3
        
    -   MongoDB
        
    -   Elasticsearch
        
    -   Apache Hive
        
    -   RDBMS (PostgreSQL, MySQL)
        
    -   –õ–æ–∫–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª–æ–≤—ã–µ —Å–∏—Å—Ç–µ–º—ã (JSON, Parquet, CSV, TSV, Avro)
        
2.  **–°—Ö–µ–º–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ (Schema-on-Read):**
    
    -   –ù–µ —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ö–µ–º—ã –¥–∞–Ω–Ω—ã—Ö.
        
    -   –°—Ö–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞.
        
3.  **–í—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
    
    -   –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞.
        
    -   –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–ª–æ–Ω–æ—á–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã (Parquet) –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏.
        
4.  **SQL-–∑–∞–ø—Ä–æ—Å—ã:**
    
    -   –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ SQL (ANSI SQL 2003).
        
    -   –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ–ª—É—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
        
5.  **–õ–µ–≥–∫–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**
    
    -   –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ JDBC/ODBC.
        
    -   –õ–µ–≥–∫–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å BI-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ (Tableau, Power BI).
        
6.  **–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ:**
    
    -   –õ–µ–≥–∫–æ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –∑–∞ —Å—á–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –Ω–æ–¥.
        

___

### **–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã Apache Drill:**

-   **Drillbit:** –£–∑–µ–ª, –∫–æ—Ç–æ—Ä—ã–π –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –≤—ã—á–∏—Å–ª–µ–Ω–∏—è.
    
-   **Zookeeper:** –ö–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç —É–∑–ª—ã Drill –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ.
    
-   **Web UI:** –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤.
    
-   **Storage Plugin:** –ü–ª–∞–≥–∏–Ω—ã –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Ä–∞–∑–ª–∏—á–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º –¥–∞–Ω–Ω—ã—Ö.
    

___

### **–ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏:**

**–§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**

```
<div><p>kotlin</p><p><code><span><span><span>data</span></span><span>/
‚îî‚îÄ‚îÄ customers.json
</span></span></code></p></div>
```

**–ü—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞ `customers.json`:**

```
<div><p>json</p><p><code id="code-lang-json"><span><span><span>{</span></span><span>
    </span><span><span>"id"</span></span><span><span>:</span></span><span> </span><span><span>1</span></span><span><span>,</span></span><span>
    </span><span><span>"name"</span></span><span><span>:</span></span><span> </span><span><span>"Alice"</span></span><span><span>,</span></span><span>
    </span><span><span>"age"</span></span><span><span>:</span></span><span> </span><span><span>30</span></span><span><span>,</span></span><span>
    </span><span><span>"orders"</span></span><span><span>:</span></span><span> </span><span><span>[</span></span><span>
        </span><span><span>{</span></span><span><span>"id"</span></span><span><span>:</span></span><span> </span><span><span>101</span></span><span><span>,</span></span><span> </span><span><span>"amount"</span></span><span><span>:</span></span><span> </span><span><span>250.5</span></span><span><span>}</span></span><span><span>,</span></span><span>
        </span><span><span>{</span></span><span><span>"id"</span></span><span><span>:</span></span><span> </span><span><span>102</span></span><span><span>,</span></span><span> </span><span><span>"amount"</span></span><span><span>:</span></span><span> </span><span><span>120.0</span></span><span><span>}</span></span><span>
    </span><span><span>]</span></span><span>
</span><span><span>}</span></span><span>
</span></span></code></p></div>
```

___

### **–ü—Ä–∏–º–µ—Ä SQL-–∑–∞–ø—Ä–æ—Å–∞:**

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span><span>SELECT</span></span><span> 
  id, 
  name, 
  age, 
  </span><span><span>SUM</span></span><span>(orders.amount) </span><span><span>AS</span></span><span> total_spent
</span><span><span>FROM</span></span><span> dfs.`</span><span><span>/</span></span><span>data</span><span><span>/</span></span><span>customers.json`
</span><span><span>GROUP</span></span><span> </span><span><span>BY</span></span><span> id, name, age
</span><span><span>ORDER</span></span><span> </span><span><span>BY</span></span><span> total_spent </span><span><span>DESC</span></span><span>;
</span></span></code></p></div>
```

___

### **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Apache Drill:**

-   –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ—Å—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö
    
-   –í—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–∞ –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–∞—Ö –¥–∞–Ω–Ω—ã—Ö
    
-   –ü—Ä–æ—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, –Ω–µ —Ç—Ä–µ–±—É–µ—Ç —Å–ª–æ–∂–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    
-   –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ SQL
    
-   –ù–µ —Ç—Ä–µ–±—É–µ—Ç —Å—Ö–µ–º—ã –¥–∞–Ω–Ω—ã—Ö –∑–∞—Ä–∞–Ω–µ–µ
    

### **–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏ Apache Drill:**

-   –í—ã—Å–æ–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø–∞–º—è—Ç–∏
    
-   –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
    
-   –ú–µ–Ω—å—à–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å Druid
    

___

### **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫ Apache Drill:**

1.  **–°–∫–∞—á–∞–π Drill:**
    

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>curl -O https://archive.apache.org/dist/drill/drill-1.21.1/apache-drill-1.21.1.tar.gz
tar -xzf apache-drill-1.21.1.tar.gz
</span><span><span>cd</span></span><span> apache-drill-1.21.1
</span></span></code></p></div>
```

2.  **–ó–∞–ø—É—Å–∫:**
    

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>bin/drillbit.sh start
</span></span></code></p></div>
```

3.  **–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:**
    

-   –î–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: [http://localhost:8047](http://localhost:8047/)
    

___

–•–æ—á–µ—à—å –ø–æ–∫–∞–∑–∞—Ç—å, –∫–∞–∫ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å Apache Drill —Å Airflow –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö? üòä

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

###### ChatGPT —Å–∫–∞–∑–∞–ª:

### **HDFS (Hadoop Distributed File System)**

**HDFS** ‚Äî —ç—Ç–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–∞—è —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞, —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –∫–ª–∞—Å—Ç–µ—Ä–µ –æ–±—ã—á–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤. –Ø–≤–ª—è–µ—Ç—Å—è –æ—Å–Ω–æ–≤–Ω—ã–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–º —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã **Hadoop** –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤.

___

#### **–û—Å–Ω–æ–≤–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ HDFS:**

1.  **–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ:**
    
    -   –î–∞–Ω–Ω—ã–µ —Ä–∞–∑–±–∏–≤–∞—é—Ç—Å—è –Ω–∞ –±–ª–æ–∫–∏ –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –ø–æ –º–Ω–æ–∂–µ—Å—Ç–≤—É —É–∑–ª–æ–≤ (–Ω–æ–¥).
        
    -   –û–±—ã—á–Ω–æ –±–ª–æ–∫–∏ –∏–º–µ—é—Ç —Ä–∞–∑–º–µ—Ä 128 –∏–ª–∏ 256 –ú–ë.
        
2.  **–ò–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç—å:**
    
    -   –î–∞–Ω–Ω—ã–µ –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ (–æ–±—ã—á–Ω–æ 3 –∫–æ–ø–∏–∏ –∫–∞–∂–¥–æ–≥–æ –±–ª–æ–∫–∞).
        
    -   –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å–±–æ—è—Ö.
        
3.  **–í—ã—Å–æ–∫–∞—è –ø—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å:**
    
    -   –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ —á—Ç–µ–Ω–∏—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤.
        
    -   –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ —á—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å.
        
4.  **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:**
    
    -   –õ–µ–≥–∫–æ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ –∑–∞ —Å—á–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –Ω–æ–¥.
        
5.  **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:**
    
    -   –ó–∞—â–∏—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ—Ç —Å–±–æ–µ–≤ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è –∏ —Å–µ—Ç–µ–≤—ã—Ö –ø—Ä–æ–±–ª–µ–º.
        

___

#### **–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã HDFS:**

-   **NameNode:**
    
    -   –ì–ª–∞–≤–Ω—ã–π —Å–µ—Ä–≤–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π —É–ø—Ä–∞–≤–ª—è–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã.
        
    -   –û—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é —Ñ–∞–π–ª–æ–≤ –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞.
        
-   **DataNode:**
    
    -   –£–∑–ª—ã, –Ω–∞ –∫–æ—Ç–æ—Ä—ã—Ö —Ñ–∏–∑–∏—á–µ—Å–∫–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –±–ª–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö.
        
    -   –û–±–º–µ–Ω–∏–≤–∞—é—Ç—Å—è –¥–∞–Ω–Ω—ã–º–∏ —Å NameNode –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π.
        
-   **Secondary NameNode:**
    
    -   –°–æ–∑–¥–∞–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ —Ç–æ—á–∫–∏ –¥–ª—è NameNode, —Å–Ω–∏–∂–∞—è —Ä–∏—Å–∫ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö.
        

___

#### **–ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ö—Ä–∞–Ω–µ–Ω–∏—è:**

```
<div><p>mathematica</p><p><code><span><span><span>/</span></span><span><span>user</span></span><span><span>/</span></span><span><span>data</span></span><span><span>/</span></span><span>
‚îú‚îÄ‚îÄ </span><span><span>sales_data</span></span><span><span>.</span></span><span><span>csv</span></span><span> </span><span><span>(</span></span><span>—Ä–∞–∑–¥–µ–ª–µ–Ω–æ –Ω–∞ –±–ª–æ–∫–∏</span><span><span>)</span></span><span>
‚îÇ   ‚îú‚îÄ‚îÄ –±–ª–æ–∫ </span><span><span>1</span></span><span> </span><span><span>(</span></span><span>—É–∑–µ–ª </span><span><span>A</span></span><span><span>,</span></span><span> —É–∑–µ–ª </span><span><span>B</span></span><span><span>,</span></span><span> —É–∑–µ–ª </span><span><span>C</span></span><span><span>)</span></span><span>
‚îÇ   ‚îî‚îÄ‚îÄ –±–ª–æ–∫ </span><span><span>2</span></span><span> </span><span><span>(</span></span><span>—É–∑–µ–ª </span><span><span>B</span></span><span><span>,</span></span><span> —É–∑–µ–ª </span><span><span>C</span></span><span><span>,</span></span><span> —É–∑–µ–ª </span><span><span>D</span></span><span><span>)</span></span><span>
‚îî‚îÄ‚îÄ </span><span><span>customer_data</span></span><span><span>.</span></span><span><span>csv</span></span><span> </span><span><span>(</span></span><span>—Ä–∞–∑–¥–µ–ª–µ–Ω–æ –Ω–∞ –±–ª–æ–∫–∏</span><span><span>)</span></span><span>
    ‚îú‚îÄ‚îÄ –±–ª–æ–∫ </span><span><span>1</span></span><span> </span><span><span>(</span></span><span>—É–∑–µ–ª </span><span><span>A</span></span><span><span>,</span></span><span> —É–∑–µ–ª </span><span><span>D</span></span><span><span>,</span></span><span> —É–∑–µ–ª </span><span><span>E</span></span><span><span>)</span></span><span>
    ‚îî‚îÄ‚îÄ –±–ª–æ–∫ </span><span><span>2</span></span><span> </span><span><span>(</span></span><span>—É–∑–µ–ª </span><span><span>C</span></span><span><span>,</span></span><span> —É–∑–µ–ª </span><span><span>E</span></span><span><span>,</span></span><span> —É–∑–µ–ª </span><span><span>F</span></span><span><span>)</span></span><span>
</span></span></code></p></div>
```

___

### **Hadoop**

**Hadoop** ‚Äî —ç—Ç–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö, —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è –¥–ª—è —Ä–∞–±–æ—Ç—ã –Ω–∞ –Ω–µ–¥–æ—Ä–æ–≥–∏—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö. –í–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è HDFS –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏ MapReduce –¥–ª—è –∏—Ö –æ–±—Ä–∞–±–æ—Ç–∫–∏.

___

#### **–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã Hadoop:**

1.  **HDFS:**
    
    -   –§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö.
        
2.  **MapReduce:**
    
    -   –ú–æ–¥–µ–ª—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö.
        
    -   –î–µ–ª–∏—Ç –∑–∞–¥–∞—á—É –Ω–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–æ –ø–æ–¥–∑–∞–¥–∞—á, –∫–æ—Ç–æ—Ä—ã–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ.
        
3.  **YARN (Yet Another Resource Negotiator):**
    
    -   –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–∞–º–∏, –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É—é—â–∞—è –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏.
        
    -   –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∏ –ø–æ–≤–µ—Ä—Ö HDFS.
        
4.  **Hadoop Common:**
    
    -   –ù–∞–±–æ—Ä –æ–±—â–∏—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –∏ –±–∏–±–ª–∏–æ—Ç–µ–∫ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Hadoop.
        

___

#### **–ü—Ä–∏–º–µ—Ä –ø—Ä–æ—Å—Ç–æ–≥–æ MapReduce:**

1.  **Map (–ö–∞—Ä—Ç–∞)** ‚Äî –¥–µ–ª–∏—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ —á–∞—Å—Ç–∏ –∏ —Å–æ–∑–¥–∞–µ—Ç –ø–∞—Ä—ã –∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ.
    
2.  **Reduce (–°–æ–∫—Ä–∞—â–µ–Ω–∏–µ)** ‚Äî –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –Ω–∞ —ç—Ç–∞–ø–µ Map.
    

___

#### **–ü–ª—é—Å—ã Hadoop:**

-   –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
    
-   –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å
    
-   –í—ã—Å–æ–∫–∞—è –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å
    
-   –ì–∏–±–∫–æ—Å—Ç—å –≤ —Ä–∞–±–æ—Ç–µ —Å –±–æ–ª—å—à–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏
    

#### **–ú–∏–Ω—É—Å—ã Hadoop:**

-   –í—ã—Å–æ–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø–∞–º—è—Ç–∏
    
-   –í—ã—Å–æ–∫–∏–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –Ω–µ–±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
    
-   –°–ª–æ–∂–Ω–æ–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
    

___

–•–æ—á–µ—à—å –ø–æ–∫–∞–∑–∞—Ç—å, –∫–∞–∫ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å HDFS —Å Apache Drill –∏–ª–∏ Druid –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏? –ò–ª–∏, –º–æ–∂–µ—Ç, –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ—Ç–æ–∫–æ–≤—É—é –∑–∞–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö —Å –ø–æ–º–æ—â—å—é Airflow? üòä

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

—á—Ç–æ –µ—â—ë –≤—Ö–æ–¥–∏—Ç –≤ —ç–∫–æ—Å–∏—Å—Ç–µ–º—É Hadoop

###### ChatGPT —Å–∫–∞–∑–∞–ª:

### **–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã Hadoop:**

–≠–∫–æ—Å–∏—Å—Ç–µ–º–∞ **Hadoop** –≤–∫–ª—é—á–∞–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è, –æ–±—Ä–∞–±–æ—Ç–∫–∏, –∞–Ω–∞–ª–∏–∑–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–æ–ª—å—à–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏. –í–æ—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –∏—Ö –∫–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

___

#### **1\. –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö:**

-   **HDFS (Hadoop Distributed File System)** ‚Äî —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–∞—è —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö.
    
-   **HBase** ‚Äî —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–∞—è NoSQL-–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö, —Ä–∞–±–æ—Ç–∞—é—â–∞—è –ø–æ–≤–µ—Ä—Ö HDFS. –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü.
    
-   **Hive** ‚Äî —Å–∏—Å—Ç–µ–º–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å SQL-–ø–æ–¥–æ–±–Ω—ã–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç HDFS –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ MapReduce –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏.
    
-   **HCatalog** ‚Äî —Å–µ—Ä–≤–∏—Å –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º –≤ Hive.
    

___

#### **2\. –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö:**

-   **MapReduce** ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è –º–æ–¥–µ–ª—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö.
    
-   **YARN (Yet Another Resource Negotiator)** ‚Äî —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–∞–º–∏, –∏—Å–ø–æ–ª—å–∑—É–µ–º–∞—è –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á.
    
-   **Tez** ‚Äî —É–ª—É—á—à–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è MapReduce –¥–ª—è –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã—Ö DAG –≤—ã—á–∏—Å–ª–µ–Ω–∏–π.
    
-   **Spark** ‚Äî –±—ã—Å—Ç—Ä—ã–π —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –¥–≤–∏–∂–æ–∫ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ –ø–∞–º—è—Ç–∏.
    
-   **Flink** ‚Äî –ø–æ—Ç–æ–∫–æ–≤—ã–π –¥–≤–∏–∂–æ–∫ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.
    
-   **Storm** ‚Äî —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –ø–æ—Ç–æ–∫–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.
    

___

#### **3\. –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞:**

-   **Drill** ‚Äî SQL-–¥–≤–∏–∂–æ–∫ –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö.
    
-   **Presto** ‚Äî –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π SQL-–¥–≤–∏–∂–æ–∫ –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
    
-   **Impala** ‚Äî MPP SQL-–¥–≤–∏–∂–æ–∫ –¥–ª—è Hadoop, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏.
    
-   **Phoenix** ‚Äî SQL-–¥–≤–∏–∂–æ–∫ –ø–æ–≤–µ—Ä—Ö HBase.
    

___

#### **4\. –ü–æ—Ç–æ–∫–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö:**

-   **Kafka** ‚Äî —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –ø–æ—Ç–æ–∫–æ–≤–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ —Å–æ–æ–±—â–µ–Ω–∏–π.
    
-   **Flume** ‚Äî —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è —Å–±–æ—Ä–∞ –∏ –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö –≤ HDFS.
    
-   **Nifi** ‚Äî –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –ø–æ—Ç–æ–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —Å–∏—Å—Ç–µ–º–∞–º–∏.
    
-   **Samza** ‚Äî —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –ø–æ—Ç–æ–∫–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π, –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å Kafka.
    

___

#### **5\. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏:**

-   **Oozie** ‚Äî –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —Ä–∞–±–æ—á–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –¥–ª—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏ –∑–∞–¥–∞–Ω–∏–π MapReduce, Pig, Hive –∏ –¥—Ä—É–≥–∏—Ö.
    
-   **Airflow** ‚Äî –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è, –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –¥–∞–Ω–Ω—ã—Ö.
    
-   **Zookeeper** ‚Äî –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏.
    

___

#### **6\. –ú–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ:**

-   **Mahout** ‚Äî –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π.
    
-   **H2O.ai** ‚Äî –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Hadoop.
    
-   **MLlib (Spark)** ‚Äî –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –¥–ª—è Apache Spark.
    

___

#### **7\. –ü–æ–∏—Å–∫ –∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è:**

-   **Solr** ‚Äî –ø–æ–∏—Å–∫–æ–≤—ã–π –¥–≤–∏–∂–æ–∫, –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –Ω–∞ –æ—Å–Ω–æ–≤–µ Apache Lucene.
    
-   **Elasticsearch** ‚Äî —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–∞—è –ø–æ–∏—Å–∫–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π JSON API.
    

___

#### **8\. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**

-   **Ranger** ‚Äî —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª–∏—Ç–∏–∫–∞–º–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤ Hadoop.
    
-   **Knox** ‚Äî —à–ª—é–∑ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ Hadoop-—Å–µ—Ä–≤–∏—Å–∞–º.
    
-   **Sentry** ‚Äî —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º.
    

___

#### **9\. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**

-   **Ambari** ‚Äî –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–∞–º–∏ Hadoop.
    
-   **Ganglia** ‚Äî —Å–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤.
    
-   **Grafana + Prometheus** ‚Äî –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫.
    

___

#### **10\. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏ —Ä–∞–±–æ—Ç–∞ —Å –≤–Ω–µ—à–Ω–∏–º–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö:**

-   **Sqoop** ‚Äî –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –∏ —ç–∫—Å–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É Hadoop –∏ —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã–º–∏ –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö.
    
-   **Nifi** ‚Äî –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –ø–æ—Ç–æ–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö.
    
-   **Azakaban** ‚Äî –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–±–æ—á–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤.
    

___

–•–æ—á–µ—à—å, —è –ø–æ–∫–∞–∂—É, –∫–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å Airflow –∫ —Ç–≤–æ–µ–º—É –∫–ª–∞—Å—Ç–µ—Ä—É Hadoop –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö? –ò–ª–∏, –º–æ–∂–µ—Ç, –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é HDFS —Å Apache Drill? üòä

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

—á—Ç–æ —Ç–∞–∫–æ–µ customer support L2 L3

###### ChatGPT —Å–∫–∞–∑–∞–ª:

### **–ß—Ç–æ —Ç–∞–∫–æ–µ Customer Support L2 –∏ L3?**

–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ (Customer Support) –æ–±—ã—á–Ω–æ –¥–µ–ª–∏—Ç—Å—è –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —É—Ä–æ–≤–Ω–µ–π (tiers), —á—Ç–æ–±—ã —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—Ç—å –∑–∞–¥–∞—á–∏ –∏ —É–ª—É—á—à–∞—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è. **L2 (Level 2)** –∏ **L3 (Level 3)** ‚Äî —ç—Ç–æ –±–æ–ª–µ–µ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —É—Ä–æ–≤–Ω–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è, –∫–æ–≥–¥–∞ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–µ—à–µ–Ω–∞ –Ω–∞ –±–∞–∑–æ–≤–æ–º —É—Ä–æ–≤–Ω–µ (L1).

___

#### **–û—Å–Ω–æ–≤–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏:**

1.  **L1 (Level 1) ‚Äî –ë–∞–∑–æ–≤–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞:**
    
    -   –û—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –ø—Ä–æ—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã (–ø–∞—Ä–æ–ª—å, –¥–æ—Å—Ç—É–ø, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏).
        
    -   –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–∏–∫–µ—Ç—ã, —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç —Å–ª–æ–∂–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ L2/L3.
        
    -   –û–±—ã—á–Ω–æ –ø–µ—Ä–≤—ã–π –∫–æ–Ω—Ç–∞–∫—Ç —Å –∫–ª–∏–µ–Ω—Ç–æ–º.
        
2.  **L2 (Level 2) ‚Äî –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞:**
    
    -   –†–∞–±–æ—Ç–∞–µ—Ç —Å –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–º–∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–º–∏ –ø—Ä–æ–±–ª–µ–º–∞–º–∏.
        
    -   –¢—Ä–µ–±—É–µ—Ç –≥–ª—É–±–æ–∫–∏—Ö –∑–Ω–∞–Ω–∏–π –æ –ø—Ä–æ–¥—É–∫—Ç–µ –∏ —Å–∏—Å—Ç–µ–º–∞—Ö.
        
    -   –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ª–æ–≥–∏, –ø—Ä–æ–≤–æ–¥–∏—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É, –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç –æ—à–∏–±–∫–∏.
        
    -   –ú–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è –∏–ª–∏ –æ–±—Ö–æ–¥–Ω—ã–µ –ø—É—Ç–∏.
        
3.  **L3 (Level 3) ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —ç–∫—Å–ø–µ—Ä—Ç–æ–≤:**
    
    -   –°–∞–º—ã–π –≤—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –ø–æ–¥–¥–µ—Ä–∂–∫–∏.
        
    -   –ß–∞—Å—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∏–ª–∏ –∏–Ω–∂–µ–Ω–µ—Ä–æ–≤ —Å –≥–ª—É–±–æ–∫–∏–º –∑–Ω–∞–Ω–∏–µ–º –∫–æ–¥–∞.
        
    -   –ò—Å–ø—Ä–∞–≤–ª—è–µ—Ç –æ—à–∏–±–∫–∏ –≤ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–º –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–∏, –≤–Ω–æ—Å–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥.
        
    -   –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞–¥ –ø–∞—Ç—á–∞–º–∏ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏.
        
    -   –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∫–æ—Ä–Ω–µ–≤—ã–µ –ø—Ä–∏—á–∏–Ω—ã (root cause analysis) –∏ —É—Å—Ç—Ä–∞–Ω—è–µ—Ç –∏—Ö.
        

___

#### **–ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã L2 –∏ L3:**

üõ†Ô∏è **–°—Ü–µ–Ω–∞—Ä–∏–π 1:** –ö–ª–∏–µ–Ω—Ç –∂–∞–ª—É–µ—Ç—Å—è –Ω–∞ –º–µ–¥–ª–µ–Ω–Ω—É—é —Ä–∞–±–æ—Ç—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

-   **L1:** –ü—Ä–æ–≤–µ—Ä–∏—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–ª–∏–µ–Ω—Ç–∞, –æ—á–∏—Å—Ç–∏—Ç –∫–µ—à, –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç —Å–µ—Ä–≤–µ—Ä.
    
-   **L2:** –ü—Ä–æ–≤–µ—Ä–∏—Ç –ª–æ–≥–∏, –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –ø—Ä–æ–≤–µ—Ä–∏—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.
    
-   **L3:** –ù–∞–π–¥–µ—Ç –ø—Ä–æ–±–ª–µ–º—É –≤ –∫–æ–¥–µ, –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã, —Å–æ–∑–¥–∞—Å—Ç –ø–∞—Ç—á –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–∫–∏.
    

___

üõ†Ô∏è **–°—Ü–µ–Ω–∞—Ä–∏–π 2:** –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –≤–Ω–µ—à–Ω–∏–º API.

-   **L1:** –£–±–µ–¥–∏—Ç—Å—è, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.
    
-   **L2:** –ü—Ä–æ–≤–µ—Ä–∏—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ API, –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∏ —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö.
    
-   **L3:** –ò—Å–ø—Ä–∞–≤–∏—Ç –ø—Ä–æ–±–ª–µ–º—É –≤ –∫–æ–¥–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –¥–æ–±–∞–≤–∏—Ç –ø—Ä–æ–≤–µ—Ä–∫—É –æ—à–∏–±–æ–∫ –∏ –æ–±—Ä–∞–±–æ—Ç–∫—É –∏—Å–∫–ª—é—á–µ–Ω–∏–π.
    

___

#### **–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –Ω–∞–≤—ã–∫–∞–º:**

-   **L2:**
    
    -   –ì–ª—É–±–æ–∫–∏–µ –∑–Ω–∞–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞
        
    -   –£–º–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –ª–æ–≥–∞–º–∏ –∏ –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö
        
    -   –ù–∞–≤—ã–∫–∏ –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        
    -   –ü–æ–Ω–∏–º–∞–Ω–∏–µ —Å–µ—Ç–µ–≤—ã—Ö –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ –∏ API
        
-   **L3:**
    
    -   –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏ –æ—Ç–ª–∞–¥–∫–∞ –∫–æ–¥–∞
        
    -   –ü–æ–Ω–∏–º–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
        
    -   –ù–∞–≤—ã–∫–∏ –ø–æ–∏—Å–∫–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–æ–∫ (bug fixing)
        
    -   –ó–Ω–∞–Ω–∏–µ CI/CD –∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ DevOps
        

___

–•–æ—á–µ—à—å –ø–æ–∫–∞–∑–∞—Ç—å, –∫–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, —á—Ç–æ–±—ã —É–ø—Ä–æ—Å—Ç–∏—Ç—å –∂–∏–∑–Ω—å L2/L3 –∫–æ–º–∞–Ω–¥–∞–º –≤ —Ç–≤–æ–µ–º –ø—Ä–æ–µ–∫—Ç–µ FastAPI? üòä

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

###### ChatGPT —Å–∫–∞–∑–∞–ª:

**StatsD** ‚Äî —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ–π, –ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π –¥–µ–º–æ–Ω –¥–ª—è —Å–±–æ—Ä–∞ –∏ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –º–µ—Ç—Ä–∏–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏. –û–±—ã—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–æ–≤, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –∏ —Å–µ—Ä–≤–∏—Å–æ–≤. –û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è StatsD ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –ø–æ UDP, —á—Ç–æ –º–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.

___

### **–û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ StatsD:**

1.  **–°–±–æ—Ä –º–µ—Ç—Ä–∏–∫:**
    
    -   –°—á–µ—Ç—á–∏–∫–∏ (Counters)
        
    -   –¢–∞–π–º–µ—Ä—ã (Timers)
        
    -   –ì–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã (Histograms)
        
    -   –£—Ä–æ–≤–Ω–∏ (Gauges)
        
    -   –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (Sets)
        
2.  **–ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö:**
    
    -   –ü–æ–¥—Å—á–µ—Ç —Å—Ä–µ–¥–Ω–µ–≥–æ, –º–µ–¥–∏–∞–Ω—ã, 95-–≥–æ –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª—è –∏ –¥—Ä—É–≥–∏—Ö —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫.
        
    -   –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –∑–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã.
        
3.  **–õ–µ–≥–∫–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**
    
    -   –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ —è–∑—ã–∫–æ–≤ (Python, Node.js, Java, Go, Ruby).
        
    -   –ß–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å **Graphite**, **Prometheus**, **InfluxDB** –∏–ª–∏ **Datadog** –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö.
        
4.  **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö:**
    
    -   –ò—Å–ø–æ–ª—å–∑—É–µ—Ç UDP –∏–ª–∏ TCP, —á—Ç–æ —Å–Ω–∏–∂–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.
        
5.  **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:**
    
    -   –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º.
        

___

### **–ü—Ä–∏–º–µ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã StatsD:**

```
<div><p>lua</p><p><code><span><span>+</span><span><span>-----------+        +-----------+        +------------+</span></span><span>
|   App </span><span><span>1</span></span><span>   |  </span><span><span>---&gt;  |  StatsD   |  ---&gt;  |   Graphite |</span></span><span>
+</span><span><span>-----------+        +-----------+        +------------+</span></span><span>
|   App </span><span><span>2</span></span><span>   |  </span><span><span>---&gt;                     ---&gt;   Grafana  |</span></span><span>
+</span><span><span>-----------+                            +------------+</span></span><span>
</span></span></code></p></div>
```

___

### **–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å Python:**

–£—Å—Ç–∞–Ω–æ–≤–∏–º –±–∏–±–ª–∏–æ—Ç–µ–∫—É:

**–ü—Ä–∏–º–µ—Ä –æ—Ç–ø—Ä–∞–≤–∫–∏ –º–µ—Ç—Ä–∏–∫:**

```
<div><p>python</p><p><code id="code-lang-python"><span><span><span>import</span></span><span> time
</span><span><span>import</span></span><span> statsd

</span><span><span># –°–æ–∑–¥–∞–µ–º –∫–ª–∏–µ–Ω—Ç–∞ StatsD</span></span><span>
client = statsd.StatsClient(</span><span><span>'localhost'</span></span><span>, </span><span><span>8125</span></span><span>)

</span><span><span># –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫</span></span><span>
client.incr(</span><span><span>'myapp.requests'</span></span><span>)

</span><span><span># –ò–∑–º–µ—Ä—è–µ–º –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏</span></span><span>
start_time = time.time()
</span><span><span># –°–∏–º—É–ª—è—Ü–∏—è –∑–∞–¥–∞—á–∏</span></span><span>
time.sleep(</span><span><span>0.5</span></span><span>)
elapsed_time = time.time() - start_time
client.timing(</span><span><span>'myapp.response_time'</span></span><span>, elapsed_time * </span><span><span>1000</span></span><span>)
</span></span></code></p></div>
```

___

### **–§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏–π StatsD:**

–§–æ—Ä–º–∞—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö:

```
<div><p>bash</p><p><code><span><span>metric_name:value|</span><span><span>type</span></span><span>
</span></span></code></p></div>
```

–ü—Ä–∏–º–µ—Ä—ã:

-   **–°—á–µ—Ç—á–∏–∫:** `myapp.requests:1|c`
    
-   **–¢–∞–π–º–µ—Ä:** `myapp.response_time:250|ms`
    
-   **–ì–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞:** `myapp.latency:30|h`
    
-   **–£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:** `myapp.users:123|s`
    
-   **–ì–µ–π–¥–∂:** `myapp.active_users:150|g`
    

___

### **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å FastAPI:**

–ß—Ç–æ–±—ã –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å StatsD —Å FastAPI, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å middleware:

```
<div><p>python</p><p><code id="code-lang-python"><span><span><span>from</span></span><span> fastapi </span><span><span>import</span></span><span> FastAPI, Request
</span><span><span>import</span></span><span> statsd
</span><span><span>import</span></span><span> time

app = FastAPI()
client = statsd.StatsClient(</span><span><span>'localhost'</span></span><span>, </span><span><span>8125</span></span><span>)

</span><span><span>@app.middleware(<span><span>"http"</span></span></span></span><span>)
</span><span><span>async</span></span><span> </span><span><span>def</span></span><span> </span><span><span>add_statsd_metrics</span></span><span>(</span><span><span>request: Request, call_next</span></span><span>):
    start_time = time.time()
    response = </span><span><span>await</span></span><span> call_next(request)
    elapsed_time = (time.time() - start_time) * </span><span><span>1000</span></span><span>
    
    </span><span><span># –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –º–µ—Ç—Ä–∏–∫–∏</span></span><span>
    client.incr(</span><span><span>'fastapi.requests'</span></span><span>)
    client.timing(</span><span><span>'fastapi.response_time'</span></span><span>, elapsed_time)
    
    </span><span><span>return</span></span><span> response

</span><span><span>@app.get(<span><span>"/"</span></span></span></span><span>)
</span><span><span>async</span></span><span> </span><span><span>def</span></span><span> </span><span><span>read_root</span></span><span>():
    </span><span><span>return</span></span><span> {</span><span><span>"message"</span></span><span>: </span><span><span>"Hello, StatsD!"</span></span><span>}
</span></span></code></p></div>
```

___

### **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ StatsD:**

-   –õ–µ–≥–∫–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    
-   –í—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
    
-   –ü—Ä–æ—Å—Ç–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
    
-   –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ —è–∑—ã–∫–æ–≤
    

### **–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏ StatsD:**

-   –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö
    
-   –ù–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö (–Ω—É–∂–µ–Ω –≤–Ω–µ—à–Ω–∏–π backend)
    
-   –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ UDP –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø–æ—Ç–µ—Ä–µ –ø–∞–∫–µ—Ç–æ–≤
    

___

–•–æ—á–µ—à—å, —è –ø–æ–∫–∞–∂—É, –∫–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å StatsD –∫ —Ç–≤–æ–µ–º—É –ø—Ä–æ–µ–∫—Ç—É FastAPI —Å Docker –∏ Prometheus –¥–ª—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞? üòä

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

—á—Ç–æ —Ç–∞–∫–æ–µ dbt –∏ –≤ —á—ë–º –æ—Ç–ª–∏—á–∏–µ –æ—Ç Apache Drill

###### ChatGPT —Å–∫–∞–∑–∞–ª:

### **–ß—Ç–æ —Ç–∞–∫–æ–µ dbt (Data Build Tool)?**

**dbt** (Data Build Tool) ‚Äî —ç—Ç–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞—Ö –¥–∞–Ω–Ω—ã—Ö (Data Warehouses), —Ç–∞–∫–∏—Ö –∫–∞–∫ **Snowflake**, **BigQuery**, **Redshift** –∏–ª–∏ **ClickHouse**, –∏—Å–ø–æ–ª—å–∑—É—è SQL –∏ Jinja.

___

#### **–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ dbt:**

1.  **–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö:**
    
    -   –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º SQL.
        
    -   –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Jinja-—à–∞–±–ª–æ–Ω—ã –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö SQL-–∑–∞–ø—Ä–æ—Å–æ–≤.
        
    -   –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–ª–æ–∂–Ω—ã—Ö –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫.
        
2.  **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏:**
    
    -   –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç—Ä–æ–∏—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É –º–æ–¥–µ–ª—è–º–∏ –¥–∞–Ω–Ω—ã—Ö.
        
    -   –°–æ–∑–¥–∞–µ—Ç DAG (Directed Acyclic Graph) –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.
        
3.  **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö:**
    
    -   –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–∞–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞ –ø—É—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è, —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å).
        
    -   –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–µ —Ç–µ—Å—Ç—ã.
        
4.  **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö:**
    
    -   –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.
        
    -   –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Å—Ö–µ–º –¥–∞–Ω–Ω—ã—Ö.
        
5.  **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –º–µ—Ç—Ä–∏–∫–∏:**
    
    -   –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (Snowflake, BigQuery).
        
    -   –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–æ–≤.
        

___

#### **–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã dbt:**

-   **Models:** SQL-—Ñ–∞–π–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.
    
-   **Seeds:** –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ CSV-—Ñ–∞–π–ª—ã, –∑–∞–≥—Ä—É–∂–∞–µ–º—ã–µ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.
    
-   **Snapshots:** –ò—Å—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π.
    
-   **Macros:** Jinja-—Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –±–ª–æ–∫–æ–≤ –∫–æ–¥–∞.
    
-   **Tests:** –ù–∞–±–æ—Ä –ø—Ä–æ–≤–µ—Ä–æ–∫ –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –∫–∞—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö.
    
-   **Documentation:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–æ –¥–∞–Ω–Ω—ã–º.
    

___

#### **–ü—Ä–∏–º–µ—Ä –ø—Ä–æ—Å—Ç–æ–≥–æ dbt-–ø—Ä–æ–µ–∫—Ç–∞:**

üìÅ **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞:**

```
<div><p>pgsql</p><p><code><span><span>my_project/
‚îú‚îÄ‚îÄ dbt_project.yml
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ customers.</span><span><span>sql</span></span><span>
‚îÇ   ‚îî‚îÄ‚îÄ sales.</span><span><span>sql</span></span><span>
‚îú‚îÄ‚îÄ seeds/
‚îÇ   ‚îî‚îÄ‚îÄ sample_data.csv
‚îî‚îÄ‚îÄ macros/
    ‚îî‚îÄ‚îÄ custom_macros.</span><span><span>sql</span></span><span>
</span></span></code></p></div>
```

üìÑ **models/customers.sql:**

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span><span>SELECT</span></span><span> 
  customer_id, 
  name, 
  email 
</span><span><span>FROM</span></span><span> raw.customers
</span><span><span>WHERE</span></span><span> active </span><span><span>=</span></span><span> </span><span><span>true</span></span><span>
</span></span></code></p></div>
```

üìÑ **dbt\_project.yml:**

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>name:</span></span><span> </span><span><span>my_project</span></span><span>
</span><span><span>version:</span></span><span> </span><span><span>1.0</span></span><span>
</span><span><span>profile:</span></span><span> </span><span><span>my_profile</span></span><span>
</span><span><span>models:</span></span><span>
  </span><span><span>my_project:</span></span><span>
    </span><span><span>+materialized:</span></span><span> </span><span><span>table</span></span><span>
</span></span></code></p></div>
```

___

#### **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ dbt:**

-   –ü—Ä–æ—Å—Ç–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è–º–∏ –¥–∞–Ω–Ω—ã—Ö
    
-   –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ DAG
    
-   –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–æ–¥—É–ª—å–Ω–æ—Å—Ç–∏ –∫–æ–¥–∞ —á–µ—Ä–µ–∑ Jinja
    
-   –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å CI/CD
    
-   –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
    

#### **–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏ dbt:**

-   –¢—Ä–µ–±—É–µ—Ç –∑–∞—Ä–∞–Ω–µ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π —Å—Ö–µ–º—ã –¥–∞–Ω–Ω—ã—Ö
    
-   –ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ –Ω–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –¥–∞–Ω–Ω—ã–º
    
-   –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–æ—Ç–æ–∫–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö
    

___

### **–ß–µ–º –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è dbt –æ—Ç Apache Drill?**

| **–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞** | **dbt** | **Apache Drill** |
| --- | --- | --- |
| **–¶–µ–ª—å** | –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö | –ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö |
| **–ü–æ–¥—Ö–æ–¥** | ETL/ELT | Schema-on-Read |
| **–¢–∏–ø –¥–∞–Ω–Ω—ã—Ö** | –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ | –ü–æ–ª—É—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏ –Ω–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ |
| **–ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö** | DWH (Snowflake, BigQuery) | HDFS, S3, MongoDB, JSON |
| **–°–∫–æ—Ä–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è** | –ó–∞–≤–∏—Å–∏—Ç –æ—Ç DWH | –í—ã—Å–æ–∫–∞—è (–∫–æ–ª–æ–Ω–æ—á–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ) |
| **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã** | –ù–µ—Ç | –î–∞ |
| **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö** | –î–∞ | –ù–µ—Ç |
| **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** | –ó–∞–≤–∏—Å–∏—Ç –æ—Ç DWH | –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è |
| **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ SQL** | –î–∞, —Å Jinja | –î–∞, ANSI SQL |

___

### **–û—Å–Ω–æ–≤–Ω—ã–µ –æ—Ç–ª–∏—á–∏—è:**

-   **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** dbt —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–≤–µ—Ä—Ö –≥–æ—Ç–æ–≤–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –¥–∞–Ω–Ω—ã—Ö, –∞ Drill —Å–∞–º —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º —Ö—Ä–∞–Ω–µ–Ω–∏–µ–º.
    
-   **–¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö:** dbt –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, Drill –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–ª–æ–∂–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã (JSON, Parquet).
    
-   **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:** dbt –±–æ–ª—å—à–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –ø–∞–∫–µ—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏, Drill –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.
    
-   **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** dbt –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é, Drill —ç—Ç–æ–≥–æ –Ω–µ –¥–µ–ª–∞–µ—Ç.
    

___

–•–æ—á–µ—à—å –ø–æ–∫–∞–∑–∞—Ç—å, –∫–∞–∫ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å dbt –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è Apache Drill –∏–ª–∏ ClickHouse? üòä

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–î–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ **dbt** –∏ **Apache Drill** –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –¥–≤–∞ –∫–ª—é—á–µ–≤—ã—Ö —à–∞–≥–∞:

1.  –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å –ø–æ–º–æ—â—å—é **dbt**.
    
2.  –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —ç—Ç–∏–º –¥–∞–Ω–Ω—ã–º –≤ **Apache Drill**.
    

___

### **üì¶ –®–∞–≥ 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å –ø–æ–º–æ—â—å—é dbt**

#### **1\. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ dbt:**

–ï—Å–ª–∏ —É —Ç–µ–±—è –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω **dbt**, —É—Å—Ç–∞–Ω–æ–≤–∏–º –µ–≥–æ:

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>pip install dbt-core dbt-postgres
</span></span></code></p></div>
```

___

#### **2\. –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ dbt –ø—Ä–æ–µ–∫—Ç–∞:**

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>dbt init my_dbt_project
</span><span><span>cd</span></span><span> my_dbt_project
</span></span></code></p></div>
```

___

#### **3\. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è dbt:**

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `~/.dbt/profiles.yml` —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, PostgreSQL, ClickHouse):

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>my_profile:</span></span><span>
  </span><span><span>outputs:</span></span><span>
    </span><span><span>dev:</span></span><span>
      </span><span><span>type:</span></span><span> </span><span><span>postgres</span></span><span>
      </span><span><span>host:</span></span><span> </span><span><span>localhost</span></span><span>
      </span><span><span>user:</span></span><span> </span><span><span>my_user</span></span><span>
      </span><span><span>password:</span></span><span> </span><span><span>my_password</span></span><span>
      </span><span><span>port:</span></span><span> </span><span><span>5432</span></span><span>
      </span><span><span>dbname:</span></span><span> </span><span><span>my_database</span></span><span>
      </span><span><span>schema:</span></span><span> </span><span><span>public</span></span><span>
      </span><span><span>threads:</span></span><span> </span><span><span>4</span></span><span>
  </span><span><span>target:</span></span><span> </span><span><span>dev</span></span><span>
</span></span></code></p></div>
```

___

#### **4\. –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π dbt:**

üìÅ **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞:**

```
<div><p>pgsql</p><p><code><span><span>my_dbt_project/
‚îú‚îÄ‚îÄ dbt_project.yml
‚îî‚îÄ‚îÄ models/
    ‚îú‚îÄ‚îÄ customers.</span><span><span>sql</span></span><span>
    ‚îî‚îÄ‚îÄ sales.</span><span><span>sql</span></span><span>
</span></span></code></p></div>
```

üìÑ **models/customers.sql:**

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span><span>SELECT</span></span><span> 
  customer_id, 
  name, 
  email 
</span><span><span>FROM</span></span><span> raw.customers
</span><span><span>WHERE</span></span><span> active </span><span><span>=</span></span><span> </span><span><span>true</span></span><span>
</span></span></code></p></div>
```

üìÑ **models/sales.sql:**

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span><span>SELECT</span></span><span> 
  s.sale_id, 
  s.amount, 
  c.name 
</span><span><span>FROM</span></span><span> raw.sales s
</span><span><span>JOIN</span></span><span> {{ </span><span><span>ref</span></span><span>(</span><span><span>'customers'</span></span><span>) }} c </span><span><span>ON</span></span><span> s.customer_id </span><span><span>=</span></span><span> c.customer_id
</span></span></code></p></div>
```

üìÑ **dbt\_project.yml:**

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>name:</span></span><span> </span><span><span>my_dbt_project</span></span><span>
</span><span><span>version:</span></span><span> </span><span><span>1.0</span></span><span>
</span><span><span>profile:</span></span><span> </span><span><span>my_profile</span></span><span>
</span><span><span>models:</span></span><span>
  </span><span><span>my_dbt_project:</span></span><span>
    </span><span><span>+materialized:</span></span><span> </span><span><span>table</span></span><span>
</span></span></code></p></div>
```

___

#### **5\. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π:**

___

#### **6\. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:**

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>dbt docs generate
dbt docs serve
</span></span></code></p></div>
```

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É `http://localhost:8000`.

___

### **üîó –®–∞–≥ 2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Apache Drill**

#### **1\. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ dbt –¥–∞–Ω–Ω—ã–º –≤ Apache Drill:**

–ï—Å–ª–∏ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ PostgreSQL, –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤ **Drill**.

üìÅ **–°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ PostgreSQL –≤ Drill:**

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>curl -X POST http://localhost:8047/storage/postgres.json -d <span>'{
  "type": "jdbc",
  "driver": "org.postgresql.Driver",
  "url": "jdbc:postgresql://localhost:5432/my_database",
  "username": "my_user",
  "password": "my_password",
  "enabled": true
}'</span>
</span></span></code></p></div>
```

___

#### **2\. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:**

–ü–µ—Ä–µ–π–¥–∏ –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Apache Drill (`http://localhost:8047`) –∏ –ø—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ PostgreSQL –∞–∫—Ç–∏–≤–Ω–æ.

___

#### **3\. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ Drill:**

–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ dbt –º–æ–¥–µ–ª–∏ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –≤ Drill. –ù–∞–ø—Ä–∏–º–µ—Ä:

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span><span>SELECT</span></span><span> 
  c.name, 
  </span><span><span>SUM</span></span><span>(s.amount) </span><span><span>AS</span></span><span> total_spent
</span><span><span>FROM</span></span><span> postgres.public.customers c
</span><span><span>JOIN</span></span><span> postgres.public.sales s </span><span><span>ON</span></span><span> c.customer_id </span><span><span>=</span></span><span> s.customer_id
</span><span><span>GROUP</span></span><span> </span><span><span>BY</span></span><span> c.name
</span><span><span>ORDER</span></span><span> </span><span><span>BY</span></span><span> total_spent </span><span><span>DESC</span></span><span>;
</span></span></code></p></div>
```

___

### **üîé –®–∞–≥ 3. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)**

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ, –º–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å Apache Drill –∫ Grafana –∏–ª–∏ –¥—Ä—É–≥–∏–º BI-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö.

___

–•–æ—á–µ—à—å —è –ø–æ–∫–∞–∂—É, –∫–∞–∫ –µ—â–µ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–µ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –≤ dbt —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Jinja –∏ –º–∞–∫—Ä–æ—Å–æ–≤? –ò–ª–∏, –º–æ–∂–µ—Ç, –¥–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ Prometheus –¥–ª—è —ç—Ç–æ–≥–æ —Å—Ç–µ–∫–∞? üòä

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–•–æ—Ä–æ—à–æ, –¥–∞–≤–∞–π –Ω–∞—á–Ω–µ–º —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π **dbt** –∏ –∑–∞—Ç–µ–º –ø–æ–¥–∫–ª—é—á–∏–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–ª—è —ç—Ç–æ–≥–æ —Å—Ç–µ–∫–∞. –Ø –ø–æ–¥–≥–æ—Ç–æ–≤–ª—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –¥–≤—É—Ö —á–∞—Å—Ç–µ–π:

1.  **–°–ª–æ–∂–Ω—ã–µ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Jinja –∏ –º–∞–∫—Ä–æ—Å–æ–≤ –≤ dbt.**
    
2.  **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ dbt –∏ Apache Drill —Å –ø–æ–º–æ—â—å—é Prometheus –∏ Grafana.**
    

–Ø –æ—Ñ–æ—Ä–º–ª—é —ç—Ç–æ –≤ –≤–∏–¥–µ –ø–æ–¥—Ä–æ–±–Ω–æ–≥–æ –≥–∞–π–¥–∞ –∏ –≤–µ—Ä–Ω—É—Å—å —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç. üëç  
–î–∞–π –∑–Ω–∞—Ç—å, –µ—Å–ª–∏ –µ—Å—Ç—å –∫–∞–∫–∏–µ-—Ç–æ —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ —Ç–∏–ø—ã –æ—Ç—á–µ—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —Ö–æ—á–µ—à—å —É–≤–∏–¥–µ—Ç—å). üòâ  
‚è≥ Give me a moment. I will update shortly. üëç

Dbt Advanced And Monitoring Guide

–Ø –¥–æ–±–∞–≤–∏–ª –ø–µ—Ä–≤—É—é —á–∞—Å—Ç—å —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏ **dbt** –≤ –¥–æ–∫—É–º–µ–Ω—Ç. –°–µ–π—á–∞—Å –¥–æ–±–∞–≤–ª—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –ø–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥—É **dbt** –∏ **Apache Drill** —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **Prometheus** –∏ **Grafana**. –î–∞–π –º–Ω–µ –µ—â–µ –Ω–µ–º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏. üòâ  
‚è≥ Give me a moment. I will update shortly. üëç

–Ø –¥–æ–±–∞–≤–∏–ª –≤—Ç–æ—Ä–æ–π —Ä–∞–∑–¥–µ–ª –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ **dbt** –∏ **Apache Drill** —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **Prometheus** –∏ **Grafana** –≤ –¥–æ–∫—É–º–µ–Ω—Ç. –¢–µ–ø–µ—Ä—å —Ç–∞–º –µ—Å—Ç—å:

1.  **–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ —Å Jinja –∏ –º–∞–∫—Ä–æ—Å–∞–º–∏ –¥–ª—è dbt.**
    
2.  **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å Prometheus –∏ Grafana.**
    

–•–æ—á–µ—à—å, —è –¥–æ–±–∞–≤–ª—é –ø—Ä–∏–º–µ—Ä—ã –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ –¥–ª—è –±–æ–ª–µ–µ –≥–ª—É–±–æ–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∞–ª–µ—Ä—Ç–æ–≤ –¥–ª—è Grafana? üòä

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

###### ChatGPT —Å–∫–∞–∑–∞–ª:

Dbt Advanced And Monitoring Guide

## –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ dbt –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å Prometheus –∏ Grafana

## –ß–∞—Å—Ç—å 1. –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ dbt —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Jinja –∏ –º–∞–∫—Ä–æ—Å–æ–≤

### 1\. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ dbt

–°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç:

dbt init my\_dbt\_project

cd my\_dbt\_project

–°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤ `~/.dbt/profiles.yml`:

my\_profile:

outputs:

dev:

type: postgres

host: localhost

user: my\_user

password: my\_password

port: 5432

dbname: my\_database

schema: public

threads: 4

target: dev

### 2\. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Jinja –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö SQL-–∑–∞–ø—Ä–æ—Å–æ–≤

–°–æ–∑–¥–∞–µ–º –º–æ–¥–µ–ª—å —Å Jinja –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ —Ñ–∏–ª—å—Ç—Ä–∞:

üìÑ **models/sales\_by\_month.sql**

WITH filtered\_sales AS (

SELECT \*,

EXTRACT(MONTH FROM sale\_date) AS sale\_month

FROM raw.sales

WHERE sale\_date \>= '{{ var("start\_date", "2025-01-01") }}'

)

SELECT

sale\_month,

COUNT(\*) AS sales\_count,

SUM(amount) AS total\_revenue

FROM filtered\_sales

GROUP BY sale\_month

ORDER BY sale\_month;

–ü–∞—Ä–∞–º–µ—Ç—Ä **start\_date** –º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É:

dbt run \--vars '{"start\_date": "2025-01-01"}'

### 3\. –°–æ–∑–¥–∞–Ω–∏–µ –º–∞–∫—Ä–æ—Å–æ–≤ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–≥–æ –∫–æ–¥–∞

üìÑ **macros/calculate\_growth.sql**

{% macro calculate\_growth(current, previous) %}

CASE

WHEN {{ previous }} \= 0 THEN NULL

ELSE ROUND(({{ current }} \- {{ previous }}) / {{ previous }} \* 100, 2)

END

{% endmacro %}

üìÑ **models/sales\_growth.sql**

SELECT

product\_id,

{{ calculate\_growth("current\_month\_sales", "previous\_month\_sales") }} AS growth\_rate

FROM sales\_data

WHERE month \= '2025-05'

### 4\. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–∞–Ω–Ω—ã—Ö

üìÑ **models/schema.yml**

version: 2

models:

\- name: sales\_by\_month

columns:

\- name: sale\_month

tests:

\- not\_null

\- unique

\- name: total\_revenue

tests:

\- not\_null

–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö:

### 5\. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

dbt docs generate

dbt docs serve

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É http://localhost:8000.

## –ß–∞—Å—Ç—å 2. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ dbt –∏ Apache Drill —Å Prometheus –∏ Grafana

### 1\. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Prometheus –∏ Grafana

–î–æ–±–∞–≤–ª—è–µ–º —Å–µ—Ä–≤–∏—Å—ã –≤ Docker Compose:

üìÑ **docker-compose.yml**

version: '3.7'

services:

prometheus:

image: prom/prometheus

volumes:

\- ./prometheus.yml:/etc/prometheus/prometheus.yml

ports:

\- '9090:9090'

grafana:

image: grafana/grafana

ports:

\- '3000:3000'

environment:

\- GF\_SECURITY\_ADMIN\_PASSWORD=admin

### 2\. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Prometheus

üìÑ **prometheus.yml**

global:

scrape\_interval: 15s

scrape\_configs:

\- job\_name: 'dbt'

static\_configs:

\- targets: \['localhost:8000'\]

–ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤:

### 3\. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ dbt –≤ Prometheus

–î–ª—è —ç—Ç–æ–≥–æ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ dbt:

pip install dbt-prometheus

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º dbt –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –º–µ—Ç—Ä–∏–∫:

üìÑ **dbt\_project.yml**

name: my\_dbt\_project

version: 1.0

profile: my\_profile

models:

my\_dbt\_project:

+materialized: table

metrics:

enable: true

prometheus:

host: localhost

port: 9090

### 4\. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ Grafana

-   –ó–∞—Ö–æ–¥–∏–º –Ω–∞ http://localhost:3000 (–ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å: admin/admin)
    
-   –î–æ–±–∞–≤–ª—è–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö (Prometheus)
    
-   –°–æ–∑–¥–∞–µ–º –ø–∞–Ω–µ–ª—å –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–µ—Ç—Ä–∏–∫ dbt
    

### 5\. –ö–∞—Å—Ç–æ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è dbt

–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å—á–µ—Ç—á–∏–∫–æ–≤ –∏ —Ç–∞–π–º–µ—Ä–æ–≤ –º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —ç–∫—Å–ø–æ—Ä—Ç–µ—Ä—ã. –ù–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è —Ñ–∏–∫—Å–∞—Ü–∏–∏ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π:

üìÑ **macros/log\_metric.sql**

{% macro log\_model\_runtime(model\_name, runtime) %}

{{ log("METRIC:dbt\_model\_runtime\_seconds{model='" ~ model\_name ~ "'} " ~ runtime, info\=True) }}

{% endmacro %}

üìÑ **models/example.sql**

{% set start\_time \= modules.datetime.datetime.now().timestamp() %}

\-- –≤–∞—à–∞ SQL –ª–æ–≥–∏–∫–∞

{% set end\_time \= modules.datetime.datetime.now().timestamp() %}

{% do log\_model\_runtime('example', end\_time \- start\_time) %}

SELECT 1 AS dummy;

Grafana —Å–º–æ–∂–µ—Ç —Å—á–∏—Ç—ã–≤–∞—Ç—å —Ç–∞–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏, –µ—Å–ª–∏ Prometheus –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –ø–∞—Ä—Å–∏–Ω–≥ –ª–æ–≥–æ–≤ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è log exporter.

### 6\. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–ª–µ—Ä—Ç–æ–≤ –≤ Grafana

-   –í Grafana –¥–æ–±–∞–≤—å—Ç–µ "Alert Rule".
    
-   –£—Å–ª–æ–≤–∏–µ: –µ—Å–ª–∏ `dbt_model_runtime_seconds` > 60
    
-   –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: Email, Telegram, Slack –∏ –¥—Ä.
    

‚úÖ –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å:

-   –°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ —Ç—Ä–∞—Ç–∏—Ç –∫–∞–∂–¥–∞—è –º–æ–¥–µ–ª—å.
    
-   –û–±—â—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å.
    
-   –û—à–∏–±–∫–∏ –∏ —Å–±–æ–∏ –≤ –ø–∞–π–ø–ª–∞–π–Ω–µ.
    

(–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –º–æ–∂–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å Airflow, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è DAG orchestration.)

–ì–æ—Ç–æ–≤–æ ‚úÖ  
–Ø –¥–æ–±–∞–≤–∏–ª:

-   –ü—Ä–∏–º–µ—Ä –∫–∞—Å—Ç–æ–º–Ω–æ–π –º–µ—Ç—Ä–∏–∫–∏ `dbt_model_runtime_seconds` —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Jinja-–º–∞–∫—Ä–æ—Å–æ–≤.
    
-   –°–ø–æ—Å–æ–± –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —ç—Ç–æ–π –º–µ—Ç—Ä–∏–∫–∏.
    
-   –ù–∞—Å—Ç—Ä–æ–π–∫—É –∞–ª–µ—Ä—Ç–æ–≤ –≤ Grafana (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ø–æ—Ä–æ–≥–∞ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è).
    

–•–æ—á–µ—à—å, –¥–æ–±–∞–≤–ª—é –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ **Apache Drill**?

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

—á—Ç–æ —Ç–∞–∫–æ–µ Apache Spark, PySpark

###### ChatGPT —Å–∫–∞–∑–∞–ª:

**Apache Spark** ‚Äî —ç—Ç–æ –º–æ—â–Ω–∞—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö (Big Data) –≤ –ø–∞–º—è—Ç–∏ (in-memory), –∫–æ—Ç–æ—Ä–∞—è –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç:

-   –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è,
    
-   –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–æ—Ç–æ–∫–æ–≤ (streaming),
    
-   –º–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ,
    
-   SQL-–∑–∞–ø—Ä–æ—Å—ã,
    
-   —Ä–∞–±–æ—Ç—É —Å –≥—Ä–∞—Ñ–∞–º–∏.
    

–û–Ω–∞ –±—ã—Å—Ç—Ä–µ–µ Hadoop MapReduce, –æ—Å–æ–±–µ–Ω–Ω–æ –¥–ª—è –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω—ã—Ö –∏—Ç–µ—Ä–∞—Ü–∏–π –Ω–∞–¥ –¥–∞–Ω–Ω—ã–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, ML).

___

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã Apache Spark:

-   **Spark Core** ‚Äì –±–∞–∑–æ–≤—ã–π –¥–≤–∏–∂–æ–∫ –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö –∑–∞–¥–∞—á.
    
-   **Spark SQL** ‚Äì —Ä–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ —á–µ—Ä–µ–∑ SQL.
    
-   **Spark Streaming** ‚Äì –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ—Ç–æ–∫–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
    
-   **MLlib** ‚Äì –º–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ.
    
-   **GraphX** ‚Äì —Ä–∞–±–æ—Ç–∞ —Å –≥—Ä–∞—Ñ–∞–º–∏.
    

___

### –ß—Ç–æ —Ç–∞–∫–æ–µ **PySpark**?

**PySpark** ‚Äî —ç—Ç–æ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è Python-–æ–±—ë—Ä—Ç–∫–∞ –Ω–∞–¥ Apache Spark, –ø–æ–∑–≤–æ–ª—è—é—â–∞—è –ø–∏—Å–∞—Ç—å Spark-–ø—Ä–æ–≥—Ä–∞–º–º—ã –Ω–∞ Python. –≠—Ç–æ —É–¥–æ–±–Ω–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ:

-   —Ç—ã –º–æ–∂–µ—à—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Python + Pandas-–ø–æ–¥–æ–±–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –Ω–∞ –æ–≥—Ä–æ–º–Ω—ã—Ö –∫–ª–∞—Å—Ç–µ—Ä–∞—Ö,
    
-   –∑–∞–ø—É—Å–∫–∞—Ç—å SQL-–∑–∞–ø—Ä–æ—Å—ã –∫ DataFrame'–∞–º,
    
-   –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å MLlib –¥–ª—è –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è,
    
-   –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ç–µ—Ä–∞–±–∞–π—Ç—ã –∏ –ø–µ—Ç–∞–±–∞–π—Ç—ã –¥–∞–Ω–Ω—ã—Ö.
    

___

### –ü—Ä–∏–º–µ—Ä: —Ä–∞–±–æ—Ç–∞ —Å PySpark

```
<div><p>python</p><p><code id="code-lang-python"><span><span><span>from</span></span><span> pyspark.sql </span><span><span>import</span></span><span> SparkSession

</span><span><span># –ó–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ Spark-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</span></span><span>
spark = SparkSession.builder \
    .appName(</span><span><span>"MyApp"</span></span><span>) \
    .master(</span><span><span>"local[*]"</span></span><span>) \
    .getOrCreate()

</span><span><span># –°–æ–∑–¥–∞–Ω–∏–µ DataFrame</span></span><span>
data = [(</span><span><span>"Alice"</span></span><span>, </span><span><span>34</span></span><span>), (</span><span><span>"Bob"</span></span><span>, </span><span><span>45</span></span><span>), (</span><span><span>"Cathy"</span></span><span>, </span><span><span>29</span></span><span>)]
df = spark.createDataFrame(data, [</span><span><span>"name"</span></span><span>, </span><span><span>"age"</span></span><span>])

</span><span><span># –ü—Ä–æ—Å—Ç–æ–π —Ñ–∏–ª—å—Ç—Ä</span></span><span>
df.</span><span><span>filter</span></span><span>(df.age &gt; </span><span><span>30</span></span><span>).show()
</span></span></code></p></div>
```

–í—ã–≤–æ–¥:

```
<div><p>pgsql</p><p><code><span><span>+</span><span><span>-----+---+</span></span><span>
| </span><span><span>name</span></span><span>|age|
+</span><span><span>-----+---+</span></span><span>
|Alice| </span><span><span>34</span></span><span>|
|  Bob| </span><span><span>45</span></span><span>|
+</span><span><span>-----+---+</span></span><span>
</span></span></code></p></div>
```

___

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Apache Spark / PySpark:

-   –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å **–æ–≥—Ä–æ–º–Ω—ã–µ –æ–±—ä—ë–º—ã –¥–∞–Ω–Ω—ã—Ö** (–±–æ–ª—å—à–µ –ø–∞–º—è—Ç–∏ –æ–¥–Ω–æ–π –º–∞—à–∏–Ω—ã),
    
-   –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ **HDFS, S3, Cassandra, Kafka, Hive** –∏ —Ç.–ø.,
    
-   –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å **–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è** –∏–ª–∏ –∑–∞–ø—É—Å–∫–∞—Ç—å **ETL-–ø–∞–π–ø–ª–∞–π–Ω—ã –Ω–∞ –∫–ª–∞—Å—Ç–µ—Ä–µ**.
    

–•–æ—á–µ—à—å, –ø–æ–∫–∞–∂—É, –∫–∞–∫ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –∫–ª–∞—Å—Ç–µ—Ä Spark –ª–æ–∫–∞–ª—å–Ω–æ –∏–ª–∏ –≤ Kubernetes?

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

###### ChatGPT —Å–∫–∞–∑–∞–ª:

**Ad-hoc** (–æ—Ç –ª–∞—Ç. _¬´–¥–ª—è —ç—Ç–æ–≥–æ¬ª_) ‚Äî –æ–∑–Ω–∞—á–∞–µ—Ç ¬´–æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π¬ª, ¬´—Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π¬ª –∏–ª–∏ ¬´–ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏¬ª. –≠—Ç–æ—Ç —Ç–µ—Ä–º–∏–Ω —à–∏—Ä–æ–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ IT –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–µ.

___

### üìä –í –∞–Ω–∞–ª–∏—Ç–∏–∫–µ:

**Ad-hoc –∞–Ω–∞–ª–∏–∑ (Ad-hoc analysis)** ‚Äî —ç—Ç–æ:

> –û–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π, –Ω–µ—Ä–µ–≥—É–ª—è—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∫ –¥–∞–Ω–Ω—ã–º, —Å–¥–µ–ª–∞–Ω–Ω—ã–π –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –≤–æ–ø—Ä–æ—Å ¬´–∑–¥–µ—Å—å –∏ —Å–µ–π—á–∞—Å¬ª.

–ù–∞–ø—Ä–∏–º–µ—Ä:

-   –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç: _¬´–°–∫–æ–ª—å–∫–æ –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø—Ä–∏—à–ª–æ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –∞–∫—Ü–∏–∏?¬ª_
    
-   –ê–Ω–∞–ª–∏—Ç–∏–∫ –ø–∏—à–µ—Ç SQL-–∑–∞–ø—Ä–æ—Å –≤—Ä—É—á–Ω—É—é, –Ω–µ –ø–æ–ª—å–∑—É—è—Å—å –≥–æ—Ç–æ–≤—ã–º –æ—Ç—á—ë—Ç–æ–º.
    

üìå Ad-hoc –∞–Ω–∞–ª–∏–∑ ‚â† –æ—Ç—á—ë—Ç—ã –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é (—Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –¥–∞—à–±–æ—Ä–¥—ã).

___

### üñ•Ô∏è –í IT –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ:

-   **Ad-hoc —Å–∫—Ä–∏–ø—Ç** ‚Äî —Å–∫—Ä–∏–ø—Ç, –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–π –±—ã—Å—Ç—Ä–æ –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∑–∞–¥–∞—á–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ—á–∏—Å—Ç–∏—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã –≤ –±–∞–∑–µ).
    
-   **Ad-hoc –∑–∞–ø—Ä–æ—Å** ‚Äî SQL –∏–ª–∏ API-–∑–∞–ø—Ä–æ—Å, —Å–æ–∑–¥–∞–Ω–Ω—ã–π –≤—Ä—É—á–Ω—É—é ¬´–Ω–∞ –ª–µ—Ç—É¬ª.
    
-   **Ad-hoc —Å–µ—Ç—å (Wi-Fi)** ‚Äî –ø—Ä—è–º–∞—è –±–µ—Å–ø—Ä–æ–≤–æ–¥–Ω–∞—è —Å–µ—Ç—å –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ –±–µ–∑ —Ä–æ—É—Ç–µ—Ä–∞.
    

___

### –ü—Ä–∏–º–µ—Ä—ã:

| –°–∏—Ç—É–∞—Ü–∏—è | Ad-hoc? | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
| --- | --- | --- |
| –ì–æ—Ç–æ–≤—ã–π –æ—Ç—á—ë—Ç –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º | ‚ùå | –†–µ–≥—É–ª—è—Ä–Ω—ã–π, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π |
| –ë—ã—Å—Ç—Ä—ã–π SQL-–∑–∞–ø—Ä–æ—Å –¥–ª—è CEO | ‚úÖ | –û–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π, —Ä—É—á–Ω–æ–π |
| –ï–¥–∏–Ω–æ—Ä–∞–∑–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –æ—á–∏—Å—Ç–∫–∏ | ‚úÖ | –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ |
| –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–π Wi-Fi —Å–µ—Ç–∏ | ‚úÖ | Ad-hoc —Å–µ—Ç—å |

___

–•–æ—á–µ—à—å –ø—Ä–∏–º–µ—Ä ad-hoc SQL-–∑–∞–ø—Ä–æ—Å–∞ –∏–ª–∏ Python-–∞–Ω–∞–ª–∏–∑–∞ –ø–æ CSV?

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

—á—Ç–æ —Ç–∞–∫–æ–µ SCD (slow changing dimention)

###### ChatGPT —Å–∫–∞–∑–∞–ª:

**SCD (Slowly Changing Dimension)** ‚Äî —ç—Ç–æ —Ç–µ—Ö–Ω–∏–∫–∞ –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞—Ö –¥–∞–Ω–Ω—ã—Ö (Data Warehouse) –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è **–∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–ø—Ä–∞–≤–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–∞–Ω–Ω—ã–µ –æ –∫–ª–∏–µ–Ω—Ç–∞—Ö, –ø—Ä–æ–¥—É–∫—Ç–∞—Ö, –ª–æ–∫–∞—Ü–∏—è—Ö –∏ —Ç.–¥.).

___

### üîπ –ß—Ç–æ —Ç–∞–∫–æ–µ ¬´—Å–ø—Ä–∞–≤–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ¬ª?

–≠—Ç–æ **—Ç–∞–±–ª–∏—Ü—ã-–∏–∑–º–µ—Ä–µ–Ω–∏—è (dimension tables)** –≤ –º–æ–¥–µ–ª–∏ ¬´–∑–≤–µ–∑–¥–∞¬ª (star schema), –Ω–∞–ø—Ä–∏–º–µ—Ä:

-   `customers (id, name, city)`
    
-   `products (id, name, category)`
    
-   `employees (id, position, department)`
    

–ü—Ä–æ–±–ª–µ–º–∞: –∑–Ω–∞—á–µ–Ω–∏—è –º–æ–≥—É—Ç **–º–µ–Ω—è—Ç—å—Å—è –≤–æ –≤—Ä–µ–º–µ–Ω–∏** ‚Äî –∏–º—è –∫–ª–∏–µ–Ω—Ç–∞, –≥–æ—Ä–æ–¥, –∫–∞—Ç–µ–≥–æ—Ä–∏—è —Ç–æ–≤–∞—Ä–∞. –ù–∞–¥–æ **—Ä–µ—à–∏—Ç—å, —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ª–∏ –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π** –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ.

___

### üîπ –í–∏–¥—ã SCD:

| –¢–∏–ø | –ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö | –ì–¥–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è |
| --- | --- | --- |
| **SCD Type 1** | –ü—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ–º —Å—Ç–∞—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ | –ò—Å—Ç–æ—Ä–∏—è –Ω–µ –≤–∞–∂–Ω–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–ø–µ—á–∞—Ç–∫–∏) |
| **SCD Type 2** | –°–æ—Ö—Ä–∞–Ω—è–µ–º **—Å—Ç–∞—Ä—É—é —Å—Ç—Ä–æ–∫—É**, –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é | –ù—É–∂–Ω–∞ –ø–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π |
| **SCD Type 3** | –•—Ä–∞–Ω–∏–º **—Å—Ç–∞—Ä–æ–µ –∏ –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ** | –û–±—ã—á–Ω–æ —Ç–æ–ª—å–∫–æ 1 –ø—Ä–µ–¥—ã–¥—É—â–∞—è –≤–µ—Ä—Å–∏—è |

___

### üî∏ –ü—Ä–∏–º–µ—Ä

–ë—ã–ª–∞ —Å—Ç—Ä–æ–∫–∞ –≤ —Ç–∞–±–ª–∏—Ü–µ –∫–ª–∏–µ–Ω—Ç–æ–≤:

| customer\_id | name | city |
| --- | --- | --- |
| 101 | Alice | New York |

–ü–æ—Ç–æ–º Alice –ø–µ—Ä–µ–µ—Ö–∞–ª–∞ –≤ **Boston**.

#### Type 1 (–∑–∞–º–µ–Ω–∞):

| customer\_id | name | city |
| --- | --- | --- |
| 101 | Alice | Boston |

#### Type 2 (–¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è —Å—Ç—Ä–æ–∫–∞):

| customer\_id | name | city | valid\_from | valid\_to | is\_current |
| --- | --- | --- | --- | --- | --- |
| 101 | Alice | New York | 2023-01-01 | 2025-05-10 | false |
| 101 | Alice | Boston | 2025-05-11 | NULL | true |

#### Type 3 (–¥–æ–±–∞–≤–ª—è–µ–º –∫–æ–ª–æ–Ω–∫—É `previous_city`):

| customer\_id | name | current\_city | previous\_city |
| --- | --- | --- | --- |
| 101 | Alice | Boston | New York |

___

### üì¶ –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:

-   –ü—Ä–∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–∏ –≤–∏—Ç—Ä–∏–Ω –¥–∞–Ω–Ω—ã—Ö (data marts)
    
-   –í ETL-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, dbt, Airflow, Talend)
    
-   –í BI-—Å–∏—Å—Ç–µ–º–∞—Ö (Power BI, Tableau), –≥–¥–µ –≤–∞–∂–Ω–∞ **–∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ—Ä–µ–Ω–∏–π**
    

___

–•–æ—á–µ—à—å –ø—Ä–∏–º–µ—Ä, –∫–∞–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å SCD Type 2 –≤ SQL –∏–ª–∏ dbt?

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–∫–∞–∫ –æ–±—ã—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç dbt? —è –∑–∞–ø—É—Å–∫–∞—é –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤ –¥–æ–∫–µ—Ä–µ, –æ–Ω –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–∫—Ä–∏–ø—Ç—ã –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ –ø–æ—Ç–æ–º —É–¥–∞–ª—è–µ—Ç—Å—è —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º –ø–æ–¥—Ö–æ–¥–æ–º? –∏–ª–∏ –µ—Å—Ç—å –±–æ–ª–µ–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–π —Å–ø–æ—Å–æ–±?

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å. –î–∞, **–∑–∞–ø—É—Å–∫ dbt –≤ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ ‚Äî —ç—Ç–æ –≤–ø–æ–ª–Ω–µ –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è –∏ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞**, –æ—Å–æ–±–µ–Ω–Ω–æ –≤ CI/CD –ø–∞–π–ø–ª–∞–π–Ω–∞—Ö –∏–ª–∏ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ –≤ –æ–±–ª–∞–∫–µ. –ù–æ –µ—Å—Ç—å —Ä–∞–∑–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è dbt –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞. –î–∞–≤–∞–π —Ä–∞–∑–±–µ—Ä—ë–º—Å—è:

___

## ‚úÖ –¢–≤–æ–π –ø–æ–¥—Ö–æ–¥: –∑–∞–ø—É—Å–∫ dbt –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ

> **"–Ø –∑–∞–ø—É—Å–∫–∞—é –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, –æ–Ω –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–∫—Ä–∏–ø—Ç—ã (dbt run, dbt test), –∏ –ø–æ—Ç–æ–º —É–¥–∞–ª—è–µ—Ç—Å—è."**

–≠—Ç–æ **—Ç–∏–ø–∏—á–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –¥–ª—è CI/CD**:

-   –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å—Ç–∞—Ä—Ç—É–µ—Ç –≤ GitLab CI, GitHub Actions, Airflow, Argo, etc.,
    
-   –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∫–æ–º–∞–Ω–¥—ã (`dbt run`, `dbt test`, `dbt docs generate`),
    
-   –ª–æ–≥–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è.
    

üìå **–ü–ª—é—Å—ã**:

-   –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ (–≤—Å—ë –ø–æ–≤—Ç–æ—Ä—è–µ–º–æ),
    
-   –Ω–µ –Ω—É–∂–µ–Ω —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π dbt –Ω–∞ —Ö–æ—Å—Ç–µ,
    
-   –ª–µ–≥–∫–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å.
    

üìå **–ú–∏–Ω—É—Å—ã**:

-   –Ω–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ —á—Ç–æ-—Ç–æ –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, `dbt artifacts`).
    

___

## üîÅ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è dbt

| –ü–æ–¥—Ö–æ–¥ | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è |
| --- | --- |
| **–õ–æ–∫–∞–ª—å–Ω–æ —Å CLI** (`dbt run`) | —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞, –æ—Ç–ª–∞–¥–∫–∞, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ |
| **–í –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ (–∫–∞–∫ —É —Ç–µ–±—è)** | CI/CD, orchestration, cloud pipelines |
| **–ß–µ—Ä–µ–∑ dbt Cloud** | –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–ø—Ä–∞–≤–ª—è–µ–º–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –æ—Ç dbt Labs |
| **–ò–∑ Airflow / Prefect / Luigi** | –∫–∞–∫ —á–∞—Å—Ç—å DAG-–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ |
| **–í Kubernetes + Helm** | –¥–µ–ø–ª–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ —Å dbt –∫–∞–∫ jobs (—á–µ—Ä–µ–∑ CronJob, Helm) |
| **–ß–µ—Ä–µ–∑ API (dbt Cloud)** | –∑–∞–ø—É—Å–∫ –ø–æ —Ç—Ä–∏–≥–≥–µ—Ä—É, –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö |

___

## üß† –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏, –µ—Å–ª–∏ –∑–∞–ø—É—Å–∫–∞–µ—à—å –≤ Docker

1.  –ò—Å–ø–æ–ª—å–∑—É–π `entrypoint.sh` –∏–ª–∏ `Makefile` –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞:
    
    ```
    <div><p>Dockerfile</p><p><code id="code-lang-undefined"><span>CMD ["dbt", "run"]
    </span></code></p></div>
    ```
    
2.  –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –º–æ–Ω—Ç–∏—Ä—É–π –∫–æ–Ω—Ñ–∏–≥–∏ –∏ –ø–∞–ø–∫–∏:
    
    ```
    <div><p>bash</p><p><code id="code-lang-bash"><span><span>docker run --</span><span><span>rm</span></span><span> -v $(</span><span><span>pwd</span></span><span>):/dbt -v ~/.dbt:/root/.dbt my-dbt-image dbt run
    </span></span></code></p></div>
    ```
    
3.  –ú–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑:
    
    ```
    <div><p>Dockerfile</p><p><code id="code-lang-undefined"><span>FROM python:3.11-slim
    RUN pip install dbt-core dbt-postgres
    WORKDIR /dbt
    CMD ["dbt", "run"]
    </span></code></p></div>
    ```
    
4.  –ü–æ–¥—É–º–∞–π –æ–± –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ `dbt artifacts` (JSON-—Ñ–∞–π–ª—ã —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏), –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –º–µ–∂–¥—É –∑–∞–ø—É—Å–∫–∞–º–∏.
    

___

## üí° –ö–æ–≥–¥–∞ —Å—Ç–æ–∏—Ç **–ø–µ—Ä–µ–π—Ç–∏ –∫ –±–æ–ª–µ–µ ¬´–ø–æ—Å—Ç–æ—è–Ω–Ω–æ–º—É¬ª —Å–ø–æ—Å–æ–±—É**

–ï—Å–ª–∏:

-   –Ω—É–∂–Ω–æ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ (docs, dbt cloud),
    
-   —Ö–æ—á–µ—à—å –∑–∞–ø—É—Å–∫–∞—Ç—å —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é,
    
-   —Ç—Ä–µ–±—É–µ—Ç—Å—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Airflow –∏–ª–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º (Prometheus/Grafana),
    
-   –Ω—É–∂–Ω–∞ –∫–æ–ª–ª–∞–±–æ—Ä–∞—Ü–∏—è –∏ CI/CD-—Å—Ç—Ä–∞—Ç–µ–≥–∏—è –¥–ª—è dbt (–Ω–∞–ø—Ä–∏–º–µ—Ä, GitOps + dbt Cloud),
    

—Ç–æ –º–æ–∂–Ω–æ –ø–æ–¥—É–º–∞—Ç—å –æ –ø–µ—Ä–µ—Ö–æ–¥–µ –∫:

-   **dbt Cloud** ‚Äî –≤—Å—ë –≤ –±—Ä–∞—É–∑–µ—Ä–µ + –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π CI.
    
-   **Kubernetes CronJob –∏–ª–∏ Argo Workflows** ‚Äî –¥–ª—è –ø—Ä–æ–¥-—Å—Ä–µ–¥.
    

___

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, —è –º–æ–≥—É –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∏–º–µ—Ä `docker-compose` + `dbt`, –∏–ª–∏ CI pipeline —Å dbt –∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞–º–∏.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

###### ChatGPT —Å–∫–∞–∑–∞–ª:

**dbt artifacts** ‚Äî —ç—Ç–æ **–≤—ã—Ö–æ–¥–Ω—ã–µ —Ñ–∞–π–ª—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON**, –∫–æ—Ç–æ—Ä—ã–µ `dbt` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥ –≤—Ä–æ–¥–µ `dbt run`, `dbt test`, `dbt compile` –∏ –¥—Ä—É–≥–∏—Ö. –û–Ω–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–æ–¥–µ–ª—è—Ö, —Ç–µ—Å—Ç–∞—Ö, —Ä–µ—Å—É—Ä—Å–∞—Ö, –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏ —Ç.–¥.

–≠—Ç–∏ —Ñ–∞–π–ª—ã –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è:

-   –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–æ–¥–µ–ª–µ–π,
    
-   –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –º–µ—Ç—Ä–∏–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è),
    
-   –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –¥—Ä—É–≥–∏–º–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, Airflow, Prometheus, –≥—Ä–∞—Ñ–∏–∫–∏ DAG),
    
-   –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –æ—Ç—á—ë—Ç–æ–≤ –∏–ª–∏ –∞–ª–µ—Ä—Ç–æ–≤.
    

___

## üìÅ –ì–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è artifacts?

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî –≤ –∫–∞—Ç–∞–ª–æ–≥–µ `target/` –≤–Ω—É—Ç—Ä–∏ —Ç–≤–æ–µ–≥–æ dbt-–ø—Ä–æ–µ–∫—Ç–∞.

___

## üì¶ –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã dbt artifacts:

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
| --- | --- |
| `manifest.json` | –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –º–∞–∫—Ä–æ—Å–æ–≤, –∫–æ–Ω—Ñ–∏–≥–æ–≤. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏, –ª–µ–Ω—Ç—ã –∏–∑–º–µ–Ω–µ–Ω–∏–π, CI |
| `run_results.json` | –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è `dbt run` –∏–ª–∏ `dbt test`: –∫–∞–∫–∏–µ –º–æ–¥–µ–ª–∏ –∑–∞–ø—É—Å–∫–∞–ª–∏—Å—å, —Å–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–Ω—è–ª–∏, –±—ã–ª–∏ –ª–∏ –æ—à–∏–±–∫–∏ |
| `catalog.json` | –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ —Ç–∏–ø—ã –≤—Å–µ—Ö –∫–æ–ª–æ–Ω–æ–∫ –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è `dbt docs generate` (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏) |
| `sources.json` | –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏—Å—Ç–æ—á–Ω–∏–∫–∞—Ö (`source()`), –∏—Ö –ø—Ä–æ–≤–µ—Ä–∫–∞—Ö, —Å—Ç–∞—Ç—É—Å–µ, –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö |
| `compiled/` | –ö–∞—Ç–∞–ª–æ–≥ —Å SQL-–∫–æ–¥–æ–º –ø–æ—Å–ª–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ —à–∞–±–ª–æ–Ω–æ–≤ (Jinja ‚Üí SQL) |

___

## üîç –ü—Ä–∏–º–µ—Ä: `run_results.json`

```
<div><p>json</p><p><code id="code-lang-json"><span><span><span>{</span></span><span>
  </span><span><span>"results"</span></span><span><span>:</span></span><span> </span><span><span>[</span></span><span>
    </span><span><span>{</span></span><span>
      </span><span><span>"status"</span></span><span><span>:</span></span><span> </span><span><span>"success"</span></span><span><span>,</span></span><span>
      </span><span><span>"timing"</span></span><span><span>:</span></span><span> </span><span><span>[</span></span><span>...</span><span><span>]</span></span><span><span>,</span></span><span>
      </span><span><span>"thread_id"</span></span><span><span>:</span></span><span> </span><span><span>"Thread-1"</span></span><span><span>,</span></span><span>
      </span><span><span>"execution_time"</span></span><span><span>:</span></span><span> </span><span><span>2.34</span></span><span><span>,</span></span><span>
      </span><span><span>"node"</span></span><span><span>:</span></span><span> </span><span><span>{</span></span><span>
        </span><span><span>"unique_id"</span></span><span><span>:</span></span><span> </span><span><span>"model.my_project.my_model"</span></span><span><span>,</span></span><span>
        </span><span><span>"name"</span></span><span><span>:</span></span><span> </span><span><span>"my_model"</span></span><span>
      </span><span><span>}</span></span><span>
    </span><span><span>}</span></span><span>
  </span><span><span>]</span></span><span>
</span><span><span>}</span></span><span>
</span></span></code></p></div>
```

___

## üß† –ö–∞–∫ —ç—Ç–æ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### ‚úÖ CI/CD:

–¢—ã –º–æ–∂–µ—à—å –≤ CI:

-   –∑–∞–ø—É—Å—Ç–∏—Ç—å `dbt run`,
    
-   —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å `run_results.json`,
    
-   —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ –º–æ–¥–µ–ª–∏ –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ,
    
-   –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫—É/–ª–æ–≥ –≤ Slack/Sentry.
    

### ‚úÖ Monitoring:

–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –∏–∑ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤, —á—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∏—Ö –≤ **Prometheus**, **Grafana**, **Datadog** –∏ —Ç.–¥.

### ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:

`dbt docs generate` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `manifest.json` –∏ `catalog.json` –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –∫—Ä–∞—Å–∏–≤–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.

___

## üì¶ –•–æ—á–µ—à—å –ø—Ä–∏–º–µ—Ä –∫–æ–¥–∞, –∫–æ—Ç–æ—Ä—ã–π –±–µ—Ä—ë—Ç `run_results.json` –∏ —Å—á–∏—Ç–∞–µ—Ç –æ–±—â–µ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π –∏–ª–∏ —Å–ø–∏—Å–æ–∫ –æ—à–∏–±–æ–∫?

–ò–ª–∏ —Ö–æ—á–µ—à—å –ø—Ä–∏–º–µ—Ä –æ—Ç–ø—Ä–∞–≤–∫–∏ —ç—Ç–∏—Ö –¥–∞–Ω–Ω—ã—Ö –≤ Prometheus/Grafana?

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–ø—Ä–∏–º–µ—Ä –∫–æ–¥–∞, –∫–æ—Ç–æ—Ä—ã–π –±–µ—Ä—ë—Ç run\_results.json –∏ —Å—á–∏—Ç–∞–µ—Ç –æ–±—â–µ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π –∏ —Å–ø–∏—Å–æ–∫ –æ—à–∏–±–æ–∫ + –ø—Ä–∏–º–µ—Ä –æ—Ç–ø—Ä–∞–≤–∫–∏ —ç—Ç–∏—Ö –¥–∞–Ω–Ω—ã—Ö –≤ Prometheus/Grafana

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–û—Ç–ª–∏—á–Ω–æ! –ù–∏–∂–µ ‚Äî –¥–≤–∞ –ø—Ä–∏–º–µ—Ä–∞:

1.  üìä **–°–∫—Ä–∏–ø—Ç Python –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ `run_results.json`**: —Å—á–∏—Ç–∞–µ—Ç –æ–±—â–µ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –º–æ–¥–µ–ª–µ–π –∏ –æ—à–∏–±–∫–∏.
    
2.  üìà **–≠–∫—Å–ø–æ—Ä—Ç–µ—Ä –º–µ—Ç—Ä–∏–∫ –≤ Prometheus**, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –∫ **Grafana**.
    

___

## ‚úÖ –ü—Ä–∏–º–µ—Ä 1: –ê–Ω–∞–ª–∏–∑ `run_results.json`

```
<div><p>python</p><p><code id="code-lang-python"><span><span><span>import</span></span><span> json
</span><span><span>from</span></span><span> pathlib </span><span><span>import</span></span><span> Path

</span><span><span># –ü—É—Ç—å –∫ run_results.json</span></span><span>
file_path = Path(</span><span><span>"target/run_results.json"</span></span><span>)

</span><span><span>with</span></span><span> file_path.</span><span><span>open</span></span><span>() </span><span><span>as</span></span><span> f:
    results = json.load(f)[</span><span><span>"results"</span></span><span>]

total_time = </span><span><span>0</span></span><span>
errors = []

</span><span><span>print</span></span><span>(</span><span><span>"=== –†–µ–∑—É–ª—å—Ç–∞—Ç—ã dbt run ===\n"</span></span><span>)

</span><span><span>for</span></span><span> r </span><span><span>in</span></span><span> results:
    model = r[</span><span><span>"node"</span></span><span>][</span><span><span>"name"</span></span><span>]
    status = r[</span><span><span>"status"</span></span><span>]
    time_sec = r.get(</span><span><span>"execution_time"</span></span><span>, </span><span><span>0</span></span><span>)
    total_time += time_sec

    </span><span><span>print</span></span><span>(</span><span><span>f"- <span>{model}</span></span></span><span>: </span><span><span>{status}</span></span><span>, </span><span><span>{time_sec:<span>.2</span></span></span><span>f} sec")

    </span><span><span>if</span></span><span> status != </span><span><span>"success"</span></span><span>:
        errors.append({
            </span><span><span>"model"</span></span><span>: model,
            </span><span><span>"status"</span></span><span>: status,
            </span><span><span>"message"</span></span><span>: r.get(</span><span><span>"message"</span></span><span>, </span><span><span>"No details"</span></span><span>)
        })

</span><span><span>print</span></span><span>(</span><span><span>f"\n–û–±—â–µ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: <span>{total_time:<span>.2</span></span></span></span><span>f} —Å–µ–∫")

</span><span><span>if</span></span><span> errors:
    </span><span><span>print</span></span><span>(</span><span><span>"\n‚ùå –û—à–∏–±–∫–∏:"</span></span><span>)
    </span><span><span>for</span></span><span> e </span><span><span>in</span></span><span> errors:
        </span><span><span>print</span></span><span>(</span><span><span>f"  - <span>{e[<span>'model'</span></span></span></span><span>]}: </span><span><span>{e[<span>'status'</span></span></span><span>]} ‚Üí </span><span><span>{e[<span>'message'</span></span></span><span>]}")
</span><span><span>else</span></span><span>:
    </span><span><span>print</span></span><span>(</span><span><span>"\n‚úÖ –í—Å–µ –º–æ–¥–µ–ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ."</span></span><span>)
</span></span></code></p></div>
```

___

## ‚úÖ –ü—Ä–∏–º–µ—Ä 2: Prometheus Exporter (—á–µ—Ä–µ–∑ Flask)

–≠—Ç–æ—Ç –∫–æ–¥ –ø–æ–¥–Ω–∏–º–∞–µ—Ç –≤–µ–±-—Å–µ—Ä–≤–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–¥–∞—ë—Ç `/metrics`, –≥–¥–µ:

-   `dbt_model_runtime_seconds{model="..."}` ‚Äî –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è,
    
-   `dbt_model_status{model="..."} 1/0` ‚Äî —Ñ–ª–∞–≥ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.
    

```
<div><p>python</p><p><code id="code-lang-python"><span><span><span>from</span></span><span> flask </span><span><span>import</span></span><span> Flask, Response
</span><span><span>import</span></span><span> json
</span><span><span>import</span></span><span> time

app = Flask(__name__)

</span><span><span>@app.route(<span><span>"/metrics"</span></span></span></span><span>)
</span><span><span>def</span></span><span> </span><span><span>metrics</span></span><span>():
    </span><span><span>try</span></span><span>:
        </span><span><span>with</span></span><span> </span><span><span>open</span></span><span>(</span><span><span>"target/run_results.json"</span></span><span>) </span><span><span>as</span></span><span> f:
            results = json.load(f)[</span><span><span>"results"</span></span><span>]
    </span><span><span>except</span></span><span> FileNotFoundError:
        </span><span><span>return</span></span><span> Response(</span><span><span>"# run_results.json not found"</span></span><span>, mimetype=</span><span><span>"text/plain"</span></span><span>)

    metrics = []
    </span><span><span>for</span></span><span> r </span><span><span>in</span></span><span> results:
        model = r[</span><span><span>"node"</span></span><span>][</span><span><span>"name"</span></span><span>]
        status = </span><span><span>1</span></span><span> </span><span><span>if</span></span><span> r[</span><span><span>"status"</span></span><span>] == </span><span><span>"success"</span></span><span> </span><span><span>else</span></span><span> </span><span><span>0</span></span><span>
        runtime = r.get(</span><span><span>"execution_time"</span></span><span>, </span><span><span>0</span></span><span>)

        metrics.append(</span><span><span>f'dbt_model_runtime_seconds{{model="<span>{model}</span></span></span><span>"}} </span><span><span>{runtime}</span></span><span>')
        metrics.append(</span><span><span>f'dbt_model_status{{model="<span>{model}</span></span></span><span>"}} </span><span><span>{status}</span></span><span>')

    </span><span><span>return</span></span><span> Response(</span><span><span>"\n"</span></span><span>.join(metrics), mimetype=</span><span><span>"text/plain"</span></span><span>)

</span><span><span>if</span></span><span> __name__ == </span><span><span>"__main__"</span></span><span>:
    app.run(host=</span><span><span>"0.0.0.0"</span></span><span>, port=</span><span><span>8000</span></span><span>)
</span></span></code></p></div>
```

___

### üîß –ö–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –≤ Grafana

1.  **–î–æ–±–∞–≤—å Prometheus –∫–∞–∫ datasource** –≤ Grafana.
    
2.  –î–æ–±–∞–≤—å `targets` –≤ `prometheus.yml`:
    
    ```
    <div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>scrape_configs:</span></span><span>
      </span><span><span>-</span></span><span> </span><span><span>job_name:</span></span><span> </span><span><span>'dbt_exporter'</span></span><span>
        </span><span><span>static_configs:</span></span><span>
          </span><span><span>-</span></span><span> </span><span><span>targets:</span></span><span> [</span><span><span>'localhost:8000'</span></span><span>]
    </span></span></code></p></div>
    ```
    
3.  –ü–æ—Å—Ç—Ä–æ–π –≥—Ä–∞—Ñ–∏–∫–∏:
    
    -   –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: `dbt_model_runtime_seconds`
        
    -   –û—à–∏–±–∫–∏: `dbt_model_status == 0`
        

___

### üöÄ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å [dbt artifacts package](https://github.com/dbt-labs/dbt-artifacts) + `dbt-artifacts` –º–æ–¥–µ–ª–∏

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, –º–æ–≥—É –ø–æ–º–æ—á—å –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —ç–∫—Å–ø–æ—Ä—Ç –≤ **ClickHouse** –∏–ª–∏ **Postgres** –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–π.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–ø–æ–º–æ—á—å –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —ç–∫—Å–ø–æ—Ä—Ç –≤ ClickHouse –∏ Postgres –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–π.

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–û—Ç–ª–∏—á–Ω–æ, –¥–∞–≤–∞–π –Ω–∞—Å—Ç—Ä–æ–∏–º —ç–∫—Å–ø–æ—Ä—Ç **–∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ dbt** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `run_results.json`, `manifest.json`) –≤ **ClickHouse** –∏–ª–∏ **Postgres**. –≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç —Å–æ–±–∏—Ä–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∑–∞–ø—É—Å–∫–æ–≤, –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏, —Å—Ç—Ä–æ–∏—Ç—å –æ—Ç—á—ë—Ç—ã –∏ –≥—Ä–∞—Ñ–∏–∫–∏.

___

## üîπ –í–∞—Ä–∏–∞–Ω—Ç 1: ClickHouse (–±—ã—Å—Ç—Ä—ã–π, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã–π)

### 1\. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è `run_results`

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span><span>CREATE</span></span><span> </span><span><span>TABLE</span></span><span> dbt_run_results (
    run_id String,
    model String,
    status String,
    execution_time Float64,
    thread_id String,
    started_at DateTime </span><span><span>DEFAULT</span></span><span> now()
)
ENGINE </span><span><span>=</span></span><span> MergeTree()
</span><span><span>ORDER</span></span><span> </span><span><span>BY</span></span><span> (run_id, model);
</span></span></code></p></div>
```

### 2\. Python-—Å–∫—Ä–∏–ø—Ç: –ø–∞—Ä—Å–∏–Ω–≥ –∏ –∑–∞–ø–∏—Å—å –≤ ClickHouse

```
<div><p>python</p><p><code id="code-lang-python"><span><span><span>import</span></span><span> json
</span><span><span>import</span></span><span> uuid
</span><span><span>from</span></span><span> clickhouse_driver </span><span><span>import</span></span><span> Client
</span><span><span>from</span></span><span> datetime </span><span><span>import</span></span><span> datetime

client = Client(host=</span><span><span>'localhost'</span></span><span>)

</span><span><span>with</span></span><span> </span><span><span>open</span></span><span>(</span><span><span>"target/run_results.json"</span></span><span>) </span><span><span>as</span></span><span> f:
    data = json.load(f)[</span><span><span>"results"</span></span><span>]

run_id = </span><span><span>str</span></span><span>(uuid.uuid4())

rows = []
</span><span><span>for</span></span><span> r </span><span><span>in</span></span><span> data:
    rows.append((
        run_id,
        r[</span><span><span>"node"</span></span><span>][</span><span><span>"name"</span></span><span>],
        r[</span><span><span>"status"</span></span><span>],
        r.get(</span><span><span>"execution_time"</span></span><span>, </span><span><span>0.0</span></span><span>),
        r.get(</span><span><span>"thread_id"</span></span><span>, </span><span><span>""</span></span><span>),
    ))

client.execute(<span>"""
    INSERT INTO dbt_run_results
    (run_id, model, status, execution_time, thread_id)
    VALUES
"""</span>, rows)
</span></span></code></p></div>
```

___

## üî∏ –í–∞—Ä–∏–∞–Ω—Ç 2: PostgreSQL (–µ—Å–ª–∏ —É —Ç–µ–±—è —É–∂–µ –µ—Å—Ç—å BI/ETL-–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞)

### 1\. –¢–∞–±–ª–∏—Ü–∞ –≤ Postgres

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span><span>CREATE</span></span><span> </span><span><span>TABLE</span></span><span> dbt_run_results (
    id SERIAL </span><span><span>PRIMARY</span></span><span> KEY,
    run_id UUID,
    model TEXT,
    status TEXT,
    execution_time </span><span><span>DOUBLE PRECISION</span></span><span>,
    thread_id TEXT,
    started_at </span><span><span>TIMESTAMP</span></span><span> </span><span><span>DEFAULT</span></span><span> now()
);
</span></span></code></p></div>
```

### 2\. Python-—Å–∫—Ä–∏–ø—Ç –¥–ª—è Postgres

```
<div><p>python</p><p><code id="code-lang-python"><span><span><span>import</span></span><span> json
</span><span><span>import</span></span><span> uuid
</span><span><span>import</span></span><span> psycopg2
</span><span><span>from</span></span><span> datetime </span><span><span>import</span></span><span> datetime

conn = psycopg2.connect(
    host=</span><span><span>"localhost"</span></span><span>,
    dbname=</span><span><span>"your_db"</span></span><span>,
    user=</span><span><span>"your_user"</span></span><span>,
    password=</span><span><span>"your_password"</span></span><span>
)
cur = conn.cursor()

</span><span><span>with</span></span><span> </span><span><span>open</span></span><span>(</span><span><span>"target/run_results.json"</span></span><span>) </span><span><span>as</span></span><span> f:
    data = json.load(f)[</span><span><span>"results"</span></span><span>]

run_id = uuid.uuid4()

</span><span><span>for</span></span><span> r </span><span><span>in</span></span><span> data:
    cur.execute(<span>"""
        INSERT INTO dbt_run_results (run_id, model, status, execution_time, thread_id)
        VALUES (%s, %s, %s, %s, %s)
    """</span>, (
        run_id,
        r[</span><span><span>"node"</span></span><span>][</span><span><span>"name"</span></span><span>],
        r[</span><span><span>"status"</span></span><span>],
        r.get(</span><span><span>"execution_time"</span></span><span>, </span><span><span>0.0</span></span><span>),
        r.get(</span><span><span>"thread_id"</span></span><span>, </span><span><span>""</span></span><span>)
    ))

conn.commit()
cur.close()
conn.close()
</span></span></code></p></div>
```

___

## üß† –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

-   ‚úÖ –ü—Ä–∏–≤—è–∑—ã–≤–∞–π `run_id` –∫ –∫–∞–∂–¥–æ–º—É –∑–∞–ø—É—Å–∫—É (`uuid`), —á—Ç–æ–±—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é.
    
-   ‚úÖ –•—Ä–∞–Ω–∏ —Ç–∞–∫–∂–µ –¥–∞—Ç—É (`started_at`) ‚Äî –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —Ç–∞–π–º–ª–∞–π–Ω–æ–≤.
    
-   üìä –ú–æ–∂–Ω–æ –¥–æ–ø–æ–ª–Ω–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É –ø–æ–ª—è–º–∏:
    
    -   `env` (dev/prod),
        
    -   `commit_sha`,
        
    -   `invoked_by` (CI, —á–µ–ª–æ–≤–µ–∫).
        

___

## üöÄ –•–æ—á–µ—à—å –ø—Ä–∏–º–µ—Ä —Å `dbt-artifacts` package?

–≠—Ç–æ –≥–æ—Ç–æ–≤—ã–π dbt-–ø—Ä–æ–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π:

-   —á–∏—Ç–∞–µ—Ç JSON-–∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã,
    
-   –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –∏—Ö –≤ –º–æ–¥–µ–ª–∏ (`run_results`, `test_results`, `exposures`),
    
-   —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Ö –≤ warehouse (Postgres, BigQuery, Snowflake, etc.).
    

–ï—Å–ª–∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ ‚Äî –º–æ–≥—É –ø–æ–º–æ—á—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å `dbt-artifacts` –∫ ClickHouse —á–µ—Ä–µ–∑ –≤–Ω–µ—à–Ω–∏–π –ø–∞—Ä—Å–∏–Ω–≥.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–ø—Ä–∏–º–µ—Ä —Å dbt-artifacts package

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–í–æ—Ç –ø–æ—à–∞–≥–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä, –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å [`dbt-artifacts`](https://github.com/dbt-labs/dbt-artifacts) ‚Äî —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π dbt-–ø–∞–∫–µ—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç `run_results.json`, `manifest.json` –∏ –¥—Ä—É–≥–∏–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –≤ –º–æ–¥–µ–ª–∏ –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∑–∞–ø—É—Å–∫–æ–≤ –≤ –≤–∞—à–µ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (PostgreSQL, Snowflake, BigQuery –∏ —Ç.–¥.). –ú—ã –∞–¥–∞–ø—Ç–∏—Ä—É–µ–º –µ–≥–æ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ **Postgres** –∏–ª–∏ **ClickHouse**.

___

## üì¶ –ß—Ç–æ –¥–µ–ª–∞–µ—Ç `dbt-artifacts`?

-   –ó–∞–±–∏—Ä–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ `target/*.json` (dbt-–∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã).
    
-   –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∏—Ö –≤ staging-—Ç–∞–±–ª–∏—Ü—ã (`stg_artifacts__*`).
    
-   –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ fact-—Ç–∞–±–ª–∏—Ü—ã (`int_artifacts__*`, `dim_*`).
    
-   –ú–æ–∂–Ω–æ –ø–æ—Ç–æ–º –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤ Grafana, Superset, Metabase –∏ —Ç.–¥.
    

___

## ‚úÖ –®–∞–≥–∏ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ

### 1\. –£—Å—Ç–∞–Ω–æ–≤–∏ –ø–∞–∫–µ—Ç –≤ —Å–≤–æ–π `packages.yml`

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>packages:</span></span><span>
  </span><span><span>-</span></span><span> </span><span><span>package:</span></span><span> </span><span><span>dbt-labs/dbt_artifacts</span></span><span>
    </span><span><span>version:</span></span><span> [</span><span><span>"&gt;=1.5.0"</span></span><span>, </span><span><span>"&lt;2.0.0"</span></span><span>]
</span></span></code></p></div>
```

–ó–∞–ø—É—Å—Ç–∏:

___

### 2\. –°–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–π `dbt_project.yml`

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>vars:</span></span><span>
  </span><span><span>dbt_artifacts:</span></span><span>
    </span><span><span>dbt_version:</span></span><span> </span><span><span>1.7</span></span><span>  </span><span><span># –∏–ª–∏ —Ç–≤–æ—è –≤–µ—Ä—Å–∏—è</span></span><span>
</span></span></code></p></div>
```

___

### 3\. –°–æ–∑–¥–∞–π —Ç–∞–±–ª–∏—Ü—ã –∏–∑ JSON-—Ñ–∞–π–ª–æ–≤

–î–æ–±–∞–≤—å `sources` (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ `models/artifacts/sources.yml`):

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>version:</span></span><span> </span><span><span>2</span></span><span>

</span><span><span>sources:</span></span><span>
  </span><span><span>-</span></span><span> </span><span><span>name:</span></span><span> </span><span><span>artifacts</span></span><span>
    </span><span><span>tables:</span></span><span>
      </span><span><span>-</span></span><span> </span><span><span>name:</span></span><span> </span><span><span>manifest</span></span><span>
        </span><span><span>external:</span></span><span>
          </span><span><span>location:</span></span><span> </span><span><span>'file://target/manifest.json'</span></span><span>
          </span><span><span>format:</span></span><span> </span><span><span>json</span></span><span>
      </span><span><span>-</span></span><span> </span><span><span>name:</span></span><span> </span><span><span>run_results</span></span><span>
        </span><span><span>external:</span></span><span>
          </span><span><span>location:</span></span><span> </span><span><span>'file://target/run_results.json'</span></span><span>
          </span><span><span>format:</span></span><span> </span><span><span>json</span></span><span>
</span></span></code></p></div>
```

üîß –ï—Å–ª–∏ —Ä–∞–±–æ—Ç–∞–µ—à—å —Å ClickHouse ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤–Ω–µ—à–Ω–∏–π –ø–∞—Ä—Å–∏–Ω–≥ –≤ Python, —Å–º. –Ω–∏–∂–µ.

___

### 4\. –í—ã–ø–æ–ª–Ω–∏ `dbt run` –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>dbt run --</span><span><span>select</span></span><span> dbt_artifacts
</span></span></code></p></div>
```

üí° –í Postgres —ç—Ç–æ —Å–æ–∑–¥–∞—Å—Ç —Ç–∞–±–ª–∏—Ü—ã –∏ –∑–∞–≥—Ä—É–∑–∏—Ç —Ç—É–¥–∞ –¥–∞–Ω–Ω—ã–µ.

___

## üåÄ –í–∞—Ä–∏–∞–Ω—Ç –¥–ª—è ClickHouse (–æ–±—Ö–æ–¥–Ω–æ–π)

ClickHouse –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç `external: file://` –Ω–∞–ø—Ä—è–º—É—é –≤ dbt, –ø–æ—ç—Ç–æ–º—É:

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –≤—Ä—É—á–Ω—É—é –ø–∞—Ä—Å–∏–º JSON –∏ –ø–∏—à–µ–º –≤ staging-—Ç–∞–±–ª–∏—Ü—ã ClickHouse

1.  –ü–∞—Ä—Å–∏ JSON-—Ñ–∞–π–ª—ã Python-—Å–∫—Ä–∏–ø—Ç–æ–º (–ø—Ä–∏–º–µ—Ä –±—ã–ª –≤—ã—à–µ).
    
2.  –í—Å—Ç–∞–≤—å –¥–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—Ü—É ClickHouse.
    
3.  –°–æ–∑–¥–∞–π dbt-–º–æ–¥–µ–ª–∏ –ø–æ–≤–µ—Ä—Ö —ç—Ç–∏—Ö staging-—Ç–∞–±–ª–∏—Ü, –∫–∞–∫ `ref('stg_artifacts__run_results')`.
    

___

## üîç –ß—Ç–æ –ø–æ–ª—É—á–∏—à—å –Ω–∞ –≤—ã—Ö–æ–¥–µ?

-   `int_artifacts__run_results` ‚Äî –º–µ—Ç—Ä–∏–∫–∏ –ø–æ –∫–∞–∂–¥–æ–π –º–æ–¥–µ–ª–∏
    
-   `dim_models`, `dim_tests` ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π/—Ç–µ—Å—Ç–æ–≤
    
-   `fct_run_results`, `fct_exposures` ‚Äî —Ñ–∞–∫—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
    

–ú–æ–∂–Ω–æ —Å—Ç—Ä–æ–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫–∏:

-   –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –º–æ–¥–µ–ª–µ–π,
    
-   —á–∞—Å—Ç–æ—Ç–∞ –æ—à–∏–±–æ–∫,
    
-   —Å—Ç–∞—Ç—É—Å –∑–∞–ø—É—Å–∫–æ–≤ –ø–æ –¥–Ω—è–º.
    

___

## üöÄ –•–æ—á–µ—à—å –ø—Ä–∏–º–µ—Ä —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è —Å dbt-artifacts + Postgres –∏–ª–∏ ClickHouse?

–ú–æ–≥—É –ø—Ä–∏—Å–ª–∞—Ç—å –∏–ª–∏ —Å–æ–±—Ä–∞—Ç—å —à–∞–±–ª–æ–Ω –ø–æ–¥ —Ç–≤–æ–π —Å—Ç–µ–∫ (Docker + dbt + exporter).

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–ø—Ä–∏—Å–ª–∞—Ç—å –∏ —Å–æ–±—Ä–∞—Ç—å —à–∞–±–ª–æ–Ω –ø–æ–¥ —Ç–≤–æ–π —Å—Ç–µ–∫ (Docker + dbt + exporter)

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–•–æ—Ä–æ—à–æ! –ù–∏–∂–µ ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —à–∞–±–ª–æ–Ω **dbt + dbt-artifacts + PostgreSQL + Prometheus Exporter** –≤ Docker. –û–Ω:

-   –∑–∞–ø—É—Å–∫–∞–µ—Ç `dbt`,
    
-   –ø–∞—Ä—Å–∏—Ç `run_results.json`,
    
-   —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ PostgreSQL,
    
-   —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –≤ Prometheus.
    

___

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
<div><p>arduino</p><p><code><span><span>dbt-artifacts-stack/
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ dbt_project/
‚îÇ   ‚îú‚îÄ‚îÄ dbt_project.yml
‚îÇ   ‚îú‚îÄ‚îÄ packages.yml
‚îÇ   ‚îî‚îÄ‚îÄ models/
‚îú‚îÄ‚îÄ parser/
‚îÇ   ‚îî‚îÄ‚îÄ exporter.py
‚îú‚îÄ‚îÄ requirements.txt
‚îî‚îÄ‚îÄ .env
</span></span></code></p></div>
```

___

## üì¶ 1. `docker-compose.yml`

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>version:</span></span><span> </span><span><span>"3.8"</span></span><span>

</span><span><span>services:</span></span><span>
  </span><span><span>postgres:</span></span><span>
    </span><span><span>image:</span></span><span> </span><span><span>postgres:15</span></span><span>
    </span><span><span>environment:</span></span><span>
      </span><span><span>POSTGRES_USER:</span></span><span> </span><span><span>dbt</span></span><span>
      </span><span><span>POSTGRES_PASSWORD:</span></span><span> </span><span><span>dbt</span></span><span>
      </span><span><span>POSTGRES_DB:</span></span><span> </span><span><span>dbt</span></span><span>
    </span><span><span>ports:</span></span><span>
      </span><span><span>-</span></span><span> </span><span><span>"5432:5432"</span></span><span>

  </span><span><span>dbt:</span></span><span>
    </span><span><span>image:</span></span><span> </span><span><span>ghcr.io/dbt-labs/dbt-postgres:1.7.6</span></span><span>
    </span><span><span>working_dir:</span></span><span> </span><span><span>/usr/app</span></span><span>
    </span><span><span>volumes:</span></span><span>
      </span><span><span>-</span></span><span> </span><span><span>./dbt_project:/usr/app</span></span><span>
    </span><span><span>environment:</span></span><span>
      </span><span><span>DBT_PROFILES_DIR:</span></span><span> </span><span><span>/usr/app</span></span><span>
    </span><span><span>depends_on:</span></span><span>
      </span><span><span>-</span></span><span> </span><span><span>postgres</span></span><span>
    </span><span><span>entrypoint:</span></span><span> [</span><span><span>"/bin/sh"</span></span><span>, </span><span><span>"-c"</span></span><span>]
    </span><span><span>command:</span></span><span> <span>&gt;
      "dbt deps &amp;&amp;
       dbt run &amp;&amp;
       dbt test &amp;&amp;
       sleep infinity"
</span>
  </span><span><span>exporter:</span></span><span>
    </span><span><span>build:</span></span><span>
      </span><span><span>context:</span></span><span> </span><span><span>./parser</span></span><span>
    </span><span><span>ports:</span></span><span>
      </span><span><span>-</span></span><span> </span><span><span>"8000:8000"</span></span><span>
    </span><span><span>volumes:</span></span><span>
      </span><span><span>-</span></span><span> </span><span><span>./dbt_project/target:/app/target</span></span><span>
    </span><span><span>depends_on:</span></span><span>
      </span><span><span>-</span></span><span> </span><span><span>dbt</span></span><span>
      </span><span><span>-</span></span><span> </span><span><span>postgres</span></span><span>
</span></span></code></p></div>
```

___

## üìÅ 2. `dbt_project/dbt_project.yml`

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>name:</span></span><span> </span><span><span>artifacts_project</span></span><span>
</span><span><span>version:</span></span><span> </span><span><span>'1.0'</span></span><span>
</span><span><span>profile:</span></span><span> </span><span><span>default</span></span><span>
</span><span><span>config-version:</span></span><span> </span><span><span>2</span></span><span>

</span><span><span>vars:</span></span><span>
  </span><span><span>dbt_artifacts:</span></span><span>
    </span><span><span>dbt_version:</span></span><span> </span><span><span>1.7</span></span><span>

</span><span><span>model-paths:</span></span><span> [</span><span><span>"models"</span></span><span>]
</span><span><span>target-path:</span></span><span> </span><span><span>"target"</span></span><span>

</span><span><span>models:</span></span><span>
  </span><span><span>dbt_artifacts:</span></span><span>  </span><span><span># –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –ø–∞–∫–µ—Ç</span></span><span>
    </span><span><span>+enabled:</span></span><span> </span><span><span>true</span></span><span>
</span></span></code></p></div>
```

___

## üìÅ 3. `dbt_project/profiles.yml`

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>default:</span></span><span>
  </span><span><span>target:</span></span><span> </span><span><span>dev</span></span><span>
  </span><span><span>outputs:</span></span><span>
    </span><span><span>dev:</span></span><span>
      </span><span><span>type:</span></span><span> </span><span><span>postgres</span></span><span>
      </span><span><span>host:</span></span><span> </span><span><span>postgres</span></span><span>
      </span><span><span>user:</span></span><span> </span><span><span>dbt</span></span><span>
      </span><span><span>password:</span></span><span> </span><span><span>dbt</span></span><span>
      </span><span><span>dbname:</span></span><span> </span><span><span>dbt</span></span><span>
      </span><span><span>schema:</span></span><span> </span><span><span>public</span></span><span>
      </span><span><span>threads:</span></span><span> </span><span><span>1</span></span><span>
</span></span></code></p></div>
```

___

## üìÅ 4. `dbt_project/packages.yml`

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>packages:</span></span><span>
  </span><span><span>-</span></span><span> </span><span><span>package:</span></span><span> </span><span><span>dbt-labs/dbt_artifacts</span></span><span>
    </span><span><span>version:</span></span><span> [</span><span><span>"&gt;=1.5.0"</span></span><span>, </span><span><span>"&lt;2.0.0"</span></span><span>]
</span></span></code></p></div>
```

___

## üêç 5. `parser/exporter.py`

```
<div><p>python</p><p><code id="code-lang-python"><span><span><span>from</span></span><span> flask </span><span><span>import</span></span><span> Flask, Response
</span><span><span>import</span></span><span> json
</span><span><span>import</span></span><span> os

app = Flask(__name__)

</span><span><span>@app.route(<span><span>"/metrics"</span></span></span></span><span>)
</span><span><span>def</span></span><span> </span><span><span>metrics</span></span><span>():
    path = </span><span><span>"target/run_results.json"</span></span><span>
    </span><span><span>if</span></span><span> </span><span><span>not</span></span><span> os.path.exists(path):
        </span><span><span>return</span></span><span> Response(</span><span><span>"# No run_results.json found"</span></span><span>, mimetype=</span><span><span>"text/plain"</span></span><span>)

    </span><span><span>with</span></span><span> </span><span><span>open</span></span><span>(path) </span><span><span>as</span></span><span> f:
        results = json.load(f)[</span><span><span>"results"</span></span><span>]

    lines = []
    </span><span><span>for</span></span><span> r </span><span><span>in</span></span><span> results:
        model = r[</span><span><span>"node"</span></span><span>][</span><span><span>"name"</span></span><span>]
        status = </span><span><span>1</span></span><span> </span><span><span>if</span></span><span> r[</span><span><span>"status"</span></span><span>] == </span><span><span>"success"</span></span><span> </span><span><span>else</span></span><span> </span><span><span>0</span></span><span>
        duration = r.get(</span><span><span>"execution_time"</span></span><span>, </span><span><span>0.0</span></span><span>)

        lines.append(</span><span><span>f'dbt_model_runtime_seconds{{model="<span>{model}</span></span></span><span>"}} </span><span><span>{duration}</span></span><span>')
        lines.append(</span><span><span>f'dbt_model_status{{model="<span>{model}</span></span></span><span>"}} </span><span><span>{status}</span></span><span>')

    </span><span><span>return</span></span><span> Response(</span><span><span>"\n"</span></span><span>.join(lines), mimetype=</span><span><span>"text/plain"</span></span><span>)

</span><span><span>if</span></span><span> __name__ == </span><span><span>"__main__"</span></span><span>:
    app.run(host=</span><span><span>"0.0.0.0"</span></span><span>, port=</span><span><span>8000</span></span><span>)
</span></span></code></p></div>
```

___

## üìÅ 6. `parser/Dockerfile`

```
<div><p>dockerfile</p><p><code id="code-lang-dockerfile"><span>FROM python:3.10-slim
WORKDIR /app
COPY exporter.py .
COPY ../requirements.txt .
RUN pip install -r requirements.txt
CMD ["python", "exporter.py"]
</span></code></p></div>
```

___

## üìÑ 7. `requirements.txt`

___

## ‚ñ∂Ô∏è –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>git </span><span><span>clone</span></span><span> &lt;—ç—Ç–æ—Ç —à–∞–±–ª–æ–Ω&gt;
</span><span><span>cd</span></span><span> dbt-artifacts-stack
docker compose up --build
</span></span></code></p></div>
```

___

## üìä –ß—Ç–æ –¥–∞–ª—å—à–µ?

-   –ü–æ–¥–∫–ª—é—á–∏ Prometheus: `localhost:8000/metrics`.
    
-   –ü–æ–¥–∫–ª—é—á–∏ Grafana, —Å–æ–∑–¥–∞–π –¥–∞—à–±–æ—Ä–¥—ã.
    
-   –î–æ–±–∞–≤—å `dbt run` –≤ CI (GitHub Actions, GitLab CI).
    
-   –î–æ–±–∞–≤—å —ç–∫—Å–ø–æ—Ä—Ç –≤ ClickHouse, –µ—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è.
    

___

–•–æ—á–µ—à—å, —á—Ç–æ–±—ã —è –∑–∞–ª–∏–ª —ç—Ç–æ—Ç —à–∞–±–ª–æ–Ω –Ω–∞ GitHub –∏ –¥–∞–ª —Å—Å—ã–ª–∫—É? –ò–ª–∏ —Å–æ–±—Ä–∞—Ç—å –≤–µ—Ä—Å–∏—é –ø–æ–¥ ClickHouse?

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–º–æ–∂–Ω–æ –ª–∏ –≤ dbt –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Python —Å–∫—Ä–∏–ø—Ç—ã?

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–î–∞, **–≤ dbt –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Python-—Å–∫—Ä–∏–ø—Ç—ã**, –Ω–æ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å **–¥–≤–∏–∂–∫–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ —ç—Ç–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç**, –Ω–∞–ø—Ä–∏–º–µ—Ä:

___

## ‚úÖ –ì–¥–µ Python –≤ dbt –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è?

| Data Warehouse | –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç Python –≤ dbt? | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
| --- | --- | --- |
| **Snowflake** | ‚úÖ –î–∞ | –ß–µ—Ä–µ–∑ `@snowflake` –≤ `language: python` |
| **Databricks** | ‚úÖ –î–∞ | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ PySpark |
| **BigQuery** | ‚ùå –ù–µ—Ç | –¢–æ–ª—å–∫–æ SQL |
| **PostgreSQL** | ‚ùå –ù–µ—Ç (–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ) | –ú–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –≤–Ω–µ dbt —á–µ—Ä–µ–∑ —Ö—É–∫–∏ |
| **ClickHouse** | ‚ùå –ù–µ—Ç | –¢–æ–ª—å–∫–æ SQL |

___

## üî∏ –ü—Ä–∏–º–µ—Ä Python-–º–æ–¥–µ–ª–∏ –¥–ª—è Snowflake

–§–∞–π–ª: `models/python_example.py`

```
<div><p>python</p><p><code id="code-lang-python"><span><span><span>def</span></span><span> </span><span><span>model</span></span><span>(</span><span><span>dbt, session</span></span><span>):
    dbt.config(
        materialized=</span><span><span>"table"</span></span><span>
    )

    df = session.sql(</span><span><span>"select * from raw_data"</span></span><span>).to_pandas()
    df[</span><span><span>"processed"</span></span><span>] = df[</span><span><span>"value"</span></span><span>] * </span><span><span>2</span></span><span>
    </span><span><span>return</span></span><span> df
</span></span></code></p></div>
```

> –≠—Ç–æ—Ç –∫–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç **—Ç–æ–ª—å–∫–æ –≤ Snowflake + dbt Cloud / dbt Core —Å Python Runtime**.

___

## üß© –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:

-   dbt –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **Python-Run-Time** –Ω–∞ –¥–≤–∏–∂–∫–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, Snowpark –≤ Snowflake –∏–ª–∏ PySpark –≤ Databricks).
    
-   Python-–º–æ–¥–µ–ª—å –æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è –≤ UDF –∏ –∏—Å–ø–æ–ª–Ω—è–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω–µ.
    
-   –í—ã –º–æ–∂–µ—Ç–µ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å DataFrame, –∫–æ—Ç–æ—Ä—ã–π —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∫–∞–∫ `table`, `view`, –∏ —Ç.–¥.
    

___

## üö´ –í ClickHouse / Postgres

-   dbt –Ω–µ –º–æ–∂–µ—Ç –Ω–∞–ø—Ä—è–º—É—é –∑–∞–ø—É—Å–∫–∞—Ç—å Python-–º–æ–¥–µ–ª–∏.
    
-   **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞**:
    
    -   –í—ã–∑—ã–≤–∞—Ç—å Python-—Å–∫—Ä–∏–ø—Ç—ã —á–µ—Ä–µ–∑ `on-run-end` / `pre-hook`.
        
    -   –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Python –≤–Ω–µ dbt (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–∞—Ä—Å–∏–Ω–≥ `run_results.json`, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü).
        
    -   –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `dbt-external-tables`, –µ—Å–ª–∏ Python –ø–∏—à–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ CSV/Parquet.
        

___

## ‚úÖ –ö–∞–∫ —É–∑–Ω–∞—Ç—å, –¥–æ—Å—Ç—É–ø–Ω–∞ –ª–∏ Python-–º–æ–¥–µ–ª—å?

dbt –ø–æ–∫–∞–∂–µ—Ç –æ—à–∏–±–∫—É –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ, –µ—Å–ª–∏ –≤–∞—à –∞–¥–∞–ø—Ç–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç Python-–º–æ–¥–µ–ª–∏. –¢–∞–∫–∂–µ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–æ –∞–¥–∞–ø—Ç–µ—Ä–∞–º –µ—Å—Ç—å —Å–ø–∏—Å–æ–∫ –¥–≤–∏–∂–∫–æ–≤ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π.

___

–•–æ—á–µ—à—å, —á—Ç–æ–±—ã —è –ø–æ–∫–∞–∑–∞–ª –ø—Ä–∏–º–µ—Ä, –∫–∞–∫ –≤ dbt + Postgres –∑–∞–ø—É—Å–∫–∞—Ç—å Python-–æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö –¥–æ –∏–ª–∏ –ø–æ—Å–ª–µ `dbt run` —á–µ—Ä–µ–∑ —Ö—É–∫–∏?

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–û—Ç–ª–∏—á–Ω–æ! –ü–æ–∫–∞–∂—É –ø—Ä–∏–º–µ—Ä, **–∫–∞–∫ –∑–∞–ø—É—Å–∫–∞—Ç—å Python-—Å–∫—Ä–∏–ø—Ç –¥–æ –∏–ª–∏ –ø–æ—Å–ª–µ `dbt run`** –≤ –ø—Ä–æ–µ–∫—Ç–µ —Å PostgreSQL (–∏–ª–∏ –¥—Ä—É–≥–∏–º SQL-–¥–≤–∏–∂–∫–æ–º, –≥–¥–µ Python –Ω–∞–ø—Ä—è–º—É—é –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è).

___

## üìå –ò–¥–µ—è: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `on-run-start` –∏–ª–∏ `on-run-end` —Ö—É–∫

dbt –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã shell –¥–æ/–ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è `dbt run`.

___

## ‚úÖ –ü—Ä–∏–º–µ—Ä: –∑–∞–ø—É—Å–∫ Python –ø–æ—Å–ª–µ `dbt run`

### 1\. Python-—Å–∫—Ä–∏–ø—Ç `scripts/analyze_run_results.py`

```
<div><p>python</p><p><code id="code-lang-python"><span><span><span>import</span></span><span> json

</span><span><span>with</span></span><span> </span><span><span>open</span></span><span>(</span><span><span>"target/run_results.json"</span></span><span>) </span><span><span>as</span></span><span> f:
    results = json.load(f)[</span><span><span>"results"</span></span><span>]

</span><span><span>for</span></span><span> r </span><span><span>in</span></span><span> results:
    model = r[</span><span><span>"node"</span></span><span>][</span><span><span>"name"</span></span><span>]
    status = r[</span><span><span>"status"</span></span><span>]
    exec_time = r.get(</span><span><span>"execution_time"</span></span><span>, </span><span><span>0</span></span><span>)
    </span><span><span>print</span></span><span>(</span><span><span>f"[<span>{status.upper()}</span></span></span><span>] </span><span><span>{model}</span></span><span> - </span><span><span>{exec_time:<span>.2</span></span></span><span>f}s")
</span></span></code></p></div>
```

___

### 2\. `dbt_project.yml` ‚Äî –¥–æ–±–∞–≤–∏–º `on-run-end`

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>name:</span></span><span> </span><span><span>my_project</span></span><span>
</span><span><span>version:</span></span><span> </span><span><span>"1.0"</span></span><span>
</span><span><span>config-version:</span></span><span> </span><span><span>2</span></span><span>

</span><span><span>on-run-end:</span></span><span>
  </span><span><span>-</span></span><span> </span><span><span>"python scripts/analyze_run_results.py"</span></span><span>
</span></span></code></p></div>
```

> –≠—Ç–æ—Ç —Ö—É–∫ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è `dbt run`.

___

## üì¶ –ü—Ä–∏–º–µ—Ä –∑–∞–ø—É—Å–∫–∞

‚úÖ –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω –≤–∞—à —Å–∫—Ä–∏–ø—Ç.

___

## üí° –ú–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å –±–æ–ª—å—à–µ:

-   –ü–∞—Ä—Å–∏—Ç—å –∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ Postgres, ClickHouse.
    
-   –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –≤ Prometheus, Sentry, Telegram –∏ —Ç.–¥.
    
-   –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `on-run-start`, —á—Ç–æ–±—ã –≥–æ—Ç–æ–≤–∏—Ç—å –≤–Ω–µ—à–Ω–∏–µ –¥–∞–Ω–Ω—ã–µ.
    

___

## üîÑ –ü—Ä–∏–º–µ—Ä —Å `on-run-start`

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>on-run-start:</span></span><span>
  </span><span><span>-</span></span><span> </span><span><span>"python scripts/prepare_input_data.py"</span></span><span>
</span></span></code></p></div>
```

___

## ‚õî –í–∞–∂–Ω–æ

-   –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è **–Ω–∞ –≤–∞—à–µ–π –º–∞—à–∏–Ω–µ** (–∏–ª–∏ CI/CD runner), –Ω–µ –≤ –±–∞–∑–µ.
    
-   –£–±–µ–¥–∏—Å—å, —á—Ç–æ `target/run_results.json` —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∫ –º–æ–º–µ–Ω—Ç—É –∑–∞–ø—É—Å–∫–∞ —Å–∫—Ä–∏–ø—Ç–∞.
    
-   –ï—Å–ª–∏ —Ç—ã –≤ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ ‚Äî —É–±–µ–¥–∏—Å—å, —á—Ç–æ Python –∏ —Ñ–∞–π–ª –µ—Å—Ç—å –≤–Ω—É—Ç—Ä–∏.
    

___

–•–æ—á–µ—à—å, —á—Ç–æ–±—ã —è –¥–æ–±–∞–≤–∏–ª —ç—Ç–æ –≤ Docker-—à–∞–±–ª–æ–Ω —Å `dbt-artifacts`, –∫–æ—Ç–æ—Ä—ã–π –º—ã –æ–±—Å—É–∂–¥–∞–ª–∏ —Ä–∞–Ω—å—à–µ?

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–•–æ—Ä–æ—à–æ! –î–æ–±–∞–≤–∏–º **Python-—Å–∫—Ä–∏–ø—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ `run_results.json` –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è dbt** –≤ –Ω–∞—à Docker-–ø—Ä–æ–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π —É–∂–µ –≤–∫–ª—é—á–∞–µ—Ç `dbt-artifacts`. –≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç:

-   –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –ø–æ—Å–ª–µ `dbt run`
    
-   –ü–æ–ª—É—á–∞—Ç—å —Å–ø–∏—Å–æ–∫ –æ—à–∏–±–æ–∫ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –≤—Ä–µ–º–µ–Ω–∏
    
-   (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —ç—Ç–æ –≤ Postgres –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
    

___

## üß© –û–±–Ω–æ–≤–ª—ë–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
<div><p>arduino</p><p><code><span><span>dbt-artifacts-stack/
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ dbt_project/
‚îÇ   ‚îú‚îÄ‚îÄ dbt_project.yml        ‚Üê –¥–æ–±–∞–≤–∏–º on-run-end
‚îÇ   ‚îú‚îÄ‚îÄ packages.yml
‚îÇ   ‚îú‚îÄ‚îÄ profiles.yml
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îî‚îÄ‚îÄ scripts/
‚îÇ       ‚îî‚îÄ‚îÄ analyze_run_results.py  ‚Üê –≤–æ—Ç –æ–Ω!
</span></span></code></p></div>
```

___

## ‚úÖ 1. –°–∫—Ä–∏–ø—Ç `analyze_run_results.py`

–ü—É—Ç—å: `dbt_project/scripts/analyze_run_results.py`

```
<div><p>python</p><p><code id="code-lang-python"><span><span><span>import</span></span><span> json
</span><span><span>import</span></span><span> os

path = </span><span><span>"target/run_results.json"</span></span><span>
</span><span><span>if</span></span><span> </span><span><span>not</span></span><span> os.path.exists(path):
    </span><span><span>print</span></span><span>(</span><span><span>"[WARN] run_results.json not found."</span></span><span>)
    exit(</span><span><span>0</span></span><span>)

</span><span><span>with</span></span><span> </span><span><span>open</span></span><span>(path) </span><span><span>as</span></span><span> f:
    data = json.load(f)

results = data.get(</span><span><span>"results"</span></span><span>, [])
total_time = </span><span><span>sum</span></span><span>(r.get(</span><span><span>"execution_time"</span></span><span>, </span><span><span>0</span></span><span>) </span><span><span>for</span></span><span> r </span><span><span>in</span></span><span> results)
errors = [r </span><span><span>for</span></span><span> r </span><span><span>in</span></span><span> results </span><span><span>if</span></span><span> r.get(</span><span><span>"status"</span></span><span>) != </span><span><span>"success"</span></span><span>]

</span><span><span>print</span></span><span>(</span><span><span>f"\n‚úÖ Models executed: <span>{<span>len</span></span></span></span><span>(results)}")
</span><span><span>print</span></span><span>(</span><span><span>f"‚è±Ô∏è Total execution time: <span>{total_time:<span>.2</span></span></span></span><span>f} seconds")
</span><span><span>print</span></span><span>(</span><span><span>f"‚ùå Errors: <span>{<span>len</span></span></span></span><span>(errors)}")

</span><span><span>if</span></span><span> errors:
    </span><span><span>print</span></span><span>(</span><span><span>"---- Failed Models ----"</span></span><span>)
    </span><span><span>for</span></span><span> r </span><span><span>in</span></span><span> errors:
        </span><span><span>print</span></span><span>(</span><span><span>f"<span>{r[<span>'node'</span></span></span></span><span>][</span><span><span>'name'</span></span><span>]} - </span><span><span>{r[<span>'status'</span></span></span><span>]}")
</span></span></code></p></div>
```

___

## üõ†Ô∏è 2. –û–±–Ω–æ–≤–∏–º `dbt_project.yml`

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>name:</span></span><span> </span><span><span>artifacts_project</span></span><span>
</span><span><span>version:</span></span><span> </span><span><span>'1.0'</span></span><span>
</span><span><span>profile:</span></span><span> </span><span><span>default</span></span><span>
</span><span><span>config-version:</span></span><span> </span><span><span>2</span></span><span>

</span><span><span>model-paths:</span></span><span> [</span><span><span>"models"</span></span><span>]
</span><span><span>target-path:</span></span><span> </span><span><span>"target"</span></span><span>

</span><span><span>vars:</span></span><span>
  </span><span><span>dbt_artifacts:</span></span><span>
    </span><span><span>dbt_version:</span></span><span> </span><span><span>1.7</span></span><span>

</span><span><span>on-run-end:</span></span><span>
  </span><span><span>-</span></span><span> </span><span><span>"python scripts/analyze_run_results.py"</span></span><span>
</span></span></code></p></div>
```

___

## üê≥ 3. –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ –≤—Å—ë –¥–æ—Å—Ç—É–ø–Ω–æ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ

–í `docker-compose.yml` (–≤ `dbt:`), –¥–æ–±–∞–≤—å volume:

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>volumes:</span></span><span>
  </span><span><span>-</span></span><span> </span><span><span>./dbt_project:/usr/app</span></span><span>
</span></span></code></p></div>
```

–£ —Ç–µ–±—è —É–∂–µ –µ—Å—Ç—å —ç—Ç–æ, –∑–Ω–∞—á–∏—Ç `scripts/analyze_run_results.py` —Ç–æ–∂–µ –ø–æ–ø–∞–¥—ë—Ç –≤–Ω—É—Ç—Ä—å.

___

## üß™ 4. –ó–∞–ø—É—Å–∫

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>docker compose up --build
</span></span></code></p></div>
```

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è `dbt run` –≤ –ª–æ–≥–∞—Ö –ø–æ—è–≤–∏—Ç—Å—è:

```
<div><p>lua</p><p><code><span><span>‚úÖ Models executed: </span><span><span>5</span></span><span>
‚è±Ô∏è Total execution </span><span><span>time</span></span><span>: </span><span><span>12.34</span></span><span> seconds
‚ùå Errors: </span><span><span>1</span></span><span>
</span><span><span>---- Failed Models ----</span></span><span>
stg_customers - </span><span><span>error</span></span><span>
</span></span></code></p></div>
```

___

## ‚è≠ –ß—Ç–æ –¥–∞–ª—å—à–µ?

–•–æ—á–µ—à—å:

-   —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –≤ Postgres/ClickHouse?
    
-   –ø–æ–¥–∫–ª—é—á–∏—Ç—å Telegram/Sentry/Prometheus?
    

–ú–æ–≥—É —Å—Ä–∞–∑—É –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç—á—ë—Ç–∞ –≤ —Ç–∞–±–ª–∏—Ü—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, `run_metrics`).

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–º–æ–∂–µ—Ç –ª–∏ dbt –≤ –æ–¥–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∑–∞–±–∏—Ä–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–∏ –∏–∑ —Ä–∞–∑–Ω—ã—Ö –±–∞–∑ postgres, clickhouse?

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–ö–æ—Ä–æ—Ç–∫–∏–π –æ—Ç–≤–µ—Ç: **dbt –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞–±–æ—Ç—É —Å —Ä–∞–∑–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ –±–∞–∑ –≤ –æ–¥–Ω–æ–º –ø—Ä–æ—Ñ–∏–ª–µ –∏–ª–∏ –≤ –æ–¥–Ω–æ–º –∑–∞–ø—É—Å–∫–µ** ‚Äî –∫–∞–∂–¥—ã–π –ø—Ä–æ—Ñ–∏–ª—å –æ–±—ã—á–Ω–æ –Ω–∞—Ü–µ–ª–µ–Ω –Ω–∞ –æ–¥–∏–Ω –∞–¥–∞–ø—Ç–µ—Ä/—Ç–∏–ø –±–∞–∑—ã.

___

### –ü–æ—á–µ–º—É?

-   –í `profiles.yml` —Ç—ã —É–∫–∞–∑—ã–≤–∞–µ—à—å –æ–¥–∏–Ω —Ç–∏–ø `adapter` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `postgres` –∏–ª–∏ `clickhouse`).
    
-   –ê–¥–∞–ø—Ç–µ—Ä —É–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º, —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–æ–º SQL –∏ —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏.
    
-   dbt-–∫–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç –º–æ–¥–µ–ª–∏ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –æ–¥–Ω–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.
    

___

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—Ç—å —Å —Ä–∞–∑–Ω—ã–º–∏ –±–∞–∑–∞–º–∏?

1.  **–ù–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ—Ñ–∏–ª–µ–π –∏ –∑–∞–ø—É—Å–∫–æ–≤ dbt:**
    

-   –°–æ–∑–¥–∞—ë—à—å –¥–≤–∞ –ø—Ä–æ—Ñ–∏–ª—è ‚Äî –æ–¥–∏–Ω –¥–ª—è Postgres, –¥—Ä—É–≥–æ–π –¥–ª—è ClickHouse.
    
-   –ó–∞–ø—É—Å–∫–∞–µ—à—å dbt –æ—Ç–¥–µ–ª—å–Ω–æ –ø–æ–¥ –∫–∞–∂–¥—ã–º –ø—Ä–æ—Ñ–∏–ª–µ–º, –Ω–∞–ø—Ä–∏–º–µ—Ä:
    

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>dbt run --profile postgres_profile --</span><span><span>select</span></span><span> models_postgres
dbt run --profile clickhouse_profile --</span><span><span>select</span></span><span> models_clickhouse
</span></span></code></p></div>
```

2.  **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `dbt multi-target` —Å —Ä–∞–∑–Ω—ã–º–∏ `target` –≤ –æ–¥–Ω–æ–º –ø—Ä–æ—Ñ–∏–ª–µ (–æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –∞–¥–∞–ø—Ç–µ—Ä):**
    

-   –≠—Ç–æ –ø–æ–¥—Ö–æ–¥–∏—Ç, –µ—Å–ª–∏ –±–∞–∑—ã –æ–¥–Ω–æ–≥–æ —Ç–∏–ø–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–µ—Å–∫–æ–ª—å–∫–æ Postgres).
    
-   –ù–æ –Ω–µ–ª—å–∑—è —Å–º–µ—à–∏–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –∞–¥–∞–ø—Ç–µ—Ä—ã (Postgres + ClickHouse).
    

3.  **–í–Ω–µ—à–Ω—è—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, Airflow, Makefile):**
    

-   –û—Ä–∫–µ—Å—Ç—Ä–∏—Ä—É–µ—à—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ dbt –¥–ª—è –∫–∞–∂–¥–æ–π –±–∞–∑—ã.
    
-   –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç—ã, —á—Ç–æ–±—ã –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –≤ Postgres –∑–∞–ø—É—Å—Ç–∏—Ç—å dbt –¥–ª—è ClickHouse.
    

___

### –ú–æ–∂–Ω–æ –ª–∏ —Å–º–µ—à–∏–≤–∞—Ç—å ClickHouse –∏ Postgres –≤ –æ–¥–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ?

-   –í —Å–∞–º–æ–º dbt ‚Äî **–Ω–µ—Ç**.
    
-   –ù–æ –º–æ–∂–Ω–æ –¥–µ—Ä–∂–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø–æ–¥–º–æ–¥—É–ª–∏/–ø–∞–ø–∫–∏ –º–æ–¥–µ–ª–µ–π –¥–ª—è –∫–∞–∂–¥–æ–π –±–∞–∑—ã –∏ –∑–∞–ø—É—Å–∫–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ.
    
-   –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º—É–ª—å—Ç–∏-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.
    

___

### –û—Å–æ–±—ã–µ —Å–ª—É—á–∞–∏

-   –ï—Å—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∞–¥–∞–ø—Ç–µ—Ä—ã, –Ω–æ –æ–Ω–∏ –Ω–µ —Ä–µ—à–∞—é—Ç –º—É–ª—å—Ç–∏–∞–¥–∞–ø—Ç–µ—Ä–Ω–æ—Å—Ç—å –≤ –æ–¥–Ω–æ–º –∑–∞–ø—É—Å–∫–µ.
    
-   –ú–æ–∂–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å –≤–Ω–µ—à–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –≤ –æ–¥–Ω—É –±–∞–∑—É –∫–æ–ø–∏—Ä—É—é—Ç –¥–∞–Ω–Ω—ã–µ –≤ –¥—Ä—É–≥—É—é.
    

___

### –ò—Ç–æ–≥

| –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å | –ï—Å—Ç—å –≤ dbt? |
| --- | --- |
| –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —Ä–∞–∑–Ω—ã–º –ë–î | –ù–µ—Ç |
| –ù–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ—Ñ–∏–ª–µ–π –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ë–î | –î–∞ |
| –ó–∞–ø—É—Å–∫ —Ä–∞–∑–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ë–î –≤ –æ–¥–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ | –ú–æ–∂–Ω–æ, –Ω–æ –ø–æ –æ—Ç–¥–µ–ª—å–Ω–æ—Å—Ç–∏ |
| –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ CI/–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä | –î–∞ |

___

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ, –º–æ–≥—É –ø–æ–º–æ—á—å —Å–æ—Å—Ç–∞–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏ –∑–∞–ø—É—Å–∫–∞ dbt –ø–æ —Ä–∞–∑–Ω—ã–º –±–∞–∑–∞–º –≤ GitHub Actions –∏–ª–∏ Airflow.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

###### ChatGPT —Å–∫–∞–∑–∞–ª:

**Staging** (—Å—Ç–µ–π–¥–∂–∏–Ω–≥) ‚Äî —ç—Ç–æ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π —ç—Ç–∞–ø –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö, –∫–∞–∫ –ø—Ä–∞–≤–∏–ª–æ, –º–µ–∂–¥—É **—Å—ã—Ä–æ–π (raw)** –∏ **—Ñ–∏–Ω–∞–ª—å–Ω–æ–π (business-ready)** –º–æ–¥–µ–ª—å—é –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö. –≠—Ç–æ—Ç —Ç–µ—Ä–º–∏–Ω –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ —Ä–∞–∑–Ω—ã—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞—Ö, –Ω–æ –≤ Data Engineering –∏ dbt –æ–Ω –∏–º–µ–µ—Ç —á—ë—Ç–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.

___

## üîπ –í –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ dbt –∏ —Ö—Ä–∞–Ω–∏–ª–∏—â –¥–∞–Ω–Ω—ã—Ö:

### Staging-–º–æ–¥–µ–ª–∏:

-   **–û—á–∏—â–∞—é—Ç, —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä—É—é—Ç –∏ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞—é—Ç** –ø–æ–ª—è –∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑ Postgres, ClickHouse –∏ —Ç.–¥.)
    
-   –û–±—ã—á–Ω–æ —Ä–∞–±–æ—Ç–∞—é—Ç **–æ–¥–∏–Ω-–∫-–æ–¥–Ω–æ–º—É** —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏ –∏–∑ `raw`\-—Å–ª–æ—è
    
-   –î–∞—é—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ–µ API –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–∏—Ö –º–æ–¥–µ–ª–µ–π
    

___

## üß± –¢–∏–ø–∏—á–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥–µ–ª–µ–π:

```
<div><p>pgsql</p><p><code><span><span>models/
‚îú‚îÄ‚îÄ staging/
‚îÇ   ‚îî‚îÄ‚îÄ stg_orders.</span><span><span>sql</span></span><span>          ‚Üê staging-—É—Ä–æ–≤–µ–Ω—å
‚îú‚îÄ‚îÄ marts/
‚îÇ   ‚îî‚îÄ‚îÄ fct_orders.</span><span><span>sql</span></span><span>          ‚Üê —Ñ–∏–Ω–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å (–º–∞—Ä—Ç—ã)
</span></span></code></p></div>
```

___

### –ü—Ä–∏–º–µ—Ä

–ò—Å—Ç–æ—á–Ω–∏–∫: `orders_raw` (–∏–∑ Postgres)

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span><span>-- models/staging/stg_orders.sql</span></span><span>
</span><span><span>with</span></span><span> source </span><span><span>as</span></span><span> (
    </span><span><span>select</span></span><span> </span><span><span>*</span></span><span> </span><span><span>from</span></span><span> {{ source(</span><span><span>'raw'</span></span><span>, </span><span><span>'orders'</span></span><span>) }}
),

renamed </span><span><span>as</span></span><span> (
    </span><span><span>select</span></span><span>
        id </span><span><span>as</span></span><span> order_id,
        user_id,
        total_amount,
        order_date::</span><span><span>date</span></span><span> </span><span><span>as</span></span><span> order_date
    </span><span><span>from</span></span><span> source
)

</span><span><span>select</span></span><span> </span><span><span>*</span></span><span> </span><span><span>from</span></span><span> renamed
</span></span></code></p></div>
```

–ó–∞—Ç–µ–º `fct_orders.sql` (—Ñ–∏–Ω–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å) –±—É–¥–µ—Ç —Å—Å—ã–ª–∞—Ç—å—Å—è –Ω–∞ `stg_orders`.

___

## üîÅ –ó–∞—á–µ–º –Ω—É–∂–µ–Ω `staging`:

| –¶–µ–ª—å | –û–ø–∏—Å–∞–Ω–∏–µ |
| --- | --- |
| üßπ –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö | –ü—Ä–∏–≤–µ–¥–µ–Ω–∏–µ —Ç–∏–ø–æ–≤, –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –ø–æ–ª–µ–π, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è |
| üîí –ò–∑–æ–ª—è—Ü–∏—è –æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π | –ï—Å–ª–∏ —Å—ã—Ä–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫ –º–µ–Ω—è–µ—Ç—Å—è ‚Äî –º–µ–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ `staging`, –Ω–µ –≤–µ—Å—å —Å–ª–æ–π |
| üîÅ –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ | –ù–µ—Å–∫–æ–ª—å–∫–æ downstream-–º–æ–¥–µ–ª–µ–π –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `stg_*` |
| üì¶ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –º–∞—Ä—Ç–∞–º | –£–ø—Ä–æ—â–∞–µ—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ `fct_*`, `dim_*`, `snapshot_*` |

___

## üìò –í –¥—Ä—É–≥–∏—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞—Ö

-   **CI/CD**: `staging` ‚Äî —Å—Ä–µ–¥–∞ –ø–µ—Ä–µ–¥ `production`, –≥–¥–µ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.
    
-   **ETL**: `staging area` ‚Äî –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –º–µ—Å—Ç–æ, –∫—É–¥–∞ –≥—Ä—É–∑—è—Ç—Å—è –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥ –æ—á–∏—Å—Ç–∫–æ–π.
    

___

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å ‚Äî –ø–æ–∫–∞–∂—É –ø—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã dbt-–ø—Ä–æ–µ–∫—Ç–∞ —Å `staging`, `marts` –∏ `snapshots`.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

—Ä–∞—Å—Å–∫–∞–∂–∏ –ø–æ–ø–æ–¥—Ä–æ–±–Ω–µ–µ: üîí –ò–∑–æ–ª—è—Ü–∏—è –æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –ï—Å–ª–∏ —Å—ã—Ä–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫ –º–µ–Ω—è–µ—Ç—Å—è ‚Äî –º–µ–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ staging, –Ω–µ –≤–µ—Å—å —Å–ª–æ–π üîÅ –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ù–µ—Å–∫–æ–ª—å–∫–æ downstream-–º–æ–¥–µ–ª–µ–π –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å stg\_\* üì¶ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –º–∞—Ä—Ç–∞–º –£–ø—Ä–æ—â–∞–µ—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ fct\_\*, dim\_\*, snapshot\_\*

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å ‚Äî —ç—Ç–æ –∫–ª—é—á–µ–≤—ã–µ **–ø—Ä–∏–Ω—Ü–∏–ø—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ dbt** –∏ –ª—é–±–æ–π —Ö–æ—Ä–æ—à–æ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ. –î–∞–≤–∞–π –ø–æ–¥—Ä–æ–±–Ω–µ–µ —Ä–∞–∑–±–µ—Ä—ë–º:

___

## üîí –ò–∑–æ–ª—è—Ü–∏—è –æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –ü—Ä–æ–±–ª–µ–º–∞:

–ï—Å–ª–∏ —Ç—ã –Ω–∞–ø—Ä—è–º—É—é –∏—Å–ø–æ–ª—å–∑—É–µ—à—å "—Å—ã—Ä—ã–µ" —Ç–∞–±–ª–∏—Ü—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, `raw.orders`) –≤ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–µ (`fct_orders`), –ª—é–±–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤ —Å—Ö–µ–º–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–ª–∏ –∫–æ–ª–æ–Ω–∫—É –∏–ª–∏ –∏–∑–º–µ–Ω–∏–ª—Å—è —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã) –ø—Ä–∏–≤–µ–¥—ë—Ç –∫ –ø–æ–ª–æ–º–∫–µ –≤—Å–µ–π —Ü–µ–ø–æ—á–∫–∏ –º–æ–¥–µ–ª–µ–π.

### –†–µ—à–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `staging`:

-   `stg_orders` —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø—Ä–æ—Å–ª–æ–π–∫–æ–π –º–µ–∂–¥—É —Å—ã—Ä—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏ –º–∞—Ä–∞—Ç–∞–º–∏.
    
-   –í—Å–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏–∏ –¥–µ–ª–∞—é—Ç—Å—è **–æ–¥–∏–Ω —Ä–∞–∑** –≤ `staging`.
    
-   –í –±–∏–∑–Ω–µ—Å-–º–æ–¥–µ–ª—è—Ö —Ç—ã –∏—Å–ø–æ–ª—å–∑—É–µ—à—å —É–∂–µ –Ω–∞–¥—ë–∂–Ω—É—é, –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—É—é —Å—Ö–µ–º—É.
    

### –ü—Ä–∏–º–µ—Ä:

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span><span>-- –°—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ:</span></span><span>
</span><span><span>select</span></span><span> OrderId, UserID, TotalAmount, dt_created </span><span><span>from</span></span><span> raw.orders

</span><span><span>-- –í staging (stg_orders.sql):</span></span><span>
</span><span><span>select</span></span><span>
  OrderId </span><span><span>as</span></span><span> order_id,
  UserID </span><span><span>as</span></span><span> user_id,
  TotalAmount </span><span><span>as</span></span><span> amount,
  to_date(dt_created) </span><span><span>as</span></span><span> order_date
</span><span><span>from</span></span><span> raw.orders

</span><span><span>-- –í fct_orders.sql:</span></span><span>
</span><span><span>select</span></span><span> order_id, user_id, amount, order_date </span><span><span>from</span></span><span> stg_orders
</span></span></code></p></div>
```

–¢–µ–ø–µ—Ä—å –µ—Å–ª–∏ `raw.orders` –ø–µ—Ä–µ–∏–º–µ–Ω—É–µ—Ç `TotalAmount` –≤ `total_amt` ‚Äî –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ `stg_orders`, –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω–æ–µ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è —Å—Ç–∞–±–∏–ª—å–Ω—ã–º.

___

## üîÅ –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `stg_*` –º–æ–¥–µ–ª–µ–π

### –ò–¥–µ—è:

–û–¥–Ω–∞ –∏ —Ç–∞ –∂–µ staging-–º–æ–¥–µ–ª—å –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è:

-   –≤ —Ä–∞–∑–Ω—ã—Ö marts (–Ω–∞–ø—Ä–∏–º–µ—Ä, `fct_orders`, `fct_payments`)
    
-   –≤ snapshot'–∞—Ö
    
-   –≤ —Ç–µ—Å—Ç–∞—Ö
    
-   –≤ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä–∞—Å—á—ë—Ç–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç)
    

### –ü—Ä–∏–º–µ—Ä:

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span><span>-- fct_orders.sql</span></span><span>
</span><span><span>select</span></span><span> order_id, user_id, amount </span><span><span>from</span></span><span> {{ </span><span><span>ref</span></span><span>(</span><span><span>'stg_orders'</span></span><span>) }}

</span><span><span>-- dim_users.sql</span></span><span>
</span><span><span>select</span></span><span> </span><span><span>distinct</span></span><span> user_id </span><span><span>from</span></span><span> {{ </span><span><span>ref</span></span><span>(</span><span><span>'stg_orders'</span></span><span>) }}
</span></span></code></p></div>
```

–¢—ã **–Ω–µ –¥—É–±–ª–∏—Ä—É–µ—à—å** –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ raw-—Ç–∞–±–ª–∏—Ü–∞–º, –Ω–µ –ø–æ–≤—Ç–æ—Ä—è–µ—à—å –ª–æ–≥–∏–∫—É –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è. –û–¥–∏–Ω staging ‚Äî –º–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

___

## üì¶ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ marts (fct\__, dim\__, snapshot\_\*)

### –ß—Ç–æ —Ç–∞–∫–æ–µ marts?

–≠—Ç–æ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Å–ª–æ–π –º–æ–¥–µ–ª–µ–π: –±–∏–∑–Ω–µ—Å-—Ç–∞–±–ª–∏—Ü—ã, —Ñ–∞–∫—Ç—ã (`fct_*`), –∏–∑–º–µ—Ä–µ–Ω–∏—è (`dim_*`), —Å–ª–µ–ø–∫–∏ (`snapshot_*`).

### –ü–æ—á–µ–º—É staging –ø–æ–º–æ–≥–∞–µ—Ç:

-   –í staging —Ç—ã —É–∂–µ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–ª –ø–æ–ª—è, —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–ª —Ñ–æ—Ä–º–∞—Ç—ã, –æ—á–∏—Å—Ç–∏–ª null'—ã –∏ –¥—É–±–ª–∏–∫–∞—Ç—ã.
    
-   –ú–∞—Ä—Ç-—Ñ–∞–π–ª—ã —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –ø—Ä–æ—â–µ ‚Äî –æ–Ω–∏ —Ç–æ–ª—å–∫–æ –∞–≥—Ä–µ–≥–∏—Ä—É—é—Ç, –æ–±—ä–µ–¥–∏–Ω—è—é—Ç –∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–æ–π –∑–∞–Ω–∏–º–∞—é—Ç—Å—è.
    

___

### –ü—Ä–∏–º–µ—Ä –ø–æ–ª–Ω–æ–π —Ü–µ–ø–æ—á–∫–∏:

```
<div><p>txt</p><p><code id="code-lang-txt"><span><span>RAW            ‚Üí STAGING        ‚Üí MART
raw.orders     ‚Üí stg_orders     ‚Üí fct_orders
raw.users      ‚Üí stg_users      ‚Üí dim_users
raw.products   ‚Üí stg_products   ‚Üí fct_orders (—á–µ—Ä–µ–∑ join)
</span></span></code></p></div>
```

–í—Å—ë, —á—Ç–æ "–≥—Ä—è–∑–Ω–æ–µ" –∏ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ–µ, –æ—Å—Ç–∞–µ—Ç—Å—è –≤ raw/staging. –ú–∞—Ä—Ç ‚Äî —á–∏—Å—Ç—ã–π, –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–π, –≥–æ—Ç–æ–≤—ã–π –∫ BI.

___

## ‚úÖ –í—ã–≥–æ–¥—ã —Ç–∞–∫–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞:

| –ü—Ä–∏–Ω—Ü–∏–ø | –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ |
| --- | --- |
| üß© –ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å | –ö–∞–∂–¥–∞—è –º–æ–¥–µ–ª—å –¥–µ–ª–∞–µ—Ç –æ–¥–Ω—É –ø—Ä–æ—Å—Ç—É—é –≤–µ—â—å |
| üîÅ –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ—Å—Ç—å | –°—Ç–∞–¥–∏—è `stg_*` ‚Äî –µ–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏–∏ |
| üìâ –°–Ω–∏–∂–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ | –ú–µ–Ω—å—à–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ–≥–∏–∫–∏ = –º–µ–Ω—å—à–µ –±–∞–≥–æ–≤ |
| üõ† –£–¥–æ–±—Å—Ç–≤–æ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ | –ò–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ staging |
| üöÄ –ë—ã—Å—Ç—Ä–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ | –ú–æ–∂–Ω–æ –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —É–∂–µ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö |

___

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, –º–æ–≥—É —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —à–∞–±–ª–æ–Ω —Å—Ç—Ä—É–∫—Ç—É—Ä—ã `models/` —Å–æ staging –∏ marts –¥–ª—è —Ç–≤–æ–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –ø–æ–¥ Postgres + ClickHouse.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

—á—Ç–æ —Ç–∞–∫–æ–µ —Å—É—Ä—Ä–æ–≥–∞—Ç–Ω—ã–π –∫–ª—é—á

###### ChatGPT —Å–∫–∞–∑–∞–ª:

**–°—É—Ä—Ä–æ–≥–∞—Ç–Ω—ã–π –∫–ª—é—á (surrogate key)** ‚Äî —ç—Ç–æ **–∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä**, —Å–æ–∑–¥–∞–≤–∞–µ–º—ã–π –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å—Ç—Ä–æ–∫ —Ç–∞–±–ª–∏—Ü—ã, **–Ω–µ –∏–º–µ—é—â–∏–π –±–∏–∑–Ω–µ—Å-—Å–º—ã—Å–ª–∞**. –û–±—ã—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–º–µ—Å—Ç–æ –∏–ª–∏ –≤–º–µ—Å—Ç–µ —Å **–µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –∫–ª—é—á–æ–º** (natural key), –∫–æ—Ç–æ—Ä—ã–π –∏–º–µ–µ—Ç —Å–º—ã—Å–ª –≤ —Ä–µ–∞–ª—å–Ω–æ–º –º–∏—Ä–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `email`, `passport_number`, `order_id`).

___

## üîë –ü—Ä–∏–º–µ—Ä

–ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, —É –Ω–∞—Å –µ—Å—Ç—å —Ç–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:

–ó–¥–µ—Å—å `id` ‚Äî **—Å—É—Ä—Ä–æ–≥–∞—Ç–Ω—ã–π –∫–ª—é—á**: —É–Ω–∏–∫–∞–ª–µ–Ω, –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –º–æ–∂–µ—Ç –±—ã—Ç—å —á–∏—Å–ª–æ–≤—ã–º, UUID –∏ —Ç.–¥.

–ê `email` ‚Äî **–µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–ª—é—á**: –æ–Ω –ª–æ–≥–∏—á–µ—Å–∫–∏ —É–Ω–∏–∫–∞–ª–µ–Ω, –Ω–æ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å—Å—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–º–µ–Ω–∏—Ç –ø–æ—á—Ç—É).

___

## üß† –ó–∞—á–µ–º –æ–Ω –Ω—É–∂–µ–Ω?

### 1\. üîÅ –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å:

-   –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫–ª—é—á–∏ –º–æ–≥—É—Ç **–º–µ–Ω—è—Ç—å—Å—è** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `email`, `–Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏`, `–Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞`).
    
-   –°—É—Ä—Ä–æ–≥–∞—Ç–Ω—ã–π –∫–ª—é—á –≤—Å–µ–≥–¥–∞ –æ—Å—Ç–∞—ë—Ç—Å—è –Ω–µ–∏–∑–º–µ–Ω–Ω—ã–º.
    

### 2\. üîÑ –û–±—Ä–∞–±–æ—Ç–∫–∞ SCD (Slowly Changing Dimension):

-   –í `dimension`\-—Ç–∞–±–ª–∏—Ü–∞—Ö –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—É—Ä—Ä–æ–≥–∞—Ç–Ω—ã–π –∫–ª—é—á, —á—Ç–æ–±—ã —Ä–∞–∑–ª–∏—á–∞—Ç—å **–≤–µ—Ä—Å–∏–∏ –æ–¥–Ω–æ–π —Å—É—â–Ω–æ—Å—Ç–∏**.
    
-   –ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑–º–µ–Ω–∏–ª–æ—Å—å ‚Äî —Å–æ–∑–¥–∞—ë–º –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É —Å —Ç–µ–º –∂–µ `user_id`, –Ω–æ –¥—Ä—É–≥–∏–º —Å—É—Ä—Ä–æ–≥–∞—Ç–Ω—ã–º –∫–ª—é—á–æ–º.
    

```
<div><p>txt</p><p><code id="code-lang-txt"><span><span>surrogate_key | user_id | name   | valid_from | valid_to
--------------|---------|--------|------------|----------
1             | 123     | Alice  | 2022-01-01 | 2023-01-01
2             | 123     | Alicia | 2023-01-01 | NULL
</span></span></code></p></div>
```

### 3\. ‚öôÔ∏è –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:

-   –ß–∏—Å–ª–æ–≤—ã–µ `surrogate key` –±—ã—Å—Ç—Ä–µ–µ –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –∏ join'–æ–≤, —á–µ–º —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –ø–æ–ª—è.
    

___

## üÜö –°—Ä–∞–≤–Ω–µ–Ω–∏–µ: —Å—É—Ä—Ä–æ–≥–∞—Ç–Ω—ã–π vs –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–ª—é—á

|  | –°—É—Ä—Ä–æ–≥–∞—Ç–Ω—ã–π –∫–ª—é—á | –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–ª—é—á |
| --- | --- | --- |
| –û—Å–Ω–æ–≤–∞–Ω –Ω–∞ | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä, –±–µ–∑ —Å–º—ã—Å–ª–∞ | –ó–Ω–∞—á–∏–º–æ–µ –±–∏–∑–Ω–µ—Å-–ø–æ–ª–µ |
| –ò–∑–º–µ–Ω—è–µ–º–æ—Å—Ç—å | –ù–µ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è | –ú–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å—Å—è |
| –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å | –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –°–£–ë–î | –î–æ–ª–∂–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å—Å—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–æ–π |
| –£–¥–æ–±—Å—Ç–≤–æ | –û—Ç–ª–∏—á–Ω–æ –¥–ª—è join‚Äô–æ–≤ | –ú–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—É–¥–æ–±–µ–Ω –ø—Ä–∏ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–∏ |

___

## üì¶ –í dbt –∏ DWH

-   –í `dim_users` —Ç—ã –º–æ–∂–µ—à—å —Å–æ–∑–¥–∞—Ç—å `user_sk` (surrogate key) –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –∫–∞–∫ –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á.
    
-   –í `fct_orders` ‚Äî –¥–µ–ª–∞—Ç—å join –ø–æ `user_sk`, –∞ –Ω–µ –ø–æ `user_id` –∏–ª–∏ `email`.
    

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span><span>-- –ü—Ä–∏–º–µ—Ä –≤ dbt</span></span><span>
</span><span><span>select</span></span><span>
  {{ dbt_utils.surrogate_key([</span><span><span>'user_id'</span></span><span>, </span><span><span>'valid_from'</span></span><span>]) }} </span><span><span>as</span></span><span> user_sk,
  user_id,
  name,
  valid_from,
  valid_to
</span><span><span>from</span></span><span> staging.stg_users
</span></span></code></p></div>
```

___

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å ‚Äî –º–æ–≥—É –ø–æ–∫–∞–∑–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø—Ä–∏–º–µ—Ä, –∫–∞–∫ —Å—Ç—Ä–æ–∏—Ç—å —Å—É—Ä—Ä–æ–≥–∞—Ç–Ω—ã–π –∫–ª—é—á –≤ `dbt` –¥–ª—è SCD-—Ç–∞–±–ª–∏—Ü—ã.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

###### ChatGPT —Å–∫–∞–∑–∞–ª:

**Unit-—Ç–µ—Å—Ç—ã (—é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã)** ‚Äî —ç—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç **–æ—Ç–¥–µ–ª—å–Ω—ã–µ —á–∞—Å—Ç–∏ –∫–æ–¥–∞ (–º–æ–¥—É–ª–∏, —Ñ—É–Ω–∫—Ü–∏–∏, –∫–ª–∞—Å—Å—ã)** **–≤ –∏–∑–æ–ª—è—Ü–∏–∏ –æ—Ç –æ—Å—Ç–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã**.

___

## üîç –û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ **–∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è/–º–µ—Ç–æ–¥**:

-   —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å –Ω–æ—Ä–º–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏,
    
-   –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è,
    
-   –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Ä–∞–∑–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö.
    

___

## üß† –ó–∞—á–µ–º –Ω—É–∂–Ω—ã?

| –ó–∞—á–µ–º? | –û–±—ä—è—Å–Ω–µ–Ω–∏–µ |
| --- | --- |
| ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏–∫–∏ | –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ç–≤–æ–π –∫–æ–¥ –¥–µ–ª–∞–µ—Ç —Ç–æ, —á—Ç–æ –Ω—É–∂–Ω–æ |
| üõ† –£–ø—Ä–æ—â–µ–Ω–∏–µ –æ—Ç–ª–∞–¥–∫–∏ | –û—à–∏–±–∫–∞ –≤ —Ç–µ—Å—Ç–µ –ø–æ–¥—Å–∫–∞–∂–µ—Ç, –≥–¥–µ –∏–º–µ–Ω–Ω–æ —Å–ª–æ–º–∞–ª–æ—Å—å |
| üîÑ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–π | –ú–æ–∂–Ω–æ —Å–ø–æ–∫–æ–π–Ω–æ –º–µ–Ω—è—Ç—å –∫–æ–¥, –Ω–µ –±–æ—è—Å—å —Å–ª–æ–º–∞—Ç—å —Å—Ç–∞—Ä–æ–µ |
| ‚öôÔ∏è CI/CD –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è | –¢–µ—Å—Ç—ã –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∫–æ–º–º–∏—Ç–µ |

___

## üß™ –ü—Ä–∏–º–µ—Ä (–Ω–∞ Python)

```
<div><p>python</p><p><code id="code-lang-python"><span><span><span># utils.py</span></span><span>
</span><span><span>def</span></span><span> </span><span><span>add</span></span><span>(</span><span><span>a, b</span></span><span>):
    </span><span><span>return</span></span><span> a + b
</span></span></code></p></div>
```

```
<div><p>python</p><p><code id="code-lang-python"><span><span><span># test_utils.py</span></span><span>
</span><span><span>import</span></span><span> unittest
</span><span><span>from</span></span><span> utils </span><span><span>import</span></span><span> add

</span><span><span>class</span></span><span> </span><span><span>TestUtils</span></span><span>(unittest.TestCase):
    </span><span><span>def</span></span><span> </span><span><span>test_add</span></span><span>(</span><span><span>self</span></span><span>):
        self.assertEqual(add(</span><span><span>2</span></span><span>, </span><span><span>3</span></span><span>), </span><span><span>5</span></span><span>)
        self.assertEqual(add(-</span><span><span>1</span></span><span>, </span><span><span>1</span></span><span>), </span><span><span>0</span></span><span>)
        self.assertEqual(add(</span><span><span>0</span></span><span>, </span><span><span>0</span></span><span>), </span><span><span>0</span></span><span>)

</span><span><span>if</span></span><span> __name__ == </span><span><span>'__main__'</span></span><span>:
    unittest.main()
</span></span></code></p></div>
```

üì¶ –†–µ–∑—É–ª—å—Ç–∞—Ç:

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>$ python test_utils.py
...
----------------------------------------------------------------------
Ran 1 </span><span><span>test</span></span><span> </span><span><span>in</span></span><span> 0.001s

OK
</span></span></code></p></div>
```

___

## üìö –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç

| –û–±–ª–∞—Å—Ç—å | –ü—Ä–∏–º–µ—Ä |
| --- | --- |
| Backend | –ü—Ä–æ–≤–µ—Ä–∫–∞ API, —Ñ—É–Ω–∫—Ü–∏–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö |
| Data Engineering | –¢–µ—Å—Ç—ã —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–π, dbt-—Ç–µ—Å—Ç—ã |
| UI-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | –ß–∞—Å—Ç–∏—á–Ω–æ, –Ω–æ —á–∞—â–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç e2e-—Ç–µ—Å—Ç—ã |
| ML/DS | –¢–µ—Å—Ç—ã –ø—Ä–µ–ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–æ–≤, –º–µ—Ç—Ä–∏–∫ |

___

## üì¶ –í dbt —Ç–æ–∂–µ –µ—Å—Ç—å —Ç–µ—Å—Ç—ã!

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>version:</span></span><span> </span><span><span>2</span></span><span>

</span><span><span>models:</span></span><span>
  </span><span><span>-</span></span><span> </span><span><span>name:</span></span><span> </span><span><span>dim_users</span></span><span>
    </span><span><span>columns:</span></span><span>
      </span><span><span>-</span></span><span> </span><span><span>name:</span></span><span> </span><span><span>user_id</span></span><span>
        </span><span><span>tests:</span></span><span>
          </span><span><span>-</span></span><span> </span><span><span>not_null</span></span><span>
          </span><span><span>-</span></span><span> </span><span><span>unique</span></span><span>
</span></span></code></p></div>
```

___

–•–æ—á–µ—à—å ‚Äî –ø–æ–∫–∞–∂—É –ø—Ä–∏–º–µ—Ä, –∫–∞–∫ –ø–∏—Å–∞—Ç—å unit-—Ç–µ—Å—Ç—ã –¥–ª—è FastAPI, Python-—Å–∫—Ä–∏–ø—Ç–æ–≤ –∏–ª–∏ SQL.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–ø–æ–∫–∞ –∂–∏ –ø—Ä–∏–º–µ—Ä unit —Ç–µ—Å—Ç–æ–≤ –≤ dbt

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–ö–æ–Ω–µ—á–Ω–æ! –í `dbt` **unit-—Ç–µ—Å—Ç—ã** –ø–æ—è–≤–∏–ª–∏—Å—å –∫–∞–∫ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Ñ–∏—á–∞ —Å –≤–µ—Ä—Å–∏–∏ **1.6+** ‚Äî –æ–Ω–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ª–æ–≥–∏–∫—É `select`\-–º–æ–¥–µ–ª–µ–π –Ω–∞ –∑–∞—Ä–∞–Ω–µ–µ –∑–∞–¥–∞–Ω–Ω—ã—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö. –≠—Ç–æ **–Ω–∞—Å—Ç–æ—è—â–∏–µ "—é–Ω–∏—Ç"-—Ç–µ—Å—Ç—ã** –≤ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–º –ø–æ–Ω–∏–º–∞–Ω–∏–∏: –≤—Ö–æ–¥ ‚Üí –º–æ–¥–µ–ª—å ‚Üí –≤—ã—Ö–æ–¥.

___

## üß™ –ü—Ä–∏–º–µ—Ä unit-—Ç–µ—Å—Ç–∞ –≤ dbt

–î–æ–ø—É—Å—Ç–∏–º, —É —Ç–µ–±—è –µ—Å—Ç—å –ø—Ä–æ—Å—Ç–∞—è –º–æ–¥–µ–ª—å `models/staging/stg_orders.sql`:

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span><span>-- models/staging/stg_orders.sql</span></span><span>
</span><span><span>select</span></span><span>
  id </span><span><span>as</span></span><span> order_id,
  user_id,
  amount,
  order_date::</span><span><span>date</span></span><span> </span><span><span>as</span></span><span> order_date
</span><span><span>from</span></span><span> {{ </span><span><span>ref</span></span><span>(</span><span><span>'raw_orders'</span></span><span>) }}
</span></span></code></p></div>
```

–¢–µ–ø–µ—Ä—å –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–µ–º –µ—ë —á–µ—Ä–µ–∑ unit-—Ç–µ—Å—Ç.

___

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤:

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>models/
‚îú‚îÄ‚îÄ staging/
‚îÇ   ‚îî‚îÄ‚îÄ stg_orders.sql
‚îî‚îÄ‚îÄ tests/
    ‚îî‚îÄ‚îÄ unit/
        ‚îî‚îÄ‚îÄ test_stg_orders.yml
</span></span></code></p></div>
```

___

## üß™ `test_stg_orders.yml`

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>version:</span></span><span> </span><span><span>2</span></span><span>

</span><span><span>unit_tests:</span></span><span>
  </span><span><span>-</span></span><span> </span><span><span>name:</span></span><span> </span><span><span>test_stg_orders_date_casting</span></span><span>
    </span><span><span>model:</span></span><span> </span><span><span>ref('stg_orders')</span></span><span>  </span><span><span># –∫–∞–∫—É—é –º–æ–¥–µ–ª—å —Ç–µ—Å—Ç–∏—Ä—É–µ–º</span></span><span>
    </span><span><span>given:</span></span><span>                    </span><span><span># –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</span></span><span>
      </span><span><span>-</span></span><span> </span><span><span>input:</span></span><span> </span><span><span>ref('raw_orders')</span></span><span>
        </span><span><span>rows:</span></span><span>
          </span><span><span>-</span></span><span> {</span><span><span>id:</span></span><span> </span><span><span>1</span></span><span>, </span><span><span>user_id:</span></span><span> </span><span><span>101</span></span><span>, </span><span><span>amount:</span></span><span> </span><span><span>500</span></span><span>, </span><span><span>order_date:</span></span><span> </span><span><span>"2024-01-01T12:00:00"</span></span><span>}
          </span><span><span>-</span></span><span> {</span><span><span>id:</span></span><span> </span><span><span>2</span></span><span>, </span><span><span>user_id:</span></span><span> </span><span><span>102</span></span><span>, </span><span><span>amount:</span></span><span> </span><span><span>300</span></span><span>, </span><span><span>order_date:</span></span><span> </span><span><span>"2024-01-02T08:00:00"</span></span><span>}
    </span><span><span>expect:</span></span><span>                   </span><span><span># –æ–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç</span></span><span>
      </span><span><span>rows:</span></span><span>
        </span><span><span>-</span></span><span> {</span><span><span>order_id:</span></span><span> </span><span><span>1</span></span><span>, </span><span><span>user_id:</span></span><span> </span><span><span>101</span></span><span>, </span><span><span>amount:</span></span><span> </span><span><span>500</span></span><span>, </span><span><span>order_date:</span></span><span> </span><span><span>"2024-01-01"</span></span><span>}
        </span><span><span>-</span></span><span> {</span><span><span>order_id:</span></span><span> </span><span><span>2</span></span><span>, </span><span><span>user_id:</span></span><span> </span><span><span>102</span></span><span>, </span><span><span>amount:</span></span><span> </span><span><span>300</span></span><span>, </span><span><span>order_date:</span></span><span> </span><span><span>"2024-01-02"</span></span><span>}
</span></span></code></p></div>
```

___

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å unit-—Ç–µ—Å—Ç—ã:

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>dbt build --</span><span><span>select</span></span><span> test_type:unit
</span></span></code></p></div>
```

–ò–ª–∏ —Ç–æ–ª—å–∫–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π:

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>dbt </span><span><span>test</span></span><span> --</span><span><span>select</span></span><span> test_stg_orders_date_casting
</span></span></code></p></div>
```

___

## üîç –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å unit-—Ç–µ—Å—Ç—ã –≤ dbt:

| –ö–æ–≥–¥–∞? | –ó–∞—á–µ–º? |
| --- | --- |
| –ù–æ–≤–∞—è –º–æ–¥–µ–ª—å | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –Ω–∞–¥–æ |
| SCD, CASE WHEN, —Ñ–∏–ª—å—Ç—Ä—ã, join‚Äô—ã | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É |
| Bugfix | –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫—É –∏ –¥–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç |

___

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, –º–æ–≥—É –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∏–º–µ—Ä –¥–ª—è `fct_orders`, –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `join`, `CASE WHEN`, SCD –∏ –∫–∞–∫ —ç—Ç–æ –ø–æ–∫—Ä—ã—Ç—å unit-—Ç–µ—Å—Ç–∞–º–∏.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–º–æ–∂–Ω–æ –ª–∏ –≤ dbt –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –∏–º–µ—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –¥–≤—É–º –¥—Ä–∞–π–≤–µ—Ä–æ–º –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ?

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–î–∞, **–≤ –æ–¥–Ω–æ–º dbt-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –º–æ–∂–Ω–æ –∏–º–µ—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –¥—Ä–∞–π–≤–µ—Ä–∞–º –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ** ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä, –∫ **Postgres –∏ ClickHouse**. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç:

-   –∑–∞–≥—Ä—É–∂–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –æ–¥–Ω–æ–π –ë–î –∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –≤ –¥—Ä—É–≥—É—é;
    
-   –¥–µ–ª–∞—Ç—å cross-database DAG-–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, staging –∏–∑ Postgres ‚Üí marts –≤ ClickHouse).
    

___

## üîß –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1\. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–¥–∞–ø—Ç–µ—Ä–æ–≤**

–í `Dockerfile` –∏–ª–∏ —á–µ—Ä–µ–∑ `pip` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—à—å **–æ–±–∞ dbt-–∞–¥–∞–ø—Ç–µ—Ä–∞**:

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>pip install dbt-postgres dbt-clickhouse
</span></span></code></p></div>
```

üí° –õ–∏–±–æ –¥–æ–±–∞–≤—å –≤ `requirements.txt`:

```
<div><p><code><span><span>dbt-core
dbt-postgres
dbt-clickhouse
</span></span></code></p></div>
```

___

### 2\. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ `profiles.yml`**

–¢—ã –º–æ–∂–µ—à—å –æ–±—ä—è–≤–∏—Ç—å **–Ω–µ—Å–∫–æ–ª—å–∫–æ targets** —Å —Ä–∞–∑–Ω—ã–º–∏ –¥—Ä–∞–π–≤–µ—Ä–∞–º–∏ –≤ –æ–¥–Ω–æ–º –ø—Ä–æ—Ñ–∏–ª–µ:

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>my_project:</span></span><span>
  </span><span><span>target:</span></span><span> </span><span><span>clickhouse</span></span><span>
  </span><span><span>outputs:</span></span><span>
    </span><span><span>postgres:</span></span><span>
      </span><span><span>type:</span></span><span> </span><span><span>postgres</span></span><span>
      </span><span><span>host:</span></span><span> </span><span><span>your_postgres_host</span></span><span>
      </span><span><span>user:</span></span><span> </span><span><span>your_user</span></span><span>
      </span><span><span>password:</span></span><span> </span><span><span>your_password</span></span><span>
      </span><span><span>dbname:</span></span><span> </span><span><span>your_db</span></span><span>
      </span><span><span>schema:</span></span><span> </span><span><span>public</span></span><span>
      </span><span><span>threads:</span></span><span> </span><span><span>4</span></span><span>
      </span><span><span>port:</span></span><span> </span><span><span>5432</span></span><span>

    </span><span><span>clickhouse:</span></span><span>
      </span><span><span>type:</span></span><span> </span><span><span>clickhouse</span></span><span>
      </span><span><span>host:</span></span><span> </span><span><span>your_clickhouse_host</span></span><span>
      </span><span><span>user:</span></span><span> </span><span><span>default</span></span><span>
      </span><span><span>password:</span></span><span> </span><span><span>""</span></span><span>
      </span><span><span>port:</span></span><span> </span><span><span>9000</span></span><span>
      </span><span><span>schema:</span></span><span> </span><span><span>default</span></span><span>
      </span><span><span>database:</span></span><span> </span><span><span>default</span></span><span>
      </span><span><span>threads:</span></span><span> </span><span><span>4</span></span><span>
</span></span></code></p></div>
```

___

### 3\. **–ó–∞–ø—É—Å–∫ –º–æ–¥–µ–ª–µ–π –ø–æ –∞–¥–∞–ø—Ç–µ—Ä–∞–º**

`dbt` —É–º–µ–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å **–æ–¥–Ω–∏–º target'–æ–º –∑–∞ —Ä–∞–∑**, **–Ω–æ –º–æ–¥–µ–ª–∏ –º–æ–≥—É—Ç –±—ã—Ç—å —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –ø–æ –ø–∞–ø–∫–∞–º –∏ tags**. –ù–∞–ø—Ä–∏–º–µ—Ä:

```
<div><p>pgsql</p><p><code><span><span>models/
‚îú‚îÄ‚îÄ clickhouse/
‚îÇ   ‚îî‚îÄ‚îÄ fct_orders.</span><span><span>sql</span></span><span>
‚îú‚îÄ‚îÄ postgres/
‚îÇ   ‚îî‚îÄ‚îÄ stg_orders.</span><span><span>sql</span></span><span>
</span></span></code></p></div>
```

üì¶ –ó–∞–ø—É—Å–∫:

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span><span># –°–Ω–∞—á–∞–ª–∞ staging –≤ Postgres</span></span><span>
dbt build --</span><span><span>select</span></span><span> tag:postgres --target=postgres

</span><span><span># –ó–∞—Ç–µ–º marts –≤ ClickHouse</span></span><span>
dbt build --</span><span><span>select</span></span><span> tag:clickhouse --target=clickhouse
</span></span></code></p></div>
```

–ü—Ä–∏–º–µ—Ä `dbt_project.yml`:

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>models:</span></span><span>
  </span><span><span>my_project:</span></span><span>
    </span><span><span>clickhouse:</span></span><span>
      </span><span><span>+tags:</span></span><span> [</span><span><span>clickhouse</span></span><span>]
    </span><span><span>postgres:</span></span><span>
      </span><span><span>+tags:</span></span><span> [</span><span><span>postgres</span></span><span>]
</span></span></code></p></div>
```

___

## ‚úÖ –ò—Ç–æ–≥–æ

| –ú–æ–∂–Ω–æ –ª–∏ –ø–æ–¥–∫–ª—é—á–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –±–∞–∑? | ‚úÖ –î–∞, —á–µ—Ä–µ–∑ `profiles.yml` —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ targets |  
| –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä? | ‚úÖ –î–∞ |  
| –ú–æ–∂–Ω–æ –ª–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞? | ‚õî –ù–µ—Ç, —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω target –∑–∞ —Ä–∞–∑ |  
| –ö–∞–∫ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å? | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ `tags`, `folders`, `build` –ø–æ —á–∞—Å—Ç—è–º |

___

–•–æ—á–µ—à—å ‚Äî –º–æ–≥—É —Å–æ–±—Ä–∞—Ç—å —à–∞–±–ª–æ–Ω `dbt + Docker` —Å ClickHouse –∏ Postgres –≤ –æ–¥–Ω–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–í–æ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —à–∞–±–ª–æ–Ω –ø—Ä–æ–µ–∫—Ç–∞ `dbt` –≤ Docker —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ ClickHouse –∏ PostgreSQL:

___

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
<div><p>pgsql</p><p><code><span><span>my_dbt_project/
‚îú‚îÄ‚îÄ dbt_project.yml
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ profiles/
‚îÇ   ‚îî‚îÄ‚îÄ profiles.yml
‚îî‚îÄ‚îÄ models/
    ‚îú‚îÄ‚îÄ postgres/
    ‚îÇ   ‚îî‚îÄ‚îÄ stg_orders.</span><span><span>sql</span></span><span>
    ‚îî‚îÄ‚îÄ clickhouse/
        ‚îî‚îÄ‚îÄ fct_orders.</span><span><span>sql</span></span><span>
</span></span></code></p></div>
```

___

## üê≥ `Dockerfile`

```
<div><p>Dockerfile</p><p><code id="code-lang-undefined"><span>FROM python:3.11-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --upgrade pip &amp;&amp; pip install -r requirements.txt

COPY . .

# –£–∫–∞–∂–µ–º –ø—É—Ç—å –∫ –ø—Ä–æ—Ñ–∏–ª—è–º
ENV DBT_PROFILES_DIR=/app/profiles

ENTRYPOINT ["dbt"]
</span></code></p></div>
```

___

## üì¶ `requirements.txt`

```
<div><p>txt</p><p><code id="code-lang-txt"><span><span>dbt-core
dbt-postgres
dbt-clickhouse
</span></span></code></p></div>
```

___

## ‚öôÔ∏è `profiles/profiles.yml`

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>my_dbt_project:</span></span><span>
  </span><span><span>target:</span></span><span> </span><span><span>postgres</span></span><span>
  </span><span><span>outputs:</span></span><span>
    </span><span><span>postgres:</span></span><span>
      </span><span><span>type:</span></span><span> </span><span><span>postgres</span></span><span>
      </span><span><span>host:</span></span><span> </span><span><span>host.docker.internal</span></span><span>  </span><span><span># –∏–ª–∏ –∏–º—è —Ö–æ—Å—Ç–∞</span></span><span>
      </span><span><span>user:</span></span><span> </span><span><span>your_user</span></span><span>
      </span><span><span>password:</span></span><span> </span><span><span>your_password</span></span><span>
      </span><span><span>dbname:</span></span><span> </span><span><span>your_db</span></span><span>
      </span><span><span>schema:</span></span><span> </span><span><span>public</span></span><span>
      </span><span><span>port:</span></span><span> </span><span><span>5432</span></span><span>
      </span><span><span>threads:</span></span><span> </span><span><span>4</span></span><span>

    </span><span><span>clickhouse:</span></span><span>
      </span><span><span>type:</span></span><span> </span><span><span>clickhouse</span></span><span>
      </span><span><span>host:</span></span><span> </span><span><span>host.docker.internal</span></span><span>
      </span><span><span>user:</span></span><span> </span><span><span>default</span></span><span>
      </span><span><span>password:</span></span><span> </span><span><span>""</span></span><span>
      </span><span><span>database:</span></span><span> </span><span><span>default</span></span><span>
      </span><span><span>schema:</span></span><span> </span><span><span>default</span></span><span>
      </span><span><span>port:</span></span><span> </span><span><span>9000</span></span><span>
      </span><span><span>threads:</span></span><span> </span><span><span>4</span></span><span>
</span></span></code></p></div>
```

___

## üîß `dbt_project.yml`

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>name:</span></span><span> </span><span><span>my_dbt_project</span></span><span>
</span><span><span>version:</span></span><span> </span><span><span>'1.0'</span></span><span>
</span><span><span>config-version:</span></span><span> </span><span><span>2</span></span><span>

</span><span><span>profile:</span></span><span> </span><span><span>my_dbt_project</span></span><span>

</span><span><span>model-paths:</span></span><span> [</span><span><span>"models"</span></span><span>]

</span><span><span>models:</span></span><span>
  </span><span><span>my_dbt_project:</span></span><span>
    </span><span><span>postgres:</span></span><span>
      </span><span><span>+tags:</span></span><span> [</span><span><span>postgres</span></span><span>]
    </span><span><span>clickhouse:</span></span><span>
      </span><span><span>+tags:</span></span><span> [</span><span><span>clickhouse</span></span><span>]
</span></span></code></p></div>
```

___

## üìÑ –ü—Ä–∏–º–µ—Ä—ã –º–æ–¥–µ–ª–µ–π

### `models/postgres/stg_orders.sql`

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span><span>select</span></span><span>
  id </span><span><span>as</span></span><span> order_id,
  user_id,
  total,
  created_at
</span><span><span>from</span></span><span> raw.orders
</span></span></code></p></div>
```

### `models/clickhouse/fct_orders.sql`

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span><span>select</span></span><span>
  order_id,
  user_id,
  total
</span><span><span>from</span></span><span> {{ </span><span><span>ref</span></span><span>(</span><span><span>'stg_orders'</span></span><span>) }}
</span></span></code></p></div>
```

___

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å

1.  –°–æ–±–µ—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:
    

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>docker build -t my-dbt-project .
</span></span></code></p></div>
```

2.  –ü—Ä–æ–≥–æ–Ω–∏ –º–æ–¥–µ–ª–∏:
    

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span><span># –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –≤ Postgres</span></span><span>
docker run --</span><span><span>rm</span></span><span> my-dbt-project build --</span><span><span>select</span></span><span> tag:postgres --target=postgres

</span><span><span># –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –≤ ClickHouse</span></span><span>
docker run --</span><span><span>rm</span></span><span> my-dbt-project build --</span><span><span>select</span></span><span> tag:clickhouse --target=clickhouse
</span></span></code></p></div>
```

___

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ, –º–æ–≥—É —Ä–∞—Å—à–∏—Ä–∏—Ç—å:

-   –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π –±–∞–∑,
    
-   —ç–∫—Å–ø–æ—Ä—Ç–æ–º –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤,
    
-   unit-—Ç–µ—Å—Ç–∞–º–∏,
    
-   CI/CD –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π.
    

–•–æ—á–µ—à—å?

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

###### ChatGPT —Å–∫–∞–∑–∞–ª:

**Redis** ‚Äî —ç—Ç–æ –±—ã—Å—Ç—Ä—ã–π, –æ—Ç–∫—Ä—ã—Ç—ã–π (open-source) **in-memory key-value —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö**, —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–µ –∫–∞–∫:

-   **–ö—ç—à** –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º,
    
-   **–ë—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π** (pub/sub, –æ—á–µ—Ä–µ–¥–∏),
    
-   **–•—Ä–∞–Ω–∏–ª–∏—â–µ —Å–µ—Å—Å–∏–π**,
    
-   **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö NoSQL** —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–∞–∑–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–Ω—ã—Ö.
    

___

## –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ Redis:

-   **–•—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ø–∞–º—è—Ç–∏** ‚Äî –æ—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å —á—Ç–µ–Ω–∏—è –∏ –∑–∞–ø–∏—Å–∏,
    
-   –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö: —Å—Ç—Ä–æ–∫–∏, —Å–ø–∏—Å–∫–∏, –º–Ω–æ–∂–µ—Å—Ç–≤–∞, —Ö—ç—à–∏, —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω—ã–µ –º–Ω–æ–∂–µ—Å—Ç–≤–∞,
    
-   –ü–æ–¥–¥–µ—Ä–∂–∫–∞ **–ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏** ‚Äî –º–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ –Ω–∞ –¥–∏—Å–∫,
    
-   –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∞—Ç–æ–º–∞—Ä–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π,
    
-   –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å —á–µ—Ä–µ–∑ –º–æ–¥—É–ª–∏.
    

___

## –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç Redis?

-   –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤,
    
-   –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤ (rate limiting),
    
-   –û—á–µ—Ä–µ–¥–∏ –∑–∞–¥–∞—á,
    
-   –•—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ—Å—Å–∏–π –≤ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö,
    
-   –†–µ–∞–ª–∏–∑–∞—Ü–∏—è real-time —Å—á–µ—Ç—á–∏–∫–æ–≤ –∏ –ª–∞–π–≤-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–π.
    

___

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, –º–æ–≥—É –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Redis –Ω–∞ Python.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

—á—Ç–æ –≤ docker compose –æ–±–æ–∑–Ω–∞—á–∞—é—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã -it -d –∏ –¥—Ä—É–≥–∏–µ

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å! –í –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ `docker compose`, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤—Ä–æ–¥–µ `-it`, `-d` –∏ –¥—Ä—É–≥–∏–µ ‚Äî —ç—Ç–æ **–æ–ø—Ü–∏–∏ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏**, –∫–æ—Ç–æ—Ä—ã–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —á–µ—Ä–µ–∑ `docker compose run`, `docker compose exec` –∏–ª–∏ `docker run`.

–í–æ—Ç —á—Ç–æ –æ–Ω–∏ –æ–∑–Ω–∞—á–∞—é—Ç:

___

## üîß –ß–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ñ–ª–∞–≥–∏ –≤ Docker (–æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ `docker run`)

| –§–ª–∞–≥ | –ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç |
| --- | --- |
| `-i` | **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º** ‚Äî –¥–µ—Ä–∂–∏—Ç STDIN –æ—Ç–∫—Ä—ã—Ç—ã–º |
| `-t` | **TTY** ‚Äî –ø–æ–¥–∫–ª—é—á–∞–µ—Ç —Ç–µ—Ä–º–∏–Ω–∞–ª, —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å –≤—ã–≤–æ–¥ |
| `-it` | –í–º–µ—Å—Ç–µ –æ–∑–Ω–∞—á–∞—é—Ç "–∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ç–µ—Ä–º–∏–Ω–∞–ª", —á—Ç–æ–±—ã —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ –≤ shell |
| `-d` | **Detached mode** ‚Äî –∑–∞–ø—É—Å–∫ –≤ —Ñ–æ–Ω–µ (–∫–∞–∫ –¥–µ–º–æ–Ω) |
| `--rm` | –£–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è |
| `--name` | –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–º—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ |
| `-v` | –ü—Ä–∏–º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–º –∏–ª–∏ –ø–∞–ø–∫—É |
| `-p` | –ü—Ä–æ–±—Ä–æ—Å –ø–æ—Ä—Ç–æ–≤ (–Ω–∞–ø—Ä. `-p 8000:80`) |
| `--env` / `-e` | –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è |

___

## üß© –í –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ `docker compose`

–ö–æ–º–∞–Ω–¥–∞ `docker compose` —Å–∞–º–∞ —É–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤, –∏:

-   **`-d`** —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ `docker compose up -d` ‚Äî –∑–∞–ø—É—Å–∫–∞–µ—Ç –≤ —Ñ–æ–Ω–µ.
    
-   **`-it`** **–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è** –Ω–∞–ø—Ä—è–º—É—é –≤ `compose`, –Ω–æ –∞–∫—Ç—É–∞–ª–µ–Ω –¥–ª—è `docker compose run` –∏–ª–∏ `exec`.
    

–ü—Ä–∏–º–µ—Ä—ã:

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span><span># –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –≤ —Ñ–æ–Ω–µ</span></span><span>
docker compose up -d

</span><span><span># –ó–∞–π—Ç–∏ –≤ —Ä–∞–±–æ—Ç–∞—é—â–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å bash</span></span><span>
docker compose </span><span><span>exec</span></span><span> web bash

</span><span><span># –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–º–∞–Ω–¥—É –≤ –Ω–æ–≤–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ —Å —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–º</span></span><span>
docker compose run --</span><span><span>rm</span></span><span> -it app python
</span></span></code></p></div>
```

___

## üéØ –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ

| –ö–æ–º–∞–Ω–¥–∞ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
| --- | --- |
| `-i -t` (`-it`) | –û—Ç–∫—Ä—ã—Ç—ã–π —Ç–µ—Ä–º–∏–Ω–∞–ª (–¥–ª—è —Ä–∞–±–æ—Ç—ã –≤—Ä—É—á–Ω—É—é) |
| `-d` | –§–æ–Ω–æ–≤—ã–π –∑–∞–ø—É—Å–∫ |
| `--rm` | –£–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è |
| `docker compose up -d` | –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –≤ —Ñ–æ–Ω–µ |
| `docker compose exec` | –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã –≤ —É–∂–µ —Ä–∞–±–æ—Ç–∞—é—â–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ |

–•–æ—á–µ—à—å ‚Äî –º–æ–≥—É –ø–æ–∫–∞–∑–∞—Ç—å `docker-compose.yml` —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏, –∫–∞–∫ —ç—Ç–æ –≤–ª–∏—è–µ—Ç.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

python —á—Ç–æ —Ç–∞–∫–æ–µ: 1. Collections Using namedtuple Using deque Using defaultdict Using OrderedDictUsing Counter Using ChainMap Using UserDict Using UserList Using UserString

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–í Python –º–æ–¥—É–ª—å [`collections`](https://docs.python.org/3/library/collections.html) ‚Äî —ç—Ç–æ **—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –º–æ–¥—É–ª—å**, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç **—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö** –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä (`dict`, `list`, `tuple`, `str` –∏ —Ç.–¥.).

–ù–∏–∂–µ —Ä–∞–∑–±–µ—Ä–µ–º **–∫–∞–∂–¥—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É** –∏–∑ `collections`:

___

### 1\. üîó `namedtuple`

üìå **–ß—Ç–æ —ç—Ç–æ**: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –æ–±—ã—á–Ω–æ–≥–æ `tuple`, –≤ –∫–æ—Ç–æ—Ä–æ–º —ç–ª–µ–º–µ–Ω—Ç—ã –º–æ–∂–Ω–æ –Ω–∞–∑—ã–≤–∞—Ç—å –ø–æ –∏–º–µ–Ω–∏ (–∫–∞–∫ –ø–æ–ª—è –æ–±—ä–µ–∫—Ç–∞).

```
<div><p>python</p><p><code id="code-lang-python"><span><span><span>from</span></span><span> collections </span><span><span>import</span></span><span> namedtuple

Point = namedtuple(</span><span><span>'Point'</span></span><span>, [</span><span><span>'x'</span></span><span>, </span><span><span>'y'</span></span><span>])
p = Point(</span><span><span>10</span></span><span>, </span><span><span>20</span></span><span>)
</span><span><span>print</span></span><span>(p.x, p.y)  </span><span><span># 10 20</span></span><span>
</span></span></code></p></div>
```

üü¢ –£–¥–æ–±–Ω–æ –¥–ª—è **–Ω–µ–∏–∑–º–µ–Ω—è–µ–º—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä —Å –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—è–º–∏**, –∫–∞–∫ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ –∫–ª–∞—Å—Å—É.

___

### 2\. üîÑ `deque` (–¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω—è—è –æ—á–µ—Ä–µ–¥—å)

üìå **–ß—Ç–æ —ç—Ç–æ**: –ë—ã—Å—Ç—Ä–∞—è –æ—á–µ—Ä–µ–¥—å, –≤ –∫–æ—Ç–æ—Ä—É—é –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å/—É–¥–∞–ª—è—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã —Å –æ–±–µ–∏—Ö —Å—Ç–æ—Ä–æ–Ω (O(1) —Å–∫–æ—Ä–æ—Å—Ç—å).

```
<div><p>python</p><p><code id="code-lang-python"><span><span><span>from</span></span><span> collections </span><span><span>import</span></span><span> deque

d = deque([</span><span><span>1</span></span><span>, </span><span><span>2</span></span><span>, </span><span><span>3</span></span><span>])
d.appendleft(</span><span><span>0</span></span><span>)
d.append(</span><span><span>4</span></span><span>)
</span><span><span>print</span></span><span>(d)  </span><span><span># deque([0, 1, 2, 3, 4])</span></span><span>
</span></span></code></p></div>
```

üü¢ –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –æ—á–µ—Ä–µ–¥–µ–π, —Å—Ç–µ–∫–æ–≤, sliding window –∏ —Ç.–¥.

___

### 3\. üß© `defaultdict`

üìå **–ß—Ç–æ —ç—Ç–æ**: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ `dict`, –≥–¥–µ **–∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é** —Å–æ–∑–¥–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä `int`, `list`, `set`).

```
<div><p>python</p><p><code id="code-lang-python"><span><span><span>from</span></span><span> collections </span><span><span>import</span></span><span> defaultdict

d = defaultdict(</span><span><span>list</span></span><span>)
d[</span><span><span>'a'</span></span><span>].append(</span><span><span>1</span></span><span>)
d[</span><span><span>'a'</span></span><span>].append(</span><span><span>2</span></span><span>)
</span><span><span>print</span></span><span>(d)  </span><span><span># defaultdict(&lt;class 'list'&gt;, {'a': [1, 2]})</span></span><span>
</span></span></code></p></div>
```

üü¢ –ò–∑–±–∞–≤–ª—è–µ—Ç –æ—Ç `if key not in dict` –∏ `try/except`.

___

### 4\. üßæ `OrderedDict`

üìå **–ß—Ç–æ —ç—Ç–æ**: –°–ª–æ–≤–∞—Ä—å, –∫–æ—Ç–æ—Ä—ã–π **—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–æ—Ä—è–¥–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–ª—é—á–µ–π** (–¥–æ Python 3.6+ —ç—Ç–æ –±—ã–ª–æ —É–Ω–∏–∫–∞–ª—å–Ω–æ–π –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é).

```
<div><p>python</p><p><code id="code-lang-python"><span><span><span>from</span></span><span> collections </span><span><span>import</span></span><span> OrderedDict

d = OrderedDict()
d[</span><span><span>'one'</span></span><span>] = </span><span><span>1</span></span><span>
d[</span><span><span>'two'</span></span><span>] = </span><span><span>2</span></span><span>
</span><span><span>print</span></span><span>(</span><span><span>list</span></span><span>(d.keys()))  </span><span><span># ['one', 'two']</span></span><span>
</span></span></code></p></div>
```

üü° –°–µ–π—á–∞—Å –æ–±—ã—á–Ω—ã–π `dict` —Ç–æ–∂–µ —É–ø–æ—Ä—è–¥–æ—á–µ–Ω (—Å Python 3.7+), –Ω–æ `OrderedDict` –µ—â—ë –ø–æ–ª–µ–∑–µ–Ω –¥–ª—è –ø–µ—Ä–µ—É–ø–æ—Ä—è–¥–æ—á–∏–≤–∞–Ω–∏—è –∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞.

___

### 5\. üî¢ `Counter`

üìå **–ß—Ç–æ —ç—Ç–æ**: –°–ª–æ–≤–∞—Ä—å-—Å—á–µ—Ç—á–∏–∫ ‚Äî —Å—á–∏—Ç–∞–µ—Ç, —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –∫–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç –≤—Å—Ç—Ä–µ—Ç–∏–ª—Å—è.

```
<div><p>python</p><p><code id="code-lang-python"><span><span><span>from</span></span><span> collections </span><span><span>import</span></span><span> Counter

c = Counter(</span><span><span>"banana"</span></span><span>)
</span><span><span>print</span></span><span>(c)  </span><span><span># Counter({'a': 3, 'n': 2, 'b': 1})</span></span><span>
</span></span></code></p></div>
```

üü¢ –£–¥–æ–±–µ–Ω –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —á–∞—Å—Ç–æ—Ç—ã, –ø–æ–¥—Å—á–µ—Ç–∞ —Å–∏–º–≤–æ–ª–æ–≤, —Å–ª–æ–≤ –∏ —Ç.–¥.

___

### 6\. üîó `ChainMap`

üìå **–ß—Ç–æ —ç—Ç–æ**: –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–ª–æ–≤–∞—Ä–µ–π –≤ –æ–¥–Ω—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É, –≥–¥–µ –ø–æ–∏—Å–∫ –∏–¥–µ—Ç **–ø–æ —Ü–µ–ø–æ—á–∫–µ**.

```
<div><p>python</p><p><code id="code-lang-python"><span><span><span>from</span></span><span> collections </span><span><span>import</span></span><span> ChainMap

dict1 = {</span><span><span>'a'</span></span><span>: </span><span><span>1</span></span><span>}
dict2 = {</span><span><span>'b'</span></span><span>: </span><span><span>2</span></span><span>, </span><span><span>'a'</span></span><span>: </span><span><span>3</span></span><span>}
cm = ChainMap(dict1, dict2)
</span><span><span>print</span></span><span>(cm[</span><span><span>'a'</span></span><span>])  </span><span><span># 1 ‚Äî –∏–∑ –ø–µ—Ä–≤–æ–≥–æ —Å–ª–æ–≤–∞—Ä—è</span></span><span>
</span></span></code></p></div>
```

üü¢ –£–¥–æ–±–Ω–æ –¥–ª—è **–Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π**, –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏—è –∑–Ω–∞—á–µ–Ω–∏–π.

___

### 7\. üõ† `UserDict`, `UserList`, `UserString`

üìå **–ß—Ç–æ —ç—Ç–æ**: –ë–∞–∑–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã –¥–ª—è **–Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –∏ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ–≤–µ–¥–µ–Ω–∏—è** —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä:

#### ‚úÖ `UserDict`

```
<div><p>python</p><p><code id="code-lang-python"><span><span><span>from</span></span><span> collections </span><span><span>import</span></span><span> UserDict

</span><span><span>class</span></span><span> </span><span><span>MyDict</span></span><span>(</span><span><span>UserDict</span></span><span>):
    </span><span><span>def</span></span><span> </span><span><span>__setitem__</span></span><span>(</span><span><span>self, key, value</span></span><span>):
        </span><span><span>print</span></span><span>(</span><span><span>f"Setting <span>{key}</span></span></span><span> = </span><span><span>{value}</span></span><span>")
        </span><span><span>super</span></span><span>().__setitem__(key, value)

d = MyDict()
d[</span><span><span>'x'</span></span><span>] = </span><span><span>42</span></span><span>
</span></span></code></p></div>
```

#### ‚úÖ `UserList` / `UserString`

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ, –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—à—å –º–µ—Ç–æ–¥—ã —Å–ø–∏—Å–∫–∞/—Å—Ç—Ä–æ–∫–∏:

```
<div><p>python</p><p><code id="code-lang-python"><span><span><span>from</span></span><span> collections </span><span><span>import</span></span><span> UserList

</span><span><span>class</span></span><span> </span><span><span>MyList</span></span><span>(</span><span><span>UserList</span></span><span>):
    </span><span><span>def</span></span><span> </span><span><span>append</span></span><span>(</span><span><span>self, item</span></span><span>):
        </span><span><span>print</span></span><span>(</span><span><span>f"Adding <span>{item}</span></span></span><span>")
        </span><span><span>super</span></span><span>().append(item)

l = MyList([</span><span><span>1</span></span><span>, </span><span><span>2</span></span><span>])
l.append(</span><span><span>3</span></span><span>)
</span></span></code></p></div>
```

üü¢ –£–¥–æ–±–Ω—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è **–æ–±–µ—Ä—Ç–æ–∫ –Ω–∞–¥ —Å–ø–∏—Å–∫–∞–º–∏, —Å—Ç—Ä–æ–∫–∞–º–∏, —Å–ª–æ–≤–∞—Ä—è–º–∏** —Å –ª–æ–≥–∏–∫–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏, –ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Ç.–ø.

___

## üß† –†–µ–∑—é–º–µ

| –°—Ç—Ä—É–∫—Ç—É—Ä–∞ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
| --- | --- |
| `namedtuple` | –ö–æ—Ä—Ç–µ–∂ —Å –∏–º–µ–Ω–∞–º–∏ –ø–æ–ª–µ–π |
| `deque` | –ë—ã—Å—Ç—Ä–∞—è –æ—á–µ—Ä–µ–¥—å (–¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω—è—è) |
| `defaultdict` | dict —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é |
| `OrderedDict` | dict —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –ø–æ—Ä—è–¥–∫–∞ –∫–ª—é—á–µ–π |
| `Counter` | –ü–æ–¥—Å—á–µ—Ç —á–∞—Å—Ç–æ—Ç—ã —ç–ª–µ–º–µ–Ω—Ç–æ–≤ |
| `ChainMap` | –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–ª–æ–≤–∞—Ä–µ–π –≤ –æ–¥–∏–Ω –≤–∏–¥ |
| `UserDict` | –û–±—ä–µ–∫—Ç-–Ω–∞—Å–ª–µ–¥–Ω–∏–∫ —Å–ª–æ–≤–∞—Ä—è —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º –ø–æ–≤–µ–¥–µ–Ω–∏–µ–º |
| `UserList` | –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ, –Ω–æ –¥–ª—è —Å–ø–∏—Å–∫–∞ |
| `UserString` | –î–ª—è —Å—Ç—Ä–æ–∫ |

–•–æ—á–µ—à—å ‚Äî –º–æ–≥—É –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∏–º–µ—Ä—ã —Å –±–æ–ª–µ–µ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–º–∏ –∑–∞–¥–∞—á–∞–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á —Å `deque`, –ø–æ–¥—Å—á–µ—Ç —Ç–µ–≥–æ–≤ —Å `Counter` –∏ —Ç.–¥.).

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

###### ChatGPT —Å–∫–∞–∑–∞–ª:

**RedisGraph** ‚Äî —ç—Ç–æ –º–æ–¥—É–ª—å –¥–ª—è Redis, –∫–æ—Ç–æ—Ä—ã–π –¥–æ–±–∞–≤–ª—è–µ—Ç **–ø–æ–¥–¥–µ—Ä–∂–∫—É –≥—Ä–∞—Ñ–æ–≤—ã—Ö –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö**. –û–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å, –∏–∑–º–µ–Ω—è—Ç—å –∏ –≤—ã–ø–æ–ª–Ω—è—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫ –¥–∞–Ω–Ω—ã–º, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–º –≤ –≤–∏–¥–µ **–≥—Ä–∞—Ñ–∞** (—É–∑–ª—ã + —Å–≤—è–∑–∏).

___

## üî∑ –ß—Ç–æ —Ç–∞–∫–æ–µ –≥—Ä–∞—Ñ–æ–≤–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö?

–í–º–µ—Å—Ç–æ —Ç–∞–±–ª–∏—Ü (–∫–∞–∫ –≤ SQL) –∏–ª–∏ –∫–æ–ª–ª–µ–∫—Ü–∏–π (–∫–∞–∫ –≤ NoSQL), –≥—Ä–∞—Ñ–æ–≤—ã–µ –ë–î —Ä–∞–±–æ—Ç–∞—é—Ç —Å:

-   **–£–∑–ª–∞–º–∏ (nodes)** ‚Äî —Å—É—â–Ω–æ—Å—Ç–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ª—é–¥–∏, –≥–æ—Ä–æ–¥–∞, –∫–æ–º–ø–∞–Ω–∏–∏),
    
-   **–†–µ–±—Ä–∞–º–∏ (edges)** ‚Äî —Å–≤—è–∑–∏ –º–µ–∂–¥—É —É–∑–ª–∞–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–∑–Ω–∞–µ—Ç", "—Ä–∞–±–æ—Ç–∞–µ—Ç –≤").
    

___

## üì¶ –ß—Ç–æ —É–º–µ–µ—Ç RedisGraph

-   –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —è–∑—ã–∫ –∑–∞–ø—Ä–æ—Å–æ–≤ **Cypher** (–∫–∞–∫ –≤ Neo4j),
    
-   –•—Ä–∞–Ω–∏—Ç –≥—Ä–∞—Ñ–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä—è–º–æ –≤ Redis (in-memory),
    
-   –û—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –≥—Ä–∞—Ñ—É,
    
-   –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–µ–ª–∞—Ç—å **—Å–ª–æ–∂–Ω—ã–µ —Å–≤—è–∑–∏, path traversal, —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏** –∏ –¥—Ä.
    

___

## üìå –ü—Ä–∏–º–µ—Ä

```
<div><p>cypher</p><p><code id="code-lang-cypher"><span>CREATE (:Person {name: 'Alice'})-[:KNOWS]-&gt;(:Person {name: 'Bob'})
</span></code></p></div>
```

```
<div><p>cypher</p><p><code id="code-lang-cypher"><span>MATCH (a:Person)-[:KNOWS]-&gt;(b:Person) RETURN a.name, b.name
</span></code></p></div>
```

–¢–∞–∫–æ–π –∑–∞–ø—Ä–æ—Å –Ω–∞–π–¥–µ—Ç –≤—Å–µ—Ö –ª—é–¥–µ–π, –∫—Ç–æ –∫–æ–≥–æ-—Ç–æ –∑–Ω–∞–µ—Ç.

___

## üöÄ –ü—Ä–∏–º–µ—Ä —Å Python (—á–µ—Ä–µ–∑ redis + redisgraph)

```
<div><p>python</p><p><code id="code-lang-python"><span><span><span>import</span></span><span> redis
</span><span><span>from</span></span><span> redisgraph </span><span><span>import</span></span><span> Node, Edge, Graph

r = redis.Redis()
graph = Graph(</span><span><span>"social"</span></span><span>, r)

alice = Node(label=</span><span><span>"Person"</span></span><span>, properties={</span><span><span>"name"</span></span><span>: </span><span><span>"Alice"</span></span><span>})
bob = Node(label=</span><span><span>"Person"</span></span><span>, properties={</span><span><span>"name"</span></span><span>: </span><span><span>"Bob"</span></span><span>})
graph.add_node(alice)
graph.add_node(bob)
graph.add_edge(Edge(alice, </span><span><span>"KNOWS"</span></span><span>, bob))
graph.commit()

query = </span><span><span>"MATCH (a:Person)-[:KNOWS]-&gt;(b:Person) RETURN a.name, b.name"</span></span><span>
result = graph.query(query)

</span><span><span>for</span></span><span> record </span><span><span>in</span></span><span> result.result_set:
    </span><span><span>print</span></span><span>(record)
</span></span></code></p></div>
```

___

## üß† –ì–¥–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç RedisGraph

-   –†–µ–∫–æ–º–µ–Ω–¥–∞—Ç–µ–ª—å–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã,
    
-   –ü–æ–∏—Å–∫ –ø—É—Ç–µ–π –∏ —Å–≤—è–∑–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–¥—Ä—É–∑—å—è –¥—Ä—É–∑–µ–π"),
    
-   –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–Ω–∞–Ω–∏—è–º–∏ –∏ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ —Å–µ—Ç–∏,
    
-   –ê–Ω–∞–ª–∏–∑ —Å–æ—Ü—Å–µ—Ç–µ–π, —Ü–µ–ø–æ—á–µ–∫ –ø–æ—Å—Ç–∞–≤–æ–∫ –∏ —Ç.–¥.
    

___

## üîç –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –¥—Ä—É–≥–∏–º–∏

| –§–∏—á–∞ | RedisGraph | Neo4j |
| --- | --- | --- |
| –í –ø–∞–º—è—Ç–∏ | ‚úÖ –ë—ã—Å—Ç—Ä–æ | ‚ùå (–¥–∏—Å–∫–æ–≤–∞—è –ë–î) |
| –Ø–∑—ã–∫ –∑–∞–ø—Ä–æ—Å–æ–≤ | Cypher | Cypher |
| –£—Å—Ç–∞–Ω–æ–≤–∫–∞ | Redis + –º–æ–¥—É–ª—å RedisGraph | –û—Ç–¥–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä |
| –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å | Redis-–∫–ª–∞—Å—Ç–µ—Ä—ã | –ë–æ–ª–µ–µ —Ç—è–∂—ë–ª—ã–π |

___

–•–æ—á–µ—à—å ‚Äî –º–æ–≥—É –ø–æ–∫–∞–∑–∞—Ç—å docker-–ø—Ä–∏–º–µ—Ä RedisGraph + Python.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–í–æ—Ç **–ø–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä –ø—Ä–æ–µ–∫—Ç–∞ —Å RedisGraph + Python**, –∏—Å–ø–æ–ª—å–∑—É—è Docker –∏ `redisgraph-py`.

___

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
<div><p><code><span><span>redisgraph-example/
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ app.py
‚îú‚îÄ‚îÄ requirements.txt
</span></span></code></p></div>
```

___

## üì¶ `docker-compose.yml`

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>version:</span></span><span> </span><span><span>'3.8'</span></span><span>

</span><span><span>services:</span></span><span>
  </span><span><span>redis:</span></span><span>
    </span><span><span>image:</span></span><span> </span><span><span>redislabs/redisgraph:2.10.9</span></span><span>
    </span><span><span>ports:</span></span><span>
      </span><span><span>-</span></span><span> </span><span><span>"6379:6379"</span></span><span>
</span></span></code></p></div>
```

> üî∏ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑ —Å RedisGraph 2.x. Redis 7+ —Ç—Ä–µ–±—É–µ—Ç Redis Modules –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–π Graph.

___

## üìÑ `requirements.txt`

___

## üêç `app.py`

```
<div><p>python</p><p><code id="code-lang-python"><span><span><span>import</span></span><span> redis
</span><span><span>from</span></span><span> redisgraph </span><span><span>import</span></span><span> Node, Edge, Graph

</span><span><span># –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Redis</span></span><span>
r = redis.Redis(host=</span><span><span>'localhost'</span></span><span>, port=</span><span><span>6379</span></span><span>)
graph = Graph(</span><span><span>"social"</span></span><span>, r)

</span><span><span># –û—á–∏—Å—Ç–∏–º –≥—Ä–∞—Ñ –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π</span></span><span>
graph.delete()

</span><span><span># –°–æ–∑–¥–∞–Ω–∏–µ —É–∑–ª–æ–≤ –∏ —Å–≤—è–∑–∏</span></span><span>
alice = Node(label=</span><span><span>"Person"</span></span><span>, properties={</span><span><span>"name"</span></span><span>: </span><span><span>"Alice"</span></span><span>})
bob = Node(label=</span><span><span>"Person"</span></span><span>, properties={</span><span><span>"name"</span></span><span>: </span><span><span>"Bob"</span></span><span>})
graph.add_node(alice)
graph.add_node(bob)

</span><span><span># –î–æ–±–∞–≤–∏–º —Å–≤—è–∑—å</span></span><span>
knows_edge = Edge(alice, </span><span><span>"KNOWS"</span></span><span>, bob)
graph.add_edge(knows_edge)

</span><span><span># –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Redis</span></span><span>
graph.commit()

</span><span><span># –ó–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–∏—Å–∫</span></span><span>
query = </span><span><span>"MATCH (a:Person)-[:KNOWS]-&gt;(b:Person) RETURN a.name, b.name"</span></span><span>
result = graph.query(query)

</span><span><span># –í—ã–≤–æ–¥–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç</span></span><span>
</span><span><span>print</span></span><span>(</span><span><span>"=== GRAPH RESULT ==="</span></span><span>)
</span><span><span>for</span></span><span> record </span><span><span>in</span></span><span> result.result_set:
    </span><span><span>print</span></span><span>(</span><span><span>f"<span>{record[<span>0</span></span></span></span><span>]} knows </span><span><span>{record[<span>1</span></span></span><span>]}")
</span></span></code></p></div>
```

___

## ‚ñ∂Ô∏è –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å

1.  –°–∫–ª–æ–Ω–∏—Ä—É–π –∏–ª–∏ —Å–æ–∑–¥–∞–π —Ñ–∞–π–ª—ã –∫–∞–∫ –≤—ã—à–µ
    
2.  –ó–∞–ø—É—Å—Ç–∏ RedisGraph:
    

3.  –£—Å—Ç–∞–Ω–æ–≤–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
    

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>pip install -r requirements.txt
</span></span></code></p></div>
```

4.  –ó–∞–ø—É—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
    

‚úÖ –¢—ã –¥–æ–ª–∂–µ–Ω —É–≤–∏–¥–µ—Ç—å:

```
<div><p>diff</p><p><code><span><span><span>=== GRAPH RESULT ===</span></span><span>
Alice knows Bob
</span></span></code></p></div>
```

___

–•–æ—á–µ—à—å ‚Äî –º–æ–≥—É —Ä–∞—Å—à–∏—Ä–∏—Ç—å –ø—Ä–∏–º–µ—Ä —Å –∏–º–ø–æ—Ä—Ç–æ–º –¥–∞–Ω–Ω—ã—Ö, —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏ –∏–ª–∏ REST API.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–∫–∞–∫–æ–µ –µ—â—ë –µ—Å—Ç—å –≤–∞–∂–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ Redis Graph

###### ChatGPT —Å–∫–∞–∑–∞–ª:

RedisGraph ‚Äî –º–æ—â–Ω–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ Redis, –∏ –∫—Ä–æ–º–µ –±–∞–∑–æ–≤—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π (—É–∑–ª—ã, —Å–≤—è–∑–∏, Cypher-–∑–∞–ø—Ä–æ—Å—ã), —É –Ω–µ–≥–æ –µ—Å—Ç—å **—Ä—è–¥ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π**, –¥–µ–ª–∞—é—â–∏—Ö –µ–≥–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –∏ —É–¥–æ–±–Ω—ã–º –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∏ real-time —Å–∏—Å—Ç–µ–º–∞—Ö.

___

## üîç –í–∞–∂–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ RedisGraph

### 1\. üß† **–Ø–∑—ã–∫ –∑–∞–ø—Ä–æ—Å–æ–≤ Cypher**

RedisGraph –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Cypher, —Ç–æ—Ç –∂–µ —è–∑—ã–∫, —á—Ç–æ –∏ –≤ Neo4j. –≠—Ç–æ –º–æ—â–Ω—ã–π DSL –¥–ª—è:

-   –ü–æ–∏—Å–∫–∞ –ø–æ —Å–≤—è–∑—è–º (`MATCH`)
    
-   –§–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ (`WHERE`)
    
-   –°–æ–∑–¥–∞–Ω–∏—è (`CREATE`, `MERGE`)
    
-   –ê–≥—Ä–µ–≥–∞—Ü–∏–∏ (`COUNT`, `AVG`, `COLLECT`, –∏ —Ç.–¥.)
    

üëâ –ü—Ä–∏–º–µ—Ä:

```
<div><p>cypher</p><p><code id="code-lang-cypher"><span>MATCH (a:Person)-[:KNOWS]-&gt;(b:Person) RETURN a.name, count(b)
</span></code></p></div>
```

___

### 2\. ‚ö° **In-Memory –±–∞–∑–∞ + Redis**

RedisGraph —Ö—Ä–∞–Ω–∏—Ç –≥—Ä–∞—Ñ **–≤ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏**, –∞ Redis –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:

-   –í—ã—Å–æ–∫—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–º–∏–ª–ª–∏–æ–Ω—ã –∑–∞–ø—Ä–æ—Å–æ–≤/—Å–µ–∫),
    
-   –ü—Ä–æ—Å—Ç—É—é —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é –∏ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—é,
    
-   –ü–æ—Å—Ç–æ—è–Ω—Å—Ç–≤–æ (—á–µ—Ä–µ–∑ RDB –∏–ª–∏ AOF ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –Ω–∞ –¥–∏—Å–∫).
    

___

### 3\. üîÑ **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π**

RedisGraph –ø–æ–∑–≤–æ–ª—è–µ—Ç:

-   –î–æ–±–∞–≤–ª—è—Ç—å/—É–¥–∞–ª—è—Ç—å —É–∑–ª—ã –∏ —Å–≤—è–∑–∏,
    
-   –û–±–Ω–æ–≤–ª—è—Ç—å —Å–≤–æ–π—Å—Ç–≤–∞,
    
-   –í—ã–ø–æ–ª–Ω—è—Ç—å `MERGE` (–∞–Ω–∞–ª–æ–≥ UPSERT).
    

```
<div><p>cypher</p><p><code id="code-lang-cypher"><span>MERGE (p:Person {name: 'Alice'}) ON CREATE SET p.age = 30
</span></code></p></div>
```

___

### 4\. üßÆ **–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã**

RedisGraph –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç:

-   –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫—É (`GROUP BY`),
    
-   –°–æ—Ä—Ç–∏—Ä–æ–≤–∫—É (`ORDER BY`),
    
-   –ü–æ–¥—Å—á—ë—Ç—ã (`COUNT`, `MIN`, `MAX`, `AVG`),
    
-   –ö–æ–ª–ª–µ–∫—Ü–∏–∏ (`COLLECT`, `UNWIND`).
    

–ü—Ä–∏–º–µ—Ä:

```
<div><p>cypher</p><p><code id="code-lang-cypher"><span>MATCH (p:Person)-[:FRIEND]-&gt;(f) RETURN p.name, count(f) as num_friends ORDER BY num_friends DESC
</span></code></p></div>
```

___

### 5\. üì¶ **–ö–æ–º–ø–∞–∫—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ: Sparse Matrices**

–í –æ—Å–Ω–æ–≤–µ RedisGraph ‚Äî **–±–∏–±–ª–∏–æ—Ç–µ–∫–∞ GraphBLAS**. –≠—Ç–æ:

-   –•—Ä–∞–Ω–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∞ –∫–∞–∫ **—Ä–∞–∑—Ä–µ–∂–µ–Ω–Ω–æ–π –º–∞—Ç—Ä–∏—Ü—ã**,
    
-   –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∞–ª–≥–µ–±—Ä–∞–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (–æ—á–µ–Ω—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ),
    
-   –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è **–±–æ–ª—å—à–∏—Ö –∏ —Ä–∞–∑—Ä–µ–∂–µ–Ω–Ω—ã—Ö –≥—Ä–∞—Ñ–æ–≤** (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–æ—Ü—Å–µ—Ç–µ–π).
    

___

### 6\. üîó **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å—Ö–µ–º –∏ –∏–Ω–¥–µ–∫—Å–æ–≤**

–ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å **–∏–Ω–¥–µ–∫—Å—ã** –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –ø–æ–∏—Å–∫–∞:

```
<div><p>cypher</p><p><code id="code-lang-cypher"><span>CREATE INDEX ON :Person(name)
</span></code></p></div>
```

–£–ª—É—á—à–∞–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è `MATCH` —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ –ø–æ–ª—é.

___

### 7\. üìâ **–ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤**

–ö–æ–º–∞–Ω–¥—ã `PROFILE` –∏ `EXPLAIN` –¥–∞—é—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–∞:

```
<div><p>cypher</p><p><code id="code-lang-cypher"><span>PROFILE MATCH (a)-[:KNOWS]-&gt;(b) RETURN a.name
</span></code></p></div>
```

üìå –£–¥–æ–±–Ω–æ –ø—Ä–∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–∏ —Å–ª–æ–∂–Ω—ã—Ö –≥—Ä–∞—Ñ–æ–≤ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Å–∫–æ—Ä–æ—Å—Ç–∏.

___

### 8\. üîí **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ ACL —á–µ—Ä–µ–∑ Redis**

RedisGraph –Ω–∞—Å–ª–µ–¥—É–µ—Ç —Å–∏—Å—Ç–µ–º—É –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ Redis:

-   –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ —á–µ—Ä–µ–∑ `AUTH`,
    
-   ACL-–ø–æ–ª–∏—Ç–∏–∫–∏ (—Å Redis 6+),
    
-   TLS/SSL.
    

___

### 9\. üîÅ **–õ–µ–≥–∫–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**

RedisGraph –ª–µ–≥–∫–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å:

-   Python (—á–µ—Ä–µ–∑ `redisgraph-py`),
    
-   Node.js, Java, Go –∏ —Ç.–¥.,
    
-   Grafana, —á–µ—Ä–µ–∑ Redis Data Source –ø–ª–∞–≥–∏–Ω,
    
-   REST-—Å–µ—Ä–≤–µ—Ä (–º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–≤–æ–π API).
    

___

## üß† –í –∫–∞–∫–∏—Ö –∑–∞–¥–∞—á–∞—Ö RedisGraph –æ—Å–æ–±–µ–Ω–Ω–æ —Ö–æ—Ä–æ—à?

| –û–±–ª–∞—Å—Ç—å | –ü–æ—á–µ–º—É RedisGraph –ø–æ–¥—Ö–æ–¥–∏—Ç |
| --- | --- |
| –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏ | –õ—é–¥–∏, –ø–æ–¥–ø–∏—Å–∫–∏, —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥—Ä—É–∑–µ–π |
| –°–∏—Å—Ç–µ–º—ã —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π | "–ü–æ–∫—É–ø–∞–ª–∏ –≤–º–µ—Å—Ç–µ", "–ü–æ—Ö–æ–∂–∏ –Ω–∞", –≥—Ä–∞—Ñ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤ |
| Fraud detection | –í—ã—è–≤–ª–µ–Ω–∏–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö —Å–≤—è–∑–µ–π |
| –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–Ω–∞–Ω–∏—è–º–∏ | –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ —Å–µ—Ç–∏, –æ–Ω—Ç–æ–ª–æ–≥–∏–∏ |
| –ú–∞—Ä—à—Ä—É—Ç—ã –∏ –ª–æ–≥–∏—Å—Ç–∏–∫–∞ | –ü–æ–∏—Å–∫ –ø—É—Ç–µ–π, —Å–≤—è–∑–∏ –º–µ–∂–¥—É —Ç–æ—á–∫–∞–º–∏ |
| IT-–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ | –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è–º–∏ |

___

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å ‚Äî –º–æ–≥—É:

-   –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∏–º–µ—Ä—ã —Å–ª–æ–∂–Ω—ã—Ö Cypher-–∑–∞–ø—Ä–æ—Å–æ–≤,
    
-   —Å—Ä–∞–≤–Ω–∏—Ç—å RedisGraph —Å Neo4j –∏–ª–∏ ArangoDB,
    
-   –∏–ª–∏ —Å–¥–µ–ª–∞—Ç—å –≥—Ä–∞—Ñ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é –≤ Python / Streamlit.
    

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∏–º–µ—Ä—ã —Å–ª–æ–∂–Ω—ã—Ö Cypher-–∑–∞–ø—Ä–æ—Å–æ–≤

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–í–æ—Ç –ø–æ–¥–±–æ—Ä–∫–∞ **–ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö –∏ –ø–æ–ª–µ–∑–Ω—ã—Ö Cypher-–∑–∞–ø—Ä–æ—Å–æ–≤** –¥–ª—è RedisGraph, —Å –ø–æ—è—Å–Ω–µ–Ω–∏–µ–º.

___

## üì¶ –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–≥—Ä–∞—Ñ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–≤—è–∑–µ–π)

–î–æ–ø—É—Å—Ç–∏–º, —É –Ω–∞—Å –µ—Å—Ç—å –≥—Ä–∞—Ñ `social`, –≤ –∫–æ—Ç–æ—Ä–æ–º:

-   –£–∑–ª—ã: `:Person {name, age, city}`
    
-   –†—ë–±—Ä–∞: `[:FRIEND {since}]`
    

```
<div><p>cypher</p><p><code id="code-lang-cypher"><span>CREATE
  (alice:Person {name: 'Alice', age: 30, city: 'Paris'}),
  (bob:Person {name: 'Bob', age: 32, city: 'London'}),
  (carol:Person {name: 'Carol', age: 29, city: 'Paris'}),
  (dave:Person {name: 'Dave', age: 35, city: 'Berlin'}),
  (alice)-[:FRIEND {since: 2015}]-&gt;(bob),
  (bob)-[:FRIEND {since: 2016}]-&gt;(carol),
  (carol)-[:FRIEND {since: 2017}]-&gt;(dave),
  (alice)-[:FRIEND {since: 2019}]-&gt;(carol)
</span></code></p></div>
```

___

## üîç 1. **–ù–∞–π—Ç–∏ –¥—Ä—É–∑–µ–π –¥—Ä—É–∑–µ–π Alice**

```
<div><p>cypher</p><p><code id="code-lang-cypher"><span>MATCH (a:Person {name: 'Alice'})-[:FRIEND]-&gt;(:Person)-[:FRIEND]-&gt;(fof)
WHERE fof.name &lt;&gt; 'Alice'
RETURN DISTINCT fof.name
</span></code></p></div>
```

> ‚õì Traversal –Ω–∞ 2 —à–∞–≥–∞: –¥—Ä—É–∑–µ–π –¥—Ä—É–∑–µ–π

___

## üìÖ 2. **–ù–∞–π—Ç–∏ –¥—Ä—É–∑–µ–π, —Å –∫–µ–º –¥—Ä—É–∂–∞—Ç –¥–æ–ª—å—à–µ 5 –ª–µ—Ç**

```
<div><p>cypher</p><p><code id="code-lang-cypher"><span>MATCH (a:Person {name: 'Alice'})-[f:FRIEND]-&gt;(b)
WHERE f.since &lt; 2020
RETURN b.name, 2025 - f.since AS years_known
</span></code></p></div>
```

___

## üìä 3. **–ü–æ—Å—á–∏—Ç–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥—Ä—É–∑–µ–π —É –∫–∞–∂–¥–æ–≥–æ**

```
<div><p>cypher</p><p><code id="code-lang-cypher"><span>MATCH (p:Person)-[:FRIEND]-&gt;(f)
RETURN p.name, count(f) AS friend_count
ORDER BY friend_count DESC
</span></code></p></div>
```

___

## üèò 4. **–°–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –ª—é–¥–µ–π –ø–æ –≥–æ—Ä–æ–¥–∞–º –∏ –ø–æ—Å—á–∏—Ç–∞—Ç—å**

```
<div><p>cypher</p><p><code id="code-lang-cypher"><span>MATCH (p:Person)
RETURN p.city, count(p) AS num_people
ORDER BY num_people DESC
</span></code></p></div>
```

___

## üéØ 5. **–ù–∞–π—Ç–∏ –∫—Ä–∞—Ç—á–∞–π—à–∏–π –ø—É—Ç—å –º–µ–∂–¥—É –¥–≤—É–º—è –ª—é–¥—å–º–∏**

```
<div><p>cypher</p><p><code id="code-lang-cypher"><span>MATCH p = shortestPath((a:Person {name: 'Alice'})-[:FRIEND*..5]-(b:Person {name: 'Dave'}))
RETURN p
</span></code></p></div>
```

> –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫—Ä–∞—Ç—á–∞–π—à–∏–π –ø—É—Ç—å –ø–æ `FRIEND` –¥–æ –≥–ª—É–±–∏–Ω—ã 5.

___

## üß¨ 6. **–ù–∞–π—Ç–∏ –∫–ª–∞—Å—Ç–µ—Ä—ã –¥—Ä—É–∑–µ–π (–≤–∑–∞–∏–º–Ω—ã–µ —Å–≤—è–∑–∏)**

```
<div><p>cypher</p><p><code id="code-lang-cypher"><span>MATCH (a:Person)-[:FRIEND]-&gt;(b)-[:FRIEND]-&gt;(a)
RETURN a.name, b.name
</span></code></p></div>
```

> –ù–∞—Ö–æ–¥–∏—Ç –≤–∑–∞–∏–º–Ω—ã–µ –¥—Ä—É–∂–±—ã.

___

## üîÅ 7. **–ù–∞–π—Ç–∏ —Ü–∏–∫–ª—ã (–ª—é–¥–∏, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ –∑–∞–º–∫–Ω—É—Ç—ã–µ —Ü–µ–ø–∏)**

```
<div><p>cypher</p><p><code id="code-lang-cypher"><span>MATCH p = (a:Person)-[:FRIEND*2..5]-&gt;(a)
RETURN p
LIMIT 5
</span></code></p></div>
```

> –õ—é–¥–∏, –≤–µ—Ä–Ω—É–≤—à–∏–µ—Å—è –∫ —Å–µ–±–µ –ø–æ –≥—Ä–∞—Ñ—É –¥—Ä—É–∂–±—ã.

___

## üí¨ 8. **–ù–∞–π—Ç–∏ –≤—Å–µ—Ö –≤ –ü–∞—Ä–∏–∂–µ, —É –∫–æ–≥–æ –±–æ–ª—å—à–µ 1 –¥—Ä—É–≥–∞**

```
<div><p>cypher</p><p><code id="code-lang-cypher"><span>MATCH (p:Person {city: 'Paris'})-[:FRIEND]-&gt;(f)
WITH p, count(f) AS friends
WHERE friends &gt; 1
RETURN p.name, friends
</span></code></p></div>
```

___

## üìå 9. **–í—Å–µ —Å–≤—è–∑–∏ –≤ –≥—Ä–∞—Ñ–µ –≤ –≤–∏–¥–µ –ø–∞—Ä**

```
<div><p>cypher</p><p><code id="code-lang-cypher"><span>MATCH (a)-[r]-&gt;(b)
RETURN a.name, type(r), b.name
</span></code></p></div>
```

___

## üß™ 10. **–ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞**

```
<div><p>cypher</p><p><code id="code-lang-cypher"><span>PROFILE MATCH (a:Person)-[:FRIEND]-&gt;(b) RETURN a.name, b.name
</span></code></p></div>
```

–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫ RedisGraph –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–ø—Ä–æ—Å ‚Äî –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏.

___

–•–æ—á–µ—à—å ‚Äî –º–æ–≥—É –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≥—Ä–∞—Ñ (–≤ Python, Streamlit –∏–ª–∏ Jupyter) –∏–ª–∏ –ø–æ–∫–∞–∑–∞—Ç—å, –∫–∞–∫ —Ç–∞–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã –≤—ã–∑—ã–≤–∞—Ç—å –∏–∑ Python-–∫–æ–¥–∞.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–∫–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤–æ—Ç —Ç–∞–∫—É—é –∫–æ–º–∞–Ω–¥—É –≤ Redis CLI: CREATE (alice:Person {name: 'Alice', age: 30, city: 'Paris'}), (bob:Person {name: 'Bob', age: 32, city: 'London'}), (carol:Person {name: 'Carol', age: 29, city: 'Paris'}), (dave:Person {name: 'Dave', age: 35, city: 'Berlin'}), (alice)-\[:FRIEND {since: 2015}\]->(bob), (bob)-\[:FRIEND {since: 2016}\]->(carol), (carol)-\[:FRIEND {since: 2017}\]->(dave), (alice)-\[:FRIEND {since: 2019}\]->(carol)

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–ß—Ç–æ–±—ã –≤—ã–ø–æ–ª–Ω–∏—Ç—å Cypher-–∑–∞–ø—Ä–æ—Å RedisGraph —á–µ—Ä–µ–∑ `redis-cli`, –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É `GRAPH.QUERY`, –ø–µ—Ä–µ–¥–∞–≤ –∏–º—è –≥—Ä–∞—Ñ–∞ –∏ —Å–∞–º –∑–∞–ø—Ä–æ—Å –≤ **–æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ**.

___

## ‚úÖ –ü—Ä–∏–º–µ—Ä –∑–∞–ø—É—Å–∫–∞ –≤ `redis-cli`

–ó–∞—Ç–µ–º –≤ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–π –∫–æ–Ω—Å–æ–ª–∏ Redis:

```
<div><p>redis</p><p><code id="code-lang-redis"><span>GRAPH.QUERY social "
CREATE
  (alice:Person {name: 'Alice', age: 30, city: 'Paris'}),
  (bob:Person {name: 'Bob', age: 32, city: 'London'}),
  (carol:Person {name: 'Carol', age: 29, city: 'Paris'}),
  (dave:Person {name: 'Dave', age: 35, city: 'Berlin'}),
  (alice)-[:FRIEND {since: 2015}]-&gt;(bob),
  (bob)-[:FRIEND {since: 2016}]-&gt;(carol),
  (carol)-[:FRIEND {since: 2017}]-&gt;(dave),
  (alice)-[:FRIEND {since: 2019}]-&gt;(carol)
"
</span></code></p></div>
```

üìå –ó–¥–µ—Å—å:

-   `social` ‚Äî –∏–º—è –≥—Ä–∞—Ñ–∞, —Ç—ã –º–æ–∂–µ—à—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª—é–±–æ–µ (–æ–Ω–æ —Å–æ–∑–¥–∞—Å—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏).
    
-   –í–µ—Å—å –∑–∞–ø—Ä–æ—Å –ø–∏—à–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ `"` (–∏–ª–∏ `'`, –Ω–æ –≥–ª–∞–≤–Ω–æ–µ ‚Äî –Ω–µ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å —Å—Ç—Ä–æ–∫–∏ –≤–Ω–µ –∫–∞–≤—ã—á–µ–∫ –±–µ–∑ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è).
    

___

## ‚ö†Ô∏è –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: —á–µ—Ä–µ–∑ `--raw`

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –Ω–∞–ø—Ä—è–º—É—é –∏–∑ shell (–±–µ–∑ –≤—Ö–æ–¥–∞ –≤ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º), —Ç–æ:

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>redis-cli --raw GRAPH.QUERY social </span><span><span>"CREATE (alice:Person {name: 'Alice', age: 30, city: 'Paris'}), (bob:Person {name: 'Bob', age: 32, city: 'London'}), (carol:Person {name: 'Carol', age: 29, city: 'Paris'}), (dave:Person {name: 'Dave', age: 35, city: 'Berlin'}), (alice)-[:FRIEND {since: 2015}]-&gt;(bob), (bob)-[:FRIEND {since: 2016}]-&gt;(carol), (carol)-[:FRIEND {since: 2017}]-&gt;(dave), (alice)-[:FRIEND {since: 2019}]-&gt;(carol)"</span></span><span>
</span></span></code></p></div>
```

___

## üí° –£–±–µ–¥–∏—Å—å, —á—Ç–æ RedisGraph —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

–ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –º–æ–¥—É–ª—å RedisGraph –∑–∞–≥—Ä—É–∂–µ–Ω:

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>redis-cli MODULE LIST
</span></span></code></p></div>
```

–ï—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω ‚Äî RedisGraph –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å —á–µ—Ä–µ–∑ Docker:

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>docker run -p 6379:6379 -it --</span><span><span>rm</span></span><span> redislabs/redisgraph
</span></span></code></p></div>
```

___

–•–æ—á–µ—à—å ‚Äî –º–æ–≥—É –¥–∞—Ç—å –ø—Ä–∏–º–µ—Ä –Ω–∞ Python (`redisgraph-py`) –∏–ª–∏ REST-–∑–∞–ø—Ä–æ—Å –∫ RedisGraph.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

127.0.0.1:6379> GRAPH.QUERY social " (error) ERR wrong number of arguments for 'GRAPH.QUERY' command 127.0.0.1:6379> CREATE (error) ERR unknown command `CREATE`, with args beginning with: 127.0.0.1:6379>

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–û—à–∏–±–∫–∞ `(error) ERR wrong number of arguments for 'GRAPH.QUERY'` –∏ `ERR unknown command CREATE` –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ:

üìå **RedisGraph –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–ª–∏ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω –∫–∞–∫ –º–æ–¥—É–ª—å.**

Redis –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é **–Ω–µ —É–º–µ–µ—Ç –ø–æ–Ω–∏–º–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã —Ç–∏–ø–∞ `GRAPH.QUERY`**, –µ—Å–ª–∏ –º–æ–¥—É–ª—å `RedisGraph` –Ω–µ –ø–æ–¥–∫–ª—é—á—ë–Ω.

___

## üîß –ö–∞–∫ —ç—Ç–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å

### ‚úÖ –°–ø–æ—Å–æ–± 1: –∑–∞–ø—É—Å—Ç–∏—Ç—å Redis —Å RedisGraph —á–µ—Ä–µ–∑ Docker

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>docker run -p 6379:6379 -it --</span><span><span>rm</span></span><span> redislabs/redisgraph
</span></span></code></p></div>
```

–ó–∞—Ç–µ–º –≤ –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:

–¢–µ–ø–µ—Ä—å `GRAPH.QUERY` –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞:

```
<div><p>redis</p><p><code id="code-lang-redis"><span>GRAPH.QUERY social "CREATE (:Person {name: 'Alice'})"
</span></code></p></div>
```

___

### ‚úÖ –°–ø–æ—Å–æ–± 2: –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –º–æ–¥—É–ª—è –≤ Redis

–ü–æ–¥–∫–ª—é—á–∏—Å—å –∫ Redis –∏ –≤—ã–ø–æ–ª–Ω–∏:

–ï—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—É—Å—Ç–æ–π (`empty array`), –∑–Ω–∞—á–∏—Ç –º–æ–¥—É–ª—å RedisGraph **–Ω–µ –ø–æ–¥–∫–ª—é—á—ë–Ω**.

___

### ‚ûï –£—Å—Ç–∞–Ω–æ–≤–∫–∞ RedisGraph –≤—Ä—É—á–Ω—É—é

–ï—Å–ª–∏ —Ç—ã –∏—Å–ø–æ–ª—å–∑—É–µ—à—å Redis –ª–æ–∫–∞–ª—å–Ω–æ, —Å–∫–∞—á–∞–π RedisGraph –∏ –ø–æ–¥–∫–ª—é—á–∏ –º–æ–¥—É–ª—å:

1.  –£—Å—Ç–∞–Ω–æ–≤–∏ RedisGraph –∏–∑ –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤ –∏–ª–∏ Redis Stack.
    
2.  –ó–∞–ø—É—Å—Ç–∏ Redis —Å —Ñ–ª–∞–≥–æ–º:
    

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>redis-server --loadmodule /path/to/redisgraph.so
</span></span></code></p></div>
```

___

### ‚ö° –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>redis-cli
127.0.0.1:6379&gt; GRAPH.QUERY social </span><span><span>"CREATE (:Person {name:'Alice'})"</span></span><span>
</span></span></code></p></div>
```

–ï—Å–ª–∏ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç, —Ç—ã –ø–æ–ª—É—á–∏—à—å –æ—Ç–≤–µ—Ç:

```
<div><p>arduino</p><p><code><span><span><span>1</span></span><span>) </span><span><span>"Labels added: 1"</span></span><span>
</span><span><span>2</span></span><span>) </span><span><span>"Nodes created: 1"</span></span><span>
...
</span></span></code></p></div>
```

___

–•–æ—á–µ—à—å ‚Äî –º–æ–≥—É —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å `docker-compose.yml`, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–¥–Ω–∏–º–µ—Ç `redis` —Å RedisGraph –∏ –≥–æ—Ç–æ–≤—ã–º –≥—Ä–∞—Ñ–æ–º.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

127.0.0.1:6379> MODULE LIST \[ \[ "name", "graph", "ver", 21009 \] \]

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–û—Ç–ª–∏—á–Ω–æ! –£ —Ç–µ–±—è **RedisGraph –∑–∞–≥—Ä—É–∂–µ–Ω** (–º–æ–¥—É–ª—å `graph`, –≤–µ—Ä—Å–∏—è `21009`), –∑–Ω–∞—á–∏—Ç –∫–æ–º–∞–Ω–¥–∞ `GRAPH.QUERY` –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å.

___

## üîß –ü—Ä–∏—á–∏–Ω–∞ –æ—à–∏–±–∫–∏

–û—à–∏–±–∫–∞ –±—ã–ª–∞ –∏–∑-–∑–∞ **–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –≤–≤–æ–¥–∞ –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞** –≤ `redis-cli`.

`redis-cli` –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–æ–∫–∏ **–≤–Ω—É—Ç—Ä–∏ –∫–∞–≤—ã—á–µ–∫**, –µ—Å–ª–∏ —Ç—ã –Ω–µ —ç–∫—Ä–∞–Ω–∏—Ä—É–µ—à—å —Å—Ç—Ä–æ–∫–∏. –ù—É–∂–Ω–æ –≤–≤–µ—Å—Ç–∏ **–≤—Å—é –∫–æ–º–∞–Ω–¥—É –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É**, –ª–∏–±–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å shell.

___

## ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—Ä–∏–º–µ—Ä (–æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π):

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>redis-cli GRAPH.QUERY social </span><span><span>"CREATE (:Person {name: 'Alice', age: 30, city: 'Paris'}), (:Person {name: 'Bob', age: 32, city: 'London'}), (:Person {name: 'Carol', age: 29, city: 'Paris'}), (:Person {name: 'Dave', age: 35, city: 'Berlin'}), (:Person {name: 'Alice'})-[:FRIEND {since: 2015}]-&gt;(:Person {name: 'Bob'}), (:Person {name: 'Bob'})-[:FRIEND {since: 2016}]-&gt;(:Person {name: 'Carol'}), (:Person {name: 'Carol'})-[:FRIEND {since: 2017}]-&gt;(:Person {name: 'Dave'}), (:Person {name: 'Alice'})-[:FRIEND {since: 2019}]-&gt;(:Person {name: 'Carol'})"</span></span><span>
</span></span></code></p></div>
```

üìù –≠—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å —Å–æ–∑–¥–∞—ë—Ç –≥—Ä–∞—Ñ `social` —Å–æ –≤—Å–µ–º–∏ —É–∑–ª–∞–º–∏ –∏ —Å–≤—è–∑—è–º–∏.

___

## ‚ö° –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –≤—Å—Ç–∞–≤–∫–∞ –ø–æ —á–∞—Å—Ç—è–º (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ –∏–∑–Ω—É—Ç—Ä–∏ `redis-cli`)

–ó–∞–π–¥–∏ –≤ Redis:

–ê –∑–∞—Ç–µ–º –≤—Å—Ç–∞–≤—å –≤—Å—ë **–≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É**:

```
<div><p>redis</p><p><code id="code-lang-redis"><span>GRAPH.QUERY social "CREATE (:Person {name: 'Alice', age: 30, city: 'Paris'}), (:Person {name: 'Bob', age: 32, city: 'London'}), (:Person {name: 'Carol', age: 29, city: 'Paris'}), (:Person {name: 'Dave', age: 35, city: 'Berlin'}), (:Person {name: 'Alice'})-[:FRIEND {since: 2015}]-&gt;(:Person {name: 'Bob'}), (:Person {name: 'Bob'})-[:FRIEND {since: 2016}]-&gt;(:Person {name: 'Carol'}), (:Person {name: 'Carol'})-[:FRIEND {since: 2017}]-&gt;(:Person {name: 'Dave'}), (:Person {name: 'Alice'})-[:FRIEND {since: 2019}]-&gt;(:Person {name: 'Carol'})"
</span></code></p></div>
```

___

## ‚ùó –í–∞–∂–Ω–æ: –Ω–µ–ª—å–∑—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ `CREATE`

–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤—Ä–æ–¥–µ `(alice:Person ...)` –Ω–µ–ª—å–∑—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ `CREATE`. –ï—Å–ª–∏ —Ö–æ—á–µ—à—å —Å–≤—è–∑–∞—Ç—å `Alice` —Å `Bob`, –Ω—É–∂–Ω–æ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –Ω–∞–π—Ç–∏ –∏—Ö –∏ –ø–æ—Ç–æ–º —Å–æ–∑–¥–∞—Ç—å —Å–≤—è–∑—å –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º `MATCH + CREATE`.

–•–æ—á–µ—à—å ‚Äî –ø–æ–∫–∞–∂—É, –∫–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥–µ–ª–∞—Ç—å `MERGE` –∏ `MATCH` + `CREATE` –ø–æ —à–∞–≥–∞–º.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–ß—Ç–æ —Ç–∞–∫–æ–µ Redis TimeSeries

###### ChatGPT —Å–∫–∞–∑–∞–ª:

**RedisTimeSeries** ‚Äî —ç—Ç–æ –º–æ–¥—É–ª—å Redis, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ **–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤** (time series data), —Ç–æ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö, –º–µ–Ω—è—é—â–∏—Ö—Å—è –≤–æ –≤—Ä–µ–º–µ–Ω–∏ –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ–º—ã—Ö –≤ —Ñ–æ—Ä–º–∞—Ç–µ ¬´–≤—Ä–µ–º—è ‚Äî –∑–Ω–∞—á–µ–Ω–∏–µ¬ª.

___

## üîß –ß—Ç–æ —Ç–∞–∫–æ–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä—è–¥—ã?

–ü—Ä–∏–º–µ—Ä—ã –¥–∞–Ω–Ω—ã—Ö:

-   –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –∫–∞–∂–¥—ã–π —á–∞—Å
    
-   –ó–∞–≥—Ä—É–∑–∫–∞ CPU –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
    
-   –ö—É—Ä—Å –¥–æ–ª–ª–∞—Ä–∞ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
    
-   –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É –∫ API
    

___

## üì¶ RedisTimeSeries –¥–∞—ë—Ç:

### ‚úÖ 1. –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ

-   –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–≥—Ä–µ–≥–∞—Ü–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä: —Å—Ä–µ–¥–Ω–µ–µ –ø–æ –º–∏–Ω—É—Ç–∞–º, –º–∞–∫—Å–∏–º—É–º –ø–æ —á–∞—Å—É)
    
-   –£–º–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ: –¥–∞–Ω–Ω—ã–µ –º–æ–∂–Ω–æ downsample-–∏—Ç—å
    
-   –ú–∞–ª–æ –ø–∞–º—è—Ç–∏, –±—ã—Å—Ç—Ä–æ
    

### ‚úÖ 2. –£–ø—Ä–æ—â—ë–Ω–Ω—ã–π API

-   –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã: `TS.ADD`, `TS.MRANGE`, `TS.CREATE`
    
-   –ù–µ –Ω–∞–¥–æ –≤—Ä—É—á–Ω—É—é —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫–ª—é—á–∏ —Å —Ç–∞–π–º—Å—Ç–µ–º–ø–∞–º–∏
    

### ‚úÖ 3. –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ç—ã

-   `AVG`, `SUM`, `MIN`, `MAX`, `COUNT`, `STDDEV`, `FIRST`, `LAST`
    

### ‚úÖ 4. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–µ–≥–æ–≤

-   –ü–æ–∑–≤–æ–ª—è–µ—Ç —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å —Å–µ—Ä–∏–∏ –ø–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º (–Ω–∞–ø—Ä–∏–º–µ—Ä: `host=server01`, `region=us-east`)
    

### ‚úÖ 5. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Grafana, Telegraf, Prometheus

-   –ï—Å—Ç—å –≥–æ—Ç–æ–≤—ã–µ –ø–ª–∞–≥–∏–Ω—ã –∏ —ç–∫—Å–ø–æ—Ä—Ç–µ—Ä—ã
    

___

## üîß –ü—Ä–∏–º–µ—Ä

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span><span># –°–æ–∑–¥–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Ä—è–¥ —Å retention 1 –¥–µ–Ω—å (–≤ –º—Å) –∏ –º–µ—Ç–∫–∞–º–∏</span></span><span>
TS.CREATE temperature:room1 RETENTION 86400000 LABELS room room1 sensor temp
</span></span></code></p></div>
```

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span><span># –î–æ–±–∞–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ</span></span><span>
TS.ADD temperature:room1 * 21.5
</span></span></code></p></div>
```

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span><span># –î–æ–±–∞–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º (–≤ –º—Å)</span></span><span>
TS.ADD temperature:room1 1650000000000 22.1
</span></span></code></p></div>
```

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span><span># –ü–æ–ª—É—á–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –∑–∞ –ø–µ—Ä–∏–æ–¥</span></span><span>
TS.RANGE temperature:room1 1650000000000 1650003600000
</span></span></code></p></div>
```

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span><span># –ü–æ–ª—É—á–∏—Ç—å –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å—Ä–µ–¥–Ω–µ–µ –ø–æ 1 –º–∏–Ω—É—Ç–µ</span></span><span>
TS.RANGE temperature:room1 - + AGGREGATION avg 60000
</span></span></code></p></div>
```

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span><span># –ù–∞–π—Ç–∏ –≤—Å–µ –º–µ—Ç—Ä–∏–∫–∏ —Å —Ç–µ–≥–æ–º room=room1</span></span><span>
TS.MRANGE - + FILTER room=room1
</span></span></code></p></div>
```

___

## üß∞ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

–ß–µ—Ä–µ–∑ Docker:

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>docker run -p 6379:6379 -it --</span><span><span>rm</span></span><span> redis/redis-stack-server
</span></span></code></p></div>
```

–ò–ª–∏ —Å –º–æ–¥—É–ª–µ–º RedisTimeSeries:

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>redis-server --loadmodule /path/to/redistimeseries.so
</span></span></code></p></div>
```

___

## üß† –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?

-   –ú–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞, –Ω–∞–≥—Ä—É–∑–∫–∞)
    
-   IoT-–¥–∞–Ω–Ω—ã–µ (—Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–∞—Ç—á–∏–∫–æ–≤)
    
-   –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (—Ü–µ–Ω—ã, –∫—É—Ä—Å—ã)
    
-   API-–ª–æ–≥–∏–∫–∞: —Å–∫–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∑–∞ 5 –º–∏–Ω—É—Ç
    

___

–•–æ—á–µ—à—å ‚Äî –ø–æ–∫–∞–∂—É, –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å RedisTimeSeries —Å Python, Grafana –∏–ª–∏ –∫–∞–∫ —Ö—Ä–∞–Ω–∏—Ç—å –∞–≥—Ä–µ–≥–∞—Ç—ã –∏ —Å—Ç—Ä–æ–∏—Ç—å –¥–∞—à–±–æ—Ä–¥—ã.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–û—Ç–ª–∏—á–Ω–æ! –ù–∏–∂–µ ‚Äî –ø–æ—à–∞–≥–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä, –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **RedisTimeSeries** —Å **Python** –∏ **Grafana**:

___

## üß± –®–∞–≥ 1. üöÄ –ó–∞–ø—É—Å–∫ Redis —Å RedisTimeSeries

### üì¶ –ß–µ—Ä–µ–∑ Docker (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>docker run -p 6379:6379 -it --</span><span><span>rm</span></span><span> redis/redis-stack-server
</span></span></code></p></div>
```

Redis Stack –≤–∫–ª—é—á–∞–µ—Ç RedisTimeSeries, RedisGraph –∏ Web-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–∞ `http://localhost:8001`.

___

## üß™ –®–∞–≥ 2. üìú –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞ –Ω–∞ Python

–£—Å—Ç–∞–Ω–æ–≤–∏–º –∫–ª–∏–µ–Ω—Ç Redis –∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏:

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>pip install redis pandas matplotlib
</span></span></code></p></div>
```

### üêç –ü—Ä–∏–º–µ—Ä: –ª–æ–≥–≥–µ—Ä –∏ –≥—Ä–∞—Ñ–∏–∫ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã

```
<div><p>python</p><p><code id="code-lang-python"><span><span><span>import</span></span><span> redis
</span><span><span>import</span></span><span> time
</span><span><span>import</span></span><span> random
</span><span><span>import</span></span><span> matplotlib.pyplot </span><span><span>as</span></span><span> plt
</span><span><span>import</span></span><span> pandas </span><span><span>as</span></span><span> pd

</span><span><span># –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Redis</span></span><span>
r = redis.Redis(host=</span><span><span>'localhost'</span></span><span>, port=</span><span><span>6379</span></span><span>)

</span><span><span># –°–æ–∑–¥–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ä—è–¥–∞ (–æ–¥–∏–Ω —Ä–∞–∑)</span></span><span>
</span><span><span>try</span></span><span>:
    r.execute_command(</span><span><span>"TS.CREATE temperature:sensor1 RETENTION 86400000 LABELS sensor sensor1"</span></span><span>)
</span><span><span>except</span></span><span> redis.exceptions.ResponseError:
    </span><span><span>pass</span></span><span>  </span><span><span># —É–∂–µ —Å–æ–∑–¥–∞–Ω</span></span><span>

</span><span><span># –î–æ–±–∞–≤–∏–º —Å–ª—É—á–∞–π–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</span></span><span>
</span><span><span>for</span></span><span> _ </span><span><span>in</span></span><span> </span><span><span>range</span></span><span>(</span><span><span>20</span></span><span>):
    temp = </span><span><span>round</span></span><span>(random.uniform(</span><span><span>20</span></span><span>, </span><span><span>25</span></span><span>), </span><span><span>2</span></span><span>)
    ts = </span><span><span>int</span></span><span>(time.time() * </span><span><span>1000</span></span><span>)
    r.execute_command(</span><span><span>"TS.ADD"</span></span><span>, </span><span><span>"temperature:sensor1"</span></span><span>, ts, temp)
    time.sleep(</span><span><span>1</span></span><span>)

</span><span><span># –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ</span></span><span>
start = </span><span><span>int</span></span><span>(time.time() * </span><span><span>1000</span></span><span>) - </span><span><span>20000</span></span><span>
end = </span><span><span>int</span></span><span>(time.time() * </span><span><span>1000</span></span><span>)

res = r.execute_command(</span><span><span>"TS.RANGE"</span></span><span>, </span><span><span>"temperature:sensor1"</span></span><span>, start, end)

</span><span><span># –ü–∞—Ä—Å–∏–º –¥–∞–Ω–Ω—ã–µ</span></span><span>
df = pd.DataFrame(res, columns=[</span><span><span>"timestamp"</span></span><span>, </span><span><span>"value"</span></span><span>])
df[</span><span><span>"timestamp"</span></span><span>] = pd.to_datetime(df[</span><span><span>"timestamp"</span></span><span>], unit=</span><span><span>"ms"</span></span><span>)
df[</span><span><span>"value"</span></span><span>] = df[</span><span><span>"value"</span></span><span>].astype(</span><span><span>float</span></span><span>)

</span><span><span># –ì—Ä–∞—Ñ–∏–∫</span></span><span>
plt.plot(df[</span><span><span>"timestamp"</span></span><span>], df[</span><span><span>"value"</span></span><span>])
plt.title(</span><span><span>"–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (sensor1)"</span></span><span>)
plt.ylabel(</span><span><span>"¬∞C"</span></span><span>)
plt.xlabel(</span><span><span>"–í—Ä–µ–º—è"</span></span><span>)
plt.xticks(rotation=</span><span><span>45</span></span><span>)
plt.tight_layout()
plt.show()
</span></span></code></p></div>
```

___

## üìä –®–∞–≥ 3. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Grafana

1.  –£—Å—Ç–∞–Ω–æ–≤–∏ Grafana.
    
2.  –ó–∞–ø—É—Å—Ç–∏ –µ—ë: [http://localhost:3000](http://localhost:3000/)
    
3.  –í Grafana:
    
    -   Data Sources ‚Üí Add ‚Üí Redis ‚Üí Redis TimeSeries
        
    -   –ê–¥—Ä–µ—Å: `localhost:6379`
        
4.  –°–æ–∑–¥–∞–π –¥–∞—à–±–æ—Ä–¥ ‚Üí –ø–∞–Ω–µ–ª—å ‚Üí –∑–∞–ø—Ä–æ—Å —Ç–∏–ø–∞ `TS.RANGE`:
    
    -   Metric: `temperature:sensor1`
        
    -   Aggregation: `avg`, `1s`
        

___

## üìå –°–æ–≤–µ—Ç—ã

-   –ò—Å–ø–æ–ª—å–∑—É–π `RETENTION` —á—Ç–æ–±—ã Redis –Ω–µ –ø–µ—Ä–µ–ø–æ–ª–Ω—è–ª—Å—è.
    
-   –ú–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–æ–º —á–µ—Ä–µ–∑ `TS.CREATERULE`.
    
-   –ú–µ—Ç–∫–∏ (`LABELS`) –ø–æ–º–æ–≥–∞—é—Ç —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å, –Ω–∞–ø—Ä–∏–º–µ—Ä: `TS.MRANGE - + FILTER sensor=sensor1`.
    

___

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å ‚Äî –º–æ–≥—É —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å `docker-compose.yml` —Å RedisTimeSeries –∏ Grafana.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

###### ChatGPT —Å–∫–∞–∑–∞–ª:

**RedisSearch** (–∏–ª–∏ Redis Search) ‚Äî —ç—Ç–æ –º–æ–¥—É–ª—å Redis, –¥–æ–±–∞–≤–ª—è—é—â–∏–π **–ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é, –∞–≥—Ä–µ–≥–∞—Ç—ã –∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é** –ø–æ–≤–µ—Ä—Ö —Ö—Ä–∞–Ω–∏–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

___

## üìö –ß—Ç–æ –¥–∞—ë—Ç RedisSearch

### üîç –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫

-   –ü–æ–∏—Å–∫ –ø–æ —á–∞—Å—Ç—è–º —Å–ª–æ–≤, —Å–∏–Ω–æ–Ω–∏–º–∞–º, —Ñ–æ—Ä–º–∞–º —Å–ª–æ–≤ (–∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä—ã)
    
-   –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –ø–æ –±–æ–ª—å—à–∏–º –∫–æ–ª–ª–µ–∫—Ü–∏—è–º —Å—Ç—Ä–æ–∫ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
    

### üß± –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä

-   –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —á–∏—Å–ª–∞–º, –¥–∞—Ç–∞–º, –≥–µ–æ–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º, —Ç–µ–≥–∞–º
    

### ‚ö° –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è

-   –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ, –≤—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ –≤ Redis (–∫–∞–∫ –≤ SQL/Elastic)
    

### üìä –ê–≥—Ä–µ–≥–∞—Ü–∏–∏

-   –ü–æ–¥—Å—á—ë—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞, –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
    

### üì¶ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ JSON –∏ Hash

-   –°–æ–≤–º–µ—Å—Ç–∏–º —Å `RedisJSON`, –º–æ–∂–Ω–æ –∏—Å–∫–∞—Ç—å –ø–æ –≤–ª–æ–∂–µ–Ω–Ω—ã–º –ø–æ–ª—è–º
    

___

## üß™ –ü—Ä–∏–º–µ—Ä

### –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞:

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>FT.CREATE products ON HASH PREFIX 1 product: SCHEMA name TEXT price NUMERIC category TAG
</span></span></code></p></div>
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞:

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>HSET product:1 name </span><span><span>"Red Apple"</span></span><span> price 1.99 category </span><span><span>"fruit"</span></span><span>
HSET product:2 name </span><span><span>"Green Apple"</span></span><span> price 2.49 category </span><span><span>"fruit"</span></span><span>
HSET product:3 name </span><span><span>"Banana"</span></span><span> price 1.50 category </span><span><span>"fruit"</span></span><span>
</span></span></code></p></div>
```

### –ü–æ–∏—Å–∫:

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>FT.SEARCH products </span><span><span>"apple"</span></span><span>
</span></span></code></p></div>
```

### –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ü–µ–Ω–µ:

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>FT.SEARCH products </span><span><span>"@price:[1.00 2.00]"</span></span><span>
</span></span></code></p></div>
```

### –ü–æ–∏—Å–∫ –ø–æ —Ç–µ–≥—É:

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>FT.SEARCH products </span><span><span>"@category:{fruit}"</span></span><span>
</span></span></code></p></div>
```

___

## üß∞ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

-   –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –º–∞–≥–∞–∑–∏–Ω–µ
    
-   –ü–æ–∏—Å–∫ –ø–æ –ª–æ–≥–∞–º
    
-   –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –∞—Ç—Ä–∏–±—É—Ç–∞–º
    
-   –ë—ã—Å—Ç—Ä—ã–π autocomplete
    
-   –ü–æ–∏—Å–∫ –ø–æ –≤–ª–æ–∂–µ–Ω–Ω—ã–º JSON'–∞–º (—Å `RedisJSON`)
    

___

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å

–ß–µ—Ä–µ–∑ Docker Redis Stack:

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>docker run -p 6379:6379 -it --</span><span><span>rm</span></span><span> redis/redis-stack-server
</span></span></code></p></div>
```

–ò –æ—Ç–∫—Ä–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å RedisInsight –Ω–∞ `http://localhost:8001` ‚Äî —Ç–∞–º RedisSearch –∏ –≤–∏–∑—É–∞–ª—å–Ω–æ.

___

## üß† RedisSearch vs Elasticsearch

| –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å | RedisSearch | Elasticsearch |
| --- | --- | --- |
| –°–∫–æ—Ä–æ—Å—Ç—å | –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è | –í—ã—Å–æ–∫–∞—è |
| –Ø–∑—ã–∫ –∑–∞–ø—Ä–æ—Å–æ–≤ | –ü—Ä–æ—Å—Ç–æ–π (FT.SEARCH) | DSL (–±–æ–≥–∞—Ç—ã–π) |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ JSON | –î–∞ (—á–µ—Ä–µ–∑ RedisJSON) | –î–∞ |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ SQL | –ù–µ—Ç | –ß–µ—Ä–µ–∑ SQL-–ø–ª–∞–≥–∏–Ω—ã |
| –£—Å—Ç–∞–Ω–æ–≤–∫–∞ | –õ–µ–≥—á–µ | –°–ª–æ–∂–Ω–µ–µ |

___

–•–æ—á–µ—à—å –ø—Ä–∏–º–µ—Ä —Å Python-–∫–ª–∏–µ–Ω—Ç–æ–º –∏–ª–∏ —á–µ—Ä–µ–∑ RedisInsight?

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

###### ChatGPT —Å–∫–∞–∑–∞–ª:

**Data Vault** ‚Äî —ç—Ç–æ –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Ö—Ä–∞–Ω–∏–ª–∏—â –¥–∞–Ω–Ω—ã—Ö (Data Warehouse), –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –Ω–∞ **–≥–∏–±–∫–æ—Å—Ç—å**, **–∏—Å—Ç–æ—Ä–∏—á–Ω–æ—Å—Ç—å** –∏ **–º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**, –æ—Å–æ–±–µ–Ω–Ω–æ –¥–ª—è **–±–æ–ª—å—à–∏—Ö –∏ —á–∞—Å—Ç–æ –∏–∑–º–µ–Ω—è—é—â–∏—Ö—Å—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö**.

___

## üß± –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã Data Vault

Data Vault —Ä–∞–∑–±–∏–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ **—Ç—Ä–∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–∏–ø–∞ —Ç–∞–±–ª–∏—Ü**:

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
| --- | --- | --- |
| üß© **Hub** | –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –±–∏–∑–Ω–µ—Å-—Å—É—â–Ω–æ—Å—Ç–∏ (–ø–æ –±–∏–∑–Ω–µ—Å-–∫–ª—é—á—É) | `hub_customer(customer_id)` |
| üîó **Link** | –°–≤—è–∑–∏ –º–µ–∂–¥—É Hubs (–æ—Ç–Ω–æ—à–µ–Ω–∏—è) | `link_customer_order(customer_id, order_id)` |
| üìù **Satellite** | –ê—Ç—Ä–∏–±—É—Ç—ã –∏ –∏—Å—Ç–æ—Ä–∏—è (–≤—Å—ë —á—Ç–æ –Ω–µ –∫–ª—é—á–∏) | `sat_customer(name, email, load_date, ... )` |

___

## üí° –ü—Ä–∏–º–µ—Ä

–î–æ–ø—É—Å—Ç–∏–º, —É –Ω–∞—Å –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –æ –∫–ª–∏–µ–Ω—Ç–∞—Ö –∏ –∑–∞–∫–∞–∑–∞—Ö.

### 1\. **Hub**\-—Ç–∞–±–ª–∏—Ü—ã

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span>hub_customer: customer_id (–±–∏–∑–Ω–µ—Å</span><span><span>-</span></span><span>–∫–ª—é—á), load_date, hash_key
hub_order: order_id, load_date, hash_key
</span></span></code></p></div>
```

### 2\. **Link**\-—Ç–∞–±–ª–∏—Ü–∞ (—Å–≤—è–∑—å)

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span>link_customer_order: customer_id, order_id, load_date
</span></span></code></p></div>
```

### 3\. **Satellite**\-—Ç–∞–±–ª–∏—Ü—ã (–∞—Ç—Ä–∏–±—É—Ç—ã)

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span>sat_customer: hash_key, name, email, updated_at
sat_order: hash_key, status, total_amount, updated_at
</span></span></code></p></div>
```

___

## üß† –ü–æ—á–µ–º—É –∏—Å–ø–æ–ª—å–∑—É—é—Ç Data Vault

| –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ | –ü–æ—è—Å–Ω–µ–Ω–∏–µ |
| --- | --- |
| üìö **–ò—Å—Ç–æ—Ä–∏—á–Ω–æ—Å—Ç—å** | –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è (–±–µ–∑ UPDATE) |
| üîÑ **–ì–∏–±–∫–æ—Å—Ç—å** | –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –ø–æ–ª—è –∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ |
| üìè **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** | –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö, –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö ETL |
| ‚úÖ **–ê—É–¥–∏—Ç** –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º–æ—Å—Ç—å | –ß—ë—Ç–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –ø—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö |
| ü§ñ **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è** | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–æ–¥–µ–ª–µ–π –≤–æ–∑–º–æ–∂–Ω–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä –≤ dbt) |

___

## üß∞ Data Vault –∏ dbt

–° –ø–æ–º–æ—â—å—é [dbt](https://www.getdbt.com/) –ª–µ–≥–∫–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Data Vault-–ø–æ–¥—Ö–æ–¥:

-   `hub_*.sql` ‚Äî –±–∏–∑–Ω–µ—Å-–∫–ª—é—á–∏
    
-   `link_*.sql` ‚Äî —Å–≤—è–∑–∏ –º–µ–∂–¥—É —Å—É—â–Ω–æ—Å—Ç—è–º–∏
    
-   `sat_*.sql` ‚Äî –∏—Å—Ç–æ—Ä–∏—á–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã
    

–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å [dbtvault](https://github.com/Datavault-UK/dbtvault) ‚Äî —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π dbt-–ø–ª–∞–≥–∏–Ω –¥–ª—è Data Vault.

___

## üìä Data Vault vs Star Schema

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | Data Vault | Star Schema |
| --- | --- | --- |
| –ì–∏–±–∫–æ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–π | –í—ã—Å–æ–∫–∞—è | –ù–∏–∑–∫–∞—è |
| –ò—Å—Ç–æ—Ä–∏—á–Ω–æ—Å—Ç—å | –ü–æ–ª–Ω–∞—è (–±–µ–∑ —É–¥–∞–ª–µ–Ω–∏–π) | –ß–∞—Å—Ç–æ –Ω–µ—Ç (overwrite) |
| –°–ª–æ–∂–Ω–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ | –í—ã—Å–æ–∫–∞—è | –ü—Ä–æ—Å—Ç–∞—è |
| –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ—Ç—á—ë—Ç–æ–≤ | –ù–∏–∂–µ (–∏–∑-–∑–∞ —Å–≤—è–∑–µ–π) | –í—ã—Å–æ–∫–∞—è |
| ETL-–ø—Ä–æ—Ü–µ—Å—Å—ã | –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ, –º–æ–¥—É–ª—å–Ω—ã–µ | –ß–∞—Å—Ç–æ –º–æ–Ω–æ–ª–∏—Ç–Ω—ã–µ |

___

## üë®üíº –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

‚úÖ –ù—É–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –ø–æ–ª–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π  
‚úÖ –ú–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤, —á–∞—Å—Ç–æ –º–µ–Ω—è—é—Ç—Å—è  
‚úÖ –ù—É–∂–Ω–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å ETL  
‚úÖ –•–æ—Ç–∏—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–∞–π–ø–ª–∞–π–Ω—ã  
‚õî –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö BI-–æ—Ç—á—ë—Ç–æ–≤ ‚Äî —Å–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω–æ

___

–•–æ—á–µ—à—å –ø—Ä–∏–º–µ—Ä —à–∞–±–ª–æ–Ω–∞ Data Vault –Ω–∞ dbt?

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–í–æ—Ç **–±–∞–∑–æ–≤—ã–π —à–∞–±–ª–æ–Ω Data Vault –Ω–∞ dbt**, —Ä–µ–∞–ª–∏–∑—É—é—â–∏–π `Hub`, `Link` –∏ `Satellite`\-–º–æ–¥–µ–ª–∏. –û–Ω —Ä–∞—Å—Å—á–∏—Ç–∞–Ω –Ω–∞ —Ä–∞–±–æ—Ç—É —Å –ª—é–±—ã–º SQL-–±—ç–∫–µ–Ω–¥–æ–º (Postgres, Snowflake, BigQuery, ClickHouse –∏ –¥—Ä.), –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Å—ã—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ —Å–ª–æ–µ `raw`.

___

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ dbt-–ø—Ä–æ–µ–∫—Ç–∞

```
<div><p>pgsql</p><p><code><span><span>dbt_project/
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ raw/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ raw_customers.</span><span><span>sql</span></span><span>
‚îÇ   ‚îú‚îÄ‚îÄ staging/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ stg_customers.</span><span><span>sql</span></span><span>
‚îÇ   ‚îú‚îÄ‚îÄ vault/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hub_customers.</span><span><span>sql</span></span><span>
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ sat_customers.</span><span><span>sql</span></span><span>
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ link_customer_orders.</span><span><span>sql</span></span><span>
</span></span></code></p></div>
```

___

## üîπ `raw_customers.sql` (–ø—Ä–∏–º–µ—Ä –∏—Å—Ç–æ—á–Ω–∏–∫–∞)

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span><span>select</span></span><span>
  customer_id,
  name,
  email,
  updated_at
</span><span><span>from</span></span><span> external_source.customers
</span></span></code></p></div>
```

___

## üî∏ `stg_customers.sql` (—Å—Ç–µ–π–¥–∂–∏–Ω–≥: –æ—á–∏—â–µ–Ω–Ω—ã–µ –ø–æ–ª—è + hash key)

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span><span>with</span></span><span> source </span><span><span>as</span></span><span> (
    </span><span><span>select</span></span><span> </span><span><span>*</span></span><span> </span><span><span>from</span></span><span> {{ </span><span><span>ref</span></span><span>(</span><span><span>'raw_customers'</span></span><span>) }}
),

cleaned </span><span><span>as</span></span><span> (
    </span><span><span>select</span></span><span>
        customer_id,
        name,
        email,
        updated_at,
        {{ dbt_utils.generate_surrogate_key([</span><span><span>'customer_id'</span></span><span>]) }} </span><span><span>as</span></span><span> customer_hkey
    </span><span><span>from</span></span><span> source
)

</span><span><span>select</span></span><span> </span><span><span>*</span></span><span> </span><span><span>from</span></span><span> cleaned
</span></span></code></p></div>
```

___

## üß© `hub_customers.sql`

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span><span>select</span></span><span>
    customer_hkey </span><span><span>as</span></span><span> hkey,
    customer_id,
    </span><span><span>current_timestamp</span></span><span> </span><span><span>as</span></span><span> load_ts,
    </span><span><span>'{{ invocation_id }}'</span></span><span> </span><span><span>as</span></span><span> source
</span><span><span>from</span></span><span> {{ </span><span><span>ref</span></span><span>(</span><span><span>'stg_customers'</span></span><span>) }}
</span><span><span>group</span></span><span> </span><span><span>by</span></span><span> </span><span><span>1</span></span><span>, </span><span><span>2</span></span><span>
</span></span></code></p></div>
```

___

## üìù `sat_customers.sql`

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span><span>select</span></span><span>
    customer_hkey </span><span><span>as</span></span><span> hkey,
    name,
    email,
    updated_at,
    </span><span><span>current_timestamp</span></span><span> </span><span><span>as</span></span><span> load_ts,
    </span><span><span>'{{ invocation_id }}'</span></span><span> </span><span><span>as</span></span><span> source
</span><span><span>from</span></span><span> {{ </span><span><span>ref</span></span><span>(</span><span><span>'stg_customers'</span></span><span>) }}
</span></span></code></p></div>
```

___

## üîó `link_customer_orders.sql` (–µ—Å–ª–∏ –µ—Å—Ç—å —Ç–∞–±–ª–∏—Ü–∞ –∑–∞–∫–∞–∑–æ–≤)

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span><span>with</span></span><span> stg_orders </span><span><span>as</span></span><span> (
    </span><span><span>select</span></span><span>
        order_id,
        customer_id,
        {{ dbt_utils.generate_surrogate_key([</span><span><span>'order_id'</span></span><span>]) }} </span><span><span>as</span></span><span> order_hkey,
        {{ dbt_utils.generate_surrogate_key([</span><span><span>'customer_id'</span></span><span>]) }} </span><span><span>as</span></span><span> customer_hkey
    </span><span><span>from</span></span><span> {{ </span><span><span>ref</span></span><span>(</span><span><span>'stg_orders'</span></span><span>) }}
)

</span><span><span>select</span></span><span>
    {{ dbt_utils.generate_surrogate_key([</span><span><span>'order_hkey'</span></span><span>, </span><span><span>'customer_hkey'</span></span><span>]) }} </span><span><span>as</span></span><span> link_hkey,
    order_hkey,
    customer_hkey,
    </span><span><span>current_timestamp</span></span><span> </span><span><span>as</span></span><span> load_ts,
    </span><span><span>'{{ invocation_id }}'</span></span><span> </span><span><span>as</span></span><span> source
</span><span><span>from</span></span><span> stg_orders
</span></span></code></p></div>
```

___

## ‚úÖ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å

1.  –ù–∞—Å—Ç—Ä–æ–π `profiles.yml` –¥–ª—è —Å–≤–æ–µ–π –±–∞–∑—ã
    
2.  –ó–∞–ø—É—Å—Ç–∏ —Å–±–æ—Ä–∫—É:
    

___

## üöÄ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

-   –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å [`dbtvault`](https://github.com/Datavault-UK/dbtvault) –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ Hubs, Links, Sats –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ
    
-   –î–æ–±–∞–≤—å `tests` –Ω–∞ `is_unique`, `not_null` –¥–ª—è –∫–ª—é—á–µ–π
    
-   –ò—Å–ø–æ–ª—å–∑—É–π `snapshot` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π, –µ—Å–ª–∏ –Ω—É–∂–Ω—ã SCD2-—Ç–∞–±–ª–∏—Ü—ã
    

___

–•–æ—á–µ—à—å docker-—à–∞–±–ª–æ–Ω —Å —ç—Ç–∏–º –ø—Ä–æ–µ–∫—Ç–æ–º –∏–ª–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –≤ ClickHouse/Postgres?

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–¥–∞–≤–∞–π —à–∞–±–ª–æ–Ω —Å —ç—Ç–∏–º –ø—Ä–æ–µ–∫—Ç–æ–º –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π —Å ClickHouse

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–í–æ—Ç –≥–æ—Ç–æ–≤—ã–π **—à–∞–±–ª–æ–Ω –ø—Ä–æ–µ–∫—Ç–∞ dbt –≤ Docker**, —Ä–µ–∞–ª–∏–∑—É—é—â–∏–π Data Vault (Hub, Satellite, Link) –∏ –ø–æ–¥–∫–ª—é—á—ë–Ω–Ω—ã–π –∫ ClickHouse.

___

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
<div><p>pgsql</p><p><code><span><span>data-vault-dbt/
‚îú‚îÄ‚îÄ dbt_project.yml
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ profiles/
‚îÇ   ‚îî‚îÄ‚îÄ profiles.yml
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ raw/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ raw_customers.</span><span><span>sql</span></span><span>
‚îÇ   ‚îú‚îÄ‚îÄ staging/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ stg_customers.</span><span><span>sql</span></span><span>
‚îÇ   ‚îî‚îÄ‚îÄ vault/
‚îÇ       ‚îú‚îÄ‚îÄ hub_customers.</span><span><span>sql</span></span><span>
‚îÇ       ‚îú‚îÄ‚îÄ sat_customers.</span><span><span>sql</span></span><span>
‚îÇ       ‚îî‚îÄ‚îÄ link_customer_orders.</span><span><span>sql</span></span><span>
</span></span></code></p></div>
```

___

## üì¶ `Dockerfile`

```
<div><p>Dockerfile</p><p><code id="code-lang-undefined"><span>FROM ghcr.io/dbt-labs/dbt-clickhouse:latest

WORKDIR /usr/app
COPY . .

CMD ["dbt", "run"]
</span></code></p></div>
```

___

## üê≥ `docker-compose.yml`

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>version:</span></span><span> </span><span><span>'3.9'</span></span><span>

</span><span><span>services:</span></span><span>
  </span><span><span>clickhouse:</span></span><span>
    </span><span><span>image:</span></span><span> </span><span><span>clickhouse/clickhouse-server:latest</span></span><span>
    </span><span><span>ports:</span></span><span>
      </span><span><span>-</span></span><span> </span><span><span>"8123:8123"</span></span><span>
      </span><span><span>-</span></span><span> </span><span><span>"9000:9000"</span></span><span>
    </span><span><span>volumes:</span></span><span>
      </span><span><span>-</span></span><span> </span><span><span>./clickhouse-data:/var/lib/clickhouse</span></span><span>

  </span><span><span>dbt:</span></span><span>
    </span><span><span>build:</span></span><span> </span><span><span>.</span></span><span>
    </span><span><span>environment:</span></span><span>
      </span><span><span>DBT_PROFILES_DIR:</span></span><span> </span><span><span>/usr/app/profiles</span></span><span>
    </span><span><span>volumes:</span></span><span>
      </span><span><span>-</span></span><span> </span><span><span>.:/usr/app</span></span><span>
    </span><span><span>depends_on:</span></span><span>
      </span><span><span>-</span></span><span> </span><span><span>clickhouse</span></span><span>
</span></span></code></p></div>
```

___

## üß© `profiles/profiles.yml`

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>clickhouse_dwh:</span></span><span>
  </span><span><span>target:</span></span><span> </span><span><span>dev</span></span><span>
  </span><span><span>outputs:</span></span><span>
    </span><span><span>dev:</span></span><span>
      </span><span><span>type:</span></span><span> </span><span><span>clickhouse</span></span><span>
      </span><span><span>schema:</span></span><span> </span><span><span>default</span></span><span>
      </span><span><span>user:</span></span><span> </span><span><span>default</span></span><span>
      </span><span><span>password:</span></span><span> </span><span><span>""</span></span><span>
      </span><span><span>host:</span></span><span> </span><span><span>clickhouse</span></span><span>
      </span><span><span>port:</span></span><span> </span><span><span>8123</span></span><span>
      </span><span><span>secure:</span></span><span> </span><span><span>false</span></span><span>
      </span><span><span>verify:</span></span><span> </span><span><span>false</span></span><span>
      </span><span><span>driver:</span></span><span> </span><span><span>native</span></span><span>
</span></span></code></p></div>
```

___

## üìö `dbt_project.yml`

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>name:</span></span><span> </span><span><span>'data_vault'</span></span><span>
</span><span><span>version:</span></span><span> </span><span><span>'1.0'</span></span><span>
</span><span><span>config-version:</span></span><span> </span><span><span>2</span></span><span>

</span><span><span>profile:</span></span><span> </span><span><span>'clickhouse_dwh'</span></span><span>

</span><span><span>model-paths:</span></span><span> [</span><span><span>"models"</span></span><span>]

</span><span><span>models:</span></span><span>
  </span><span><span>data_vault:</span></span><span>
    </span><span><span>+materialized:</span></span><span> </span><span><span>table</span></span><span>
</span></span></code></p></div>
```

___

## ‚úÖ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å

1.  –£–±–µ–¥–∏—Å—å, —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Docker
    
2.  –í –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –≤—ã–ø–æ–ª–Ω–∏:
    

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>docker-compose up --build dbt
</span></span></code></p></div>
```

___

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ ClickHouse

–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –º–æ–∂–Ω–æ –≤—Ä—É—á–Ω—É—é —Å–æ–∑–¥–∞—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span><span>CREATE</span></span><span> DATABASE IF </span><span><span>NOT</span></span><span> </span><span><span>EXISTS</span></span><span> </span><span><span>default</span></span><span>;
</span></span></code></p></div>
```

–ª–∏–±–æ dbt —Å–æ–∑–¥–∞—Å—Ç —Ç–∞–±–ª–∏—Ü—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ `default`.

___

## üìå –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

-   –ú–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å `dbtvault` (—á–µ—Ä–µ–∑ `packages.yml`) –∏ –æ–ø–∏—Å—ã–≤–∞—Ç—å –º–æ–¥–µ–ª–∏ –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ
    
-   –î–æ–±–∞–≤—å `dbt test` –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —à–∞–≥
    
-   –ü–æ–¥–¥–µ—Ä–∂–∫–∞ `incremental` –∏ `snapshot` —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ ClickHouse –ø—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
    

___

–•–æ—á–µ—à—å –¥–æ–±–∞–≤–∏—Ç—å —ç–∫—Å–ø–æ—Ä—Ç –≤ Postgres –∏–ª–∏ –º–µ—Ç—Ä–∏–∫–∏ —á–µ—Ä–µ–∑ Prometheus?

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

—Å–¥–µ–ª–∞–π –≤–æ—Ç —ç—Ç–æ: –ø–æ–¥–∫–ª—é—á–∏—Ç—å dbtvault (—á–µ—Ä–µ–∑ packages.yml) –∏ –æ–ø–∏—Å—ã–≤–∞—Ç—å –º–æ–¥–µ–ª–∏ –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ –î–æ–±–∞–≤–∏—Ç—å dbt test –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —à–∞–≥ –∏ —ç–∫—Å–ø–æ—Ä—Ç –≤ Postgres –∏ –º–µ—Ç—Ä–∏–∫–∏ —á–µ—Ä–µ–∑ Prometheus

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–í–æ—Ç –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π —à–∞–±–ª–æ–Ω —Å:

‚úÖ **dbtvault** —á–µ—Ä–µ–∑ `packages.yml`  
‚úÖ –®–∞–≥–æ–º `dbt test`  
‚úÖ –≠–∫—Å–ø–æ—Ä—Ç–æ–º –≤ **Postgres**  
‚úÖ –ú–µ—Ç—Ä–∏–∫–∞–º–∏ —á–µ—Ä–µ–∑ **Prometheus PostgreSQL Exporter**

___

–¢–µ–ø–µ—Ä—å –¥–æ–±–∞–≤–∏–º:

### üì¶ `packages.yml`

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>packages:</span></span><span>
  </span><span><span>-</span></span><span> </span><span><span>package:</span></span><span> </span><span><span>Datavault-UK/dbtvault</span></span><span>
    </span><span><span>version:</span></span><span> [</span><span><span>"&gt;=0.9.2"</span></span><span>]
</span></span></code></p></div>
```

–ò –≤ `Dockerfile`:

___

### üîß –ü—Ä–∏–º–µ—Ä `profiles.yml`

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>clickhouse_dwh:</span></span><span>
  </span><span><span>target:</span></span><span> </span><span><span>dev</span></span><span>
  </span><span><span>outputs:</span></span><span>
    </span><span><span>dev:</span></span><span>
      </span><span><span>type:</span></span><span> </span><span><span>clickhouse</span></span><span>
      </span><span><span>host:</span></span><span> </span><span><span>clickhouse</span></span><span>
      </span><span><span>port:</span></span><span> </span><span><span>8123</span></span><span>
      </span><span><span>user:</span></span><span> </span><span><span>default</span></span><span>
      </span><span><span>password:</span></span><span> </span><span><span>""</span></span><span>
      </span><span><span>schema:</span></span><span> </span><span><span>default</span></span><span>
      </span><span><span>driver:</span></span><span> </span><span><span>native</span></span><span>

</span><span><span>postgres_dwh:</span></span><span>
  </span><span><span>target:</span></span><span> </span><span><span>dev</span></span><span>
  </span><span><span>outputs:</span></span><span>
    </span><span><span>dev:</span></span><span>
      </span><span><span>type:</span></span><span> </span><span><span>postgres</span></span><span>
      </span><span><span>host:</span></span><span> </span><span><span>postgres</span></span><span>
      </span><span><span>user:</span></span><span> </span><span><span>dbt</span></span><span>
      </span><span><span>password:</span></span><span> </span><span><span>dbt</span></span><span>
      </span><span><span>port:</span></span><span> </span><span><span>5432</span></span><span>
      </span><span><span>dbname:</span></span><span> </span><span><span>dwh</span></span><span>
      </span><span><span>schema:</span></span><span> </span><span><span>public</span></span><span>
</span></span></code></p></div>
```

___

### üìò –ü—Ä–∏–º–µ—Ä –º–æ–¥–µ–ª–∏ `hub_customers.sql` —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `dbtvault`

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span>{{ config(materialized</span><span><span>=</span></span><span><span>'table'</span></span><span>) }}

{</span><span><span>%</span></span><span> </span><span><span>set</span></span><span> source_model </span><span><span>=</span></span><span> </span><span><span>'stg_customers'</span></span><span> </span><span><span>%</span></span><span>}
{</span><span><span>%</span></span><span> </span><span><span>set</span></span><span> src_pk </span><span><span>=</span></span><span> </span><span><span>'customer_id'</span></span><span> </span><span><span>%</span></span><span>}
{</span><span><span>%</span></span><span> </span><span><span>set</span></span><span> src_nk </span><span><span>=</span></span><span> [</span><span><span>'customer_id'</span></span><span>] </span><span><span>%</span></span><span>}
{</span><span><span>%</span></span><span> </span><span><span>set</span></span><span> hub_name </span><span><span>=</span></span><span> </span><span><span>'hub_customers'</span></span><span> </span><span><span>%</span></span><span>}

{{ dbtvault.hub(src_pk</span><span><span>=</span></span><span>src_pk, src_nk</span><span><span>=</span></span><span>src_nk, source_model</span><span><span>=</span></span><span>source_model, hub_name</span><span><span>=</span></span><span>hub_name) }}
</span></span></code></p></div>
```

___

### üìä –≠–∫—Å–ø–æ—Ä—Ç –º–µ—Ç—Ä–∏–∫

Prometheus-—ç–∫—Å–ø–æ—Ä—Ç–µ—Ä —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω —á–µ—Ä–µ–∑ –æ–±—Ä–∞–∑ `prometheuscommunity/postgres-exporter` ‚Äî –æ–Ω –±—É–¥–µ—Ç –æ—Ç–¥–∞–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ `http://localhost:9187/metrics`.

___

–•–æ—á–µ—à—å –¥–æ–±–∞–≤–∏—Ç—å Grafana –∏–ª–∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é dbt artifacts (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏)?

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–¥–æ–±–∞–≤—å –≥—Ä–∞—Ñ–∞–Ω–∞ –∏ –ø—Ä–∏—à–ª–∏ –≤—Å–µ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

###### ChatGPT —Å–∫–∞–∑–∞–ª:

version: '3.9'

services:

clickhouse:

image: clickhouse/clickhouse-server:latest

ports:

\- "8123:8123"

\- "9000:9000"

volumes:

\- ./clickhouse-data:/var/lib/clickhouse

postgres:

image: postgres:15

ports:

\- "5432:5432"

environment:

POSTGRES\_USER: dbt

POSTGRES\_PASSWORD: dbt

POSTGRES\_DB: dwh

volumes:

\- pgdata:/var/lib/postgresql/data

dbt:

build: .

environment:

DBT\_PROFILES\_DIR: /usr/app/profiles

volumes:

\- .:/usr/app

depends\_on:

\- clickhouse

\- postgres

command: \["bash", "-c", "dbt deps && dbt run && dbt test"\]

prometheus-exporter:

image: prometheuscommunity/postgres-exporter

ports:

üü¢ –ì–æ—Ç–æ–≤–æ! –ù–∏–∂–µ –≤—Å–µ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

___

### üì¶ `packages.yml`

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>packages:</span></span><span>
  </span><span><span>-</span></span><span> </span><span><span>package:</span></span><span> </span><span><span>Datavault-UK/dbtvault</span></span><span>
    </span><span><span>version:</span></span><span> [</span><span><span>"&gt;=0.9.2"</span></span><span>]
</span></span></code></p></div>
```

___

### ‚öôÔ∏è `Dockerfile` (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

```
<div><p>Dockerfile</p><p><code id="code-lang-undefined"><span>FROM ghcr.io/dbt-labs/dbt-core:1.7.0

WORKDIR /usr/app

COPY . .

RUN pip install dbt-clickhouse dbt-postgres
RUN dbt deps
</span></code></p></div>
```

___

### üîß `profiles.yml`

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>clickhouse_dwh:</span></span><span>
  </span><span><span>target:</span></span><span> </span><span><span>dev</span></span><span>
  </span><span><span>outputs:</span></span><span>
    </span><span><span>dev:</span></span><span>
      </span><span><span>type:</span></span><span> </span><span><span>clickhouse</span></span><span>
      </span><span><span>host:</span></span><span> </span><span><span>clickhouse</span></span><span>
      </span><span><span>port:</span></span><span> </span><span><span>8123</span></span><span>
      </span><span><span>user:</span></span><span> </span><span><span>default</span></span><span>
      </span><span><span>password:</span></span><span> </span><span><span>""</span></span><span>
      </span><span><span>schema:</span></span><span> </span><span><span>default</span></span><span>
      </span><span><span>driver:</span></span><span> </span><span><span>native</span></span><span>

</span><span><span>postgres_dwh:</span></span><span>
  </span><span><span>target:</span></span><span> </span><span><span>dev</span></span><span>
  </span><span><span>outputs:</span></span><span>
    </span><span><span>dev:</span></span><span>
      </span><span><span>type:</span></span><span> </span><span><span>postgres</span></span><span>
      </span><span><span>host:</span></span><span> </span><span><span>postgres</span></span><span>
      </span><span><span>user:</span></span><span> </span><span><span>dbt</span></span><span>
      </span><span><span>password:</span></span><span> </span><span><span>dbt</span></span><span>
      </span><span><span>port:</span></span><span> </span><span><span>5432</span></span><span>
      </span><span><span>dbname:</span></span><span> </span><span><span>dwh</span></span><span>
      </span><span><span>schema:</span></span><span> </span><span><span>public</span></span><span>
</span></span></code></p></div>
```

___

### üìä `prometheus.yml`

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>global:</span></span><span>
  </span><span><span>scrape_interval:</span></span><span> </span><span><span>15s</span></span><span>

</span><span><span>scrape_configs:</span></span><span>
  </span><span><span>-</span></span><span> </span><span><span>job_name:</span></span><span> </span><span><span>'postgres'</span></span><span>
    </span><span><span>static_configs:</span></span><span>
      </span><span><span>-</span></span><span> </span><span><span>targets:</span></span><span> [</span><span><span>'prometheus-exporter:9187'</span></span><span>]
</span></span></code></p></div>
```

___

üîó –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞:

-   Grafana: [http://localhost:3000](http://localhost:3000/)
    
    -   –õ–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `admin` / `admin`
        
    -   –î–æ–±–∞–≤—å—Ç–µ Prometheus –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö: `http://prometheus:9090`
        
-   Prometheus: [http://localhost:9090](http://localhost:9090/)
    

–ù—É–∂–Ω–æ –ª–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–º–µ—Ä –¥–∞—à–±–æ—Ä–¥–∞ –≤ Grafana –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –º–æ–¥–µ–ª–µ–π –∏–∑ dbt?

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–µ—â—ë —Ä–∞–∑ –ø–æ–ª–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞ —Å —É—á—ë—Ç–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–í–æ—Ç –ø–æ–ª–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ —Å —É—á—ë—Ç–æ–º –≤—Å–µ—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π:

```
<div><p>pgsql</p><p><code><span><span>dbt_dvault_project/
‚îú‚îÄ‚îÄ dbt_project.yml
‚îú‚îÄ‚îÄ packages.yml
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ prometheus.yml
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ staging/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ stg_customers.</span><span><span>sql</span></span><span>
‚îÇ   ‚îú‚îÄ‚îÄ vault/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hub_customers.</span><span><span>sql</span></span><span>
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ other_dbtvault_models.</span><span><span>sql</span></span><span>
‚îÇ   ‚îî‚îÄ‚îÄ marts/
‚îÇ       ‚îî‚îÄ‚îÄ final_output.</span><span><span>sql</span></span><span>
‚îú‚îÄ‚îÄ target/                # —Å–æ–∑–¥–∞—ë—Ç—Å—è dbt –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
‚îú‚îÄ‚îÄ logs/                  # —Å–æ–∑–¥–∞—ë—Ç—Å—è dbt –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
‚îú‚îÄ‚îÄ profiles/
‚îÇ   ‚îî‚îÄ‚îÄ profiles.yml
‚îú‚îÄ‚îÄ clickhouse-data/       # —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö clickhouse (volume)
‚îî‚îÄ‚îÄ grafana-</span><span><span>storage</span></span><span>/       # volume –¥–ª—è grafana
</span></span></code></p></div>
```

___

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã:

#### `docker-compose.yml`

–í–∫–ª—é—á–∞–µ—Ç:

-   ClickHouse
    
-   PostgreSQL
    
-   –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è dbt
    
-   Prometheus Exporter –¥–ª—è PostgreSQL
    
-   Prometheus
    
-   Grafana
    

#### `Dockerfile`

–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º–∏ dbt, `dbt-postgres`, `dbt-clickhouse`, `dbtvault`.

#### `packages.yml`

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>packages:</span></span><span>
  </span><span><span>-</span></span><span> </span><span><span>package:</span></span><span> </span><span><span>Datavault-UK/dbtvault</span></span><span>
    </span><span><span>version:</span></span><span> [</span><span><span>"&gt;=0.9.2"</span></span><span>]
</span></span></code></p></div>
```

#### `profiles.yml`

–ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –¥–≤–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:

-   `clickhouse_dwh`
    
-   `postgres_dwh`
    

#### `prometheus.yml`

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ PostgreSQL –º–µ—Ç—Ä–∏–∫ —á–µ—Ä–µ–∑ Exporter.

___

### üõ† –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:

1.  **–°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫:**
    
    ```
    <div><p>bash</p><p><code id="code-lang-bash"><span><span>docker compose up --build
    </span></span></code></p></div>
    ```
    
2.  **Grafana –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:**  
    –û—Ç–∫—Ä—ã—Ç—å [http://localhost:3000](http://localhost:3000/), –ª–æ–≥–∏–Ω: `admin`, –ø–∞—Ä–æ–ª—å: `admin`
    
3.  **Prometheus –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:**  
    [http://localhost:9090](http://localhost:9090/)
    

___

–•–æ—á–µ—à—å, —è –¥–æ–±–∞–≤–ª—é –ø—Ä–∏–º–µ—Ä –º–æ–¥–µ–ª–∏ —Å `dbtvault.stage` –∏ —à–∞–±–ª–æ–Ω–æ–º `fact`?

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

\=> \[dbt 4/5\] RUN pip install dbt-clickhouse dbt-postgres 77.6s => ERROR \[dbt 5/5\] RUN dbt deps 0.5s ------ > \[dbt 5/5\] RUN dbt deps: 0.412 Traceback (most recent call last): 0.412 File "/usr/local/bin/dbt", line 5, in <module> 0.412 from dbt.cli.main import cli 0.412 File "/usr/local/lib/python3.10/site-packages/dbt/cli/\_\_init\_\_.py", line 1, in <module> 0.412 from .main import cli as dbt\_cli # noqa 0.412 File "/usr/local/lib/python3.10/site-packages/dbt/cli/main.py", line 11, in <module> 0.412 from dbt.adapters.factory import register\_adapter 0.412 ModuleNotFoundError: No module named 'dbt.adapters.factory' ------ failed to solve: process "/bin/sh -c dbt deps" did not complete successfully: exit code: 1

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–û—à–∏–±–∫–∞ `ModuleNotFoundError: No module named 'dbt.adapters.factory'` –≤–æ–∑–Ω–∏–∫–∞–µ—Ç, –ø–æ—Ç–æ–º—É —á—Ç–æ —Ç—ã –∏—Å–ø–æ–ª—å–∑—É–µ—à—å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑ `ghcr.io/dbt-labs/dbt-core`, –≤ –∫–æ—Ç–æ—Ä–æ–º **–Ω–µ—Ç** —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –∞–¥–∞–ø—Ç–µ—Ä–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `dbt-postgres`, `dbt-clickhouse`) –∏ –æ–Ω–∏ **–Ω–µ –≤—Å–µ–≥–¥–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã –ø–æ –≤–µ—Ä—Å–∏—è–º** –º–µ–∂–¥—É —Å–æ–±–æ–π –∏ —è–¥—Ä–æ–º dbt.

___

### ‚úÖ –†–µ—à–µ–Ω–∏–µ: –°–æ–±–µ—Ä–∏ dbt-–æ–±—Ä–∞–∑ **—Å –Ω—É–ª—è –Ω–∞ –±–∞–∑–µ Python**, —á—Ç–æ–±—ã –≤—Å—ë –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å:

#### üîß –ù–æ–≤—ã–π `Dockerfile`:

```
<div><p>dockerfile</p><p><code id="code-lang-dockerfile"><span>FROM python:3.10-slim

# –£—Å—Ç–∞–Ω–æ–≤–∏–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
RUN apt-get update &amp;&amp; apt-get install -y build-essential git curl &amp;&amp; rm -rf /var/lib/apt/lists/*

# –£—Å—Ç–∞–Ω–æ–≤–∏–º dbt –∏ –Ω—É–∂–Ω—ã–µ –∞–¥–∞–ø—Ç–µ—Ä—ã
RUN pip install --upgrade pip &amp;&amp; \
    pip install dbt-core dbt-postgres dbt-clickhouse 'dbtvault&gt;=0.9.2'

# –£—Å—Ç–∞–Ω–æ–≤–∏–º —Ä–∞–±–æ—á—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
WORKDIR /usr/app

COPY . .

CMD ["bash"]
</span></code></p></div>
```

___

### üêã –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `docker-compose.yml` (—Å–µ–∫—Ü–∏–∏ `dbt:`):

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span>  </span><span><span>dbt:</span></span><span>
    </span><span><span>build:</span></span><span>
      </span><span><span>context:</span></span><span> </span><span><span>.</span></span><span>
      </span><span><span>dockerfile:</span></span><span> </span><span><span>Dockerfile</span></span><span>
    </span><span><span>environment:</span></span><span>
      </span><span><span>DBT_PROFILES_DIR:</span></span><span> </span><span><span>/usr/app/profiles</span></span><span>
    </span><span><span>volumes:</span></span><span>
      </span><span><span>-</span></span><span> </span><span><span>.:/usr/app</span></span><span>
    </span><span><span>depends_on:</span></span><span>
      </span><span><span>-</span></span><span> </span><span><span>clickhouse</span></span><span>
      </span><span><span>-</span></span><span> </span><span><span>postgres</span></span><span>
    </span><span><span>command:</span></span><span> <span>&gt;
      bash -c "dbt deps &amp;&amp;
               dbt run --project-dir . --profiles-dir /usr/app/profiles &amp;&amp;
               dbt test --project-dir . --profiles-dir /usr/app/profiles"
</span></span></span></code></p></div>
```

___

### ‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä–∫–∞:

1.  –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–π –æ–±—Ä–∞–∑ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ):
    
    ```
    <div><p>bash</p><p><code id="code-lang-bash"><span><span>docker image </span><span><span>rm</span></span><span> &lt;–∏–º—è_–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏–ª–∏ </span><span><span>id</span></span><span>&gt;
    </span></span></code></p></div>
    ```
    
2.  –°–æ–±—Ä–∞—Ç—å –∑–∞–Ω–æ–≤–æ:
    
    ```
    <div><p>bash</p><p><code id="code-lang-bash"><span><span>docker compose build
    docker compose up
    </span></span></code></p></div>
    ```
    

___

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å ‚Äî –º–æ–≥—É —Å–æ–±—Ä–∞—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π `dbt_project.yml` –∏ –ø–∞—Ä—É –º–æ–¥–µ–ª–µ–π, —á—Ç–æ–±—ã —Å—Ä–∞–∑—É –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–¥–∞, —Å–æ–±–µ—Ä–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π dbt\_project.yml –∏ –ø–∞—Ä—É –º–æ–¥–µ–ª–µ–π, —á—Ç–æ–±—ã —Å—Ä–∞–∑—É –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å.

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–û—Ç–ª–∏—á–Ω–æ! –ù–∏–∂–µ ‚Äî **–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π dbt-–ø—Ä–æ–µ–∫—Ç**, –≥–æ—Ç–æ–≤—ã–π –∫ –∑–∞–ø—É—Å–∫—É –≤ —Ç–≤–æ–µ–π docker-—Å—Ä–µ–¥–µ. –ò—Å–ø–æ–ª—å–∑—É–µ–º `dbtvault`, `ClickHouse` –∏ `PostgreSQL`.

___

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ (–º–∏–Ω–∏–º—É–º)

```
<div><p>pgsql</p><p><code><span><span>dbt_dvault_project/
‚îú‚îÄ‚îÄ dbt_project.yml
‚îú‚îÄ‚îÄ packages.yml
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ profiles/
‚îÇ   ‚îî‚îÄ‚îÄ profiles.yml
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ staging/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ stg_customers.</span><span><span>sql</span></span><span>
‚îÇ   ‚îî‚îÄ‚îÄ vault/
‚îÇ       ‚îî‚îÄ‚îÄ hub_customers.</span><span><span>sql</span></span><span>
</span></span></code></p></div>
```

___

## üîß `dbt_project.yml`

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>name:</span></span><span> </span><span><span>dbt_dvault_project</span></span><span>
</span><span><span>version:</span></span><span> </span><span><span>'1.0'</span></span><span>
</span><span><span>config-version:</span></span><span> </span><span><span>2</span></span><span>

</span><span><span>profile:</span></span><span> </span><span><span>clickhouse_dwh</span></span><span>

</span><span><span>model-paths:</span></span><span> [</span><span><span>"models"</span></span><span>]
</span><span><span>target-path:</span></span><span> </span><span><span>"target"</span></span><span>
</span><span><span>clean-targets:</span></span><span> [</span><span><span>"target"</span></span><span>, </span><span><span>"dbt_modules"</span></span><span>]

</span><span><span>models:</span></span><span>
  </span><span><span>dbt_dvault_project:</span></span><span>
    </span><span><span>+materialized:</span></span><span> </span><span><span>table</span></span><span>
</span></span></code></p></div>
```

___

## üì¶ `packages.yml`

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>packages:</span></span><span>
  </span><span><span>-</span></span><span> </span><span><span>package:</span></span><span> </span><span><span>Datavault-UK/dbtvault</span></span><span>
    </span><span><span>version:</span></span><span> [</span><span><span>"&gt;=0.9.2"</span></span><span>]
</span></span></code></p></div>
```

___

## üîÅ `models/staging/stg_customers.sql`

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span>{{ config(materialized</span><span><span>=</span></span><span><span>'table'</span></span><span>) }}

</span><span><span>SELECT</span></span><span>
  id </span><span><span>AS</span></span><span> customer_id,
  name,
  email,
  </span><span><span>current_timestamp</span></span><span> </span><span><span>AS</span></span><span> load_date
</span><span><span>FROM</span></span><span> {{ source(</span><span><span>'raw'</span></span><span>, </span><span><span>'customers'</span></span><span>) }}
</span></span></code></p></div>
```

___

## üîê `models/vault/hub_customers.sql`

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span>{{ config(materialized</span><span><span>=</span></span><span><span>'table'</span></span><span>) }}

{{
  dbtvault.hub(
    source_model</span><span><span>=</span></span><span><span>'stg_customers'</span></span><span>,
    hub_name</span><span><span>=</span></span><span><span>'hub_customers'</span></span><span>,
    business_key</span><span><span>=</span></span><span><span>'customer_id'</span></span><span>,
    load_date</span><span><span>=</span></span><span><span>'load_date'</span></span><span>,
    record_source</span><span><span>=</span></span><span>"'raw.customers'"
  )
}}
</span></span></code></p></div>
```

___

## üìÇ `profiles/profiles.yml`

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>clickhouse_dwh:</span></span><span>
  </span><span><span>target:</span></span><span> </span><span><span>dev</span></span><span>
  </span><span><span>outputs:</span></span><span>
    </span><span><span>dev:</span></span><span>
      </span><span><span>type:</span></span><span> </span><span><span>clickhouse</span></span><span>
      </span><span><span>host:</span></span><span> </span><span><span>clickhouse</span></span><span>
      </span><span><span>port:</span></span><span> </span><span><span>8123</span></span><span>
      </span><span><span>user:</span></span><span> </span><span><span>default</span></span><span>
      </span><span><span>password:</span></span><span> </span><span><span>""</span></span><span>
      </span><span><span>schema:</span></span><span> </span><span><span>default</span></span><span>
      </span><span><span>driver:</span></span><span> </span><span><span>native</span></span><span>

</span><span><span>postgres_dwh:</span></span><span>
  </span><span><span>target:</span></span><span> </span><span><span>dev</span></span><span>
  </span><span><span>outputs:</span></span><span>
    </span><span><span>dev:</span></span><span>
      </span><span><span>type:</span></span><span> </span><span><span>postgres</span></span><span>
      </span><span><span>host:</span></span><span> </span><span><span>postgres</span></span><span>
      </span><span><span>user:</span></span><span> </span><span><span>dbt</span></span><span>
      </span><span><span>password:</span></span><span> </span><span><span>dbt</span></span><span>
      </span><span><span>port:</span></span><span> </span><span><span>5432</span></span><span>
      </span><span><span>dbname:</span></span><span> </span><span><span>dwh</span></span><span>
      </span><span><span>schema:</span></span><span> </span><span><span>public</span></span><span>
</span></span></code></p></div>
```

___

## üê≥ `docker-compose.yml` (–æ–±—Ä–µ–∑–∞–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏)

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>version:</span></span><span> </span><span><span>'3.8'</span></span><span>

</span><span><span>services:</span></span><span>
  </span><span><span>clickhouse:</span></span><span>
    </span><span><span>image:</span></span><span> </span><span><span>clickhouse/clickhouse-server</span></span><span>
    </span><span><span>ports:</span></span><span> [</span><span><span>8123</span></span><span><span>:8123</span></span><span>]

  </span><span><span>postgres:</span></span><span>
    </span><span><span>image:</span></span><span> </span><span><span>postgres:15</span></span><span>
    </span><span><span>environment:</span></span><span>
      </span><span><span>POSTGRES_DB:</span></span><span> </span><span><span>dwh</span></span><span>
      </span><span><span>POSTGRES_USER:</span></span><span> </span><span><span>dbt</span></span><span>
      </span><span><span>POSTGRES_PASSWORD:</span></span><span> </span><span><span>dbt</span></span><span>
    </span><span><span>ports:</span></span><span> [</span><span><span>5432</span></span><span><span>:5432</span></span><span>]

  </span><span><span>dbt:</span></span><span>
    </span><span><span>build:</span></span><span>
      </span><span><span>context:</span></span><span> </span><span><span>.</span></span><span>
      </span><span><span>dockerfile:</span></span><span> </span><span><span>Dockerfile</span></span><span>
    </span><span><span>environment:</span></span><span>
      </span><span><span>DBT_PROFILES_DIR:</span></span><span> </span><span><span>/usr/app/profiles</span></span><span>
    </span><span><span>volumes:</span></span><span>
      </span><span><span>-</span></span><span> </span><span><span>.:/usr/app</span></span><span>
    </span><span><span>depends_on:</span></span><span>
      </span><span><span>-</span></span><span> </span><span><span>clickhouse</span></span><span>
      </span><span><span>-</span></span><span> </span><span><span>postgres</span></span><span>
    </span><span><span>command:</span></span><span> <span>&gt;
      bash -c "dbt deps &amp;&amp;
               dbt run --project-dir . --profiles-dir /usr/app/profiles &amp;&amp;
               dbt test --project-dir . --profiles-dir /usr/app/profiles"
</span></span></span></code></p></div>
```

___

## ‚ûï –ß—Ç–æ –µ—â—ë –Ω—É–∂–Ω–æ:

### 1\. –°–æ–∑–¥–∞–π `source` –≤ `models/schema.yml`:

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>version:</span></span><span> </span><span><span>2</span></span><span>

</span><span><span>sources:</span></span><span>
  </span><span><span>-</span></span><span> </span><span><span>name:</span></span><span> </span><span><span>raw</span></span><span>
    </span><span><span>tables:</span></span><span>
      </span><span><span>-</span></span><span> </span><span><span>name:</span></span><span> </span><span><span>customers</span></span><span>
</span></span></code></p></div>
```

### 2\. –ù–∞–ø–æ–ª–Ω–∏ —Ç–∞–±–ª–∏—Ü—É `raw.customers` –≤ PostgreSQL –∏–ª–∏ ClickHouse:

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span><span>CREATE</span></span><span> </span><span><span>TABLE</span></span><span> raw.customers (
  id </span><span><span>INT</span></span><span>,
  name TEXT,
  email TEXT
);

</span><span><span>INSERT</span></span><span> </span><span><span>INTO</span></span><span> raw.customers </span><span><span>VALUES</span></span><span>
  (</span><span><span>1</span></span><span>, </span><span><span>'Alice'</span></span><span>, </span><span><span>'alice@example.com'</span></span><span>),
  (</span><span><span>2</span></span><span>, </span><span><span>'Bob'</span></span><span>, </span><span><span>'bob@example.com'</span></span><span>);
</span></span></code></p></div>
```

___

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, —è –º–æ–≥—É —É–ø–∞–∫–æ–≤–∞—Ç—å —ç—Ç–æ –≤ `.zip` –∏–ª–∏ GitHub-—à–∞–±–ª–æ–Ω. –ù—É–∂–Ω–æ?

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

10.14 Downloading dbt\_clickhouse-1.9.1-py2.py3-none-any.whl.metadata (37 kB) 10.66 ERROR: Could not find a version that satisfies the requirement dbtvault>=0.9.2 (from versions: none) 10.66 ERROR: No matching distribution found for dbtvault>=0.9.2 ------ failed to solve: process "/bin/sh -c pip install --upgrade pip && pip install dbt-core dbt-postgres dbt-clickhouse 'dbtvault>=0.9.2'" did not complete successfully: exit code: 1

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–û—à–∏–±–∫–∞ `ERROR: No matching distribution found for dbtvault>=0.9.2` –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ `pip` –Ω–µ –º–æ–∂–µ—Ç –Ω–∞–π—Ç–∏ `dbtvault` ‚Äî –∏ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ, `dbtvault` **–Ω–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ PyPI**, –∞ **—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `packages.yml` –≤–Ω—É—Ç—Ä–∏ –ø—Ä–æ–µ–∫—Ç–∞ dbt**.

___

### ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–± —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `dbtvault`:

1.  –£–±–µ—Ä–∏ `dbtvault` –∏–∑ `pip install` –≤ `Dockerfile` ‚Äî **–æ–Ω–∞ –Ω–µ –¥–æ–ª–∂–Ω–∞ —Å—Ç–∞–≤–∏—Ç—å—Å—è —á–µ—Ä–µ–∑ pip**:
    

#### üîß –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π `Dockerfile`

```
<div><p>dockerfile</p><p><code id="code-lang-dockerfile"><span>FROM python:3.10-slim

RUN apt-get update &amp;&amp; apt-get install -y build-essential git curl &amp;&amp; rm -rf /var/lib/apt/lists/*

RUN pip install --upgrade pip &amp;&amp; \
    pip install dbt-core dbt-postgres dbt-clickhouse

# –†–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è
WORKDIR /usr/app
COPY . .

CMD ["bash"]
</span></code></p></div>
```

___

2.  –ò—Å–ø–æ–ª—å–∑—É–π `packages.yml` –≤ –ø—Ä–æ–µ–∫—Ç–µ dbt:
    

#### üì¶ `packages.yml`

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>packages:</span></span><span>
  </span><span><span>-</span></span><span> </span><span><span>package:</span></span><span> </span><span><span>Datavault-UK/dbtvault</span></span><span>
    </span><span><span>version:</span></span><span> [</span><span><span>"&gt;=0.9.2"</span></span><span>]
</span></span></code></p></div>
```

> üí° –ü–∞–∫–µ—Ç—ã dbt (–≤ —Ç.—á. `dbtvault`) —Å–∫–∞—á–∏–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `dbt deps` ‚Äî **–≤–æ –≤—Ä–µ–º—è —Å–±–æ—Ä–∫–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏–ª–∏ –≤ –º–æ–º–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è `dbt run`**.

___

### ‚úÖ –ö–∞–∫ —Å–æ–±—Ä–∞—Ç—å —Ç–µ–ø–µ—Ä—å:

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>docker compose build
docker compose up
</span></span></code></p></div>
```

___

### ‚ùó–í–∞–∂–Ω–æ

–ï—Å–ª–∏ `dbt deps` –≤—Å—ë –µ—â—ë –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø—Ä–æ–≤–µ—Ä—å:

-   –≤ `dbt_project.yml` –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–º—è –ø—Ä–æ–µ–∫—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä `dbt_dvault_project`);
    
-   –≤–Ω—É—Ç—Ä–∏ –ø—Ä–æ–µ–∫—Ç–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ñ–∞–π–ª `packages.yml`;
    
-   –ø–µ—Ä–µ–¥ `dbt deps` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `cd /usr/app` (–≤ `command` –∏–ª–∏ `Dockerfile`, –µ—Å–ª–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤–Ω–µ —Ä–∞–±–æ—á–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏).
    

___

–•–æ—á–µ—à—å, —è —Å–æ–±–µ—Ä—É `.zip` —Å –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—á–∏–º –ø—Ä–∏–º–µ—Ä–æ–º?

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

dbt-1 | 16:23:55 Running with dbt=1.9.6 dbt-1 | 16:23:55 Registered adapter: clickhouse=1.9.1 dbt-1 | 16:23:55 Unable to do partial parsing because saved manifest not found. Starting full parse. dbt-1 | 16:24:00 Encountered an error: dbt-1 | Compilation Error dbt-1 | In dispatch: No macro named 'get\_escape\_characters' found within namespace: 'dbtvault' dbt-1 | Searched for: 'data\_vault.clickhouse\_\_get\_escape\_characters', 'data\_vault.default\_\_get\_escape\_characters', 'dbtvault.clickhouse\_\_get\_escape\_characters', 'dbtvault.default\_\_get\_escape\_c haracters'

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–û—à–∏–±–∫–∞:

```
<div><p>pgsql</p><p><code><span><span>Compilation Error: </span><span><span>In</span></span><span> dispatch: </span><span><span>No</span></span><span> macro named </span><span><span>'get_escape_characters'</span></span><span> </span><span><span>found</span></span><span> </span><span><span>within</span></span><span> namespace: </span><span><span>'dbtvault'</span></span><span>
</span></span></code></p></div>
```

–æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ `dbtvault` –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞–¥–∞–ø—Ç–µ—Ä **ClickHouse** ‚Äî —É –Ω–µ–≥–æ –Ω–µ—Ç –º–∞–∫—Ä–æ—Å–∞ `get_escape_characters` –¥–ª—è —ç—Ç–æ–≥–æ –∞–¥–∞–ø—Ç–µ—Ä–∞.

___

### üìå –ü—Ä–∏—á–∏–Ω–∞

`dbtvault` –Ω–∞ —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –¥–µ–Ω—å **–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ**:

-   `dbt-postgres`
    
-   `dbt-snowflake`
    
-   `dbt-bigquery`
    
-   `dbt-redshift`
    

–ü–æ–¥–¥–µ—Ä–∂–∫–∏ `ClickHouse` **–Ω–µ—Ç**, –∏ –ø–æ–ø—ã—Ç–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `dbtvault` —Å `dbt-clickhouse` –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –æ—à–∏–±–∫–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏.

___

### ‚úÖ –ß—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:

#### –í–∞—Ä–∏–∞–Ω—Ç 1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `dbtvault` —Ç–æ–ª—å–∫–æ —Å `Postgres`

–û—Å—Ç–∞–≤–∏—Ç—å `dbtvault` —Ç–æ–ª—å–∫–æ –¥–ª—è `dbt-postgres`, –∞ `ClickHouse` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ –±–µ–∑ `dbtvault` (—á–µ—Ä–µ–∑ –æ–±—ã—á–Ω—ã–µ SQL-–º–æ–¥–µ–ª–∏).

#### –í–∞—Ä–∏–∞–Ω—Ç 2. –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `dbtvault`, –∞ –ø–∏—Å–∞—Ç—å –º–æ–¥–µ–ª–∏ Data Vault –≤—Ä—É—á–Ω—É—é

–¢—ã –º–æ–∂–µ—à—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–¥—Ö–æ–¥ Data Vault, –Ω–æ –±–µ–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ `dbtvault`, –∞ –æ–ø–∏—Å—ã–≤–∞—Ç—å —Ö–∞–±—ã, –ª–∏–Ω–∫–æ–≤–∫–∏ –∏ —Å–∞—Ç–µ–ª–ª–∏—Ç—ã –∫–∞–∫ –æ–±—ã—á–Ω—ã–µ –º–æ–¥–µ–ª–∏ dbt.

#### –í–∞—Ä–∏–∞–Ω—Ç 3. –†–∞—Å—à–∏—Ä–∏—Ç—å `dbtvault` —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å —É–≥–ª—É–±–∏—Ç—å—Å—è, –º–æ–∂–Ω–æ –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è **—Ñ–æ—Ä–∫–Ω—É—Ç—å `dbtvault`** –∏ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É `ClickHouse`, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–≤ –Ω—É–∂–Ω—ã–µ –º–∞–∫—Ä–æ—Å—ã ‚Äî –Ω–æ —ç—Ç–æ –Ω–µ–ø—Ä–æ—Å—Ç–æ.

___

### üîß –ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å —Å–µ–π—á–∞—Å

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `ClickHouse`, —Ç–æ:

1.  –£–¥–∞–ª–∏ `dbtvault` –∏–∑ `packages.yml`.
    
2.  –£–¥–∞–ª–∏ –≤—Å–µ –º–æ–¥–µ–ª–∏, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ –º–∞–∫—Ä–æ—Å—ã `dbtvault.*`.
    
3.  –û–ø–∏—à–∏ –º–æ–¥–µ–ª–∏ –≤—Ä—É—á–Ω—É—é –≤ —Å—Ç–∏–ª–µ Data Vault.
    

___

### ‚ùì–•–æ—á–µ—à—å, —è —Å–µ–π—á–∞—Å —Å–æ–±–µ—Ä—É —à–∞–±–ª–æ–Ω dbt –ø—Ä–æ–µ–∫—Ç–∞ **—Å ClickHouse –∏ Postgres**, –±–µ–∑ `dbtvault`, –Ω–æ —Å –≥–æ—Ç–æ–≤—ã–º–∏ –ø—Ä–∏–º–µ—Ä–∞–º–∏ –º–æ–¥–µ–ª–µ–π-—Ö–∞–±–æ–≤, –ª–∏–Ω–æ–≤, —Å–∞—Ç–µ–ª–ª–∏—Ç–æ–≤?

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–¥–∞–≤–∞–π –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–∫–ª—é—á–∏–º ClickHouse –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –æ—Å—Ç–∞–≤–∏–º —Ç–æ–ª—å–∫–æ Postgres –ø–µ—Ä–µ—Å–æ–∑–¥–∞–π –≤—Å–µ —Ñ–∞–π–ª—ã –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞

###### ChatGPT —Å–∫–∞–∑–∞–ª:

\# Dockerfile (–≤ –∫–∞—Ç–∞–ª–æ–≥–µ ./dbt)

FROM python:3.10-slim

WORKDIR /usr/app

RUN pip install --upgrade pip && \\

pip install dbt-core dbt-postgres prometheus\_client

COPY . .

\# dbt\_project.yml

name: 'dv\_postgres\_project'

version: '1.0'

config-version: 2

profile: 'dv\_postgres\_profile'

target-path: 'target'

clean-targets:

\- 'target'

\- 'dbt\_modules'

model-paths: \['models'\]

data-paths: \['data'\]

macro-paths: \['macros'\]

test-paths: \['tests'\]

models:

dv\_postgres\_project:

staging:

+materialized: view

marts:

+materialized: table

\# profiles.yml (–≤ –∫–∞—Ç–∞–ª–æ–≥–µ ./dbt)

dv\_postgres\_profile:

–ü—Ä–æ–µ–∫—Ç –ø–µ—Ä–µ—Å–æ–±—Ä–∞–Ω —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ç–æ–ª—å–∫–æ PostgreSQL. –í –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

-   `docker-compose.yml` –∑–∞–ø—É—Å–∫–∞–µ—Ç:
    
    -   PostgreSQL
        
    -   –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å dbt
        
    -   Prometheus –∏ Grafana
        
-   `dbt` –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω —á–µ—Ä–µ–∑ `dbt_project.yml` –∏ `profiles.yml`
    
-   –î–æ–±–∞–≤–ª–µ–Ω—ã –º–æ–¥–µ–ª–∏: `stg_customers` –∏ `dim_customers`
    
-   –ú–µ—Ç—Ä–∏–∫–∏ –≥–æ—Ç–æ–≤—ã –∫ —ç–∫—Å–ø–æ—Ä—Ç—É —á–µ—Ä–µ–∑ `prometheus_client`
    

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å –¥–æ–±–∞–≤–∏—Ç—å `dbt-artifacts`, —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –≤ –ë–î –∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –ø–æ–¥—Ä–æ–±–Ω–æ ‚Äî –º–æ–≥—É —Å—Ä–∞–∑—É –≤—Å—Ç—Ä–æ–∏—Ç—å.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–¥–∞–π –ø–æ–ª–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–í–æ—Ç –ø–æ–ª–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ `dbt + PostgreSQL + Prometheus + Grafana`, —Å —É—á—ë—Ç–æ–º –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —Ñ–∞–π–ª–æ–≤ –∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π:

```
<div><p>pgsql</p><p><code><span><span>my_dbt_project/
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ dbt/
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îú‚îÄ‚îÄ dbt_project.yml
‚îÇ   ‚îú‚îÄ‚îÄ profiles.yml
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ staging/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ stg_customers.</span><span><span>sql</span></span><span>
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ marts/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ dim_customers.</span><span><span>sql</span></span><span>
‚îÇ   ‚îú‚îÄ‚îÄ seeds/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ raw_customers.csv
‚îÇ   ‚îú‚îÄ‚îÄ macros/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ metrics_exporter.</span><span><span>sql</span></span><span>
‚îú‚îÄ‚îÄ prometheus/
‚îÇ   ‚îî‚îÄ‚îÄ prometheus.yml
‚îú‚îÄ‚îÄ grafana/
‚îÇ   ‚îî‚îÄ‚îÄ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å dashboard.json –∏–ª–∏ provisioning)
‚îî‚îÄ‚îÄ .env (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –≤—ã–Ω–µ—Å—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è)
</span></span></code></p></div>
```

___

### üìÑ –û–ø–∏—Å–∞–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:

#### `docker-compose.yml`

–ó–∞–ø—É—Å–∫–∞–µ—Ç:

-   PostgreSQL (`db`)
    
-   dbt-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (`dbt`)
    
-   Prometheus (`prometheus`)
    
-   Grafana (`grafana`)
    

#### `dbt/Dockerfile`

–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç:

-   `dbt-core`, `dbt-postgres`
    
-   `prometheus_client` (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω —ç–∫—Å–ø–æ—Ä—Ç –º–µ—Ç—Ä–∏–∫ –∏–∑ Python-—Å–∫—Ä–∏–ø—Ç–∞)
    

#### `dbt/dbt_project.yml`

–û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª –ø—Ä–æ–µ–∫—Ç–∞ dbt.

#### `dbt/profiles.yml`

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è dbt –∫ PostgreSQL (–±—ç–∫–µ–Ω–¥).

#### `models/staging/stg_customers.sql`

staging-–º–æ–¥–µ–ª—å, –ø—Ä–µ–æ–±—Ä–∞–∑—É—é—â–∞—è –¥–∞–Ω–Ω—ã–µ –∏–∑ seed-–∞.

#### `models/marts/dim_customers.sql`

–ü—Ä–∏–º–µ—Ä –∫–æ–Ω–µ—á–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã –≤ data mart.

#### `seeds/raw_customers.csv`

–ü—Ä–∏–º–µ—Ä CSV-–¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ —á–µ—Ä–µ–∑ `dbt seed`.

#### `macros/metrics_exporter.sql`

–ó–∞–≥–æ—Ç–æ–≤–∫–∞ –º–∞–∫—Ä–æ—Å–∞, –µ—Å–ª–∏ —Ö–æ—á–µ—à—å –∑–∞–ø—É—Å–∫–∞—Ç—å —ç–∫—Å–ø–æ—Ä—Ç –º–µ—Ç—Ä–∏–∫ –≤—Ä—É—á–Ω—É—é (–º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ Python-—Å–∫—Ä–∏–ø—Ç –ø–æ–∑–∂–µ).

#### `prometheus/prometheus.yml`

–ö–æ–Ω—Ñ–∏–≥ Prometheus –¥–ª—è —Å–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ —ç–∫—Å–ø–æ—Ä—Ç–∞ –∏–∑ dbt).

___

–•–æ—á–µ—à—å, –º–æ–≥—É –¥–æ–±–∞–≤–∏—Ç—å:

-   –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —ç–∫—Å–ø–æ—Ä—Ç `run_results.json` –≤ Prometheus/ClickHouse/Postgres
    
-   –≥–æ—Ç–æ–≤—ã–π dashboard –¥–ª—è Grafana
    
-   —Ç–µ—Å—Ç—ã dbt
    
-   dbt-artifacts –ø–∞–∫–µ—Ç
    

–°–∫–∞–∑–∞—Ç—å?

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–í–æ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `Dockerfile` –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ dbt, –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–æ–ª—å–∫–æ –Ω–∞ PostgreSQL:

```
<div><p>Dockerfile</p><p><code id="code-lang-undefined"><span># dbt/Dockerfile

FROM python:3.10-slim

# –£—Å—Ç–∞–Ω–æ–≤–∏–º —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
RUN apt-get update &amp;&amp; apt-get install -y \
    build-essential \
    git \
    &amp;&amp; apt-get clean

# –û–±–Ω–æ–≤–∏–º pip –∏ —É—Å—Ç–∞–Ω–æ–≤–∏–º dbt –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
RUN pip install --upgrade pip &amp;&amp; \
    pip install dbt-core dbt-postgres prometheus_client

# –°–æ–∑–¥–∞–¥–∏–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
WORKDIR /app
COPY . /app

# –£—Å—Ç–∞–Ω–æ–≤–∏–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ dbt (–µ—Å–ª–∏ –µ—Å—Ç—å packages.yml)
RUN dbt deps || true

# –ö–æ–º–∞–Ω–¥–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–º–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤ docker-compose)
CMD ["dbt", "run"]
</span></code></p></div>
```

___

üìå –ï—Å–ª–∏ —Ç—ã –∏—Å–ø–æ–ª—å–∑—É–µ—à—å `dbt-artifacts` –∏–ª–∏ —Ö–æ—á–µ—à—å –ø–∏—Å–∞—Ç—å Python-—Å–∫—Ä–∏–ø—Ç—ã, –∞–Ω–∞–ª–∏–∑–∏—Ä—É—é—â–∏–µ `run_results.json` –∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—é—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏ ‚Äî `prometheus_client` —É–∂–µ –≤–∫–ª—é—á—ë–Ω.

–•–æ—á–µ—à—å —Å—Ä–∞–∑—É –ø–æ–ª—É—á–∏—Ç—å `docker-compose.yml`, —á—Ç–æ–±—ã –≤—Å—ë —ç—Ç–æ —Å–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å?

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–ø–æ—á–µ–º—É —ç—Ç–æ—Ç –∫–æ–¥ –¥—Ä—É–≥–æ–π, –Ω–µ–∂–µ–ª–∏ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ –¥–æ —ç—Ç–æ–≥–æ?

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–•–æ—Ä–æ—à–∏–π –≤–æ–ø—Ä–æ—Å.

–†–∞–∑–ª–∏—á–∏–µ –º–µ–∂–¥—É –¥–≤—É–º—è –≤–µ—Ä—Å–∏—è–º–∏ `Dockerfile` —Å–≤—è–∑–∞–Ω–æ —Å **–∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è** –∏ **—É—Ä–æ–≤–Ω–µ–º –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏**:

___

### ‚úÖ –í Canvas (–≤ —Ç–≤–æ—ë–º –ø—Ä–æ–µ–∫—Ç–µ):

```
<div><p>dockerfile</p><p><code id="code-lang-dockerfile"><span># Dockerfile (–≤ –∫–∞—Ç–∞–ª–æ–≥–µ ./dbt)
FROM python:3.10-slim

WORKDIR /usr/app

RUN pip install --upgrade pip &amp;&amp; \
    pip install dbt-core dbt-postgres prometheus_client

COPY . .
</span></code></p></div>
```

üîπ **–£–ø—Ä–æ—â—ë–Ω**: –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è —Å–±–æ—Ä–∫–∏ _–≤–Ω—É—Ç—Ä–∏ docker-compose_, –≥–¥–µ —Å–µ—Ç—å, volume –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è **–∏–∑–≤–Ω–µ**  
üîπ **–ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç –Ω–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞ –≤ —Ç–µ–∫—É—â–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ** (`COPY . .`)  
üîπ **–ù–µ—Ç –ª–∏—à–Ω–µ–≥–æ** ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ dbt –∏ —ç–∫—Å–ø–æ—Ä—Ç–∞ –º–µ—Ç—Ä–∏–∫

___

### üì¶ –í –ø—Ä–µ–¥—ã–¥—É—â–µ–º —Å–æ–æ–±—â–µ–Ω–∏–∏:

```
<div><p>dockerfile</p><p><code id="code-lang-dockerfile"><span># dbt/Dockerfile

FROM python:3.10-slim

# –£—Å—Ç–∞–Ω–æ–≤–∏–º —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
RUN apt-get update &amp;&amp; apt-get install -y \
    build-essential \
    git \
    &amp;&amp; apt-get clean

# –û–±–Ω–æ–≤–∏–º pip –∏ —É—Å—Ç–∞–Ω–æ–≤–∏–º dbt –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
RUN pip install --upgrade pip &amp;&amp; \
    pip install dbt-core dbt-postgres prometheus_client

WORKDIR /app
COPY . /app

# –£—Å—Ç–∞–Ω–æ–≤–∏–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ dbt (–µ—Å–ª–∏ –µ—Å—Ç—å packages.yml)
RUN dbt deps || true

CMD ["dbt", "run"]
</span></code></p></div>
```

üî∏ **–ë–æ–ª–µ–µ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π**: –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (`build-essential`, `git`) –Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ —Ç–µ–±–µ –ø–æ–Ω–∞–¥–æ–±—è—Ç—Å—è –ø–∞–∫–µ—Ç—ã –∏–∑ GitHub (–Ω–∞–ø—Ä–∏–º–µ—Ä, `dbtvault`)  
üî∏ –í–∫–ª—é—á—ë–Ω –∑–∞–ø—É—Å–∫ `dbt deps`, –µ—Å–ª–∏ –ø—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `packages.yml`  
üî∏ –ò–º–µ–µ—Ç `CMD`, —á—Ç–æ–±—ã –æ–±—Ä–∞–∑ –º–æ–∂–Ω–æ –±—ã–ª–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –∞–≤—Ç–æ–Ω–æ–º–Ω–æ

___

### ü§î –ö–∞–∫–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –ª—É—á—à–µ?

| –ó–∞–¥–∞—á–∞ | –ü–æ–¥—Ö–æ–¥–∏—Ç –≤–∞—Ä–∏–∞–Ω—Ç |
| --- | --- |
| –õ—ë–≥–∫–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤–Ω—É—Ç—Ä–∏ `docker-compose` | üéØ **Canvas** |
| –°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–π –æ–±—Ä–∞–∑ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Git | üì¶ **–ü—Ä–µ–¥—ã–¥—É—â–∏–π** |
| –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `dbtvault`, Git-–ø–∞–∫–µ—Ç–æ–≤ | üì¶ **–ü—Ä–µ–¥—ã–¥—É—â–∏–π** |
| –¢–æ–ª—å–∫–æ PostgreSQL, –±–µ–∑ –ª–∏—à–Ω–µ–≥–æ | üéØ **Canvas** |

___

–•–æ—á–µ—à—å, —è –æ–±—ä–µ–¥–∏–Ω—é –ª—É—á—à–µ–µ –∏–∑ –¥–≤—É—Ö –ø–æ–¥—Ö–æ–¥–æ–≤ –∏ –ø—Ä–∏—à–ª—é –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω—ã–π `Dockerfile`, –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫ —Ç–≤–æ–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –ø—Ä–æ–µ–∫—Ç–∞?

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

(HTTP code 400) unexpected - failed to create task for container: failed to create shim task: OCI runtime create failed: runc create failed: unable to start container process: error during container init: error mounting "/run/desktop/mnt/host/c/Projects/dbt/data-vault-dbt/prometheus/prometheus.yml" to rootfs at "/etc/prometheus/prometheus.yml": create mountpoint for /etc/prometheus/prometheus.yml mount: cannot create subdirectories in "/var/lib/docker/rootfs/overlayfs/e91097c834b6176a6f80ccb3715a46912b2458df1bf2aa8f4fe6d25eba064256/etc/prometheus/prometheus.yml": not a directory: unknown: Are you trying to mount a directory onto a file (or vice-versa)? Check if the specified host path exists and is the expected type

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–û—à–∏–±–∫–∞, –∫–æ—Ç–æ—Ä—É—é —Ç—ã –ø–æ–ª—É—á–∏–ª:

> **"Are you trying to mount a directory onto a file (or vice-versa)?"**

–æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ **—Ç—ã –ø—ã—Ç–∞–µ—à—å—Å—è –ø—Ä–∏–º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª –ø–æ–≤–µ—Ä—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏**, –∏–ª–∏ –Ω–∞–æ–±–æ—Ä–æ—Ç. Docker —Ç—Ä–µ–±—É–µ—Ç, —á—Ç–æ–±—ã **—Ç–∏–ø –º–æ–Ω—Ç–∏—Ä—É–µ–º–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ (—Ñ–∞–π–ª –∏–ª–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è)** –Ω–∞ —Ö–æ—Å—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞–ª —Ç–∏–ø—É –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ.

___

### üí• –ü—Ä–∏—á–∏–Ω–∞ –æ—à–∏–±–∫–∏:

–¢—ã, —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ, —É–∫–∞–∑–∞–ª **—Ñ–∞–π–ª `prometheus.yml`** –≤ `volumes`, –Ω–æ –ø—É—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ ‚Äî `/etc/prometheus/prometheus.yml` ‚Äî **—É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∫–∞–∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è**, –ª–∏–±–æ **–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `/etc/prometheus` –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç**, –∏ Docker –Ω–µ –º–æ–∂–µ—Ç —Ç—É–¥–∞ –ø–æ–º–µ—Å—Ç–∏—Ç—å —Ñ–∞–π–ª.

___

### ‚úÖ –†–µ—à–µ–Ω–∏–µ:

–ü—Ä–æ–≤–µ—Ä—å, –∫–∞–∫ —Ç—ã —É–∫–∞–∑—ã–≤–∞–µ—à—å volume –≤ `docker-compose.yml` –∏–ª–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ `docker run`.

#### **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–±:**

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span># docker-compose.yml</span></span><span>
  </span><span><span>prometheus:</span></span><span>
    </span><span><span>image:</span></span><span> </span><span><span>prom/prometheus</span></span><span>
    </span><span><span>volumes:</span></span><span>
      </span><span><span>-</span></span><span> </span><span><span>./prometheus/prometheus.yml:/etc/prometheus/prometheus.yml</span></span><span>
</span></span></code></p></div>
```

#### –£–±–µ–¥–∏—Å—å, —á—Ç–æ:

1.  –§–∞–π–ª **–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç** –Ω–∞ —Ö–æ—Å—Ç–µ:  
    `./prometheus/prometheus.yml`
    
2.  –≠—Ç–æ **—Ñ–∞–π–ª**, –∞ –Ω–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è:
    

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>file ./prometheus/prometheus.yml
</span><span><span># –î–æ–ª–∂–Ω–æ –≤—ã–≤–µ—Å—Ç–∏ —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ: "prometheus.yml: ASCII text"</span></span><span>
</span></span></code></p></div>
```

3.  –ö–∞—Ç–∞–ª–æ–≥ `./prometheus` –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç **–ø–∞–ø–∫–∏ —Å —Ç–∞–∫–∏–º –∂–µ –∏–º–µ–Ω–µ–º**, –∫–∞–∫ —Ñ–∞–π–ª.
    

___

### üîß –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ (–µ—Å–ª–∏ Prometheus —Ç—Ä–µ–±—É–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é):

–ï—Å–ª–∏ Prometheus –æ–∂–∏–¥–∞–µ—Ç `config` –∫–∞–∫ **–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é**, —Ç—ã –º–æ–∂–µ—à—å —Å–¥–µ–ª–∞—Ç—å —Ç–∞–∫:

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞:

```
<div><p>bash</p><p><code><span><span>./prometheus/
  ‚îî‚îÄ‚îÄ prometheus.yml
</span></span></code></p></div>
```

#### –ò –º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–∞–∫:

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>volumes:</span></span><span>
  </span><span><span>-</span></span><span> </span><span><span>./prometheus:/etc/prometheus</span></span><span>
</span></span></code></p></div>
```

___

### üí° –†–µ–∑—é–º–µ:

| –ü—Ä–æ–±–ª–µ–º–∞ | –ß—Ç–æ –¥–µ–ª–∞—Ç—å |
| --- | --- |
| –ú–æ–Ω—Ç–∏—Ä—É–µ—à—å —Ñ–∞–π–ª, –∞ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ —ç—Ç–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è | –ü—Ä–æ–≤–µ—Ä—å –ø—É—Ç—å, –∏—Å–ø–æ–ª—å–∑—É–π `file` –≤–º–µ—Å—Ç–æ `dir` |
| –ü–∞–ø–∫–∞ –Ω–∞ —Ö–æ—Å—Ç–µ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è `prometheus.yml` | –ü–µ—Ä–µ–∏–º–µ–Ω—É–π ‚Äî —Ñ–∞–π–ª –∏ –ø–∞–ø–∫–∞ –Ω–µ –º–æ–≥—É—Ç —Å–æ–≤–ø–∞–¥–∞—Ç—å |
| –ù—É–∂–Ω–æ –±–æ–ª—å—à–µ –≥–∏–±–∫–æ—Å—Ç–∏ | –°–º–æ–Ω—Ç–∏—Ä—É–π –≤—Å—é –ø–∞–ø–∫—É: `./prometheus:/etc/prometheus` |

___

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å ‚Äî —è –ø–æ–º–æ–≥—É –ø–µ—Ä–µ–ø—Ä–æ–≤–µ—Ä–∏—Ç—å `docker-compose.yml` –∏ –ø—É—Ç—å –∫ `prometheus.yml`, –ø—Ä–æ—Å—Ç–æ –ø—Ä–∏—à–ª–∏ –µ–≥–æ.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

dbt-1 | 18:07:40 Encountered an error: dbt-1 | Compilation Error dbt-1 | Model 'model.dv\_postgres\_project.stg\_customers' (models/staging/stg\_customers.sql) depends on a source named 'public.raw\_customers' which was not found dbt-1 exited with code 2

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–û—à–∏–±–∫–∞:

```
<div><p>bash</p><p><code><span><span>Model </span><span><span>'model.dv_postgres_project.stg_customers'</span></span><span> ... depends on a </span><span><span>source</span></span><span> named </span><span><span>'public.raw_customers'</span></span><span> </span><span><span>which</span></span><span> was not found
</span></span></code></p></div>
```

–æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —Ç—ã —Å—Å—ã–ª–∞–µ—à—å—Å—è –Ω–∞ `{{ source('public', 'raw_customers') }}`, –Ω–æ **–Ω–µ –æ–ø—Ä–µ–¥–µ–ª–∏–ª —ç—Ç–æ—Ç source** –≤ `sources`.

___

### ‚úÖ –†–µ—à–µ–Ω–∏–µ: –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö (`source`)

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `models/staging/schema.yml` —Å–æ —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>version:</span></span><span> </span><span><span>2</span></span><span>

</span><span><span>sources:</span></span><span>
  </span><span><span>-</span></span><span> </span><span><span>name:</span></span><span> </span><span><span>public</span></span><span>
    </span><span><span>database:</span></span><span> </span><span><span>dbt</span></span><span>
    </span><span><span>schema:</span></span><span> </span><span><span>public</span></span><span>
    </span><span><span>tables:</span></span><span>
      </span><span><span>-</span></span><span> </span><span><span>name:</span></span><span> </span><span><span>raw_customers</span></span><span>
</span></span></code></p></div>
```

___

### üîÑ –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —ç—Ç–æ—Ç YAML:

-   **name: public** ‚Äî —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø–µ—Ä–≤–æ–º—É –∞—Ä–≥—É–º–µ–Ω—Ç—É `source('public', ...)`
    
-   **tables -> name: raw\_customers** ‚Äî —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –≤—Ç–æ—Ä–æ–º—É –∞—Ä–≥—É–º–µ–Ω—Ç—É `source(..., 'raw_customers')`
    
-   **schema/database** ‚Äî —É–∫–∞–∑—ã–≤–∞–µ—Ç, –≥–¥–µ –∏—Å–∫–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É –≤ –±–∞–∑–µ
    

___

### üß™ –ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:

–í—ã–ø–æ–ª–Ω–∏:

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>docker compose run dbt dbt debug
docker compose run dbt dbt seed
docker compose run dbt dbt run
</span></span></code></p></div>
```

___

### üí° –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:

–¢—ã –∏—Å–ø–æ–ª—å–∑—É–µ—à—å `dbt seed`, —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ `seeds/raw_customers.csv`, –∏ –∑–∞—Ç–µ–º `{{ source(...) }}` ‚Äî —á—Ç–æ–±—ã –∫ –Ω–∏–º –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫–∞–∫ –∫ "–∏—Å—Ç–æ—á–Ω–∏–∫—É". –≠—Ç–æ —Ä–∞–±–æ—á–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω, –Ω–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –Ω—É–∂–Ω–æ —è–≤–Ω–æ –æ–ø–∏—Å–∞—Ç—å `source`.

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, —è –º–æ–≥—É –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞ –∏ –ø–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª–Ω—ã–π YAML-—Ñ–∞–π–ª.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

dbt-1 | 18:15:27 Finished running in 0 hours 0 minutes and 0.09 seconds (0.09s). dbt-1 | 18:15:27 Encountered an error: dbt-1 | Database Error dbt-1 | connection to server at "db" (172.18.0.2), port 5432 failed: FATAL: database "dbt" does not exist

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–û—à–∏–±–∫–∞:

```
<div><p>pgsql</p><p><code><span><span><span>connection</span></span><span> </span><span><span>to</span></span><span> </span><span><span>server</span></span><span> at "db" (</span><span><span>172.18</span></span><span><span>.0</span></span><span><span>.2</span></span><span>), port </span><span><span>5432</span></span><span> failed: FATAL:  </span><span><span>database</span></span><span> "dbt" does </span><span><span>not</span></span><span> exist
</span></span></code></p></div>
```

–æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ dbt –ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –±–∞–∑–µ `dbt`, –Ω–æ —Ç–∞–∫–∞—è –±–∞–∑–∞ **–µ—â—ë –Ω–µ —Å–æ–∑–¥–∞–Ω–∞** –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ PostgreSQL.

___

### ‚úÖ –†–µ—à–µ–Ω–∏—è

#### üîß –í–∞—Ä–∏–∞–Ω—Ç 1: –°–æ–∑–¥–∞—Ç—å –ë–î `dbt` –≤—Ä—É—á–Ω—É—é

–ï—Å–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –º–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ PostgreSQL –∏ —Å–æ–∑–¥–∞—Ç—å –±–∞–∑—É:

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>docker compose </span><span><span>exec</span></span><span> postgres psql -U postgres
</span></span></code></p></div>
```

–ê –≤ –∫–æ–Ω—Å–æ–ª–∏ `psql`:

___

#### üõ† –í–∞—Ä–∏–∞–Ω—Ç 2: –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ-—Å–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –≤ `docker-compose.yml`

–í —Å–µ–∫—Ü–∏–∏ `postgres` –¥–æ–±–∞–≤—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç:

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>services:</span></span><span>
  </span><span><span>postgres:</span></span><span>
    </span><span><span>image:</span></span><span> </span><span><span>postgres:15</span></span><span>
    </span><span><span>environment:</span></span><span>
      </span><span><span>POSTGRES_USER:</span></span><span> </span><span><span>dbt</span></span><span>
      </span><span><span>POSTGRES_PASSWORD:</span></span><span> </span><span><span>dbt</span></span><span>
      </span><span><span>POSTGRES_DB:</span></span><span> </span><span><span>dbt</span></span><span>  </span><span><span># üëà —Å–æ–∑–¥–∞—ë—Ç –ë–î –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ</span></span><span>
    </span><span><span>ports:</span></span><span>
      </span><span><span>-</span></span><span> </span><span><span>"5432:5432"</span></span><span>
    </span><span><span>volumes:</span></span><span>
      </span><span><span>-</span></span><span> </span><span><span>pgdata:/var/lib/postgresql/data</span></span><span>

</span><span><span>volumes:</span></span><span>
  </span><span><span>pgdata:</span></span><span>
</span></span></code></p></div>
```

–≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –±–∞–∑–∞ `dbt` –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ.

___

### üîÅ –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

1.  –£–¥–∞–ª–∏ volume, –µ—Å–ª–∏ –æ–Ω —É–∂–µ –µ—Å—Ç—å, —á—Ç–æ–±—ã –ë–î –ø–µ—Ä–µ—Å–æ–∑–¥–∞–ª–∞—Å—å:
    

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>docker compose down -v
</span></span></code></p></div>
```

2.  –ó–∞–ø—É—Å—Ç–∏ –≤—Å—ë –∑–∞–Ω–æ–≤–æ:
    

___

–•–æ—á–µ—à—å, —è –ø—Ä–∏—à–ª—é –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π `docker-compose.yml` —Å —É—á—ë—Ç–æ–º —ç—Ç–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π?

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

2025-06-01 18:19:59.561 UTC \[72\] ERROR: relation "public.raw\_customers" does not exist at character 316 db-1 | 2025-06-01 18:19:59.561 UTC \[72\] STATEMENT: /\* {"app": "dbt", "dbt\_version": "1.9.6", "profile\_name": "dv\_postgres\_profile", "target\_name": "dev", "node\_id": "model.dv\_postgres\_project.stg\_customers "} \*/ db-1 | db-1 | create view "dbt"."public"."stg\_customers\_\_dbt\_tmp" dbt-1 | 18:19:59 1 of 2 ERROR creating sql view model public.stg\_customers ...................... \[ERROR in 0.12s\] db-1 | dbt-1 | 18:19:59 2 of 2 SKIP relation public.dim\_customers ...................................... \[SKIP\] db-1 | db-1 | as ( db-1 | db-1 | db-1 | select db-1 | id as customer\_id, dbt-1 | 18:19:59 db-1 | name as customer\_name, dbt-1 | 18:19:59 Finished running 1 table model, 1 view model in 0 hours 0 minutes and 0.34 seconds (0.34s). db-1 | created\_at db-1 | from "dbt"."public"."raw\_customers" db-1 | ); db-1 | 2025-06-01 18:19:59.601 UTC \[73\] WARNING: there is already a transaction in progress dbt-1 | 18:19:59 dbt-1 | 18:19:59 Completed with 1 error, 0 partial successes, and 0 warnings: dbt-1 | 18:19:59 dbt-1 | 18:19:59 Database Error in model stg\_customers (models/staging/stg\_customers.sql) dbt-1 | relation "public.raw\_customers" does not exist dbt-1 | LINE 13: from "dbt"."public"."raw\_customers" dbt-1 | ^ dbt-1 | compiled code at target/run/dv\_postgres\_project/models/staging/stg\_customers.sql dbt-1 | 18:19:59 dbt-1 | 18:19:59 Done. PASS=0 WARN=0 ERROR=1 SKIP=1 TOTAL=2 dbt-1 exited with code 1

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–û—à–∏–±–∫–∞:

```
<div><p>nginx</p><p><code><span><span><span>relation</span></span><span> </span><span><span>"public.raw_customers"</span></span><span> does not exist
</span></span></code></p></div>
```

–æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ (—Ç–æ—á–Ω–µ–µ ‚Äî **view –∏–ª–∏ seed**) `raw_customers` –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö PostgreSQL.

___

### üîç –ü—Ä–∏—á–∏–Ω–∞

–í –º–æ–¥–µ–ª–∏ `stg_customers.sql` —É —Ç–µ–±—è —Ç–∞–∫–æ–π –∫–æ–¥:

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span><span>from</span></span><span> {{ source(</span><span><span>'public'</span></span><span>, </span><span><span>'raw_customers'</span></span><span>) }}
</span></span></code></p></div>
```

–ù–æ —Ç—ã **–Ω–µ –æ–ø—Ä–µ–¥–µ–ª–∏–ª –∏—Å—Ç–æ—á–Ω–∏–∫ (`source`)** –≤ dbt, **–∏/–∏–ª–∏ –Ω–µ –ø–æ–¥–≥—Ä—É–∑–∏–ª seed-—Ñ–∞–π–ª** `raw_customers.csv`.

___

### ‚úÖ –†–µ—à–µ–Ω–∏–µ

#### üîß –í–∞—Ä–∏–∞–Ω—Ç 1: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `seed`\-—Ñ–∞–π–ª `raw_customers.csv`

1.  –£–±–µ–¥–∏—Å—å, —á—Ç–æ —É —Ç–µ–±—è –≤ `dbt_project.yml` –ø—Ä–æ–ø–∏—Å–∞–Ω–∞ –ø–∞–ø–∫–∞ `seeds`:
    

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>data-paths:</span></span><span> [</span><span><span>'data'</span></span><span>]
</span><span><span>seeds:</span></span><span>
  </span><span><span>dv_postgres_project:</span></span><span>
    </span><span><span>+schema:</span></span><span> </span><span><span>public</span></span><span>
</span></span></code></p></div>
```

2.  –£ —Ç–µ–±—è —É–∂–µ –µ—Å—Ç—å —Ñ–∞–π–ª:
    

```
<div><p>text</p><p><code id="code-lang-text"><span><span>./seeds/raw_customers.csv
</span></span></code></p></div>
```

3.  –ó–∞–ø—É—Å—Ç–∏ –∑–∞–≥—Ä—É–∑–∫—É —Å–∏–¥–æ–≤:
    

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>docker compose </span><span><span>exec</span></span><span> dbt dbt seed
</span></span></code></p></div>
```

4.  –ó–∞–º–µ–Ω–∏ `source(...)` –≤ `stg_customers.sql` –Ω–∞ –æ–±—ã—á–Ω–æ–µ –∏–º—è —Ç–∞–±–ª–∏—Ü—ã:
    

___

#### ‚úÖ –õ–∏–±–æ: –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å `source` —á–µ—Ä–µ–∑ `sources.yml`

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `models/staging/sources.yml`:

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>version:</span></span><span> </span><span><span>2</span></span><span>

</span><span><span>sources:</span></span><span>
  </span><span><span>-</span></span><span> </span><span><span>name:</span></span><span> </span><span><span>public</span></span><span>
    </span><span><span>tables:</span></span><span>
      </span><span><span>-</span></span><span> </span><span><span>name:</span></span><span> </span><span><span>raw_customers</span></span><span>
</span></span></code></p></div>
```

–ò —É–±–µ–¥–∏—Å—å, —á—Ç–æ –≤ –º–æ–¥–µ–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å:

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span><span>from</span></span><span> {{ source(</span><span><span>'public'</span></span><span>, </span><span><span>'raw_customers'</span></span><span>) }}
</span></span></code></p></div>
```

–ù–æ –¥–∞–∂–µ —Å `source` —Ç–∞–±–ª–∏—Ü–∞ –¥–æ–ª–∂–Ω–∞ **—Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å —Ñ–∏–∑–∏—á–µ—Å–∫–∏** (–≤ –≤–∏–¥–µ `CREATE TABLE` –∏–ª–∏ `seed`).

___

### üí° –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø—É—Ç—å

–ò—Å–ø–æ–ª—å–∑—É–π `seed`, –∫–∞–∫ –≤ —Ç–≤–æ—ë–º —Å–ª—É—á–∞–µ:

1.  –ü—Ä–æ–≤–µ—Ä—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞:
    

```
<div><p>pgsql</p><p><code><span><span>dbt/
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ staging/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ sources.yml ‚úÖ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ stg_customers.</span><span><span>sql</span></span><span>
‚îú‚îÄ‚îÄ seeds/
‚îÇ   ‚îî‚îÄ‚îÄ raw_customers.csv ‚úÖ
‚îú‚îÄ‚îÄ dbt_project.yml
‚îî‚îÄ‚îÄ profiles.yml
</span></span></code></p></div>
```

2.  –í—ã–ø–æ–ª–Ω–∏:
    

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>docker compose </span><span><span>exec</span></span><span> dbt dbt seed
docker compose </span><span><span>exec</span></span><span> dbt dbt run
</span></span></code></p></div>
```

–•–æ—á–µ—à—å ‚Äî —è –ø—Ä–∏—à–ª—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ `stg_customers.sql`, `sources.yml` –∏ `docker-compose` —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø—É—Ç—è–º–∏ –∏ —à–∞–≥–∞–º–∏?

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

PS C:\\Projects\\dbt\\data-vault-dbt> docker compose exec dbt dbt seed service "dbt" is not running

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–û—à–∏–±–∫–∞:

```
<div><p>arduino</p><p><code><span><span>service </span><span><span>"dbt"</span></span><span> is </span><span><span>not</span></span><span> running
</span></span></code></p></div>
```

–æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –∏–º–µ–Ω–µ–º `dbt` –≤ —Ç–≤–æ—ë–º `docker-compose.yml` **–Ω–µ –∑–∞–ø—É—â–µ–Ω**, –ª–∏–±–æ –∏–º–µ–µ—Ç **–¥—Ä—É–≥–æ–µ –∏–º—è**.

___

### üîç –®–∞–≥–∏ –¥–ª—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è

#### 1\. –ü—Ä–æ–≤–µ—Ä—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:

–£–±–µ–¥–∏—Å—å, —á—Ç–æ –≤ —Å–ø–∏—Å–∫–µ –µ—Å—Ç—å —Å–µ—Ä–≤–∏—Å —Å –∏–º–µ–Ω–µ–º `dbt` (–∏–ª–∏ –¥—Ä—É–≥–∏–º, –µ—Å–ª–∏ —Ç—ã –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–ª –µ–≥–æ).

#### 2\. –ï—Å–ª–∏ —Å–µ—Ä–≤–∏—Å `dbt` **–Ω–µ –∑–∞–ø—É—â–µ–Ω**, –∑–∞–ø—É—Å—Ç–∏:

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å –ø–æ–ª—É—á–∏—Ç—å –ª–æ–≥–∏:

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>docker compose logs -f dbt
</span></span></code></p></div>
```

#### 3\. –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ ‚Äî –≤—ã–ø–æ–ª–Ω–∏ `dbt seed`:

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>docker compose </span><span><span>exec</span></span><span> dbt dbt seed
</span></span></code></p></div>
```

___

### üìå –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –µ—Å–ª–∏ —Å–µ—Ä–≤–∏—Å –Ω–∞–∑–≤–∞–Ω –ø–æ-–¥—Ä—É–≥–æ–º—É

–ï—Å–ª–∏ –≤ `docker-compose.yml` –∏–º—è —Å–µ—Ä–≤–∏—Å–∞ –Ω–µ `dbt`, –∞, –Ω–∞–ø—Ä–∏–º–µ—Ä, `dbt-service`, —Ç–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å:

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>docker compose </span><span><span>exec</span></span><span> dbt-service dbt seed
</span></span></code></p></div>
```

___

### üí° –•–æ—á–µ—à—å ‚Äî —è –ø—Ä–æ—Å–º–æ—Ç—Ä—é –∏ –ø—Ä–æ–≤–µ—Ä—é —Ç–≤–æ–π `docker-compose.yml`, —á—Ç–æ–±—ã —Ç–æ—á–Ω–æ –Ω–∞–∑–≤–∞—Ç—å –Ω—É–∂–Ω—ã–π —Å–µ—Ä–≤–∏—Å? –ü—Ä–æ—Å—Ç–æ –ø—Ä–∏—à–ª–∏ –µ–≥–æ —Å—é–¥–∞.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

dbt –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤–æ—Ç –ø–æ—á–µ–º—É —Ç–∞–∫–∞—è –æ—à–∏–±–∫–∞ –∫–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å seed –≤ —Ç–∞–∫–æ–º —Å–ª—É—á–∞–µ?

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–¢—ã –ø—Ä–∞–≤ ‚Äî –µ—Å–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä `dbt` **–æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**, —Ç–æ –ø–æ–ø—ã—Ç–∫–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç—å `docker compose exec dbt dbt seed` –¥–∞—Å—Ç –æ—à–∏–±–∫—É –≤–∏–¥–∞ `service "dbt" is not running`.

___

### ‚úÖ –†–µ—à–µ–Ω–∏–µ: –∑–∞–ø—É—Å—Ç–∏—Ç—å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—É—é —Å–µ—Å—Å–∏—é –≤—Ä—É—á–Ω—É—é

–ß—Ç–æ–±—ã –≤—ã–ø–æ–ª–Ω–∏—Ç—å `dbt seed` **–≤ —Ä–∞–±–æ—Ç–∞—é—â–µ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏**, –Ω—É–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä `dbt` –≤ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–º —Ä–µ–∂–∏–º–µ –∏ –≤–Ω—É—Ç—Ä–∏ –Ω–µ–≥–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å –∫–æ–º–∞–Ω–¥—ã. –ï—Å—Ç—å –¥–≤–∞ —Å–ø–æ—Å–æ–±–∞:

___

### üîß –°–ø–æ—Å–æ–± 1: –≤—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä `dbt` –≤—Ä—É—á–Ω—É—é

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>docker compose run --</span><span><span>rm</span></span><span> dbt dbt seed
</span></span></code></p></div>
```

-   `run` ‚Äî –∑–∞–ø—É—Å—Ç–∏—Ç –Ω–æ–≤—ã–π –≤—Ä–µ–º–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏–∑ —Å–µ—Ä–≤–∏—Å–∞ `dbt`
    
-   `--rm` ‚Äî —É–¥–∞–ª–∏—Ç –µ–≥–æ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
    
-   `dbt seed` ‚Äî –≤—ã–ø–æ–ª–Ω–∏—Ç –∫–æ–º–∞–Ω–¥—É –≤–Ω—É—Ç—Ä–∏
    

üëâ –≠—Ç–æ –∏–¥–µ–∞–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–± –¥–ª—è –æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π (seed, run, test –∏ —Ç.–¥.)

___

### üîß –°–ø–æ—Å–æ–± 2: –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫–∞–∫ "–≤–µ—á–Ω–æ —Ä–∞–±–æ—Ç–∞—é—â–∏–π"

–ï—Å–ª–∏ —Ç—ã —Ö–æ—á–µ—à—å, —á—Ç–æ–±—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä `dbt` **–Ω–µ –∑–∞–≤–µ—Ä—à–∞–ª—Å—è –ø–æ—Å–ª–µ –∫–æ–º–∞–Ω–¥—ã**, –∏–∑–º–µ–Ω–∏ `command:` –≤ `docker-compose.yml`:

#### –ë—ã–ª–æ:

#### –°—Ç–∞–ª–æ:

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>command:</span></span><span> </span><span><span>tail</span></span><span> </span><span><span>-f</span></span><span> </span><span><span>/dev/null</span></span><span>
</span></span></code></p></div>
```

–ò –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏:

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>docker compose up -d --build
</span></span></code></p></div>
```

–¢–µ–ø–µ—Ä—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –±—É–¥–µ—Ç –≤–µ—á–Ω–æ "–≤–∏—Å–µ—Ç—å", –∏ —Ç—ã —Å–º–æ–∂–µ—à—å –¥–µ–ª–∞—Ç—å:

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>docker compose </span><span><span>exec</span></span><span> dbt dbt seed
docker compose </span><span><span>exec</span></span><span> dbt dbt run
</span></span></code></p></div>
```

___

### üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è `seed`:

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>docker compose </span><span><span>exec</span></span><span> dbt dbt run
docker compose </span><span><span>exec</span></span><span> dbt dbt </span><span><span>test</span></span><span>
</span></span></code></p></div>
```

___

–•–æ—á–µ—à—å ‚Äî —è –º–æ–≥—É –æ–±–Ω–æ–≤–∏—Ç—å —Ç–µ–±–µ `docker-compose.yml`, —á—Ç–æ–±—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä `dbt` –≤—Å–µ–≥–¥–∞ –±—ã–ª –∞–∫—Ç–∏–≤–µ–Ω.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

18:38:55 \[WARNING\]: Deprecated functionality The `data-paths` config has been renamed to `seed-paths`. Please update your `dbt_project.yml` configuration to reflect this change. 18:38:55 Registered adapter: postgres=1.9.0 18:38:56 \[WARNING\]: Configuration paths exist in your dbt\_project.yml file which do not apply to any resources. There are 1 unused configuration paths: - seeds.dv\_postgres\_project

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–¢—ã –ø–æ–ª—É—á–∏–ª –¥–≤–∞ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ—Ç `dbt`, –∫–æ—Ç–æ—Ä—ã–µ –ª–µ–≥–∫–æ —É—Å—Ç—Ä–∞–Ω–∏—Ç—å:

___

### ‚ö†Ô∏è 1. –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: `data-paths` ‚Üí `seed-paths`

```
<div><p>text</p><p><code id="code-lang-text"><span><span>The `data-paths` config has been renamed to `seed-paths`.
</span></span></code></p></div>
```

**–†–µ—à–µ–Ω–∏–µ:** –≤ `dbt_project.yml` –∑–∞–º–µ–Ω–∏:

–Ω–∞:

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>seed-paths:</span></span><span> [</span><span><span>'seeds'</span></span><span>]
</span></span></code></p></div>
```

(–≤ —Ç–≤–æ—ë–º –ø—Ä–æ–µ–∫—Ç–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å —Å–∏–¥–∞–º–∏ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è `seeds`, –∞ –Ω–µ `data`)

___

### ‚ö†Ô∏è 2. –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: `seeds.dv_postgres_project` –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è

```
<div><p>text</p><p><code id="code-lang-text"><span><span>There are 1 unused configuration paths:
- seeds.dv_postgres_project
</span></span></code></p></div>
```

–≠—Ç–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —Ç—ã —É–∫–∞–∑–∞–ª –∫–∞—Å—Ç–æ–º–Ω—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É –¥–ª—è —Å–∏–¥–æ–≤, –Ω–æ `dbt` –Ω–µ –Ω–∞—à—ë–ª —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Å–∏–¥—ã –≤ —ç—Ç–æ–º namespace (–Ω–∞–ø—Ä–∏–º–µ—Ä, `seeds/dv_postgres_project/*.csv`).

**–†–µ—à–µ–Ω–∏—è:**

1.  **–õ–∏–±–æ –ø–µ—Ä–µ–º–µ—Å—Ç–∏ —Ñ–∞–π–ª `raw_customers.csv` –≤–Ω—É—Ç—Ä—å –ø–∞–ø–∫–∏ `seeds/dv_postgres_project/`**  
    –∏ –æ—Å—Ç–∞–≤—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é `seeds.dv_postgres_project` –≤ `dbt_project.yml`.
    
2.  **–õ–∏–±–æ —É–¥–∞–ª–∏/–Ω–µ —É–∫–∞–∑—ã–≤–∞–π –ø—É—Ç—å `seeds.dv_postgres_project`, –µ—Å–ª–∏ –∫–∞—Å—Ç–æ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–µ –Ω—É–∂–Ω—ã.**
    

___

### ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –∏—Ç–æ–≥–æ–≤—ã–π `dbt_project.yml`

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>name:</span></span><span> </span><span><span>'dv_postgres_project'</span></span><span>
</span><span><span>version:</span></span><span> </span><span><span>'1.0'</span></span><span>
</span><span><span>config-version:</span></span><span> </span><span><span>2</span></span><span>

</span><span><span>profile:</span></span><span> </span><span><span>'dv_postgres_profile'</span></span><span>

</span><span><span>target-path:</span></span><span> </span><span><span>'target'</span></span><span>
</span><span><span>clean-targets:</span></span><span>
  </span><span><span>-</span></span><span> </span><span><span>'target'</span></span><span>
  </span><span><span>-</span></span><span> </span><span><span>'dbt_modules'</span></span><span>

</span><span><span>model-paths:</span></span><span> [</span><span><span>'models'</span></span><span>]
</span><span><span>seed-paths:</span></span><span> [</span><span><span>'seeds'</span></span><span>]
</span><span><span>macro-paths:</span></span><span> [</span><span><span>'macros'</span></span><span>]
</span><span><span>test-paths:</span></span><span> [</span><span><span>'tests'</span></span><span>]

</span><span><span>models:</span></span><span>
  </span><span><span>dv_postgres_project:</span></span><span>
    </span><span><span>staging:</span></span><span>
      </span><span><span>+materialized:</span></span><span> </span><span><span>view</span></span><span>
    </span><span><span>marts:</span></span><span>
      </span><span><span>+materialized:</span></span><span> </span><span><span>table</span></span><span>
</span></span></code></p></div>
```

–ï—Å–ª–∏ —Ç—ã –≤—Å—ë-—Ç–∞–∫–∏ —Ö–æ—á–µ—à—å –∑–∞–¥–∞–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–∏–¥–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `quote_columns: false`), —Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ç–∞–∫–∞—è:

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>seeds:</span></span><span>
  </span><span><span>dv_postgres_project:</span></span><span>
    </span><span><span>raw_customers:</span></span><span>
      </span><span><span>quote_columns:</span></span><span> </span><span><span>false</span></span><span>
</span></span></code></p></div>
```

–ù–æ —Ç–æ–≥–¥–∞ —Ñ–∞–π–ª –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å: `seeds/dv_postgres_project/raw_customers.csv`.

___

–•–æ—á–µ—à—å ‚Äî –º–æ–≥—É —Å—Ä–∞–∑—É –≤—ã–¥–∞—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–∑–∞–ø—É—Å—Ç–∏–ª–æ—Å—å dbt –æ—Ç—Ä–∞–±–æ—Ç–∞–ª–æ –¥–∞–Ω–Ω—ã–µ —Å–æ–∑–¥–∞–ª–∏—Å—å –≤ postgres –≤ –ª–æ–≥–µ dbt: dbt-1 exited with code 0 —Ç–µ–ø–µ—Ä—å –¥–∞–≤–∞–π –ø—Ä–æ–¥–æ–∂–∏–º —Å –ø—Ä–æ–º–µ—Ç–µ—É—Å–æ–º –∏ –≥—Ä–∞—Ñ–∞–Ω–æ–π —è –∏—Ö –æ—Ç–∫—Ä—ã–ª –ø–æ —É–∫–∞–∑–∞–Ω–Ω—ã–º –∞–¥—Ä–µ—Å–∞–º —á—Ç–æ –¥–∞–ª—å—à–µ —Å –Ω–∏–º–∏ –¥–µ–ª–∞—Ç—å?

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–û—Ç–ª–∏—á–Ω–æ! –¢–µ–ø–µ—Ä—å, –∫–æ–≥–¥–∞ `dbt` –æ—Ç—Ä–∞–±–æ—Ç–∞–ª, –∏ –¥–∞–Ω–Ω—ã–µ –µ—Å—Ç—å –≤ PostgreSQL, –º–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å **Prometheus** –∏ **Grafana** –¥–ª—è —Å–±–æ—Ä–∞ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –º–µ—Ç—Ä–∏–∫. –û–ø–∏—à—É –ø–æ—à–∞–≥–æ–≤–æ:

___

## ‚úÖ –ß—Ç–æ —É –Ω–∞—Å —É–∂–µ –µ—Å—Ç—å

-   `dbt` —Ä–∞–±–æ—Ç–∞–µ—Ç.
    
-   PostgreSQL –∑–∞–ø—É—â–µ–Ω.
    
-   Prometheus –∏ Grafana –ø–æ–¥–Ω—è–ª–∏—Å—å –∏ –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ –∞–¥—Ä–µ—Å–∞–º (–ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º:
    
    -   Prometheus: [http://localhost:9090](http://localhost:9090/)
        
    -   Grafana: [http://localhost:3000](http://localhost:3000/))
        

___

## üß© –¶–µ–ª—å

–°–¥–µ–ª–∞—Ç—å —Ç–∞–∫, —á—Ç–æ–±—ã:

1.  `dbt` –∏–ª–∏ –æ–±—ë—Ä—Ç–∫–∞ –≤–æ–∫—Ä—É–≥ –Ω–µ–≥–æ –ø—É–±–ª–∏–∫–æ–≤–∞–ª–∞ –º–µ—Ç—Ä–∏–∫–∏ (—á–µ—Ä–µ–∑ `prometheus_client`).
    
2.  Prometheus –∏—Ö —Å–æ–±–∏—Ä–∞–ª.
    
3.  Grafana –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∞ –Ω–∞ –¥–∞—à–±–æ—Ä–¥–µ.
    

___

## üîß –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å Python-–º–µ—Ç—Ä–∏–∫ —ç–∫—Å–ø–æ—Ä—Ç–µ—Ä

–°–æ–∑–¥–∞—ë–º —Å–∫—Ä–∏–ø—Ç, –∫–æ—Ç–æ—Ä—ã–π —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –±–∞–∑–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –æ `dbt`\-–∑–∞–ø—É—Å–∫–∞—Ö:

### `metrics/exporter.py`:

```
<div><p>python</p><p><code id="code-lang-python"><span><span><span>from</span></span><span> prometheus_client </span><span><span>import</span></span><span> start_http_server, Counter, Gauge
</span><span><span>import</span></span><span> time

</span><span><span># –ú–µ—Ç—Ä–∏–∫–∏</span></span><span>
dbt_runs_total = Counter(</span><span><span>"dbt_runs_total"</span></span><span>, </span><span><span>"Total dbt runs"</span></span><span>)
dbt_runs_success = Counter(</span><span><span>"dbt_runs_success"</span></span><span>, </span><span><span>"Successful dbt runs"</span></span><span>)
dbt_runs_failed = Counter(</span><span><span>"dbt_runs_failed"</span></span><span>, </span><span><span>"Failed dbt runs"</span></span><span>)
dbt_run_duration = Gauge(</span><span><span>"dbt_run_duration_seconds"</span></span><span>, </span><span><span>"Duration of last dbt run"</span></span><span>)

</span><span><span># –°–∏–º—É–ª—è—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ dbt (–≤ –±–æ–µ–≤–æ–º –≤–∞—Ä–∏–∞–Ω—Ç–µ ‚Äî –ª–æ–≥–∏–∫–∞ –∑–∞–ø—É—Å–∫–∞ dbt –∑–¥–µ—Å—å)</span></span><span>
</span><span><span>def</span></span><span> </span><span><span>run_dbt_and_export_metrics</span></span><span>():
    </span><span><span>import</span></span><span> subprocess
    </span><span><span>import</span></span><span> time

    start_time = time.time()
    dbt_runs_total.inc()
    </span><span><span>try</span></span><span>:
        result = subprocess.run([</span><span><span>"dbt"</span></span><span>, </span><span><span>"run"</span></span><span>], check=</span><span><span>True</span></span><span>)
        dbt_runs_success.inc()
    </span><span><span>except</span></span><span> subprocess.CalledProcessError:
        dbt_runs_failed.inc()
    duration = time.time() - start_time
    dbt_run_duration.</span><span><span>set</span></span><span>(duration)

</span><span><span>if</span></span><span> __name__ == </span><span><span>"__main__"</span></span><span>:
    </span><span><span># HTTP endpoint –¥–ª—è Prometheus</span></span><span>
    start_http_server(</span><span><span>8000</span></span><span>)
    </span><span><span>while</span></span><span> </span><span><span>True</span></span><span>:
        run_dbt_and_export_metrics()
        time.sleep(</span><span><span>300</span></span><span>)  </span><span><span># –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç</span></span><span>
</span></span></code></p></div>
```

___

## üê≥ –®–∞–≥ 2: –î–æ–±–∞–≤—å —Å–µ—Ä–≤–∏—Å –≤ `docker-compose.yml`

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span>  </span><span><span>metrics-exporter:</span></span><span>
    </span><span><span>build:</span></span><span>
      </span><span><span>context:</span></span><span> </span><span><span>.</span></span><span>
      </span><span><span>dockerfile:</span></span><span> </span><span><span>metrics/Dockerfile</span></span><span>
    </span><span><span>volumes:</span></span><span>
      </span><span><span>-</span></span><span> </span><span><span>./dbt:/usr/app/dbt</span></span><span>
    </span><span><span>working_dir:</span></span><span> </span><span><span>/usr/app/dbt</span></span><span>
    </span><span><span>command:</span></span><span> [</span><span><span>"python"</span></span><span>, </span><span><span>"metrics/exporter.py"</span></span><span>]
    </span><span><span>ports:</span></span><span>
      </span><span><span>-</span></span><span> </span><span><span>"8000:8000"</span></span><span>
</span></span></code></p></div>
```

### `metrics/Dockerfile`:

```
<div><p>dockerfile</p><p><code id="code-lang-dockerfile"><span>FROM python:3.10-slim

WORKDIR /usr/app

RUN pip install prometheus_client dbt-core dbt-postgres

COPY . .

CMD ["python", "metrics/exporter.py"]
</span></code></p></div>
```

___

## üì° –®–∞–≥ 3: Prometheus –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–§–∞–π–ª `prometheus/prometheus.yml` –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å:

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>global:</span></span><span>
  </span><span><span>scrape_interval:</span></span><span> </span><span><span>15s</span></span><span>

</span><span><span>scrape_configs:</span></span><span>
  </span><span><span>-</span></span><span> </span><span><span>job_name:</span></span><span> </span><span><span>'dbt_metrics'</span></span><span>
    </span><span><span>static_configs:</span></span><span>
      </span><span><span>-</span></span><span> </span><span><span>targets:</span></span><span> [</span><span><span>'metrics-exporter:8000'</span></span><span>]
</span></span></code></p></div>
```

___

## üìà –®–∞–≥ 4: Grafana

1.  –ü–µ—Ä–µ–π–¥–∏ –≤ Grafana: [http://localhost:3000](http://localhost:3000/)  
    (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: **admin / admin**)
    
2.  –î–æ–±–∞–≤—å –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:
    
    -   **Configuration ‚Üí Data Sources**
        
    -   –¢–∏–ø: **Prometheus**
        
    -   URL: `http://prometheus:9090`
        
    -   –ù–∞–∂–º–∏ "Save & Test"
        
3.  –°–æ–∑–¥–∞–π Dashboard:
    
    -   New Dashboard ‚Üí Add Panel
        
    -   –ü—Ä–∏–º–µ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã:
        
        -   `dbt_runs_total`
            
        -   `dbt_runs_success`
            
        -   `dbt_runs_failed`
            
        -   `dbt_run_duration_seconds`
            

___

## üöÄ –†–µ–∑—É–ª—å—Ç–∞—Ç

–£ —Ç–µ–±—è –±—É–¥–µ—Ç:

-   —Ñ–æ–Ω–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å, —Ä–µ–≥—É–ª—è—Ä–Ω–æ –∑–∞–ø—É—Å–∫–∞—é—â–∏–π `dbt run` –∏ –ø—É–±–ª–∏–∫—É—é—â–∏–π –º–µ—Ç—Ä–∏–∫–∏
    
-   Prometheus, —Å–æ–±–∏—Ä–∞—é—â–∏–π –∏—Ö
    
-   Grafana, –æ—Ç–æ–±—Ä–∞–∂–∞—é—â–∞—è —Å—Ç–∞—Ç—É—Å
    

___

–•–æ—á–µ—à—å ‚Äî —è –º–æ–≥—É —Å—Ä–∞–∑—É —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã: `Dockerfile`, `exporter.py`, –∏ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π `docker-compose.yml`. –°–∫–∞–∂–∏.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–≤–æ–ø—Ä–æ—Å –±—ã–ª –ø—Ä–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ devault. –∏ –ø–æ—á–µ–º—É –æ–Ω –ø—Ä–æ–ø–∞–ª –∏–∑ –∫—É–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏?

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å. –î–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ, –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Ç—ã –ø—Ä–æ—Å–∏–ª –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **Data Vault (dbtvault)** —Å `dbt`, –Ω–æ –ø–æ–∑–∂–µ:

1.  –¢—ã –∑–∞—Ö–æ—Ç–µ–ª **–∏—Å–∫–ª—é—á–∏—Ç—å ClickHouse** –∏ –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ Postgres.
    
2.  –£ —Ç–µ–±—è –≤–æ–∑–Ω–∏–∫–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ `dbtvault>=0.9.2`, –ø–æ—Ç–æ–º—É —á—Ç–æ:
    
    -   `dbtvault` **–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ –Ω–µ –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è** –≤ PyPI.
        
    -   –ï–≥–æ –Ω—É–∂–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –∏–∑ –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤ (—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è GitHub), –ª–∏–±–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `pip install git+https://...`.
        

___

## –ü–æ—á–µ–º—É `dbtvault` –ø—Ä–æ–ø–∞–ª –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏?

–ß—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ —Ä–∞–±–æ—á–∏–π –ø—Ä–∏–º–µ—Ä –Ω–∞ `dbt + Postgres` –±–µ–∑ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤, —è –≤—Ä–µ–º–µ–Ω–Ω–æ –∏—Å–∫–ª—é—á–∏–ª `dbtvault`, –ø–æ—Ç–æ–º—É —á—Ç–æ:

-   –£—Å—Ç–∞–Ω–æ–≤–∫–∞ `dbtvault` —Å `pip install dbtvault>=0.9.2` –∑–∞–≤–µ—Ä—à–∞–ª–∞—Å—å **–æ—à–∏–±–∫–æ–π**.
    
-   –ù—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π —Å–ø–æ—Å–æ–± —É—Å—Ç–∞–Ω–æ–≤–∫–∏ (—á–µ—Ä–µ–∑ `git+https://...`), –∏ —ç—Ç–æ —Ç—Ä–µ–±—É–µ—Ç:
    
    -   –Ω–∞–ª–∏—á–∏—è `git` –≤ Docker-–æ–±—Ä–∞–∑–µ;
        
    -   –ª–∏–±–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è `dbtvault` –≤—Ä—É—á–Ω—É—é –≤ –ø—Ä–æ–µ–∫—Ç.
        

___

## –ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ —Ç—ã —Ö–æ—á–µ—à—å –≤–µ—Ä–Ω—É—Ç—å **dbtvault**?

–í–æ—Ç –∫–∞–∫ –º–æ–∂–Ω–æ —ç—Ç–æ —Å–¥–µ–ª–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:

___

### ‚úÖ –û–±–Ω–æ–≤–∏–º `Dockerfile` –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ dbtvault –∏–∑ GitHub:

```
<div><p>dockerfile</p><p><code id="code-lang-dockerfile"><span># Dockerfile (–≤ –∫–∞—Ç–∞–ª–æ–≥–µ ./dbt)
FROM python:3.10-slim

RUN apt-get update &amp;&amp; apt-get install -y git

WORKDIR /usr/app

RUN pip install --upgrade pip &amp;&amp; \
    pip install dbt-core dbt-postgres prometheus_client &amp;&amp; \
    pip install git+https://github.com/Datavault-UK/dbtvault.git@v0.9.2

COPY . .
</span></code></p></div>
```

___

### ‚úÖ –ü—Ä–∏–º–µ—Ä –º–æ–¥–µ–ª–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `dbtvault` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `hub_customers.sql`):

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span>{{ config(materialized</span><span><span>=</span></span><span><span>'table'</span></span><span>) }}

{{ hub(
    src_pk</span><span><span>=</span></span><span><span>'customer_id'</span></span><span>,
    src_nk</span><span><span>=</span></span><span><span>'customer_name'</span></span><span>,
    src_ldts</span><span><span>=</span></span><span><span>'created_at'</span></span><span>,
    src</span><span><span>=</span></span><span><span>'stg_customers'</span></span><span>,
    hub_name</span><span><span>=</span></span><span><span>'hub_customers'</span></span><span>
) }}
</span></span></code></p></div>
```

___

### ‚úÖ –ü—Ä–∏–º–µ—Ä `models/staging/stg_customers.sql`, –µ—Å–ª–∏ –∏—Å—Ç–æ—á–Ω–∏–∫ ‚Äî seed:

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span>{{ config(materialized</span><span><span>=</span></span><span><span>'view'</span></span><span>) }}

</span><span><span>select</span></span><span>
    id </span><span><span>as</span></span><span> customer_id,
    name </span><span><span>as</span></span><span> customer_name,
    created_at
</span><span><span>from</span></span><span> {{ </span><span><span>ref</span></span><span>(</span><span><span>'raw_customers'</span></span><span>) }}
</span></span></code></p></div>
```

___

### ‚úÖ –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π `dbt_project.yml`

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>models:</span></span><span>
  </span><span><span>dv_postgres_project:</span></span><span>
    </span><span><span>staging:</span></span><span>
      </span><span><span>+materialized:</span></span><span> </span><span><span>view</span></span><span>
    </span><span><span>vault:</span></span><span>
      </span><span><span>+materialized:</span></span><span> </span><span><span>table</span></span><span>
</span></span></code></p></div>
```

___

## ‚úçÔ∏è –ò—Ç–æ–≥

–¢—ã –º–æ–∂–µ—à—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **dbtvault —Å Postgres**, –Ω–æ –Ω—É–∂–Ω–æ:

-   —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –µ–≥–æ –∏–∑ GitHub;
    
-   –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–¥–µ–ª–∏ —Ç–∏–ø–∞ `hub`, `link`, `satellite` –∏ —Ç.–ø.;
    
-   —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ staging-–º–æ–¥–µ–ª–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ã –ø–æ–¥ —Ñ–æ—Ä–º–∞—Ç Data Vault.
    

___

–•–æ—á–µ—à—å ‚Äî —è –ø–µ—Ä–µ—Å–æ–±–µ—Ä—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞ —Å `dbtvault` –∏ –ø—Ä–∏–º–µ—Ä–æ–º `hub`/`satellite`. –ü—Ä–æ–¥–æ–ª–∂–∏–º?

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–¥–∞–≤–∞–π –Ω–∞ —à–∞–≥ –Ω–∞–∑–∞–¥ python: can't open file '/usr/app/dbt/metrics/exporter.py': \[Errno 2\] No such file or directory –ø—Ä–∏ —ç—Ç–æ–º –≤ –ø–∞–ø–∫–∞ metrics –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ - —Ä—è–¥–æ–º —Å dbt docker-compose: metrics-exporter: build: context: . dockerfile: metrics/Dockerfile volumes: - ./dbt:/usr/app/dbt working\_dir: /usr/app/dbt command: \["python", "metrics/exporter.py"\] ports: - "8000:8000" metrics/Dockerfile: FROM python:3.10-slim WORKDIR /usr/app RUN pip install prometheus\_client dbt-core dbt-postgres COPY . . CMD \["python", "metrics/exporter.py"\]

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–ü—Ä–æ–±–ª–µ–º–∞ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –ø–æ—Ç–æ–º—É, —á—Ç–æ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Ñ–∞–π–ª `metrics/exporter.py` **–Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è** –ø–æ –æ–∂–∏–¥–∞–µ–º–æ–º—É –ø—É—Ç–∏ `/usr/app/dbt/metrics/exporter.py`.

–†–∞–∑–±–µ—Ä—ë–º—Å—è –ø–æ—à–∞–≥–æ–≤–æ:

___

### üìÇ –¢–µ–∫—É—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
<div><p><code><span><span>.
‚îú‚îÄ‚îÄ dbt/
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ metrics/
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îî‚îÄ‚îÄ exporter.py
‚îú‚îÄ‚îÄ docker-compose.yml
</span></span></code></p></div>
```

___

### ‚ùå –ß—Ç–æ —Å–µ–π—á–∞—Å –¥–µ–ª–∞–µ—Ç Dockerfile –∏ Compose

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>metrics-exporter:</span></span><span>
  </span><span><span>build:</span></span><span>
    </span><span><span>context:</span></span><span> </span><span><span>.</span></span><span>
    </span><span><span>dockerfile:</span></span><span> </span><span><span>metrics/Dockerfile</span></span><span>
  </span><span><span>volumes:</span></span><span>
    </span><span><span>-</span></span><span> </span><span><span>./dbt:/usr/app/dbt</span></span><span>
  </span><span><span>working_dir:</span></span><span> </span><span><span>/usr/app/dbt</span></span><span>
  </span><span><span>command:</span></span><span> [</span><span><span>"python"</span></span><span>, </span><span><span>"metrics/exporter.py"</span></span><span>]
</span></span></code></p></div>
```

-   –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä **—Å–æ–±–∏—Ä–∞–µ—Ç—Å—è** –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ `.` (–≤—Å—ë –≤–∏–¥–Ω–æ, –≤ —Ç–æ–º —á–∏—Å–ª–µ `metrics/exporter.py`);
    
-   –ù–û: –ø–æ—Ç–æ–º —Ç—ã **–ø–µ—Ä–µ–∫—Ä—ã–≤–∞–µ—à—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞** —á–µ—Ä–µ–∑ volume:
    

–¢–æ –µ—Å—Ç—å –≤–µ—Å—å –ø—É—Ç—å `/usr/app/dbt` —Ç–µ–ø–µ—Ä—å —Å–æ–¥–µ—Ä–∂–∏—Ç **—Ç–æ–ª—å–∫–æ —Ñ–∞–π–ª—ã –∏–∑ `./dbt`**, –∞ `metrics/exporter.py` ‚Äî **—Ç–µ—Ä—è–µ—Ç—Å—è**.

___

### ‚úÖ –ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å

#### ‚úÖ –í–∞—Ä–∏–∞–Ω—Ç 1: –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ `exporter.py` –≤–Ω—É—Ç—Ä—å `./dbt`

–ï—Å–ª–∏ —Ç—ã —Ö–æ—á–µ—à—å **–æ—Å—Ç–∞–≤–∏—Ç—å volume**, —Ç–æ –ø–µ—Ä–µ–º–µ—Å—Ç–∏ `metrics/exporter.py` –≤ `./dbt/metrics/exporter.py`.

```
<div><p><code><span><span>.
‚îú‚îÄ‚îÄ dbt/
‚îÇ   ‚îú‚îÄ‚îÄ metrics/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ exporter.py
</span></span></code></p></div>
```

–¢–æ–≥–¥–∞ –≤—Å—ë –∑–∞—Ä–∞–±–æ—Ç–∞–µ—Ç, –ø–æ—Ç–æ–º—É —á—Ç–æ volume `./dbt` –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Å–æ–¥–µ—Ä–∂–∏—Ç `metrics/exporter.py`.

___

#### ‚úÖ –í–∞—Ä–∏–∞–Ω—Ç 2: –∏–∑–º–µ–Ω–∏—Ç—å volume

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å **–æ—Å—Ç–∞–≤–∏—Ç—å `metrics/exporter.py` –≤ –ø–∞–ø–∫–µ `metrics/`**, —Ç–æ–≥–¥–∞ **–Ω–µ –Ω—É–∂–Ω–æ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å `./dbt`** –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>metrics-exporter:</span></span><span>
  </span><span><span>build:</span></span><span>
    </span><span><span>context:</span></span><span> </span><span><span>.</span></span><span>
    </span><span><span>dockerfile:</span></span><span> </span><span><span>metrics/Dockerfile</span></span><span>
  </span><span><span>working_dir:</span></span><span> </span><span><span>/usr/app</span></span><span>
  </span><span><span>command:</span></span><span> [</span><span><span>"python"</span></span><span>, </span><span><span>"metrics/exporter.py"</span></span><span>]
  </span><span><span>ports:</span></span><span>
    </span><span><span>-</span></span><span> </span><span><span>"8000:8000"</span></span><span>
</span></span></code></p></div>
```

–í —ç—Ç–æ–º —Å–ª—É—á–∞–µ:

-   –í `metrics/Dockerfile` —Ç—ã –¥–µ–ª–∞–µ—à—å `COPY . .`, –∏ `metrics/exporter.py` –æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ –ø—É—Ç–∏ `/usr/app/metrics/exporter.py`.
    

___

### ‚úçÔ∏è –í—ã–≤–æ–¥

-   üí° –ï—Å–ª–∏ —Ç—ã –º–æ–Ω—Ç–∏—Ä—É–µ—à—å volume `./dbt:/usr/app/dbt` ‚Äî **–≤—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ –∏—Å—á–µ–∑–∞–µ—Ç** –∏–∑ `/usr/app/dbt`, –∫—Ä–æ–º–µ `./dbt`.
    
-   üìÅ –ò–ª–∏ –ø–µ—Ä–µ–º–µ—Å—Ç–∏ `exporter.py` –≤ `./dbt/metrics/`, –∏–ª–∏ —É–±–µ—Ä–∏ volume –≤ —Å–µ—Ä–≤–∏—Å–µ `metrics-exporter`.
    

–•–æ—á–µ—à—å ‚Äî —è —Å—Ä–∞–∑—É –ø—Ä–∏—à–ª—é —Ä–∞–±–æ—á–∏–π `docker-compose.yml` –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞ –ø–æ–¥ –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–∑–∞—Ä–∞–±–æ—Ç–∞–ª–æ –≤–µ—Ä–Ω—ë–º—Å—è –∫ dbtvault –≤ –∫–∞–∫–æ–π –ø–∞–ø–∫–µ —Å–æ–∑–¥–∞—Ç—å hub\_customers.sql ?

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–û—Ç–ª–∏—á–Ω–æ, —á—Ç–æ –∑–∞—Ä–∞–±–æ—Ç–∞–ª–æ! üöÄ

–ü–æ –ø–æ–≤–æ–¥—É **dbtvault** –∏ —Ñ–∞–π–ª–∞ `hub_customers.sql` ‚Äî –¥–∞–≤–∞–π —Ä–∞–∑–±–µ—Ä—ë–º—Å—è —Å —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ–º –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π.

___

### –ì–¥–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å `hub_customers.sql`?

–í —Ç–∏–ø–∏—á–Ω–æ–º dbt-–ø—Ä–æ–µ–∫—Ç–µ —Å Data Vault –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π –µ—Å—Ç—å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π –ø–æ —Å–ª–æ—è–º. –û–±—ã—á–Ω–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–∫–∞—è:

```
<div><p>bash</p><p><code><span><span>models/
‚îú‚îÄ‚îÄ staging/    </span><span><span># –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ –æ—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö</span></span><span>
‚îú‚îÄ‚îÄ hubs/       </span><span><span># hub-–º–æ–¥–µ–ª–∏ (–∫–ª—é—á–µ–≤—ã–µ –±–∏–∑–Ω–µ—Å-—Å—É—â–Ω–æ—Å—Ç–∏)</span></span><span>
‚îú‚îÄ‚îÄ links/      </span><span><span># link-–º–æ–¥–µ–ª–∏ (—Å–≤—è–∑–∏ –º–µ–∂–¥—É hub'–∞–º–∏)</span></span><span>
‚îú‚îÄ‚îÄ satellites/ </span><span><span># satellite-–º–æ–¥–µ–ª–∏ (–æ–ø–∏—Å–∞—Ç–µ–ª—å–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã)</span></span><span>
‚îú‚îÄ‚îÄ marts/      </span><span><span># –¥–∞—Ç–∞-–º–∞—Ä—Ç—ã (—Ñ–∏–Ω–∞–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏)</span></span><span>
</span></span></code></p></div>
```

–ü–æ—ç—Ç–æ–º—É:

-   –§–∞–π–ª `hub_customers.sql` –ª–æ–≥–∏—á–Ω–æ –ø–æ–ª–æ–∂–∏—Ç—å –≤ –ø–∞–ø–∫—É `models/hubs/`.
    

___

### –ü—Ä–∏–º–µ—Ä:

```
<div><p>markdown</p><p><code><span><span>models/
‚îî‚îÄ‚îÄ hubs/
<span>    ‚îî‚îÄ‚îÄ hub_customers.sql
</span></span></span></code></p></div>
```

___

### –ü–æ—á–µ–º—É —Ç–∞–∫?

-   Hub ‚Äî —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç Data Vault, –æ–Ω –æ–ø–∏—Å—ã–≤–∞–µ—Ç –∫–ª—é—á–µ–≤—É—é –±–∏–∑–Ω–µ—Å-—Å—É—â–Ω–æ—Å—Ç—å.
    
-   –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ø–∞–ø–∫–∞–º –ø–æ–º–æ–≥–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç, –ª–µ–≥–∫–æ –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å –≤–µ—Ä—Å–∏—è–º–∏.
    
-   –í dbt\_project.yml –æ–±—ã—á–Ω–æ —É–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –ø—É—Ç–∏ `models: ['models']` –∏–ª–∏ –º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –∫–∞–∂–¥–æ–π –ø–∞–ø–∫–∏.
    

___

### –ö—Ä–∞—Ç–∫–∏–π –ø—Ä–∏–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ `hub_customers.sql` –¥–ª—è Data Vault (Postgres):

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span>{{ config(materialized</span><span><span>=</span></span><span><span>'table'</span></span><span>) }}

</span><span><span>select</span></span><span>
    customer_id </span><span><span>as</span></span><span> hub_customer_key,
    </span><span><span>current_timestamp</span></span><span> </span><span><span>as</span></span><span> load_date,
    </span><span><span>'source_system'</span></span><span> </span><span><span>as</span></span><span> record_source
</span><span><span>from</span></span><span> {{ </span><span><span>ref</span></span><span>(</span><span><span>'stg_customers'</span></span><span>) }}
</span></span></code></p></div>
```

–ó–¥–µ—Å—å:

-   `hub_customer_key` ‚Äî –∫–ª—é—á–µ–≤–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä.
    
-   `load_date` ‚Äî –¥–∞—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–ø–∏—Å–∏.
    
-   `record_source` ‚Äî –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö.
    

___

### –ï—Å–ª–∏ —Ö–æ—á–µ—à—å, –º–æ–≥—É –ø–æ–º–æ—á—å –Ω–∞–ø–∏—Å–∞—Ç—å —à–∞–±–ª–æ–Ω –¥–ª—è hub, link –∏ satellite ‚Äî —Å–∫–∞–∂–∏!

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–ø—Ä–∏—à–ª–∏ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π dbt\_project.yml

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–í–æ—Ç –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π `dbt_project.yml` —Å —É—á—ë—Ç–æ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–ª—è Data Vault (hub, link, satellite):

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>name:</span></span><span> </span><span><span>'dv_postgres_project'</span></span><span>
</span><span><span>version:</span></span><span> </span><span><span>'1.0'</span></span><span>
</span><span><span>config-version:</span></span><span> </span><span><span>2</span></span><span>

</span><span><span>profile:</span></span><span> </span><span><span>'dv_postgres_profile'</span></span><span>

</span><span><span>target-path:</span></span><span> </span><span><span>'target'</span></span><span>
</span><span><span>clean-targets:</span></span><span>
  </span><span><span>-</span></span><span> </span><span><span>'target'</span></span><span>
  </span><span><span>-</span></span><span> </span><span><span>'dbt_modules'</span></span><span>

</span><span><span>model-paths:</span></span><span> [</span><span><span>'models'</span></span><span>]
</span><span><span>data-paths:</span></span><span> [</span><span><span>'data'</span></span><span>]
</span><span><span>macro-paths:</span></span><span> [</span><span><span>'macros'</span></span><span>]
</span><span><span>test-paths:</span></span><span> [</span><span><span>'tests'</span></span><span>]

</span><span><span>models:</span></span><span>
  </span><span><span>dv_postgres_project:</span></span><span>
    </span><span><span>staging:</span></span><span>
      </span><span><span>+materialized:</span></span><span> </span><span><span>view</span></span><span>
    </span><span><span>hubs:</span></span><span>
      </span><span><span>+materialized:</span></span><span> </span><span><span>table</span></span><span>
    </span><span><span>links:</span></span><span>
      </span><span><span>+materialized:</span></span><span> </span><span><span>table</span></span><span>
    </span><span><span>satellites:</span></span><span>
      </span><span><span>+materialized:</span></span><span> </span><span><span>table</span></span><span>
    </span><span><span>marts:</span></span><span>
      </span><span><span>+materialized:</span></span><span> </span><span><span>table</span></span><span>
</span></span></code></p></div>
```

___

### –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:

-   –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –º–æ–¥–µ–ª–µ–π: `hubs`, `links`, `satellites` ‚Äî —Å –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π –∫–∞–∫ `table`.
    
-   –û—Å—Ç–∞–ª—å–Ω–æ–µ –æ—Å—Ç–∞–ª–æ—Å—å —Ç–∞–∫ –∂–µ: `staging` ‚Äî –∫–∞–∫ `view`, `marts` ‚Äî —Ç–∞–±–ª–∏—Ü—ã.
    

–ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å —Å `profiles.yml` –∏–ª–∏ –ø—Ä–∏–º–µ—Ä–∞–º–∏ –º–æ–¥–µ–ª–µ–π ‚Äî —Å–∫–∞–∂–∏!

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–∏ –≤ —á—ë–º —Ç—É—Ç –ø—Ä–∏–Ω—Ü–∏–ø–∏–∞–ª—å–Ω–∞—è –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ dbvault

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å! –í–æ—Ç –ø—Ä–∏–Ω—Ü–∏–ø–∏–∞–ª—å–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∏ –∫–∞–∫ –æ–Ω–∏ –æ—Ç—Ä–∞–∂–∞—é—Ç—Å—è –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ –ø–æ–¥—Ö–æ–¥–µ —Å dbtvault:

___

### –ü—Ä–∏–Ω—Ü–∏–ø–∏–∞–ª—å–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ Data Vault –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ dbtvault –≤ `dbt_project.yml`

1.  **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π –Ω–∞ —Ö–∞–±—ã, —Å—Å—ã–ª–∫–∏ –∏ —Å–∞—Ç–µ–ª–ª–∏—Ç—ã**
    

-   **Hub (—Ü–µ–Ω—Ç—Ä—ã)** ‚Äî —Ö—Ä–∞–Ω—è—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –±–∏–∑–Ω–µ—Å-–∫–ª—é—á–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `customer_id`).
    
-   **Link (—Å–≤—è–∑–∏)** ‚Äî –æ–ø–∏—Å—ã–≤–∞—é—Ç –æ—Ç–Ω–æ—à–µ–Ω–∏—è –º–µ–∂–¥—É —Ö–∞–±–∞–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–≤—è–∑—å –º–µ–∂–¥—É –∫–ª–∏–µ–Ω—Ç–æ–º –∏ –∑–∞–∫–∞–∑–æ–º).
    
-   **Satellite (—Å–∞—Ç–µ–ª–ª–∏—Ç—ã)** ‚Äî —Å–æ–¥–µ—Ä–∂–∞—Ç –æ–ø–∏—Å–∞—Ç–µ–ª—å–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã, –º–µ–Ω—è—é—â–∏–µ—Å—è –≤–æ –≤—Ä–µ–º–µ–Ω–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∞–¥—Ä–µ—Å –∫–ª–∏–µ–Ω—Ç–∞, —Ç–µ–ª–µ—Ñ–æ–Ω).
    

–í `dbt_project.yml` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–∑ —ç—Ç–∏—Ö —Å–ª–æ—ë–≤ –∑–∞–¥–∞—ë—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥ (`hubs/`, `links/`, `satellites/`) –∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è ‚Äî –æ–±—ã—á–Ω–æ —Ç–∞–±–ª–∏—Ü—ã.

2.  **–ò–∑–æ–ª—è—Ü–∏—è –∏ –≥–∏–±–∫–æ—Å—Ç—å**
    

–ö–∞–∂–¥—ã–π —Å–ª–æ–π –º–æ–¥–µ–ª–µ–π –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Å–≤–æ–π –∞—Å–ø–µ–∫—Ç –¥–∞–Ω–Ω—ã—Ö, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª–µ–≥—á–µ –æ–±–Ω–æ–≤–ª—è—Ç—å –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —á–∞—Å—Ç–∏ –±–µ–∑ –≤–ª–∏—è–Ω–∏—è –Ω–∞ –¥—Ä—É–≥–∏–µ.

3.  **–ò—Å—Ç–æ—Ä–∏—á–Ω–æ—Å—Ç—å –∏ —Ç—Ä–∞—Å—Å–∏—Ä—É–µ–º–æ—Å—Ç—å**
    

–°–∞—Ç–µ–ª–ª–∏—Ç—ã –¥–∞—é—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ö—Ä–∞–Ω–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π, —á—Ç–æ –≤–∞–∂–Ω–æ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏ –∞—É–¥–∏—Ç–∞.

4.  **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–∫–µ—Ç–∞ dbtvault**
    

-   dbtvault –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≥–æ—Ç–æ–≤—ã–µ –º–∞–∫—Ä–æ—Å—ã –∏ —à–∞–±–ª–æ–Ω—ã, —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä—É—é—â–∏–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ö–∞–±–æ–≤, —Å—Å—ã–ª–æ–∫ –∏ —Å–∞—Ç–µ–ª–ª–∏—Ç–æ–≤.
    
-   –ü–æ–∑–≤–æ–ª—è–µ—Ç –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ –æ–ø–∏—Å—ã–≤–∞—Ç—å –º–æ–¥–µ–ª–∏ (—É–∫–∞–∑—ã–≤–∞—è –±–∏–∑–Ω–µ—Å-–∫–ª—é—á–∏, –∞—Ç—Ä–∏–±—É—Ç—ã –∏ –ø—Ä.), –∞ dbtvault —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω—É–∂–Ω—ã–π SQL.
    

5.  **–í –∫–æ–Ω—Ñ–∏–≥–µ dbt**
    

-   –í—ã —Å–æ–∑–¥–∞—ë—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø–∞–ø–∫–∏ –¥–ª—è hub, link, satellite –º–æ–¥–µ–ª–µ–π ‚Äî –∏ –∑–∞–¥–∞—ë—Ç–µ –∏–º –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—é —Ç–∞–±–ª–∏—Ü—ã (—á—Ç–æ–±—ã –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è–ª–∏—Å—å –∏ –±—ã–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã).
    
-   –≠—Ç–æ —É–ø—Ä–æ—â–∞–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ, –≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç —Å–ø–ª–æ—à–Ω–æ–≥–æ –º–æ–Ω–æ–ª–∏—Ç–Ω–æ–≥–æ —Å–ª–æ—è –º–æ–¥–µ–ª–µ–π.
    

___

### –ò—Ç–æ–≥

–í `dbt_project.yml` –æ—Ç—Ä–∞–∂–∞–µ—Ç—Å—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ Data Vault ‚Äî —Ä–∞–∑–Ω—ã–µ –ø–∞–ø–∫–∏ –∏ –ø—Ä–∞–≤–∏–ª–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–ª—è –∫–ª—é—á–µ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤. –≠—Ç–æ –∑–∞–¥–∞—ë—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ —É–ø—Ä–∞–≤–ª—è–µ–º–æ—Å—Ç—å, –¥–∞—ë—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ —Å—Ç—Ä–æ–∏—Ç—å Data Vault —Å –ø–æ–º–æ—â—å—é dbtvault, –∏ –≤ –∏—Ç–æ–≥–µ ‚Äî –≥–∏–±–∫–æ –∏ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –∏—Å—Ç–æ—Ä–∏—á–Ω—ã–º–∏, —Å–≤—è–∑–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.

___

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, –º–æ–≥—É –ø–æ–º–æ—á—å –Ω–∞–ø–∏—Å–∞—Ç—å –ø—Ä–∏–º–µ—Ä –ø—Ä–æ—Å—Ç–æ–π hub-–º–æ–¥–µ–ª–∏ —Å dbtvault, —á—Ç–æ–±—ã –ª—É—á—à–µ –ø–æ–∫–∞–∑–∞—Ç—å —ç—Ç–æ –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–¥–∞–≤–∞–π –ø—Ä–∏–º–µ—Ä –¥–ª—è –º–æ–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–ö–æ–Ω–µ—á–Ω–æ! –í–æ—Ç –ø—Ä–∏–º–µ—Ä –ø—Ä–æ—Å—Ç–æ–π **hub-–º–æ–¥–µ–ª–∏** –¥–ª—è –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `dbtvault`. –ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å —Å—É—â–Ω–æ—Å—Ç—å Customer, –∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å–æ–∑–¥–∞—Ç—å —Ö–∞–± –¥–ª—è –Ω–µ—ë.

___

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫ –≤ –≤–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ (–ø—Ä–∏–º–µ—Ä):

```
<div><p>markdown</p><p><code><span><span>models/
  hubs/
<span>    hub_customers.sql
  links/
  satellites/
</span></span></span></code></p></div>
```

___

### –ü—Ä–∏–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Ñ–∞–π–ª–∞ `models/hubs/hub_customers.sql`

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span>{{ 
  config(
    materialized</span><span><span>=</span></span><span><span>'table'</span></span><span>
  ) 
}}

</span><span><span>-- –ü—Ä–∏–º–µ—Ä –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è —Ö–∞–±–∞ —Å –ø–æ–º–æ—â—å—é dbtvault</span></span><span>
{{ dbtvault.hub(
    source </span><span><span>=</span></span><span> </span><span><span>ref</span></span><span>(</span><span><span>'stg_customers'</span></span><span>),     </span><span><span>-- —Å—Å—ã–ª–∫–∞ –Ω–∞ —Å—Ç–∞–¥–∏—é —Å –¥–∞–Ω–Ω—ã–º–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä staging –º–æ–¥–µ–ª—å</span></span><span>
    hub_name </span><span><span>=</span></span><span> </span><span><span>'customers'</span></span><span>,             </span><span><span>-- –∏–º—è —Ö–∞–±–∞ (—Ç–∞–±–ª–∏—Ü—ã –±–µ–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞ hub_)</span></span><span>
    business_key </span><span><span>=</span></span><span> </span><span><span>'customer_id'</span></span><span>,       </span><span><span>-- –±–∏–∑–Ω–µ—Å-–∫–ª—é—á</span></span><span>
    load_date </span><span><span>=</span></span><span> </span><span><span>'created_at'</span></span><span>             </span><span><span>-- –ø–æ–ª–µ –¥–∞—Ç—ã –∑–∞–≥—Ä—É–∑–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</span></span><span>
) }}
</span></span></code></p></div>
```

___

### –û–±—ä—è—Å–Ω–µ–Ω–∏–µ:

-   `dbtvault.hub` ‚Äî —ç—Ç–æ –º–∞–∫—Ä–æ—Å –∏–∑ –ø–∞–∫–µ—Ç–∞ `dbtvault`, –∫–æ—Ç–æ—Ä—ã–π —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç SQL –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ö–∞–±–∞.
    
-   `source` ‚Äî —Å—Å—ã–ª–∫–∞ –Ω–∞ staging –º–æ–¥–µ–ª—å, –≥–¥–µ –µ—Å—Ç—å "—Å—ã—Ä—ã–µ" –¥–∞–Ω–Ω—ã–µ —Å –Ω—É–∂–Ω—ã–º–∏ –ø–æ–ª—è–º–∏.
    
-   `hub_name` ‚Äî –∏–º—è —Ç–∞–±–ª–∏—Ü—ã –±–µ–∑ –ø—Ä–∏—Å—Ç–∞–≤–∫–∏ `hub_`, –ø–æ —Å–æ–≥–ª–∞—à–µ–Ω–∏—é dbtvault –ø—Ä–µ—Ñ–∏–∫—Å –¥–æ–±–∞–≤–∏—Ç —Å–∞–º.
    
-   `business_key` ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–ª—é—á (–Ω–∞–ø—Ä–∏–º–µ—Ä, `customer_id`).
    
-   `load_date` ‚Äî –ø–æ–ª–µ —Å –¥–∞—Ç–æ–π –∑–∞–≥—Ä—É–∑–∫–∏/—Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏ (–¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω–æ–π –º–µ—Ç–∫–∏).
    

___

### –ß—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ `dbt_project.yml` –¥–ª—è hub-–º–æ–¥–µ–ª–µ–π

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>models:</span></span><span>
  </span><span><span>dv_postgres_project:</span></span><span>
    </span><span><span>hubs:</span></span><span>
      </span><span><span>+materialized:</span></span><span> </span><span><span>table</span></span><span>
    </span><span><span>links:</span></span><span>
      </span><span><span>+materialized:</span></span><span> </span><span><span>table</span></span><span>
    </span><span><span>satellites:</span></span><span>
      </span><span><span>+materialized:</span></span><span> </span><span><span>table</span></span><span>
</span></span></code></p></div>
```

___

### –ß—Ç–æ –µ—â–µ –Ω–∞–¥–æ

-   –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å staging –º–æ–¥–µ–ª—å `stg_customers`, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ—Ç –Ω—É–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.
    
-   `dbtvault` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –ø–æ–¥–∫–ª—é—á—ë–Ω —á–µ—Ä–µ–∑ `packages.yml`.
    
-   –í `profiles.yml` –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ.
    
-   –ó–∞–ø—É—Å–∫–∞–µ—Ç–µ `dbt run` ‚Äî dbtvault —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∏ —Å–æ–∑–¥–∞—Å—Ç —Ö–∞–±.
    

___

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å ‚Äî –º–æ–≥—É –ø–æ–º–æ—á—å —Å–¥–µ–ª–∞—Ç—å –ø—Ä–∏–º–µ—Ä—ã –¥–ª—è link –∏ satellite –º–æ–¥–µ–ª–µ–π.  
–ò–ª–∏ —Å—Ä–∞–∑—É –ø–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª–Ω—ã–π workflow –ø–æ dbtvault –¥–ª—è —Ç–≤–æ–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–Ω—É–∂–Ω—ã –ø—Ä–∏–º–µ—Ä—ã –¥–ª—è link –∏ satellite –º–æ–¥–µ–ª–µ–π

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–ö–æ–Ω–µ—á–Ω–æ! –í–æ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –¥–ª—è –º–æ–¥–µ–ª–µ–π **link** –∏ **satellite** —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `dbtvault` –≤ —Ç–≤–æ—ë–º –ø—Ä–æ–µ–∫—Ç–µ.

___

## 1\. –ü—Ä–∏–º–µ—Ä Link –º–æ–¥–µ–ª–∏

–§–∞–π–ª: `models/links/link_customer_orders.sql`

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span>{{
  config(
    materialized</span><span><span>=</span></span><span><span>'table'</span></span><span>
  )
}}

{{ dbtvault.link(
    source </span><span><span>=</span></span><span> </span><span><span>ref</span></span><span>(</span><span><span>'stg_orders'</span></span><span>),       </span><span><span>-- staging –º–æ–¥–µ–ª—å —Å –∑–∞–∫–∞–∑–∞–º–∏</span></span><span>
    link_name </span><span><span>=</span></span><span> </span><span><span>'customer_orders'</span></span><span>,    </span><span><span>-- –∏–º—è –ª–∏–Ω–∫–∞ –±–µ–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞ link_</span></span><span>
    hubs </span><span><span>=</span></span><span> [</span><span><span>'customers'</span></span><span>, </span><span><span>'orders'</span></span><span>],   </span><span><span>-- —Å–ø–∏—Å–æ–∫ —Ö–∞–±–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —Å–≤—è–∑—ã–≤–∞–µ—Ç –ª–∏–Ω–∫</span></span><span>
    load_date </span><span><span>=</span></span><span> </span><span><span>'order_date'</span></span><span>,          </span><span><span>-- –¥–∞—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–∞—Ç–∞ –∑–∞–∫–∞–∑–∞)</span></span><span>
    source_key_map </span><span><span>=</span></span><span> {                 </span><span><span>-- –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–ª—é—á–µ–π –∏–∑ source –≤ –±–∏–∑–Ω–µ—Å-–∫–ª—é—á–∏ —Ö–∞–±–æ–≤</span></span><span>
        </span><span><span>'customer_id'</span></span><span>: </span><span><span>'customer_id'</span></span><span>,
        </span><span><span>'order_id'</span></span><span>: </span><span><span>'order_id'</span></span><span>
    }
) }}
</span></span></code></p></div>
```

### –ü–æ—è—Å–Ω–µ–Ω–∏–µ:

-   `link_name` ‚Äî –∏–º—è —Å—Å—ã–ª–∫–∏ –±–µ–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞ `link_`.
    
-   `hubs` ‚Äî —Å–ø–∏—Å–æ–∫ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Ö–∞–±–æ–≤.
    
-   `source_key_map` ‚Äî –º–∞–ø–ø–∏–Ω–≥ –∏–∑ —Å—Ç–æ–ª–±—Ü–æ–≤ –∏—Å—Ö–æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã –≤ –±–∏–∑–Ω–µ—Å-–∫–ª—é—á–∏ —Ö–∞–±–æ–≤.
    

___

## 2\. –ü—Ä–∏–º–µ—Ä Satellite –º–æ–¥–µ–ª–∏

–§–∞–π–ª: `models/satellites/sat_customer_details.sql`

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span>{{
  config(
    materialized</span><span><span>=</span></span><span><span>'table'</span></span><span>
  )
}}

{{ dbtvault.satellite(
    source </span><span><span>=</span></span><span> </span><span><span>ref</span></span><span>(</span><span><span>'stg_customers'</span></span><span>),
    satellite_name </span><span><span>=</span></span><span> </span><span><span>'customer_details'</span></span><span>,  </span><span><span>-- –∏–º—è —Å–∞—Ç–µ–ª–ª–∏—Ç–∞ –±–µ–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞ sat_</span></span><span>
    hub_name </span><span><span>=</span></span><span> </span><span><span>'customers'</span></span><span>,                </span><span><span>-- —Å–≤—è–∑–∞–Ω–Ω—ã–π —Ö–∞–±</span></span><span>
    load_date </span><span><span>=</span></span><span> </span><span><span>'created_at'</span></span><span>,              </span><span><span>-- –¥–∞—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏/–∏–∑–º–µ–Ω–µ–Ω–∏—è</span></span><span>
    attributes </span><span><span>=</span></span><span> [                         </span><span><span>-- —Å–ø–∏—Å–æ–∫ –∞—Ç—Ä–∏–±—É—Ç–æ–≤ —Å–∞—Ç–µ–ª–ª–∏—Ç–∞ (–≤—Å–µ –∫—Ä–æ–º–µ –±–∏–∑–Ω–µ—Å-–∫–ª—é—á–∞ –∏ –¥–∞—Ç—ã)</span></span><span>
      </span><span><span>'customer_name'</span></span><span>,
      </span><span><span>'city'</span></span><span>,
      </span><span><span>'email'</span></span><span>
    ]
) }}
</span></span></code></p></div>
```

### –ü–æ—è—Å–Ω–µ–Ω–∏–µ:

-   `satellite_name` ‚Äî –∏–º—è —Å–∞—Ç–µ–ª–ª–∏—Ç–∞ –±–µ–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞ `sat_`.
    
-   `hub_name` ‚Äî –∏–º—è —Å–≤—è–∑–∞–Ω–Ω–æ–≥–æ —Ö–∞–±–∞.
    
-   `attributes` ‚Äî –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≤ —Å–∞—Ç–µ–ª–ª–∏—Ç–µ.
    

___

## –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫ —Å –º–æ–¥–µ–ª—è–º–∏

```
<div><p>pgsql</p><p><code><span><span>models/
  hubs/
    hub_customers.</span><span><span>sql</span></span><span>
  links/
    link_customer_orders.</span><span><span>sql</span></span><span>
  satellites/
    sat_customer_details.</span><span><span>sql</span></span><span>
  staging/
    stg_customers.</span><span><span>sql</span></span><span>
    stg_orders.</span><span><span>sql</span></span><span>
</span></span></code></p></div>
```

___

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ ‚Äî –ø–æ–º–æ–≥—É –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–∏–º–µ—Ä staging –º–æ–¥–µ–ª–µ–π –∏ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.  
–•–æ—á–µ—à—å?

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–≤–æ—Ç —ç—Ç–æ—Ç —Ñ–∞–π–ª –¥–∞–≤–∞–π stg\_orders.sql

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–í–æ—Ç –ø—Ä–∏–º–µ—Ä –ø—Ä–æ—Å—Ç–æ–≥–æ —Ñ–∞–π–ª–∞ `models/staging/stg_orders.sql` –¥–ª—è —Ç–≤–æ–µ–≥–æ Data Vault –ø—Ä–æ–µ–∫—Ç–∞ —Å dbtvault:

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span>{{ config(materialized</span><span><span>=</span></span><span><span>'view'</span></span><span>) }}

</span><span><span>select</span></span><span>
    order_id,
    customer_id,
    order_date,
    total_amount,
    status
</span><span><span>from</span></span><span> {{ source(</span><span><span>'public'</span></span><span>, </span><span><span>'raw_orders'</span></span><span>) }}
</span></span></code></p></div>
```

**–ü–æ—è—Å–Ω–µ–Ω–∏—è:**

-   –≠—Ç–æ—Ç —Ñ–∞–π–ª –æ–ø–∏—Å—ã–≤–∞–µ—Ç staging-—Å–ª–æ–π –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã –∑–∞–∫–∞–∑–æ–≤ (`raw_orders`), –∫–æ—Ç–æ—Ä–∞—è –ª–µ–∂–∏—Ç –≤ —Å—Ö–µ–º–µ `public` –≤ PostgreSQL.
    
-   –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è `view` ‚Äî —É–¥–æ–±–Ω–∞ –¥–ª—è —Å—Ç–∞–¥–∏–π–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏.
    
-   –í –≤—ã–±–æ—Ä–∫–µ –±–µ—Ä—ë–º –∫–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è, –≤–∫–ª—é—á–∞—è –¥–∞—Ç—É –∑–∞–∫–∞–∑–∞ `order_date` (–≤–∞–∂–Ω–æ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –≤ Data Vault).
    

___

–ï—Å–ª–∏ –≤ –ø—Ä–æ–µ–∫—Ç–µ –µ—â—ë –Ω–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–∞ `raw_orders`, –¥–æ–±–∞–≤—å –µ–≥–æ –≤ `models/schema.yml`:

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>version:</span></span><span> </span><span><span>2</span></span><span>

</span><span><span>sources:</span></span><span>
  </span><span><span>-</span></span><span> </span><span><span>name:</span></span><span> </span><span><span>public</span></span><span>
    </span><span><span>tables:</span></span><span>
      </span><span><span>-</span></span><span> </span><span><span>name:</span></span><span> </span><span><span>raw_orders</span></span><span>
      </span><span><span>-</span></span><span> </span><span><span>name:</span></span><span> </span><span><span>raw_customers</span></span><span>
</span></span></code></p></div>
```

___

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, –º–æ–≥—É –ø–æ–º–æ—á—å —Å–¥–µ–ª–∞—Ç—å –∏ –¥—Ä—É–≥–∏–µ staging –º–æ–¥–µ–ª–∏ –∏–ª–∏ –æ–ø–∏—Å–∞—Ç—å –ø–æ–ª–Ω—ã–π pipeline.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–∏ –µ—â—ë seed –¥–ª—è raw\_orders —Å —É—á—ë—Ç–æ–º —Ç–æ–≥–æ, —á—Ç–æ raw\_customers.csv: id,name,created\_at 1,Alice,2020-01-01 2,Bob,2020-02-01

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–í–æ—Ç –ø—Ä–∏–º–µ—Ä seed-—Ñ–∞–π–ª–∞ `seeds/raw_orders.csv`, —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã–π —Å —Ç–≤–æ–∏–º `raw_customers.csv`:

```
<div><p>csv</p><p><code id="code-lang-csv"><span>order_id,customer_id,order_date,total_amount,status
101,1,2020-03-01,150.75,completed
102,2,2020-03-05,200.00,pending
103,1,2020-04-01,75.50,cancelled
</span></code></p></div>
```

–ü–æ—è—Å–Ω–µ–Ω–∏—è:

-   `customer_id` —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ `id` –∏–∑ `raw_customers.csv` (Alice = 1, Bob = 2).
    
-   –ï—Å—Ç—å —Ä–∞–∑–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã –∑–∞–∫–∞–∑–æ–≤.
    
-   `order_date` ‚Äî –¥–∞—Ç–∞ –∑–∞–∫–∞–∑–∞.
    
-   `total_amount` ‚Äî —Å—É–º–º–∞ –∑–∞–∫–∞–∑–∞.
    

–ü–æ–ª–æ–∂–∏ —ç—Ç–æ—Ç —Ñ–∞–π–ª –≤ –ø–∞–ø–∫—É `seeds/` —Ä—è–¥–æ–º —Å `raw_customers.csv`, –∑–∞—Ç–µ–º –≤—ã–ø–æ–ª–Ω–∏:

—á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –±–∞–∑—É –¥–ª—è —Ç–µ—Å—Ç–æ–≤ –∏ –º–æ–¥–µ–ª–∏ staging.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–ø–µ—Ä–≤–∞—è –≤–µ—Ä—Å–∏—è hub\_customers.sql –±—ã–ª–∞: {{ config(materialized='table') }} {{ hub( src\_pk='customer\_id', src\_nk='customer\_name', src\_ldts='created\_at', src='stg\_customers', hub\_name='hub\_customers' ) }} –ø–æ—Ç–æ–º —Ç—ã –ø—Ä–µ–¥–ª–æ–∂–∏–ª–∞: {{ config( materialized='table' ) }} -- –ü—Ä–∏–º–µ—Ä –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è —Ö–∞–±–∞ —Å –ø–æ–º–æ—â—å—é dbtvault {{ dbtvault.hub( source = ref('stg\_customers'), -- —Å—Å—ã–ª–∫–∞ –Ω–∞ —Å—Ç–∞–¥–∏—é —Å –¥–∞–Ω–Ω—ã–º–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä staging –º–æ–¥–µ–ª—å hub\_name = 'customers', -- –∏–º—è —Ö–∞–±–∞ (—Ç–∞–±–ª–∏—Ü—ã –±–µ–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞ hub\_) business\_key = 'customer\_id', -- –±–∏–∑–Ω–µ—Å-–∫–ª—é—á load\_date = 'created\_at' -- –ø–æ–ª–µ –¥–∞—Ç—ã –∑–∞–≥—Ä—É–∑–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ) }} –∫–∞–∫–∞ –∏–∑ –Ω–∏—Ö –ø–æ–¥—Ö–æ–¥–∏—Ç –∫ —É–∫–∞–∑–∞–Ω–Ω—ã–º –≤—ã—à–µ link\_customer\_orders.sql sat\_customer\_details.sql stg\_orders.sql ?

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å! –î–∞–≤–∞–π —Ä–∞–∑–±–µ—Ä—ë–º—Å—è, –∫–∞–∫–∞—è –≤–µ—Ä—Å–∏—è —à–∞–±–ª–æ–Ω–∞ `hub_customers.sql` –ª—É—á—à–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –ø–æ–¥ —Ç–≤–æ–∏ –º–æ–¥–µ–ª–∏ `link_customer_orders.sql`, `sat_customer_details.sql`, `stg_orders.sql` –∏ —Ç–≤–æ–π —Ç–µ–∫—É—â–∏–π —Å—Ç–µ–∫ —Å dbtvault.

___

### –ö—Ä–∞—Ç–∫–æ –ø–æ —Å—É—Ç–∏:

-   **dbtvault 0.9+ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–π —Å—Ç–∏–ª—å —Å –º–∞–∫—Ä–æ—Å–æ–º `dbtvault.hub()`** ‚Äî –∏–º–µ–Ω–Ω–æ –µ–≥–æ –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å, –µ—Å–ª–∏ —Ç—ã —Ö–æ—á–µ—à—å –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ –æ–ø–∏—Å—ã–≤–∞—Ç—å –º–æ–¥–µ–ª–∏ (—Ö—É–∫–∏, —Å—Å—ã–ª–∫–∏, —Å–∞—Ç–µ–ª–ª–∏—Ç—ã).
    
-   –ü–µ—Ä–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç —Å –ø—Ä—è–º—ã–º –≤—ã–∑–æ–≤–æ–º `hub(...)` ‚Äî —Å–∫–æ—Ä–µ–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏–π –∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –º–∞–∫—Ä–æ—Å, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –≤—Ö–æ–¥–∏—Ç –≤ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –ø–∞–∫–µ—Ç dbtvault.
    

___

### –ß—Ç–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ç–≤–æ–∏—Ö –º–æ–¥–µ–ª–µ–π?

-   **hub\_customers.sql**: –∏—Å–ø–æ–ª—å–∑—É–π –≤—Ç–æ—Ä–æ–π –≤–∞—Ä–∏–∞–Ω—Ç ‚Äî –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–π –≤—ã–∑–æ–≤ –∏–∑ –ø–∞–∫–µ—Ç–∞ dbtvault —Å `dbtvault.hub(...)`.
    
-   **link\_customer\_orders.sql** –∏ **sat\_customer\_details.sql**: —Ç–∞–º –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –±—É–¥—É—Ç –≤—ã–∑–æ–≤—ã `dbtvault.link(...)` –∏ `dbtvault.satellite(...)` —Å –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏.
    
-   **stg\_orders.sql** ‚Äî —ç—Ç–æ staging-–º–æ–¥–µ–ª—å, —Å –∫–æ—Ç–æ—Ä–æ–π –ø–æ—Ç–æ–º —Å—Ç—Ä–æ—è—Ç—Å—è —Å—Å—ã–ª–∫–∏ (link) –∏ —Å–∞—Ç–µ–ª–ª–∏—Ç—ã (satellite). –¢–∞–º –æ–±—ã—á–Ω—ã–π `select` –±–µ–∑ dbtvault-–º–∞–∫—Ä–æ—Å–æ–≤.
    

___

### –ü—Ä–∏–º–µ—Ä –¥–ª—è —Ç–≤–æ–µ–≥–æ `hub_customers.sql` ‚Äî —É–∂–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–π:

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{{ config(materialized='table') }}

{{ dbtvault.hub(
    source=ref('stg_customers'),       -- staging-–º–æ–¥–µ–ª—å —Å ¬´—Å—ã—Ä—ã–º–∏¬ª –¥–∞–Ω–Ω—ã–º–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤
    hub_name='customers',               -- –∏–º—è —Ö–∞–±–∞ –±–µ–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞ hub_
    business_key='customer_id',         -- –±–∏–∑–Ω–µ—Å-–∫–ª—é—á
    load_date='created_at'              -- –ø–æ–ª–µ –¥–ª—è –¥–∞—Ç—ã –∑–∞–≥—Ä—É–∑–∫–∏
) }}
</span></code></p></div>
```

___

### –ü—Ä–∏–º–µ—Ä –¥–ª—è `link_customer_orders.sql`:

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{{ config(materialized='table') }}

{{ dbtvault.link(
    source=ref('stg_orders'),
    link_name='customer_orders',
    business_keys=['customer_id', 'order_id'],
    load_date='order_date'
) }}
</span></code></p></div>
```

___

### –ü—Ä–∏–º–µ—Ä –¥–ª—è `sat_customer_details.sql`:

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{{ config(materialized='table') }}

{{ dbtvault.satellite(
    source=ref('stg_customers'),
    satellite_name='customer_details',
    business_key='customer_id',
    load_date='created_at',
    attributes=['customer_name']
) }}
</span></code></p></div>
```

___

### –ò—Ç–æ–≥:

-   –î–ª—è –≤—Å–µ—Ö dbtvault-–º–æ–¥–µ–ª–µ–π (hub, link, satellite) **–∏—Å–ø–æ–ª—å–∑—É–π –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–µ –≤—ã–∑–æ–≤—ã –∏–∑ –ø–∞–∫–µ—Ç–∞ `dbtvault` ‚Äî `dbtvault.hub()`, `dbtvault.link()`, `dbtvault.satellite()`**.
    
-   –î–ª—è staging-–º–æ–¥–µ–ª–µ–π (stg\_\*) ‚Äî –æ–±—ã—á–Ω—ã–π SQL select, –±–µ–∑ –º–∞–∫—Ä–æ—Å–æ–≤.
    
-   –≠—Ç–æ—Ç –ø–æ–¥—Ö–æ–¥ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç–≤–æ–µ–º—É —Ç–µ–∫—É—â–µ–º—É –ø—Ä–æ–µ–∫—Ç—É –∏ –æ–±–µ—Å–ø–µ—á–∏—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é Data Vault –º–æ–¥–µ–ª–µ–π.
    

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, –º–æ–≥—É –ø–æ–º–æ—á—å —Å–æ–±—Ä–∞—Ç—å –ø–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä –≤—Å–µ—Ö —Ç—Ä—ë—Ö –º–æ–¥–µ–ª–µ–π —Å —Ç–≤–æ–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

—Ç—ã –æ–ø—è—Ç—å –∏—Å–ø—Ä–∞–≤–∏–ª–∞ —Å–∫—Ä–∏–ø—Ç—ã link\_customer\_orders.sql sat\_customer\_details.sql –ø—Ä–∏—à–ª–∏ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—É—é –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—é

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–ü–æ–Ω—è–ª, –¥–∞–≤–∞–π —Å–¥–µ–ª–∞–µ–º –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω—É—é –∏ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã—Ö –º–∞–∫—Ä–æ—Å–æ–≤ –∏–∑ `dbtvault` –¥–ª—è –≤—Å–µ—Ö —Ç—Ä—ë—Ö –º–æ–¥–µ–ª–µ–π: hub, link –∏ satellite.

___

## –ü–æ–ª–Ω–∞—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–∞—è –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è —Ç–≤–æ–∏—Ö –º–æ–¥–µ–ª–µ–π

___

### 1\. **hub\_customers.sql**

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{{ config(materialized='table') }}

{{ dbtvault.hub(
    source=ref('stg_customers'),        -- staging –º–æ–¥–µ–ª—å —Å —Å—ã—Ä—ã–º–∏ –∫–ª–∏–µ–Ω—Ç–∞–º–∏
    hub_name='customers',                -- –∏–º—è —Ö–∞–±–∞ (–±–µ–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞ hub_)
    business_key='customer_id',          -- –±–∏–∑–Ω–µ—Å-–∫–ª—é—á (–Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã–π –∫–ª—é—á)
    load_date='created_at'               -- –¥–∞—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
) }}
</span></code></p></div>
```

___

### 2\. **link\_customer\_orders.sql**

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{{ config(materialized='table') }}

{{ dbtvault.link(
    source=ref('stg_orders'),            -- staging –º–æ–¥–µ–ª—å —Å –∑–∞–∫–∞–∑–∞–º–∏
    link_name='customer_orders',         -- –∏–º—è –ª–∏–Ω–∫–∞ (–±–µ–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞ link_)
    business_keys=['customer_id', 'order_id'],  -- —Å–ø–∏—Å–æ–∫ –±–∏–∑–Ω–µ—Å-–∫–ª—é—á–µ–π –¥–ª—è —Å–≤—è–∑–∏
    load_date='order_date'                -- –¥–∞—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏
) }}
</span></code></p></div>
```

___

### 3\. **sat\_customer\_details.sql**

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{{ config(materialized='table') }}

{{ dbtvault.satellite(
    source=ref('stg_customers'),          -- staging –º–æ–¥–µ–ª—å —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏
    satellite_name='customer_details',    -- –∏–º—è —Å–∞—Ç–µ–ª–ª–∏—Ç–∞ (–±–µ–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞ sat_)
    business_key='customer_id',            -- –±–∏–∑–Ω–µ—Å-–∫–ª—é—á –¥–ª—è —Å–≤—è–∑–∏
    load_date='created_at',                 -- –¥–∞—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏
    attributes=['customer_name']            -- –∞—Ç—Ä–∏–±—É—Ç—ã (—Å—Ç–æ–ª–±—Ü—ã), –∫–æ—Ç–æ—Ä—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Å–∞—Ç–µ–ª–ª–∏—Ç–µ
) }}
</span></code></p></div>
```

___

## –ö—Ä–∞—Ç–∫–æ–µ –ø–æ—è—Å–Ω–µ–Ω–∏–µ

-   `source=ref('stg_*')` ‚Äî —Å—Å—ã–ª–∫–∏ –Ω–∞ staging –º–æ–¥–µ–ª–∏, –≥–¥–µ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ã "—Å—ã—Ä—ã–µ" –¥–∞–Ω–Ω—ã–µ.
    
-   `hub_name`, `link_name`, `satellite_name` ‚Äî –∏–º–µ–Ω–∞ –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö —Ç–∞–±–ª–∏—Ü –±–µ–∑ –ø—Ä–µ—Ñ–∏–∫—Å–æ–≤ (`hub_`, `link_`, `sat_` dbtvault –¥–æ–±–∞–≤–∏—Ç –∏—Ö —Å–∞–º.
    
-   `business_key`/`business_keys` ‚Äî –Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏ (—É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã).
    
-   `load_date` ‚Äî –ø–æ–ª–µ —Å –¥–∞—Ç–æ–π –∏–ª–∏ –¥–∞—Ç–æ–π-–≤—Ä–µ–º–µ–Ω–µ–º –∑–∞–≥—Ä—É–∑–∫–∏.
    
-   `attributes` (—Ç–æ–ª—å–∫–æ –¥–ª—è satellite) ‚Äî —Å–ø–∏—Å–æ–∫ –ø–æ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ –∞—Ç—Ä–∏–±—É—Ç—ã.
    

___

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, –º–æ–≥—É –µ—â—ë —Ä–∞–∑ –ø—Ä–∏—Å–ª–∞—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å seed-—Ñ–∞–π–ª–∞–º–∏, staging –∏ –≤—Å–µ–º–∏ –º–æ–¥–µ–ª—è–º–∏ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ ‚Äî —á—Ç–æ–±—ã —Å—Ä–∞–∑—É –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏ –∑–∞–ø—É—Å–∫–∞—Ç—å.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–ö–æ–Ω–µ—á–Ω–æ! –í–æ—Ç **–ø–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞ dbt —Å Data Vault**, –≤–∫–ª—é—á–∞—è seed-—Ñ–∞–π–ª—ã, staging, hub/link/satellite –º–æ–¥–µ–ª–∏ ‚Äî –≤—Å—ë –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ –∏ –≥–æ—Ç–æ–≤–æ –∫ –∑–∞–ø—É—Å–∫—É.

___

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
<div><p>pgsql</p><p><code><span><span>dbt/
‚îú‚îÄ‚îÄ dbt_project.yml
‚îú‚îÄ‚îÄ profiles.yml
‚îú‚îÄ‚îÄ seeds/
‚îÇ   ‚îú‚îÄ‚îÄ raw_customers.csv
‚îÇ   ‚îî‚îÄ‚îÄ raw_orders.csv
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ staging/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ stg_customers.</span><span><span>sql</span></span><span>
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ stg_orders.</span><span><span>sql</span></span><span>
‚îÇ   ‚îú‚îÄ‚îÄ hubs/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ hub_customers.</span><span><span>sql</span></span><span>
‚îÇ   ‚îú‚îÄ‚îÄ links/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ link_customer_orders.</span><span><span>sql</span></span><span>
‚îÇ   ‚îî‚îÄ‚îÄ satellites/
‚îÇ       ‚îî‚îÄ‚îÄ sat_customer_details.</span><span><span>sql</span></span><span>
‚îî‚îÄ‚îÄ macros/
    ‚îî‚îÄ‚îÄ dbtvault_macros.</span><span><span>sql</span></span><span>  (–µ—Å–ª–∏ –Ω—É–∂–Ω—ã –∫–∞—Å—Ç–æ–º–Ω—ã–µ –º–∞–∫—Ä–æ—Å—ã, –Ω–æ –¥–ª—è dbtvault —ç—Ç–æ –æ–±—ã—á–Ω–æ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
</span></span></code></p></div>
```

___

## –§–∞–π–ª—ã –∏ –∏—Ö —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ

___

### `seeds/raw_customers.csv`

```
<div><p>csv</p><p><code id="code-lang-csv"><span>id,name,created_at
1,Alice,2020-01-01
2,Bob,2020-02-01
</span></code></p></div>
```

___

### `seeds/raw_orders.csv`

```
<div><p>csv</p><p><code id="code-lang-csv"><span>order_id,customer_id,order_date,order_amount
101,1,2020-03-01,100.50
102,2,2020-03-05,200.00
</span></code></p></div>
```

___

### `models/staging/stg_customers.sql`

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{{ config(materialized='view') }}

select
    id as customer_id,
    name as customer_name,
    created_at
from {{ ref('raw_customers') }}
</span></code></p></div>
```

___

### `models/staging/stg_orders.sql`

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{{ config(materialized='view') }}

select
    order_id,
    customer_id,
    order_date,
    order_amount
from {{ ref('raw_orders') }}
</span></code></p></div>
```

___

### `models/hubs/hub_customers.sql`

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{{ config(materialized='table') }}

{{ dbtvault.hub(
    source=ref('stg_customers'),
    hub_name='customers',
    business_key='customer_id',
    load_date='created_at'
) }}
</span></code></p></div>
```

___

### `models/links/link_customer_orders.sql`

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{{ config(materialized='table') }}

{{ dbtvault.link(
    source=ref('stg_orders'),
    link_name='customer_orders',
    business_keys=['customer_id', 'order_id'],
    load_date='order_date'
) }}
</span></code></p></div>
```

___

### `models/satellites/sat_customer_details.sql`

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{{ config(materialized='table') }}

{{ dbtvault.satellite(
    source=ref('stg_customers'),
    satellite_name='customer_details',
    business_key='customer_id',
    load_date='created_at',
    attributes=['customer_name']
) }}
</span></code></p></div>
```

___

### `dbt_project.yml`

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>name:</span></span><span> </span><span><span>'dv_postgres_project'</span></span><span>
</span><span><span>version:</span></span><span> </span><span><span>'1.0'</span></span><span>
</span><span><span>config-version:</span></span><span> </span><span><span>2</span></span><span>

</span><span><span>profile:</span></span><span> </span><span><span>'dv_postgres_profile'</span></span><span>

</span><span><span>target-path:</span></span><span> </span><span><span>'target'</span></span><span>
</span><span><span>clean-targets:</span></span><span>
  </span><span><span>-</span></span><span> </span><span><span>'target'</span></span><span>
  </span><span><span>-</span></span><span> </span><span><span>'dbt_modules'</span></span><span>

</span><span><span>model-paths:</span></span><span> [</span><span><span>'models'</span></span><span>]
</span><span><span>seed-paths:</span></span><span> [</span><span><span>'seeds'</span></span><span>]
</span><span><span>macro-paths:</span></span><span> [</span><span><span>'macros'</span></span><span>]
</span><span><span>test-paths:</span></span><span> [</span><span><span>'tests'</span></span><span>]

</span><span><span>models:</span></span><span>
  </span><span><span>dv_postgres_project:</span></span><span>
    </span><span><span>staging:</span></span><span>
      </span><span><span>+materialized:</span></span><span> </span><span><span>view</span></span><span>
    </span><span><span>hubs:</span></span><span>
      </span><span><span>+materialized:</span></span><span> </span><span><span>table</span></span><span>
    </span><span><span>links:</span></span><span>
      </span><span><span>+materialized:</span></span><span> </span><span><span>table</span></span><span>
    </span><span><span>satellites:</span></span><span>
      </span><span><span>+materialized:</span></span><span> </span><span><span>table</span></span><span>
</span></span></code></p></div>
```

___

### `profiles.yml`

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>dv_postgres_profile:</span></span><span>
  </span><span><span>target:</span></span><span> </span><span><span>dev</span></span><span>
  </span><span><span>outputs:</span></span><span>
    </span><span><span>dev:</span></span><span>
      </span><span><span>type:</span></span><span> </span><span><span>postgres</span></span><span>
      </span><span><span>host:</span></span><span> </span><span><span>db</span></span><span>
      </span><span><span>user:</span></span><span> </span><span><span>dbt</span></span><span>
      </span><span><span>password:</span></span><span> </span><span><span>dbt</span></span><span>
      </span><span><span>port:</span></span><span> </span><span><span>5432</span></span><span>
      </span><span><span>dbname:</span></span><span> </span><span><span>dbt</span></span><span>
      </span><span><span>schema:</span></span><span> </span><span><span>public</span></span><span>
</span></span></code></p></div>
```

___

## –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã

-   Seed-—Ñ–∞–π–ª—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤ –ë–î –∫–∞–∫ –æ–±—ã—á–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã `raw_customers` –∏ `raw_orders`.
    
-   Staging –º–æ–¥–µ–ª–∏ —Å—Å—ã–ª–∞—é—Ç—Å—è –Ω–∞ —ç—Ç–∏ seed-—Ç–∞–±–ª–∏—Ü—ã, –¥–µ–ª–∞—é—Ç –±–∞–∑–æ–≤—É—é –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫—É –∏ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫.
    
-   Hub, Link, Satellite –º–æ–¥–µ–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –º–∞–∫—Ä–æ—Å—ã dbtvault —Å –µ–¥–∏–Ω–æ–π –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π.
    
-   –í `dbt_project.yml` –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—É—Ç–∏ –∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ –ø–∞–ø–∫–∞–º.
    
-   –í `profiles.yml` –æ–ø–∏—Å–∞–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Postgres.
    

___

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å ‚Äî –º–æ–≥—É –ø–æ–º–æ—á—å —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π Docker + –∑–∞–ø—É—Å–∫–æ–º dbt seed, dbt run, dbt test –¥–ª—è —ç—Ç–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞.  
–ò–ª–∏ –ø–æ–º–æ—á—å —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π Prometheus / Grafana –¥–ª—è –º–µ—Ç—Ä–∏–∫ –∏–∑ dbt.

–ö–∞–∫ —Ç–µ–±–µ —Ç–∞–∫–æ–π –≤–∞—Ä–∏–∞–Ω—Ç?

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

154.4 ERROR: git+https://github.com/Datavault-UK/dbtvault.git@v0.9.2 does not appear to be a Python project: neither 'setup.py' nor 'pyproject.toml' found. ------ failed to solve: process "/bin/sh -c pip install --upgrade pip && pip install dbt-core dbt-postgres prometheus\_client && pip install git+https://github.com/Datavault-UK/dbtvault.git@v0.9.2" did not complete successfully: exit code: 1 `docker-compose` process finished with exit code 1

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–û—à–∏–±–∫–∞:

```
<div><p>bash</p><p><code><span><span>ERROR: git+https://github.com/Datavault-UK/dbtvault.git@v0.9.2 does not appear to be a Python project: neither </span><span><span>'setup.py'</span></span><span> nor </span><span><span>'pyproject.toml'</span></span><span> found.
</span></span></code></p></div>
```

–æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –≤—ã –ø—ã—Ç–∞–µ—Ç–µ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `dbtvault` –∫–∞–∫ **Python-–ø–∞–∫–µ—Ç**, –∞ —ç—Ç–æ **–Ω–µ–≤–µ—Ä–Ω–æ** ‚Äî `dbtvault` –Ω–µ —è–≤–ª—è–µ—Ç—Å—è Python-–±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π. –û–Ω —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –∫–∞–∫ **–Ω–∞–±–æ—Ä Jinja-–º–∞–∫—Ä–æ—Å–æ–≤ –∏ –º–æ–¥–µ–ª–µ–π dbt**, –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –Ω–µ —á–µ—Ä–µ–∑ `pip`, –∞ —á–µ—Ä–µ–∑ dbt package system.

___

### ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–± –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è `dbtvault`

1.  –£–¥–∞–ª–∏—Ç–µ –∏–∑ `Dockerfile` —Å—Ç—Ä–æ–∫—É:
    

```
<div><p>dockerfile</p><p><code id="code-lang-dockerfile"><span>pip install git+https://github.com/Datavault-UK/dbtvault.git@v0.9.2
</span></code></p></div>
```

2.  –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ ‚Äî –ø–æ–¥–∫–ª—é—á–∏—Ç–µ `dbtvault` —á–µ—Ä–µ–∑ —Ñ–∞–π–ª `packages.yml`:
    

#### `packages.yml` (–≤ –∫–æ—Ä–Ω–µ dbt-–ø—Ä–æ–µ–∫—Ç–∞ —Ä—è–¥–æ–º —Å `dbt_project.yml`):

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>packages:</span></span><span>
  </span><span><span>-</span></span><span> </span><span><span>package:</span></span><span> </span><span><span>Datavault-UK/dbtvault</span></span><span>
    </span><span><span>version:</span></span><span> </span><span><span>0.9</span></span><span><span>.2</span></span><span>
</span></span></code></p></div>
```

3.  –í –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ `dbt` (–∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –Ω–µ –≤ Docker), –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É:
    

–û–Ω–∞ –∑–∞–≥—Ä—É–∑–∏—Ç –ø–∞–∫–µ—Ç `dbtvault` –≤ –ø–∞–ø–∫—É `dbt_packages`.

___

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Dockerfile (–ø—Ä–∏–º–µ—Ä)

–ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ `dbtvault`, `prometheus_client` –∏ `dbt`, —Ç–æ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π `Dockerfile` –º–æ–∂–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Ç–∞–∫:

```
<div><p>dockerfile</p><p><code id="code-lang-dockerfile"><span>FROM python:3.10-slim

WORKDIR /usr/app

RUN pip install --upgrade pip \
 &amp;&amp; pip install dbt-core dbt-postgres prometheus_client

COPY . .

# –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ: dbtvault —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ dbt deps
CMD ["sh", "-c", "dbt deps &amp;&amp; dbt run"]
</span></code></p></div>
```

___

### –ü–æ–¥—ã—Ç–æ–∂–∏–º

| –ß—Ç–æ | –ö–∞–∫ |
| --- | --- |
| `dbtvault` | –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `packages.yml` –∏ `dbt deps` |
| `dbt` –∏ `prometheus_client` | –ß–µ—Ä–µ–∑ `pip` |
| `dbtvault` **–Ω–µ** Python-–±–∏–±–ª–∏–æ—Ç–µ–∫–∞ | –ù–µ–ª—å–∑—è —Å—Ç–∞–≤–∏—Ç—å —á–µ—Ä–µ–∑ `pip install git+https://...` |

___

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å ‚Äî –ø–æ–º–æ–≥—É —Ç–µ–±–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å `docker-compose.yml` –∏ `Dockerfile` –ø–æ–¥ —ç—Ç–æ.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

20:02:01 Running with dbt=1.9.6 20:02:03 \[WARNING\]: Deprecated functionality The `Datavault-UK/dbtvault` package is deprecated in favor of `Datavault-UK/automate_dv`. Please update your `packages.yml` configuration to use `Datavault-UK/automate_dv` instead. 20:02:04 Updating lock file in file path: /usr/app/package-lock.yml 20:02:04 Installing Datavault-UK/dbtvault 20:02:07 Installed from version 0.9.2 20:02:07 Updated version available: 0.9.5 20:02:07 Installing dbt-labs/dbt\_utils 20:02:12 Installed from version 0.9.6 20:02:12 Updated version available: 1.3.0 20:02:12 20:02:12 Updates available for packages: \['Datavault-UK/dbtvault', 'dbt-labs/dbt\_utils'\] Update your versions in packages.yml, then run dbt deps 20:02:16 Running with dbt=1.9.6 20:02:16 Registered adapter: postgres=1.9.0 20:02:17 Unable to do partial parsing because a project dependency has been added 20:02:17 Unable to do partial parsing because a project config has changed 20:02:23 Encountered an error: Compilation Error in model hub\_customers (models/hubs/hub\_customers.sql) invalid syntax for function call expression line 3 {{ dbtvault.hub(

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–°—É–¥—è –ø–æ –æ—à–∏–±–∫–µ:

```
<div><p>r</p><p><code><span><span>Compilation Error </span><span><span>in</span></span><span> model hub_customers </span><span><span>(</span></span><span>models</span><span><span>/</span></span><span>hubs</span><span><span>/</span></span><span>hub_customers.sql</span><span><span>)</span></span><span>

  invalid syntax </span><span><span>for</span></span><span> </span><span><span>function</span></span><span> </span><span><span>call</span></span><span> </span><span><span>expression</span></span><span>

    line </span><span><span>3</span></span><span>

      </span><span><span>{</span></span><span><span>{</span></span><span> dbtvault.hub</span><span><span>(</span></span><span>
</span></span></code></p></div>
```

–¢—ã –ø—ã—Ç–∞–µ—à—å—Å—è –≤—ã–∑–≤–∞—Ç—å –º–∞–∫—Ä–æ—Å `dbtvault.hub(...)`, –Ω–æ:

-   –ª–∏–±–æ **–æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–º–ø–æ—Ä—Ç `dbtvault`** (—Ö–æ—Ç—è `dbt` –¥–æ–ª–∂–µ–Ω —ç—Ç–æ —Å–¥–µ–ª–∞—Ç—å —Å–∞–º –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ),
    
-   –ª–∏–±–æ —Ç—ã –∏—Å–ø–æ–ª—å–∑—É–µ—à—å **—É—Å—Ç–∞—Ä–µ–≤—à–∏–π –º–∞–∫—Ä–æ—Å –∏–∑ `Datavault-UK/dbtvault`**, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ –Ω–æ–≤—ã—Ö –≤–µ—Ä—Å–∏—è—Ö dbt,
    
-   –ª–∏–±–æ **–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –≤—ã–∑–æ–≤–∞** –∏–ª–∏ **—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ YAML-—Ñ–∞–π–ª–∞ –ø–∞–∫–µ—Ç–æ–≤**.
    

–¢–∞–∫–∂–µ –≤ –ª–æ–≥–∞—Ö –µ—Å—Ç—å –≤–∞–∂–Ω–æ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ:

> ‚úÖ **The `Datavault-UK/dbtvault` package is deprecated in favor of `Datavault-UK/automate_dv`.**

___

## ‚úÖ –ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ

### 1\. –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –ø–∞–∫–µ—Ç `automate_dv`

–í–º–µ—Å—Ç–æ `dbtvault` –∏—Å–ø–æ–ª—å–∑—É–π [**`automate_dv`**](https://github.com/Datavault-UK/automate-dv), –æ–Ω –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å `dbt v1.9+`.

___

### üîß –û–±–Ω–æ–≤–∏ `packages.yml`:

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>packages:</span></span><span>
  </span><span><span>-</span></span><span> </span><span><span>package:</span></span><span> </span><span><span>Datavault-UK/automate_dv</span></span><span>
    </span><span><span>version:</span></span><span> </span><span><span>0.10</span></span><span><span>.0</span></span><span>  </span><span><span># –∏–ª–∏ latest –Ω–∞ –º–æ–º–µ–Ω—Ç —á—Ç–µ–Ω–∏—è</span></span><span>
  </span><span><span>-</span></span><span> </span><span><span>package:</span></span><span> </span><span><span>dbt-labs/dbt_utils</span></span><span>
    </span><span><span>version:</span></span><span> </span><span><span>1.3</span></span><span><span>.0</span></span><span>
</span></span></code></p></div>
```

‚ö†Ô∏è `dbt_utils` 1.3.0 ‚Äî –≤–µ—Ä—Å–∏—è, —Å–æ–≤–º–µ—Å—Ç–∏–º–∞—è —Å `dbt` 1.9.x

___

### üì¶ –û–±–Ω–æ–≤–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

–í–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (–∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞):

___

### üõ† –û–±–Ω–æ–≤–∏ –º–æ–¥–µ–ª—å `hub_customers.sql` –ø–æ–¥ `automate_dv`

–ü—Ä–∏–º–µ—Ä (—Å–∏–Ω—Ç–∞–∫—Å–∏—Å –Ω–µ–º–Ω–æ–≥–æ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç `dbtvault`):

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span>{{ config(materialized</span><span><span>=</span></span><span><span>'incremental'</span></span><span>) }}

{</span><span><span>%</span></span><span> </span><span><span>set</span></span><span> source_model </span><span><span>=</span></span><span> </span><span><span>ref</span></span><span>(</span><span><span>'stg_customers'</span></span><span>) </span><span><span>%</span></span><span>}

{</span><span><span>%</span></span><span> </span><span><span>set</span></span><span> hub_config </span><span><span>=</span></span><span> {
    "src_pk": "customer_id",
    "src_nk": "customer_name",
    "src_ldts": "created_at",
    "src_source": "dbt_source",
    "hub_name": "hub_customers"
} </span><span><span>%</span></span><span>}

{{ automate_dv.hub(source_model, hub_config) }}
</span></span></code></p></div>
```

___

## üí° –ì–ª–∞–≤–Ω–æ–µ –æ—Ç–ª–∏—á–∏–µ `automate_dv` –æ—Ç `dbtvault`

| –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å | `dbtvault` | `automate_dv` |
| --- | --- | --- |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ dbt 1.4+ | –ù–µ—Ç | ‚úÖ –î–∞ |
| –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–∞–∫—Ä–æ—Å–æ–≤ | –£—Å—Ç–∞—Ä–µ–≤—à–∏–π –≤—ã–∑–æ–≤ (`dbtvault.hub(...)`) | –ù–æ–≤—ã–π –≤—ã–∑–æ–≤ —Å –∫–æ–Ω—Ñ–∏–≥–æ–º (`automate_dv.hub(source_model, config_dict)`) |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è | –ù–µ—Ç | ‚úÖ –ê–∫—Ç–∏–≤–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ |

___

–•–æ—á–µ—à—å ‚Äî —è –ø–æ–º–æ–≥—É –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å –≤—Å–µ –º–æ–¥–µ–ª–∏ `hub`, `link`, `satellite`, `stg` –ø–æ–¥ `automate_dv`.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–ø—Ä–µ–∫—Ä–∞—Ç–∏ –ø–æ–Ω–æ—Å—Ç—å—é –º–µ–Ω—è—Ç—å –∫–æ–¥ –±–µ–∑ –ø—Ä–∏—á–∏–Ω—ã –∏—Å–ø—Ä–∞–≤–ª—è–π —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π! –≤–æ—Ç –±—ã–ª –∫–æ–¥ hub\_customers.sql {{ config(materialized='table') }} {{ dbtvault.hub( source=ref('stg\_customers'), -- staging –º–æ–¥–µ–ª—å —Å —Å—ã—Ä—ã–º–∏ –∫–ª–∏–µ–Ω—Ç–∞–º–∏ hub\_name='customers', -- –∏–º—è —Ö–∞–±–∞ (–±–µ–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞ hub\_) business\_key='customer\_id', -- –±–∏–∑–Ω–µ—Å-–∫–ª—é—á (–Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã–π –∫–ª—é—á) load\_date='created\_at' -- –¥–∞—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ) }} –∏—Å–ø—Ä–∞–≤–ª—è–π –µ–≥–æ —Ç—ã —Å–∞–º–∞ –µ–≥–æ –≤ —á–∞—Ç–µ –Ω–∞–ø–∏—Å–∞–ª–∞ –ø–æ—á–µ–º—É –æ–ø—è—Ç—å –≤—Å–µ –ø–æ–ª—è –Ω–∞–∑–≤–∞–Ω—ã –ø–æ –¥—Ä—É–≥–æ–º—É –≤ —Ç–≤–æ–µ–π –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏?

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–¢—ã –∞–±—Å–æ–ª—é—Ç–Ω–æ –ø—Ä–∞–≤ ‚Äî –º–µ–Ω—è—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –±–µ–∑ –ø—Ä–∏—á–∏–Ω—ã –Ω–µ —Å—Ç–æ–∏—Ç. –û—Å—Ç–∞–µ–º—Å—è –≤ —Ä–∞–º–∫–∞—Ö **—Ç–≤–æ–µ–≥–æ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–¥—Ö–æ–¥–∞ —Å `dbtvault`**, –∫–∞–∫ —Ç—ã –∏ –ø—Ä–æ—Å–∏–ª.

–û—à–∏–±–∫–∞ `invalid syntax for function call expression` –ø–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –æ–¥–Ω—É –∏–∑ –¥–≤—É—Ö –ø—Ä–∏—á–∏–Ω:

___

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π `hub_customers.sql`

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span>{{ config(materialized</span><span><span>=</span></span><span><span>'table'</span></span><span>) }}

{{ dbtvault.hub(
    source</span><span><span>=</span></span><span><span>ref</span></span><span>(</span><span><span>'stg_customers'</span></span><span>),        </span><span><span>-- staging –º–æ–¥–µ–ª—å —Å —Å—ã—Ä—ã–º–∏ –∫–ª–∏–µ–Ω—Ç–∞–º–∏</span></span><span>
    hub_name</span><span><span>=</span></span><span><span>'hub_customers'</span></span><span>,           </span><span><span>-- –∏–º—è —Ç–∞–±–ª–∏—Ü—ã —Ö–∞–±–∞ (—Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º –∏–ª–∏ –±–µ–∑ ‚Äî –∑–∞–≤–∏—Å–∏—Ç –æ—Ç convention)</span></span><span>
    business_key</span><span><span>=</span></span><span><span>'customer_id'</span></span><span>,         </span><span><span>-- –±–∏–∑–Ω–µ—Å-–∫–ª—é—á (–Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã–π –∫–ª—é—á)</span></span><span>
    load_date</span><span><span>=</span></span><span><span>'created_at'</span></span><span>              </span><span><span>-- –¥–∞—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</span></span><span>
) }}
</span></span></code></p></div>
```

___

### üí° –ß—Ç–æ –º–æ–≥–ª–æ –±—ã—Ç—å –Ω–µ —Ç–∞–∫:

1.  **`hub_name` = `'customers'`**, –Ω–æ —Ç–≤–æ—è –º–æ–¥–µ–ª—å –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è `hub_customers.sql` ‚Äî —ç—Ç–æ —Å–±–∏–≤–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É. –õ—É—á—à–µ —è–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –∏–º—è (`hub_customers`).
    
2.  **–ú–∞–∫—Ä–æ—Å –Ω–µ –Ω–∞–π–¥–µ–Ω?** –£–±–µ–¥–∏—Å—å, —á—Ç–æ:
    
    -   –í `packages.yml` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:
        
        ```
        <div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>packages:</span></span><span>
          </span><span><span>-</span></span><span> </span><span><span>package:</span></span><span> </span><span><span>Datavault-UK/dbtvault</span></span><span>
            </span><span><span>version:</span></span><span> </span><span><span>0.9</span></span><span><span>.2</span></span><span>
        </span></span></code></p></div>
        ```
        
    -   –ò —Ç—ã –≤—ã–∑–≤–∞–ª `dbt deps`.
        
3.  **–ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –≤ `models/hubs/hub_customers.sql` –Ω–µ—Ç –ª–∏—à–Ω–∏—Ö –æ—Ç—Å—Ç—É–ø–æ–≤, –ø—Ä–æ–±–µ–ª–æ–≤ –¥–æ `{{`, —Å–∏–º–≤–æ–ª–æ–≤ BOM –∏–ª–∏ –¥—Ä—É–≥–∏—Ö —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏—Ö –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤.**
    

___

### üöÄ –•–æ—á–µ—à—å ‚Äî —è –ø—Ä–æ–≤–µ—Ä—é –∏ –∞–¥–∞–ø—Ç–∏—Ä—É—é `link`, `satellite`, `staging` –ø–æ–¥ —Ç–æ—Ç –∂–µ —Å—Ç–∏–ª—å ‚Äî —á—Ç–æ–±—ã –≤—Å—ë –±—ã–ª–æ **–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ** –∏ –±–µ–∑ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π.

–ü–æ–¥—Ç–≤–µ—Ä–¥–∏, –∏ –º—ã –ø–æ–π–¥—ë–º –¥–∞–ª—å—à–µ.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–Ω–µ—Ç —Å—Ç–æ–ø –æ–±—ä—è—Å–Ω–∏ —Ä–∞–∑–Ω–∏—Ü—É –º–µ–∂–¥—É –º–æ–∏–º –∏ —Ç–≤–æ–∏–º –Ω–æ–≤—ã–º hub\_customers.sql

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å. –î–∞–≤–∞–π —Ä–∞–∑–ª–æ–∂–∏–º **–ø–æ —à–∞–≥–∞–º**, —á–µ–º **—Ç–≤–æ–π –∏—Å—Ö–æ–¥–Ω—ã–π `hub_customers.sql`** –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç **–º–æ–µ–π –≤–µ—Ä—Å–∏–∏**, –∏ —á—Ç–æ —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç **–Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ**.

___

## üîπ –¢–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span>{{ config(materialized</span><span><span>=</span></span><span><span>'table'</span></span><span>) }}

{{ hub(
    src_pk</span><span><span>=</span></span><span><span>'customer_id'</span></span><span>,
    src_nk</span><span><span>=</span></span><span><span>'customer_name'</span></span><span>,
    src_ldts</span><span><span>=</span></span><span><span>'created_at'</span></span><span>,
    src</span><span><span>=</span></span><span><span>'stg_customers'</span></span><span>,
    hub_name</span><span><span>=</span></span><span><span>'hub_customers'</span></span><span>
) }}
</span></span></code></p></div>
```

### –≠—Ç–æ:

-   –ò—Å–ø–æ–ª—å–∑—É–µ—Ç **—Å—Ç–∞—Ä—É—é —Å–∏–≥–Ω–∞—Ç—É—Ä—É –º–∞–∫—Ä–æ—Å–∞ `hub`**, —Ö–∞—Ä–∞–∫—Ç–µ—Ä–Ω—É—é –¥–ª—è **–≤–µ—Ä—Å–∏–π –¥–æ `0.8.x`** `dbtvault`.
    
-   –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å `src_`, —á—Ç–æ —É—Å—Ç–∞—Ä–µ–ª–æ.
    
-   –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —è–≤–Ω—ã–π –≤—ã–∑–æ–≤ —á–µ—Ä–µ–∑ `dbtvault.hub(...)` (–≤ –Ω–æ–≤—ã—Ö –≤–µ—Ä—Å–∏—è—Ö ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ).
    

___

## üîπ –ú–æ—è –≤–µ—Ä—Å–∏—è:

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span>{{ config(materialized</span><span><span>=</span></span><span><span>'table'</span></span><span>) }}

{{ dbtvault.hub(
    source</span><span><span>=</span></span><span><span>ref</span></span><span>(</span><span><span>'stg_customers'</span></span><span>),
    hub_name</span><span><span>=</span></span><span><span>'hub_customers'</span></span><span>,
    business_key</span><span><span>=</span></span><span><span>'customer_id'</span></span><span>,
    load_date</span><span><span>=</span></span><span><span>'created_at'</span></span><span>
) }}
</span></span></code></p></div>
```

### –≠—Ç–æ:

-   –°–æ–≤–º–µ—Å—Ç–∏–º–æ —Å **dbtvault >= 0.9.0** (–æ—Å–æ–±–µ–Ω–Ω–æ –≤–∞–∂–Ω–æ, —Ç–∞–∫ –∫–∞–∫ —É —Ç–µ–±—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ `0.9.2`).
    
-   –ò—Å–ø–æ–ª—å–∑—É–µ—Ç **–Ω–æ–≤—É—é —Å–∏–≥–Ω–∞—Ç—É—Ä—É**, –ø—Ä–∏–Ω—è—Ç—É—é –≤ `Datavault-UK/automate_dv` (–∑–∞–º–µ–Ω–∞ dbtvault).
    
-   –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ **–Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç** –º–∞–∫—Ä–æ—Å–æ–≤ —Å `dbtvault.hub(...)` (—á–µ—Ä–µ–∑ namespace).
    

___

## üìå –ö–ª—é—á–µ–≤—ã–µ –æ—Ç–ª–∏—á–∏—è

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –°—Ç–∞—Ä—ã–π —Å—Ç–∏–ª—å (`< 0.9`) | –ù–æ–≤—ã–π —Å—Ç–∏–ª—å (`>= 0.9`) |
| --- | --- | --- |
| –ò–º—è –º–∞–∫—Ä–æ—Å–∞ | `hub(...)` | `dbtvault.hub(...)` |
| –ü–∞—Ä–∞–º–µ—Ç—Ä—ã | `src_pk`, `src_nk`, `src_ldts` | `business_key`, `load_date` –∏ –¥—Ä |
| –°—Å—ã–ª–∫–∞ –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫ | `'stg_customers'` (—Å—Ç—Ä–æ–∫–∞) | `ref('stg_customers')` (Jinja) |
| –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è | –ù–µ—Ç | –î–∞ |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ | –£—Å—Ç–∞—Ä–µ–ª–æ | –ê–∫—Ç—É–∞–ª—å–Ω–æ |

___

## ‚ö†Ô∏è –ü–æ—á–µ–º—É —Ç–≤–æ–π –∫–æ–¥ –±–æ–ª—å—à–µ **–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç**?

–¢—ã –∏—Å–ø–æ–ª—å–∑—É–µ—à—å `dbtvault 0.9.2`, –∞ —Å –≤–µ—Ä—Å–∏–∏ `0.9.0` **—Å—Ç–∞—Ä—ã–µ –∏–º–µ–Ω–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –±–æ–ª—å—à–µ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è**. –ü–æ—ç—Ç–æ–º—É –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞:

```
<div><p>r</p><p><code><span><span>Compilation Error </span><span><span>in</span></span><span> model hub_customers
invalid syntax </span><span><span>for</span></span><span> </span><span><span>function</span></span><span> </span><span><span>call</span></span><span> </span><span><span>expression</span></span><span>
</span></span></code></p></div>
```

___

## ‚úÖ –í—ã–≤–æ–¥

-   **–¢–≤–æ—è –≤–µ—Ä—Å–∏—è** –±—ã–ª–∞ –≤–∞–ª–∏–¥–Ω–∞ –¥–æ `dbtvault 0.9.0`.
    
-   **–° –≤–µ—Ä—Å–∏–∏ 0.9.0** –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–Ω–æ–≤—É—é —Å–∏–≥–Ω–∞—Ç—É—Ä—É —Å `dbtvault.hub(...)`**.
    
-   –ü–µ—Ä–µ–ø–∏—Å—ã–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –Ω–µ –Ω—É–∂–Ω–æ ‚Äî —Ç–æ–ª—å–∫–æ **–æ–±–Ω–æ–≤–∏—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏ `ref()`**.
    

___

–•–æ—á–µ—à—å ‚Äî —è –ø–æ–º–æ–≥—É –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏ (`link`, `satellite`, `stg`) –∫ —ç—Ç–æ–π —Å–∏–≥–Ω–∞—Ç—É—Ä–µ, –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

—Å—Ç–æ–ø!!!! –º–æ—è –≤–µ—Ä—Å–∏—è –±—ã–ª–∞: {{ config(materialized='table') }} {{ dbtvault.hub( source=ref('stg\_customers'), -- staging –º–æ–¥–µ–ª—å —Å —Å—ã—Ä—ã–º–∏ –∫–ª–∏–µ–Ω—Ç–∞–º–∏ hub\_name='customers', -- –∏–º—è —Ö–∞–±–∞ (–±–µ–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞ hub\_) business\_key='customer\_id', -- –±–∏–∑–Ω–µ—Å-–∫–ª—é—á (–Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã–π –∫–ª—é—á) load\_date='created\_at' -- –¥–∞—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ) }} —Ç–≤–æ—è –≤–µ—Ä—Å–∏—è –≤–æ—Ç: {{ config(materialized='incremental') }} {% set source\_model = ref('stg\_customers') %} {% set hub\_config = { "src\_pk": "customer\_id", "src\_nk": "customer\_name", "src\_ldts": "created\_at", "src\_source": "dbt\_source", "hub\_name": "hub\_customers" } %} {{ automate\_dv.hub(source\_model, hub\_config) }} –∏—Ö —Å—Ä–∞–≤–Ω–∏–≤–∞–π! –∏ –∞–¥–∞–ø—Ç–∏—Ä—É–π –º–æ—é

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–û—Ç–ª–∏—á–Ω–æ! –¢–µ–ø–µ—Ä—å —è—Å–Ω–æ, —á—Ç–æ —Ç—ã —Ö–æ—Ç–µ–ª —Å—Ä–∞–≤–Ω–∏—Ç—å:

-   ‚úÖ **–¢–≤–æ—è –≤–µ—Ä—Å–∏—è** ‚Äî —É–∂–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `dbtvault.hub(...)` —Å –Ω–æ–≤—ã–º–∏ –∏–º–µ–Ω–∞–º–∏ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤.
    
-   ‚ö†Ô∏è **–ú–æ—è –≤–µ—Ä—Å–∏—è** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `automate_dv.hub(...)`, –¥—Ä—É–≥—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É (–∑–∞–º–µ–Ω–∞ dbtvault), **–¥—Ä—É–≥–æ–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –∏ –º–∞–∫—Ä–æ—Å**.
    

___

## üîç –ß—Ç–æ –º—ã —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º?

|  | –¢–≤–æ—è –≤–µ—Ä—Å–∏—è (`dbtvault`) | –ú–æ—è –≤–µ—Ä—Å–∏—è (`automate_dv`) |
| --- | --- | --- |
| –ú–∞–∫—Ä–æ—Å | `dbtvault.hub(...)` | `automate_dv.hub(...)` |
| –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è | –ê—Ä–≥—É–º–µ–Ω—Ç—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é | –ê—Ä–≥—É–º–µ–Ω—Ç—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `dict` –≤ `hub_config` |
| –§–æ—Ä–º–∞—Ç –≤—ã–∑–æ–≤–∞ –º–æ–¥–µ–ª–∏ | `ref('stg_customers')` –Ω–∞–ø—Ä—è–º—É—é | `source_model = ref(...)`, –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ `customer_name` | –£ —Ç–µ–±—è –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (`customer_id` ‚Äî —ç—Ç–æ ok) | –£ –º–µ–Ω—è –µ—Å—Ç—å –∫–∞–∫ `src_nk` |
| –ü–æ–¥—Ö–æ–¥ –∫ –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ | `materialized='table'` | `materialized='incremental'` |
| –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å | `dbtvault` (v0.9.2) | `automate_dv` (–Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç, –∑–∞–º–µ–Ω–∞ dbtvault) |

___

## üß† –í—ã–≤–æ–¥: –ø–æ—á–µ–º—É —Ç–∞–∫?

-   `dbtvault` –∏ `automate_dv` ‚Äî **—Ä–∞–∑–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏**, –∏ **—Å–∏–Ω—Ç–∞–∫—Å–∏—Å –º–∞–∫—Ä–æ—Å–æ–≤ —É –Ω–∏—Ö —Ä–∞–∑–Ω—ã–π**.
    
-   `automate_dv` —Ç—Ä–µ–±—É–µ—Ç `hub_config` –∫–∞–∫ —Å–ª–æ–≤–∞—Ä—å, –∞ `dbtvault` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ—Å—Ç—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã.
    
-   **–¢—ã –∏—Å–ø–æ–ª—å–∑—É–µ—à—å `dbtvault v0.9.2`**, –ø–æ—ç—Ç–æ–º—É —Ç–≤–æ–π –∫–æ–¥ —É–∂–µ **–∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω –∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π**.
    

___

## ‚úÖ –ß—Ç–æ –¥–µ–ª–∞—Ç—å?

–û—Å—Ç–∞–≤–∏—Ç—å **—Ç–≤–æ—é –≤–µ—Ä—Å–∏—é** –∫–∞–∫ –µ—Å—Ç—å, –æ–Ω–∞ **—Å–æ–≤–º–µ—Å—Ç–∏–º–∞ —Å `dbtvault v0.9.2`**:

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span>{{ config(materialized</span><span><span>=</span></span><span><span>'table'</span></span><span>) }}

{{ dbtvault.hub(
    source</span><span><span>=</span></span><span><span>ref</span></span><span>(</span><span><span>'stg_customers'</span></span><span>),
    hub_name</span><span><span>=</span></span><span><span>'customers'</span></span><span>,
    business_key</span><span><span>=</span></span><span><span>'customer_id'</span></span><span>,
    load_date</span><span><span>=</span></span><span><span>'created_at'</span></span><span>
) }}
</span></span></code></p></div>
```

___

## ‚ö†Ô∏è –ê –µ—Å–ª–∏ –∑–∞—Ö–æ—á–µ—à—å –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ `automate_dv` (–≤ –±—É–¥—É—â–µ–º)

–¢–æ–≥–¥–∞ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å –≤—Å–µ –≤—ã–∑–æ–≤—ã `dbtvault.*` –Ω–∞ `automate_dv.*` –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É `hub_config` –∏ –¥—Ä—É–≥–∏–µ –º–∞–∫—Ä–æ—Å—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, `automate_dv.sat`, `automate_dv.link`, –∏ —Ç.–¥.).

___

–ù—É–∂–Ω–æ –ª–∏ —Ç–µ–±–µ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—É—â–∏–π –ø—Ä–æ–µ–∫—Ç –ø–æ–¥ `automate_dv`? –ò–ª–∏ –æ—Å—Ç–∞—ë–º—Å—è –Ω–∞ `dbtvault` 0.9.2 –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –≤ —ç—Ç–æ–º —Å—Ç–∏–ª–µ?

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

—É–∂–µ –ª—É—á—à–µ –º–æ—è –≤–µ—Ä—Å–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑-–∑–∞ —É–∫–∞–∑–∞–Ω–Ω–æ–π –≤—ã—à–µ –æ—à–∏–±–∫–∏ –¥–∞–≤–∞–π —Ç–µ–ø–µ—Ä—å –ø–µ—Ä–µ–π–¥—ë–º –Ω–∞ automate\_dv —Ç–æ–ª—å–∫–æ, –µ—Å–ª–∏ –º–µ–Ω—è–µ—à—å —á—Ç–æ-—Ç–æ –≤ –∫–æ–Ω—Ñ–∏–≥–µ - –æ–±—ä—è—Å–Ω—è–π –ø–æ—á–µ–º—É

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–û—Ç–ª–∏—á–Ω–æ, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ `automate_dv`.

–í–æ—Ç –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –≤–∞—à–µ–≥–æ —Ñ–∞–π–ª–∞ `hub_customers.sql` —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `automate_dv`, —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–∞—è –≤–∞—à–µ–π –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏:

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span>{{ config(materialized</span><span><span>=</span></span><span><span>'incremental'</span></span><span>) }}

{</span><span><span>%</span></span><span> </span><span><span>set</span></span><span> source_model </span><span><span>=</span></span><span> </span><span><span>ref</span></span><span>(</span><span><span>'stg_customers'</span></span><span>) </span><span><span>%</span></span><span>}

{</span><span><span>%</span></span><span> </span><span><span>set</span></span><span> hub_config </span><span><span>=</span></span><span> {
    "src_pk": "customer_id",          </span><span><span>-- —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π surrogate key</span></span><span>
    "src_nk": "customer_name",        </span><span><span>-- –±–∏–∑–Ω–µ—Å-–∫–ª—é—á (–Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã–π –∫–ª—é—á)</span></span><span>
    "src_ldts": "created_at",         </span><span><span>-- –¥–∞—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏ (Load Date Timestamp)</span></span><span>
    "src_source": "dbt_source",       </span><span><span>-- –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö (–º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å –≤ .yml –∏–ª–∏ –∫–∞–∫ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Ç—Ä–æ–∫—É)</span></span><span>
    "hub_name": "hub_customers"       </span><span><span>-- –∏–º—è —Ö–∞–±–∞</span></span><span>
} </span><span><span>%</span></span><span>}

{{ automate_dv.hub(source_model, hub_config) }}
</span></span></code></p></div>
```

### –ü–æ—è—Å–Ω–µ–Ω–∏–µ –ø–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º:

| –ü–æ–ª–µ –≤ –∫–æ–Ω—Ñ–∏–≥–µ | –ü—Ä–∏—á–∏–Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è / –∏–∑–º–µ–Ω–µ–Ω–∏—è |
| --- | --- |
| `materialized='incremental'` | `automate_dv` –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É, —á—Ç–æ –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–µ–µ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞. |
| `src_pk` | –£–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è surrogate key (–æ–±—ã—á–Ω–æ —Ö—ç—à –æ—Ç –±–∏–∑–Ω–µ—Å-–∫–ª—é—á–∞). –í `automate_dv` —ç—Ç–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä. |
| `src_nk` | –≠—Ç–æ –≤–∞—à –±–∏–∑–Ω–µ—Å-–∫–ª—é—á (–Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã–π ID, –Ω–∞–ø—Ä–∏–º–µ—Ä, `customer_name`). |
| `src_ldts` | –î–∞—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∏—Å—Ç–æ—Ä–∏—á–Ω–æ—Å—Ç–∏ –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π. |
| `src_source` | –¢—Ä–µ–±—É–µ—Ç—Å—è `automate_dv` –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏. –ú–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º, –Ω–∞–ø—Ä–∏–º–µ—Ä `'postgres_raw'` –∏–ª–∏ –∫–∞–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è. |
| `hub_name` | –ò–º—è —Ä–µ–∑—É–ª—å—Ç–∏—Ä—É—é—â–µ–π —Ç–∞–±–ª–∏—Ü—ã (—Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `hub_` –ø–æ –∫–æ–Ω–≤–µ–Ω—Ü–∏–∏). |

### –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–∞–ª—å—à–µ:

1.  –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `customer_id` ‚Äî —ç—Ç–æ —É–∂–µ —Ö—ç—à, –ª–∏–±–æ –¥–æ–±–∞–≤—å—Ç–µ —Ö—ç—à-—Ñ—É–Ω–∫—Ü–∏—é –≤ `stg_customers`.
    
2.  –ó–Ω–∞—á–µ–Ω–∏–µ `src_source` –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –≤ YAML –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –º–æ–¥–µ–ª–µ–π (`models/hubs/hub_customers.yml`) –∫–∞–∫ `meta: source: postgres_raw`, —Ç–æ–≥–¥–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä –º–æ–∂–Ω–æ —É–±—Ä–∞—Ç—å –∏–∑ SQL.
    
3.  –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ `packages.yml`:
    
    ```
    <div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>packages:</span></span><span>
      </span><span><span>-</span></span><span> </span><span><span>package:</span></span><span> </span><span><span>Datavault-UK/automate_dv</span></span><span>
        </span><span><span>version:</span></span><span> [</span><span><span>"&gt;=0.9.0"</span></span><span>, </span><span><span>"&lt;1.0.0"</span></span><span>]
    </span></span></code></p></div>
    ```
    

–ï—Å–ª–∏ –≤—Å—ë —ç—Ç–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ, –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∫ –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ `link` –∏ `satellite` –º–æ–¥–µ–ª–µ–π. –ì–æ—Ç–æ–≤ –ø–æ–º–æ—á—å.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–¥–æ —ç—Ç–æ–≥–æ –ø—Ä–µ–¥–∞–ª–∞–≥–∞–ª–∞ –≤–æ—Ç —Ç–∞–∫: packages: - package: Datavault-UK/automate\_dv version: 0.10.0 # –∏–ª–∏ latest –Ω–∞ –º–æ–º–µ–Ω—Ç —á—Ç–µ–Ω–∏—è - package: dbt-labs/dbt\_utils version: 1.3.0 –≤ —á—ë–º —Ä–∞–∑–Ω–∏—Ü–∞? —á—Ç–æ –ª—É—á—à–µ?

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å ‚Äî –¥–∞–≤–∞–π —Å—Ä–∞–≤–Ω–∏–º:

___

## üí° –†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É:

### ‚úÖ –í–∞—Ä–∏–∞–Ω—Ç 1 (–∂—ë—Å—Ç–∫–∞—è –≤–µ—Ä—Å–∏—è)

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>packages:</span></span><span>
  </span><span><span>-</span></span><span> </span><span><span>package:</span></span><span> </span><span><span>Datavault-UK/automate_dv</span></span><span>
    </span><span><span>version:</span></span><span> </span><span><span>0.10</span></span><span><span>.0</span></span><span>
  </span><span><span>-</span></span><span> </span><span><span>package:</span></span><span> </span><span><span>dbt-labs/dbt_utils</span></span><span>
    </span><span><span>version:</span></span><span> </span><span><span>1.3</span></span><span><span>.0</span></span><span>
</span></span></code></p></div>
```

### ‚úÖ –í–∞—Ä–∏–∞–Ω—Ç 2 (–≥–∏–±–∫–∏–π –¥–∏–∞–ø–∞–∑–æ–Ω –≤–µ—Ä—Å–∏–π)

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>packages:</span></span><span>
  </span><span><span>-</span></span><span> </span><span><span>package:</span></span><span> </span><span><span>Datavault-UK/automate_dv</span></span><span>
    </span><span><span>version:</span></span><span> [</span><span><span>"&gt;=0.9.0"</span></span><span>, </span><span><span>"&lt;1.0.0"</span></span><span>]
  </span><span><span>-</span></span><span> </span><span><span>package:</span></span><span> </span><span><span>dbt-labs/dbt_utils</span></span><span>
    </span><span><span>version:</span></span><span> [</span><span><span>"&gt;=1.0.0"</span></span><span>, </span><span><span>"&lt;2.0.0"</span></span><span>]
</span></span></code></p></div>
```

___

## üìå –í —á—ë–º —Ä–∞–∑–Ω–∏—Ü–∞?

| –°–≤–æ–π—Å—Ç–≤–æ | –ñ—ë—Å—Ç–∫–∞—è –≤–µ—Ä—Å–∏—è (`version: 0.10.0`) | –î–∏–∞–ø–∞–∑–æ–Ω –≤–µ—Ä—Å–∏–π (`[">=0.9.0", "<1.0.0"]`) |
| --- | --- | --- |
| üì¶ –ö–æ–Ω—Ç—Ä–æ–ª—å —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π ‚Äî –≤—Å–µ–≥–¥–∞ –æ–¥–Ω–∞ –≤–µ—Ä—Å–∏—è | –ú–µ–Ω–µ–µ —Å—Ç—Ä–æ–≥–∏–π, –º–æ–∂–µ—Ç –ø–æ–¥—Ç—è–Ω—É—Ç—å –Ω–æ–≤—É—é |
| üîÅ –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ `dbt deps` | ‚ùå –ù–µ—Ç | ‚úÖ –î–∞, –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –Ω–æ–≤–æ–π –ø–æ–¥—Ö–æ–¥—è—â–µ–π –≤–µ—Ä—Å–∏–∏ |
| üêõ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–ª–æ–≤–∏—Ç—å –±–∞–≥–∏ | –ú–µ–Ω—å—à–µ | –ë–æ–ª—å—à–µ (–µ—Å–ª–∏ –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è –æ–∫–∞–∂–µ—Ç—Å—è —Å –±–∞–≥–æ–º) |
| üîç –ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å —Å—Ä–µ–¥—ã | ‚úÖ –î–∞ | ‚ùå –ù–µ—Ç ‚Äî —Å—Ä–µ–¥–∞ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å—Å—è |

___

## ü§î –ß—Ç–æ –ª—É—á—à–µ?

-   **–î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞** ‚Äî **–ñ–Å–°–¢–ö–ê–Ø –í–ï–†–°–ò–Ø (`0.10.0`)**  
    ‚úÖ –¢—ã —Ç–æ—á–Ω–æ –∑–Ω–∞–µ—à—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å, –∏ –∏–∑–±–µ–≥–∞–µ—Ç–µ —Å—é—Ä–ø—Ä–∏–∑–æ–≤ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏.
    
-   **–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ / —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤** ‚Äî **–î–∏–∞–ø–∞–∑–æ–Ω (`[">=0.9.0", "<1.0.0"]`)**  
    ‚úÖ –ü–æ–ª—É—á–∞–µ—à—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –Ω–æ–≤—ã–µ —Ñ–∏—á–∏, –Ω–æ —ç—Ç–æ –º–æ–∂–µ—Ç —Å–ª—É—á–∞–π–Ω–æ —á—Ç–æ-—Ç–æ —Å–ª–æ–º–∞—Ç—å.
    

___

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

–¢–≤–æ–π –ø—Ä–æ–µ–∫—Ç ‚Äî **–Ω–∞ —ç—Ç–∞–ø–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤**, –ø–æ—ç—Ç–æ–º—É **–º–æ–∂–Ω–æ –Ω–∞—á–∞—Ç—å —Å –≥–∏–±–∫–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞**, –∞ –∫–∞–∫ —Ç–æ–ª—å–∫–æ —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä—É–µ—à—å ‚Äî –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å `version: 0.10.0` –≤ `packages.yml`.

–ú–æ–∂–Ω–æ –µ—â—ë —Å–æ–∑–¥–∞—Ç—å `requirements.txt` –∏–ª–∏ `manifest.lock.yml` –∏ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ ‚Äî —Ç–æ–≥–¥–∞ –±—É–¥–µ—Ç 100% –ø–æ–≤—Ç–æ—Ä—è–µ–º–æ—Å—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏—è. –ï—Å–ª–∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ ‚Äî –ø–æ–∫–∞–∂—É –∫–∞–∫.

–•–æ—á–µ—à—å –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ —Å–µ–π—á–∞—Å?

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–Ω–æ —Ä–∞–∑–Ω–∏—Ü–∞ –Ω–µ —Ç–æ–ª—å–∫–æ –≤ –≤–µ—Ä—Å–∏–∏ —Ç—ã –µ—â—ë –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–ª–∞ –±–µ–∑ –ø–∞–∫–µ—Ç–∞ dbt-labs/dbt\_utils –æ–Ω –Ω–∞–º –Ω—É–∂–µ–Ω?

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å ‚Äî —Ç—ã –∞–±—Å–æ–ª—é—Ç–Ω–æ –ø—Ä–∞–≤: —Ä–∞–Ω—å—à–µ —è –ø—Ä–µ–¥–ª–∞–≥–∞–ª–∞ –≤–∞—Ä–∏–∞–Ω—Ç –±–µ–∑ `dbt-labs/dbt_utils`. –î–∞–≤–∞–π —Ä–∞–∑–±–µ—Ä—ë–º—Å—è, **–Ω—É–∂–µ–Ω –ª–∏ –æ–Ω —Ç–µ–±–µ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ `automate_dv`**.

___

## ‚öôÔ∏è `dbt-labs/dbt_utils`: –∑–∞—á–µ–º –æ–Ω –Ω—É–∂–µ–Ω?

–≠—Ç–æ **–Ω–∞–±–æ—Ä –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö –º–∞–∫—Ä–æ—Å–æ–≤**, –∫–æ—Ç–æ—Ä—ã–π:

-   –£–ø—Ä–æ—â–∞–µ—Ç —Ä–∞–±–æ—Ç—É —Å null-–∑–Ω–∞—á–µ–Ω–∏—è–º–∏, —Ç–∏–ø–∞–º–∏, `surrogate_key`, union-–∞–º–∏, etc.
    
-   –ß–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –º–æ–¥–µ–ª—è—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, staging –∏–ª–∏ —Ä–µ–ø–æ—Ä—Ç–Ω—ã—Ö —Å–ª–æ—è—Ö).
    
-   –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–Ω–æ–≥–∏–º–∏ —Å—Ç–æ—Ä–æ–Ω–Ω–∏–º–∏ –ø–∞–∫–µ—Ç–∞–º–∏ (–≤–∫–ª—é—á–∞—è —Å—Ç–∞—Ä—ã–π `dbtvault`).
    

___

## ü§ñ `automate_dv` –∏ `dbt_utils`

### üîç –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ª–∏ —Ç—Ä–µ–±—É–µ—Ç `automate_dv` –ø–∞–∫–µ—Ç `dbt_utils`?

**–ù–µ—Ç.** –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç `dbtvault`, **–ø–∞–∫–µ—Ç `automate_dv` –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç `dbt_utils` –Ω–∞–ø—Ä—è–º—É—é**.

–û–¥–Ω–∞–∫–æ:

-   **–¢—ã —Å–∞–º –º–æ–∂–µ—à—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∞–∫—Ä–æ—Å—ã –∏–∑ `dbt_utils` –≤ —Å–≤–æ–∏—Ö `stg_`\-–º–æ–¥–µ–ª—è—Ö –∏–ª–∏ –æ—Ç—á—ë—Ç–∞—Ö.**
    
-   –û–Ω–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω—ã –ø—Ä–∏ –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–µ –¥–∞–Ω–Ω—ã—Ö, –Ω–∞–ø—Ä–∏–º–µ—Ä:
    
    ```
    <div><p>sql</p><p><code id="code-lang-sql"><span><span>{{ dbt_utils.surrogate_key([</span><span><span>'col1'</span></span><span>, </span><span><span>'col2'</span></span><span>]) }}
    </span></span></code></p></div>
    ```
    

___

## üìå –ö–æ–≥–¥–∞ —Ç–æ—á–Ω–æ —Å—Ç–æ–∏—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å `dbt_utils`

–ü–æ–¥–∫–ª—é—á–∞–π, –µ—Å–ª–∏:

-   –¢—ã –∏—Å–ø–æ–ª—å–∑—É–µ—à—å `dbt_utils.surrogate_key`, `safe_cast`, `date_spine`, `generate_surrogate_key`, `union_relations` –∏ –¥—Ä.
    
-   –¢—ã —Ö–æ—á–µ—à—å –ø–∏—Å–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–µ –º–æ–¥–µ–ª–∏ –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ `automate_dv`.
    
-   –¢—ã –ø–ª–∞–Ω–∏—Ä—É–µ—à—å —Ä–∞—Å—à–∏—Ä—è—Ç—å –ø—Ä–æ–µ–∫—Ç –∏ —Å—Ç—Ä–æ–∏—Ç—å –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è.
    

___

## üß† –í—ã–≤–æ–¥

| –°—Ü–µ–Ω–∞—Ä–∏–π | –ù—É–∂–Ω–æ –ª–∏ `dbt_utils`? |
| --- | --- |
| –¢–æ–ª—å–∫–æ `automate_dv`, –∏ –Ω–∏—á–µ–≥–æ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ | ‚ùå –ù–µ—Ç |
| –ò—Å–ø–æ–ª—å–∑—É–µ—à—å `stg_*.sql`, union, –∫–ª—é—á–∏ –∏ —Ç.–ø. | ‚úÖ –î–∞ |
| –•–æ—á–µ—à—å –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ö–µ–ª–ø–µ—Ä—ã | ‚úÖ –î–∞ |

___

## ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

–¢—ã —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å `stg_customers.sql` –∏ `stg_orders.sql`. –î–∞–∂–µ –µ—Å–ª–∏ —Å–µ–π—á–∞—Å –æ–Ω–∏ –ø—Ä–æ—Å—Ç—ã–µ ‚Äî **–≤ –±—É–¥—É—â–µ–º `dbt_utils` —Ç–æ—á–Ω–æ –ø—Ä–∏–≥–æ–¥–∏—Ç—Å—è**.

**–û—Å—Ç–∞–≤—å `dbt-labs/dbt_utils` –≤ `packages.yml`** ‚Äî –≤—Ä–µ–¥–∞ –Ω–µ –±—É–¥–µ—Ç, –∞ –≥–∏–±–∫–æ—Å—Ç–∏ –¥–æ–±–∞–≤–∏—Ç.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

—Ö–æ—Ä–æ—à–µ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ, —Å–ø–∞—Å–∏–±–æ —Ç–µ–ø–µ—Ä—å –¥–∞–≤–∞–π –∞–¥–∞–ø—Ç–∏—Ä—É–µ–º link, satellite, staging –ø–æ–¥ —Ç–æ—Ç –∂–µ —Å—Ç–∏–ª—å

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–û—Ç–ª–∏—á–Ω–æ, –ø—Ä–æ–¥–æ–ª–∂–∏–º –≤ —Å—Ç–∏–ª–µ `automate_dv`, –∫–∞–∫ –≤ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–º `hub_customers.sql`. –í–æ—Ç –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –º–æ–¥–µ–ª–µ–π **link**, **satellite** –∏ **staging**:

___

### `models/links/link_customer_orders.sql`

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span>{{ config(materialized</span><span><span>=</span></span><span><span>'incremental'</span></span><span>) }}

{</span><span><span>%</span></span><span> </span><span><span>set</span></span><span> source_model </span><span><span>=</span></span><span> </span><span><span>ref</span></span><span>(</span><span><span>'stg_orders'</span></span><span>) </span><span><span>%</span></span><span>}

{</span><span><span>%</span></span><span> </span><span><span>set</span></span><span> link_config </span><span><span>=</span></span><span> {
    "src_pk": "customer_order_pk",
    "src_fk": ["customer_id", "order_id"],
    "src_ldts": "created_at",
    "src_source": "dbt_source",
    "link_name": "link_customer_orders"
} </span><span><span>%</span></span><span>}

{{ automate_dv.link(source_model, link_config) }}
</span></span></code></p></div>
```

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ**:

-   `src_pk` ‚Äî —Å–æ—Å—Ç–∞–≤–Ω–æ–π surrogate key (–º–æ–∂–µ—Ç –±—ã—Ç—å md5 –æ—Ç fks, –µ—Å–ª–∏ —Ç—ã –µ–≥–æ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—à—å –Ω–∞ —Å—Ç–∞–¥–∏–∏).
    
-   `src_fk` ‚Äî —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ö–∞–±—ã, —É—á–∞—Å—Ç–≤—É—é—â–∏–µ –≤ —Å–≤—è–∑–∏.
    
-   `src_source` ‚Äî —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –º–æ–∂–Ω–æ —Å—Ç–∞–≤–∏—Ç—å `"dbt_source"`, –µ—Å–ª–∏ –Ω–µ—Ç –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞.
    

___

### `models/satellites/sat_customer_details.sql`

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span>{{ config(materialized</span><span><span>=</span></span><span><span>'incremental'</span></span><span>) }}

{</span><span><span>%</span></span><span> </span><span><span>set</span></span><span> source_model </span><span><span>=</span></span><span> </span><span><span>ref</span></span><span>(</span><span><span>'stg_customers'</span></span><span>) </span><span><span>%</span></span><span>}

{</span><span><span>%</span></span><span> </span><span><span>set</span></span><span> sat_config </span><span><span>=</span></span><span> {
    "src_pk": "customer_id",
    "src_hashdiff": "customer_hashdiff",
    "src_payload": ["customer_name"],
    "src_ldts": "created_at",
    "src_source": "dbt_source",
    "sat_name": "sat_customer_details"
} </span><span><span>%</span></span><span>}

{{ automate_dv.sat(source_model, sat_config) }}
</span></span></code></p></div>
```

**–í–∞–∂–Ω–æ**:

-   `src_hashdiff` ‚Äî –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞—Ä–∞–Ω–µ–µ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω –≤ staging. –û–±—ã—á–Ω–æ `md5(concat(payload_columns))`.
    

___

### `models/staging/stg_orders.sql`

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span>{{ config(materialized</span><span><span>=</span></span><span><span>'view'</span></span><span>) }}

</span><span><span>with</span></span><span> source </span><span><span>as</span></span><span> (

    </span><span><span>select</span></span><span> </span><span><span>*</span></span><span> </span><span><span>from</span></span><span> {{ source(</span><span><span>'public'</span></span><span>, </span><span><span>'raw_orders'</span></span><span>) }}

),

renamed </span><span><span>as</span></span><span> (

    </span><span><span>select</span></span><span>
        id </span><span><span>as</span></span><span> order_id,
        customer_id,
        created_at,
        {{ dbt_utils.generate_surrogate_key([</span><span><span>'customer_id'</span></span><span>, </span><span><span>'order_id'</span></span><span>]) }} </span><span><span>as</span></span><span> customer_order_pk
    </span><span><span>from</span></span><span> source

)

</span><span><span>select</span></span><span> </span><span><span>*</span></span><span> </span><span><span>from</span></span><span> renamed
</span></span></code></p></div>
```

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ, –¥–æ–±–∞–≤–∏–º `hashdiff` –¥–ª—è satellite:

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span>    , md5(</span><span><span>coalesce</span></span><span>(customer_name, </span><span><span>''</span></span><span>)) </span><span><span>as</span></span><span> customer_hashdiff
</span></span></code></p></div>
```

(–≤ staging `stg_customers.sql`, –≥–¥–µ customer\_name ‚Äî —ç—Ç–æ payload)

___

–ï—Å–ª–∏ —Ç—ã —Ö–æ—á–µ—à—å, —á—Ç–æ–±—ã –º—ã —Ç–∞–∫–∂–µ –¥–æ–±–∞–≤–∏–ª–∏ `stg_customers.sql` —Å `hashdiff`, —Å–∫–∞–∂–∏ ‚Äî —è –ø—Ä–∏—à–ª—é –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–í–æ—Ç –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è `stg_customers.sql`, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∞—è —Å—Ç–∏–ª—é `automate_dv` –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –º–æ–¥–µ–ª–µ–π `hub` –∏ `satellite`.

___

### `models/staging/stg_customers.sql`

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span>{{ config(materialized</span><span><span>=</span></span><span><span>'view'</span></span><span>) }}

</span><span><span>with</span></span><span> source </span><span><span>as</span></span><span> (

    </span><span><span>select</span></span><span> </span><span><span>*</span></span><span> </span><span><span>from</span></span><span> {{ source(</span><span><span>'public'</span></span><span>, </span><span><span>'raw_customers'</span></span><span>) }}

),

renamed </span><span><span>as</span></span><span> (

    </span><span><span>select</span></span><span>
        id </span><span><span>as</span></span><span> customer_id,
        name </span><span><span>as</span></span><span> customer_name,
        created_at,
        md5(</span><span><span>coalesce</span></span><span>(name, </span><span><span>''</span></span><span>)) </span><span><span>as</span></span><span> customer_hashdiff
    </span><span><span>from</span></span><span> source

)

</span><span><span>select</span></span><span> </span><span><span>*</span></span><span> </span><span><span>from</span></span><span> renamed
</span></span></code></p></div>
```

___

### –ü–æ—è—Å–Ω–µ–Ω–∏–µ:

-   `customer_id` ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ `src_pk` –≤ —Ö–∞–±–µ.
    
-   `customer_name` ‚Äî —ç—Ç–æ payload –≤ satellite.
    
-   `customer_hashdiff` ‚Äî –Ω–µ–æ–±—Ö–æ–¥–∏–º –¥–ª—è –º–æ–¥–µ–ª–∏ satellite (`src_hashdiff`).
    
-   `created_at` ‚Äî –¥–∞—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏ (`src_ldts`).
    
-   `md5(coalesce(name, ''))` ‚Äî –±–∞–∑–æ–≤–∞—è —Ñ–æ—Ä–º–∞ —Ö—ç—à-–¥–∏—Ñ—Ñ–∞. –ï—Å–ª–∏ payload –±—É–¥–µ—Ç —Å–æ—Å—Ç–æ—è—Ç—å –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ–ª–µ–π, –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –¥–µ–ª–∞—Ç—å `md5(concat(coalesce(...), ...))`.
    

–ï—Å–ª–∏ payload —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–æ–ª–æ–Ω–æ–∫, –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `dbt_utils.surrogate_key()`:

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span>{{ dbt_utils.generate_surrogate_key([</span><span><span>'customer_name'</span></span><span>, </span><span><span>'other_column'</span></span><span>]) }} </span><span><span>as</span></span><span> customer_hashdiff
</span></span></code></p></div>
```

–ì–æ—Ç–æ–≤ –ø–æ–º–æ—á—å –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–æ –ø–æ–¥ –ª—é–±—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö, –µ—Å–ª–∏ –æ–Ω–∞ —Å—Ç–∞–Ω–µ—Ç —Å–ª–æ–∂–Ω–µ–µ.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–∑–∞–ø—É—Å—Ç–∏–ª –±–∏–ª–¥ docker compose –æ—à–∏–±–∫–∞ dbt: 20:24:26 Running with dbt=1.9.6 20:24:30 Updating lock file in file path: /usr/app/package-lock.yml 20:24:30 Installing Datavault-UK/automate\_dv 20:24:33 Installed from version 0.11.2 20:24:33 Up to date! 20:24:33 Installing dbt-labs/dbt\_utils 20:24:38 Installed from version 1.3.0 20:24:38 Up to date! 20:24:42 Running with dbt=1.9.6 20:24:42 Registered adapter: postgres=1.9.0 20:24:42 Unable to do partial parsing because a project dependency has been added 20:24:42 Unable to do partial parsing because a project config has changed 20:24:47 Encountered an error: Compilation Error in model hub\_customers (models/hubs/hub\_customers.sql) expected token ':', got 'surrogate' line 6 "src\_pk": "customer\_id", -- —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π surrogate key –Ω–µ —Ç–æ—Ä–æ–ø–∏—Å—å —Å –æ—Ç–≤–µ—Ç–æ–º –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞–∫–∏–µ-—Ç–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã - –∑–∞–ø—Ä–∞—à–∏–≤–∞–π –ø–æ –æ–¥–Ω–æ–º—É —Ä–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–∞–≤–∞–π –ø–æ –æ–¥–Ω–æ–π

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–ü–æ–Ω—è–ª, –±—É–¥–µ–º —Ä–∞–∑–±–∏—Ä–∞—Ç—å—Å—è –ø–æ —à–∞–≥–∞–º.

–î–ª—è –Ω–∞—á–∞–ª–∞ –ø—Ä–∏—à–ª–∏, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, —Ç–≤–æ–π —Ç–µ–∫—É—â–∏–π —Ñ–∞–π–ª `hub_customers.sql` (–∏–ª–∏ —Ç–æ—Ç —Ñ–∞–π–ª, –≥–¥–µ –≤–æ–∑–Ω–∏–∫–ª–∞ –æ—à–∏–±–∫–∞ —Å `expected token ':'`), —á—Ç–æ–±—ã –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É. –≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç –ø–æ–Ω—è—Ç—å, –ø–æ—á–µ–º—É –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä dbt —Ä—É–≥–∞–µ—Ç—Å—è.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

hub\_customers.sql: {{ config(materialized='incremental') }} {% set source\_model = ref('stg\_customers') %} {% set hub\_config = { "src\_pk": "customer\_id", -- —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π surrogate key "src\_nk": "customer\_name", -- –±–∏–∑–Ω–µ—Å-–∫–ª—é—á (–Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã–π –∫–ª—é—á) "src\_ldts": "created\_at", -- –¥–∞—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏ (Load Date Timestamp) "src\_source": "dbt\_source", -- –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö (–º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å –≤ .yml –∏–ª–∏ –∫–∞–∫ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Ç—Ä–æ–∫—É) "hub\_name": "hub\_customers" -- –∏–º—è —Ö–∞–±–∞ } %} {{ automate\_dv.hub(source\_model, hub\_config) }}

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–°–ø–∞—Å–∏–±–æ, —Ç–µ–ø–µ—Ä—å –ø–æ–Ω—è—Ç–Ω–æ, –≥–¥–µ –æ—à–∏–±–∫–∞.

–°—É—Ç—å –æ—à–∏–±–∫–∏ `expected token ':', got 'surrogate'` —Å–≤—è–∑–∞–Ω–∞ —Å —Ç–µ–º, —á—Ç–æ –≤ Jinja-—à–∞–±–ª–æ–Ω–µ –≤–Ω—É—Ç—Ä–∏ —Å–ª–æ–≤–∞—Ä—è Python (`hub_config = { ... }`) –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è **–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —Å `--`**. –í Python (–∏ –≤ Jinja, –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Python-—Å–∏–Ω—Ç–∞–∫—Å–∏—Å) —Ç–∞–∫ –¥–µ–ª–∞—Ç—å –Ω–µ–ª—å–∑—è ‚Äî –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤–Ω—É—Ç—Ä–∏ —Å–ª–æ–≤–∞—Ä—è –Ω—É–∂–Ω–æ –ª–∏–±–æ –ø–∏—Å–∞—Ç—å —á–µ—Ä–µ–∑ `#` (—Ç–æ–ª—å–∫–æ –≤ –æ–±—ã—á–Ω–æ–º Python –∫–æ–¥–µ), –ª–∏–±–æ –≤–æ–æ–±—â–µ —É–±—Ä–∞—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤–Ω—É—Ç—Ä–∏ —Å–ª–æ–≤–∞—Ä—è.

–¢–æ –µ—Å—Ç—å, —Ç–≤–æ–π —Å–ª–æ–≤–∞—Ä—å:

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{% set hub_config = {
    "src_pk": "customer_id",          -- —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π surrogate key
    "src_nk": "customer_name",        -- –±–∏–∑–Ω–µ—Å-–∫–ª—é—á (–Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã–π –∫–ª—é—á)
    "src_ldts": "created_at",         -- –¥–∞—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏ (Load Date Timestamp)
    "src_source": "dbt_source",       -- –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö (–º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å –≤ .yml –∏–ª–∏ –∫–∞–∫ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Ç—Ä–æ–∫—É)
    "hub_name": "hub_customers"       -- –∏–º—è —Ö–∞–±–∞
} %}
</span></code></p></div>
```

–Ω—É–∂–Ω–æ –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å **–±–µ–∑** `-- –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤` –≤–Ω—É—Ç—Ä–∏:

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{% set hub_config = {
    "src_pk": "customer_id",
    "src_nk": "customer_name",
    "src_ldts": "created_at",
    "src_source": "dbt_source",
    "hub_name": "hub_customers"
} %}
</span></code></p></div>
```

–ò–ª–∏, –µ—Å–ª–∏ —Ö–æ—á–µ—à—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, –≤—ã–Ω–µ—Å–∏ –∏—Ö –∑–∞ –ø—Ä–µ–¥–µ–ª—ã —Å–ª–æ–≤–∞—Ä—è:

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{# —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π surrogate key #}
{# –±–∏–∑–Ω–µ—Å-–∫–ª—é—á (–Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã–π –∫–ª—é—á) #}
{# –¥–∞—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏ (Load Date Timestamp) #}
{# –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö (–º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å –≤ .yml –∏–ª–∏ –∫–∞–∫ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Ç—Ä–æ–∫—É) #}
{# –∏–º—è —Ö–∞–±–∞ #}

{% set hub_config = {
    "src_pk": "customer_id",
    "src_nk": "customer_name",
    "src_ldts": "created_at",
    "src_source": "dbt_source",
    "hub_name": "hub_customers"
} %}
</span></code></p></div>
```

___

**–ò—Ç–æ–≥:**

–í Jinja —à–∞–±–ª–æ–Ω–∞—Ö –∏ Python-—Å–ª–æ–≤–∞—Ä—è—Ö –Ω–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SQL-–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ `--` –≤–Ω—É—Ç—Ä–∏ —Å–ª–æ–≤–∞—Ä—è, –Ω—É–∂–Ω–æ —É–±—Ä–∞—Ç—å –∏–ª–∏ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ Jinja `{# ... #}` –≤–Ω–µ —Å–ª–æ–≤–∞—Ä—è.

___

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å ‚Äî –ø—Ä–∏—à–ª–∏ —Å–ª–µ–¥—É—é—â–∏–π —Ñ–∞–π–ª (–Ω–∞–ø—Ä–∏–º–µ—Ä `link_customer_orders.sql`), –ø–æ—Å–º–æ—Ç—Ä–∏–º —Ç–∞–º —Ç–æ–∂–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏–ª–∏ –¥—Ä—É–≥–∏–µ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏–ª –±–∏–ª–¥ –±–µ–∑ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ 20:34:32 Encountered an error: Compilation Error in model hub\_customers (models/hubs/hub\_customers.sql) The object (""dbt"."public"."hub\_customers"") was used as a dictionary. This capability has been removed from objects of this type. > in macro is\_list (macros/internal/helpers/is\_checks.sql) > called by macro expand\_column\_list (macros/internal/metadata\_processing/expand\_column\_list.sql) > called by macro postgres\_\_hub (macros/tables/postgres/hub.sql) > called by macro hub (macros/tables/snowflake/hub.sql) > called by model hub\_customers (models/hubs/hub\_customers.sql) –Ω–µ —Ç–æ—Ä–æ–ø–∏—Å—å —Å –æ—Ç–≤–µ—Ç–æ–º –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞–∫–∏–µ-—Ç–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã - –∑–∞–ø—Ä–∞—à–∏–≤–∞–π –ø–æ –æ–¥–Ω–æ–º—É —Ä–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–∞–≤–∞–π –ø–æ –æ–¥–Ω–æ–π

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–ü–æ–Ω—è–ª, –æ—à–∏–±–∫–∞ —Å–≤—è–∑–∞–Ω–∞ —Å —Ç–µ–º, —á—Ç–æ –≤ –º–∞–∫—Ä–æ—Å–µ `hub` –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –æ–±—ä–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π DBT –æ–∂–∏–¥–∞–µ—Ç –∫–∞–∫ —Å–ª–æ–≤–∞—Ä—å (dict), –∞ –ø–æ–ª—É—á–∏–ª –æ–±—ä–µ–∫—Ç —Ç–∏–ø–∞ relation (—Ç–∞–±–ª–∏—Ü—É –∏–ª–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ).

–≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∏–∑-–∑–∞ —Ç–æ–≥–æ, —á—Ç–æ –≤ —Ç–≤–æ—ë–º –≤—ã–∑–æ–≤–µ –º–∞–∫—Ä–æ—Å–∞ `automate_dv.hub(source_model, hub_config)` `source_model` ‚Äî —ç—Ç–æ —É–∂–µ –Ω–µ –ø—Ä–æ—Å—Ç–æ —Å—Ç—Ä–æ–∫–∞ –∏–ª–∏ –∏–º—è –º–æ–¥–µ–ª–∏, –∞ **–æ–±—ä–µ–∫—Ç relation**, –∫–æ—Ç–æ—Ä—ã–π dbt —Å–æ–∑–¥–∞–µ—Ç —á–µ—Ä–µ–∑ `ref()`.

### –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –∫–∞–∫ –ø–æ–ø—Ä–∞–≤–∏—Ç—å:

1.  **–ü—Ä–æ–≤–µ—Ä—å, –∫–∞–∫ –∏–º–µ–Ω–Ω–æ –¥–æ–ª–∂–µ–Ω –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä `source` –≤ –º–∞–∫—Ä–æ—Å–µ `hub` –ø–∞–∫–µ—Ç–∞ `automate_dv`:**
    
    -   –ù—É–∂–Ω–æ –ª–∏ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å —Å—Ç—Ä–æ–∫—É —Å –∏–º–µ–Ω–µ–º –º–æ–¥–µ–ª–∏ (`'stg_customers'`), –∏–ª–∏ –∂–µ –æ–±—ä–µ–∫—Ç, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π `ref()`?
        
2.  –ï—Å–ª–∏ –ø–∞–∫–µ—Ç –æ–∂–∏–¥–∞–µ—Ç –∏–º—è –º–æ–¥–µ–ª–∏, –ø–æ–ø—Ä–æ–±—É–π –≤–º–µ—Å—Ç–æ:
    
    ```
    <div><p>jinja</p><p><code id="code-lang-jinja"><span>{% set source_model = ref('stg_customers') %}
    {{ automate_dv.hub(source_model, hub_config) }}
    </span></code></p></div>
    ```
    
    —Å–¥–µ–ª–∞—Ç—å:
    
    ```
    <div><p>jinja</p><p><code id="code-lang-jinja"><span>{% set source_model = 'stg_customers' %}
    {{ automate_dv.hub(source_model, hub_config) }}
    </span></code></p></div>
    ```
    
3.  –ò–ª–∏, –µ—Å–ª–∏ `hub` –æ–∂–∏–¥–∞–µ—Ç **–æ–±—ä–µ–∫—Ç `ref`**, —Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ –Ω–∞–¥–æ –º–µ–Ω—è—Ç—å –Ω–µ –≤—ã–∑–æ–≤, –∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—É `hub_config`.
    

___

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**  
–°–Ω–∞—á–∞–ª–∞ –ø—Ä–∏—à–ª–∏, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –º–∞–∫—Ä–æ—Å–∞ `hub` –∏–∑ –ø–∞–∫–µ—Ç–∞ `automate_dv` (–∏–ª–∏ —Ö–æ—Ç—è –±—ã –ø—É—Ç—å –∫ –Ω–µ–º—É) ‚Äî —Ç–∞–∫ —è —Ç–æ—á–Ω–æ —É–≤–∏–∂—É, –∫–∞–∫ –æ–Ω –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∏ —á–µ–≥–æ –∏–º–µ–Ω–Ω–æ –æ–∂–∏–¥–∞–µ—Ç. –≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –¥–∞—Ç—å —Ç–æ—á–Ω—ã–π —Å–æ–≤–µ—Ç.

–ò–ª–∏, –µ—Å–ª–∏ –Ω–µ –º–æ–∂–µ—à—å –ø–æ–ª—É—á–∏—Ç—å –º–∞–∫—Ä–æ—Å, —Ç–æ –ø—Ä–∏—à–ª–∏ —Å–≤–æ–π `dbt_project.yml` –∏ `packages.yml`, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å –≤–µ—Ä—Å–∏–∏ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é.  
–ù–∞—á–Ω—ë–º —Å –æ–¥–Ω–æ–≥–æ –∏–∑ —ç—Ç–∏—Ö —Ñ–∞–π–ª–æ–≤?

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

1\. –≤–æ—Ç —Ç–∞–∫ –Ω–∞–ø–∏—Å–∞–Ω–æ –≤ C:\\Projects\\Python\\data-vault-dbt\\dbt\\dbt\_packages\\automate\_dv\\README.md: # Call the macro {{ automate\_dv.hub(src\_pk, src\_nk, src\_ldts, src\_source, source\_model) }} 2. –ø–æ–ø—Ä–æ–±–æ–≤–∞–ª –æ—à–∏–±–∫–∞ –≤—Å—ë —Ç–∞ –∂–µ 11:43:32 Running with dbt=1.9.6 11:43:33 Registered adapter: postgres=1.9.0 11:43:33 Unable to do partial parsing because a project dependency has been added 11:43:33 Unable to do partial parsing because a project config has changed 11:43:38 Encountered an error: Compilation Error in model link\_customer\_orders (models/links/link\_customer\_orders.sql) The object (""dbt"."public"."link\_customer\_orders"") was used as a dictionary. This capability has been removed from objects of this type. > in macro is\_list (macros/internal/helpers/is\_checks.sql) > called by macro expand\_column\_list (macros/internal/metadata\_processing/expand\_column\_list.sql) > called by macro postgres\_\_link (macros/tables/postgres/link.sql) > called by macro link (macros/tables/snowflake/link.sql) > called by model link\_customer\_orders (models/links/link\_customer\_orders.sql) –Ω–µ —Ç–æ—Ä–æ–ø–∏—Å—å —Å –æ—Ç–≤–µ—Ç–æ–º –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞–∫–∏–µ-—Ç–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã - –∑–∞–ø—Ä–∞—à–∏–≤–∞–π –ø–æ –æ–¥–Ω–æ–º—É —Ä–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–∞–≤–∞–π –ø–æ –æ–¥–Ω–æ–π

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–û—Ç–ª–∏—á–Ω–æ, —Ç—ã —É–∂–µ –¥–∞–ª –∫–ª—é—á–µ–≤—É—é —á–∞—Å—Ç—å ‚Äî –ø–æ–¥–ø–∏—Å—å –º–∞–∫—Ä–æ—Å–∞:

```
<div><p>scss</p><p><code><span><span>{{ automate_dv</span><span><span>.hub</span></span><span>(src_pk, src_nk, src_ldts, src_source, source_model) }}
</span></span></code></p></div>
```

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ **–º–∞–∫—Ä–æ—Å `automate_dv.hub(...)` –æ–∂–∏–¥–∞–µ—Ç –ø—è—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–æ–Ω–Ω—ã—Ö –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤, –∞ –Ω–µ —Å–ª–æ–≤–∞—Ä—å-–∫–æ–Ω—Ñ–∏–≥ –∏ –Ω–µ –æ–±—ä–µ–∫—Ç relation**, –∫–∞–∫ –º—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ —Ä–∞–Ω–µ–µ.

___

### üí• –ü—Ä–æ–±–ª–µ–º–∞

–¢—ã –ø–µ—Ä–µ–¥–∞—ë—à—å:

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{{ automate_dv.hub(source_model, hub_config) }}
</span></code></p></div>
```

–ê –Ω–∞–¥–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å —Å—Ç—Ä–æ–≥–æ –ø–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º:

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{{ automate_dv.hub('customer_id', 'customer_name', 'created_at', 'dbt_source', 'stg_customers') }}
</span></code></p></div>
```

___

### ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

–û–±–Ω–æ–≤–∏ `hub_customers.sql` –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–µ:

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{{ config(materialized='incremental') }}

{{ automate_dv.hub(
    'customer_id',       -- src_pk (—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∫–ª—é—á)
    'customer_name',     -- src_nk (–±–∏–∑–Ω–µ—Å-–∫–ª—é—á)
    'created_at',        -- src_ldts (–≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏)
    'dbt_source',        -- src_source (–º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é)
    'stg_customers'      -- source_model (–∏–º—è staging –º–æ–¥–µ–ª–∏, –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞)
) }}
</span></code></p></div>
```

___

üîÑ –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ:

1.  –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ —Å–±–æ—Ä–∫—É.
    
2.  –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è, –º—ã –ø—Ä–æ–≤–µ—Ä–∏–º `link_customer_orders.sql` ‚Äî —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ, –æ–Ω –Ω–∞–ø–∏—Å–∞–Ω –≤ —Ç–æ–º –∂–µ –æ—à–∏–±–æ—á–Ω–æ–º —Å—Ç–∏–ª–µ.
    

–ü—Ä–æ–¥–æ–ª–∂–∏–º –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

11:46:48 Running with dbt=1.9.6 11:46:49 Registered adapter: postgres=1.9.0 11:46:49 Unable to do partial parsing because a project dependency has been added 11:46:49 Unable to do partial parsing because a project config has changed 11:46:54 Encountered an error: Compilation Error in model hub\_customers (models/hubs/hub\_customers.sql) expected token ',', got '–∫–ª—é—á' line 4 'customer\_id', -- src\_pk (—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∫–ª—é—á)

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–û—Ç–ª–∏—á–Ω–æ, —ç—Ç–æ –ø—Ä–æ—Å—Ç–∞—è —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: –≤ Jinja2 **–Ω–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ Python-—Å—Ç–∏–ª—è (`-- ...`) –≤–Ω—É—Ç—Ä–∏ —Å–∫–æ–±–æ–∫ `(...)`** –ø—Ä–∏ –≤—ã–∑–æ–≤–µ –º–∞–∫—Ä–æ—Å–∞.

___

### üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

–ó–∞–º–µ–Ω–∏–º –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω—ã–π –≤—ã–∑–æ–≤ —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏ –≤–Ω—É—Ç—Ä–∏ –Ω–∞ –æ–¥–Ω–æ—Å—Ç—Ä–æ—á–Ω—ã–π **–±–µ–∑ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤**, –ª–∏–±–æ –≤—ã–Ω–µ—Å–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤—ã—à–µ.

___

#### ‚úÖ –í–µ—Ä—Å–∏—è –±–µ–∑ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Å–±–æ—Ä–∫–∏):

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{{ config(materialized='incremental') }}

{{ automate_dv.hub('customer_id', 'customer_name', 'created_at', 'dbt_source', 'stg_customers') }}
</span></code></p></div>
```

___

#### ‚úÖ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏ –≤—ã—à–µ:

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{{ config(materialized='incremental') }}

-- src_pk: customer_id
-- src_nk: customer_name
-- src_ldts: created_at
-- src_source: dbt_source
-- source_model: stg_customers

{{ automate_dv.hub('customer_id', 'customer_name', 'created_at', 'dbt_source', 'stg_customers') }}
</span></code></p></div>
```

___

üîÑ –ü–æ–ø—Ä–æ–±—É–π —Å–Ω–æ–≤–∞ —Å –ª—é–±–æ–π –∏–∑ —ç—Ç–∏—Ö –≤–µ—Ä—Å–∏–π –∏ –Ω–∞–ø–∏—à–∏, –µ—Å–ª–∏ –ø–æ—è–≤–∏—Ç—Å—è –Ω–æ–≤–∞—è –æ—à–∏–±–∫–∞. –ï—Å–ª–∏ `hub_customers` –ø—Ä–æ–π–¥—ë—Ç —É—Å–ø–µ—à–Ω–æ ‚Äî –ø–æ–π–¥—ë–º –¥–∞–ª—å—à–µ –∫ `link_customer_orders`.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–ø–æ—Ö–æ–∂–µ hub\_customers –ø–æ—á–∏–Ω–∏–ª—Å—è –Ω–æ–≤–∞—è –æ—à–∏–±–∫–∞: 11:49:07 Unable to do partial parsing because a project dependency has been added 11:49:07 Unable to do partial parsing because a project config has changed 11:49:12 Encountered an error: Compilation Error in model link\_customer\_orders (models/links/link\_customer\_orders.sql) The object (""dbt"."public"."link\_customer\_orders"") was used as a dictionary. This capability has been removed from objects of this type. > in macro is\_list (macros/internal/helpers/is\_checks.sql) > called by macro expand\_column\_list (macros/internal/metadata\_processing/expand\_column\_list.sql) > called by macro postgres\_\_link (macros/tables/postgres/link.sql) > called by macro link (macros/tables/snowflake/link.sql) > called by model link\_customer\_orders (models/links/link\_customer\_orders.sql) –¥–∞–≤–∞–π —Ç–µ–ø–µ—Ä—å –∏—Å–ø—Ä–∞–≤–∏–º link\_customer\_orders.sql: {{ config(materialized='incremental') }} {% set source\_model = ref('stg\_orders') %} {% set link\_config = { "src\_pk": "customer\_order\_pk", "src\_fk": \["customer\_id", "order\_id"\], "src\_ldts": "created\_at", "src\_source": "dbt\_source", "link\_name": "link\_customer\_orders" } %} {{ automate\_dv.link(source\_model, link\_config) }}

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–û—Ç–ª–∏—á–Ω–æ, —á—Ç–æ `hub_customers` —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç. –û—à–∏–±–∫–∞ –≤ `link_customer_orders.sql` –∞–Ω–∞–ª–æ–≥–∏—á–Ω–∞ ‚Äî `automate_dv` –æ–∂–∏–¥–∞–µ—Ç **–ø–æ–∑–∏—Ü–∏–æ–Ω–Ω—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã**, –∞ –Ω–µ —Å–ª–æ–≤–∞—Ä—å (`dict`) –≤ `link(...)`.

___

### üìå –ü—Ä–æ–±–ª–µ–º–∞:

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>automate_dv.link(source_model, link_config)
</span></code></p></div>
```

‚ùå –±–æ–ª—å—à–µ **–Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è** ‚Äî —Å –≤–µ—Ä—Å–∏–∏ `0.10.0+` `automate_dv` —Ç—Ä–µ–±—É–µ—Ç **–ø–µ—Ä–µ–¥–∞—á—É –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ —è–≤–Ω–æ**, –∫–∞–∫ —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–æ –≤ [README](https://github.com/Datavault-UK/automate_dv/blob/main/README.md).

___

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π `link_customer_orders.sql`:

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{{ config(materialized='incremental') }}

{{ automate_dv.link(
    'customer_order_pk',      -- src_pk (—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∫–ª—é—á —Å—Å—ã–ª–∫–∏)
    ['customer_id', 'order_id'],  -- src_fk (–≤–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏ –Ω–∞ —Ö–∞–±—ã)
    'created_at',             -- src_ldts (–≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏)
    'dbt_source',             -- src_source (–∏—Å—Ç–æ—á–Ω–∏–∫)
    'stg_orders'              -- –∏—Å—Ç–æ—á–Ω–∏–∫-—Ç–∞–±–ª–∏—Ü–∞ (ref –Ω–µ –Ω—É–∂–µ–Ω, automate_dv —Å–∞–º –≤—ã–∑—ã–≤–∞–µ—Ç)
) }}
</span></code></p></div>
```

___

### üîé –ü—Ä–∏–º–µ—á–∞–Ω–∏—è:

-   `ref()` –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è ‚Äî `automate_dv` **–≤–Ω—É—Ç—Ä–∏ –º–∞–∫—Ä–æ—Å–∞ –≤—ã–∑—ã–≤–∞–µ—Ç `ref()` —Å–∞–º**, –ø–µ—Ä–µ–¥–∞–≤–∞—è –∏–º—è –º–æ–¥–µ–ª–∏ –∫–∞–∫ —Å—Ç—Ä–æ–∫—É.
    
-   –í—Å–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã ‚Äî **–ø–æ–∑–∏—Ü–∏–æ–Ω–Ω—ã–µ**.
    
-   –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å–Ω–∞—Ä—É–∂–∏, –Ω–µ –º–µ—à–∞—é—Ç —Å–∏–Ω—Ç–∞–∫—Å–∏—Å—É Jinja.
    

___

‚öôÔ∏è –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π —Å–±–æ—Ä–∫—É —Å —ç—Ç–∏–º —Ñ–∞–π–ª–æ–º. –ï—Å–ª–∏ –≤—Å—ë —É—Å–ø–µ—à–Ω–æ, –ø–µ—Ä–µ–π–¥—ë–º –∫ `sat_customer_details.sql`.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–Ω–µ –∑–∞–±—ã–≤–∞–π, —á—Ç–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤–Ω—É—Ç—Ä—å –º–∞–∫—Ä–æ—Å–∞ –≤—Å—Ç–∞–≤–ª—è—Ç—å –Ω–µ–ª—å–∑—è!

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–ê–±—Å–æ–ª—é—Ç–Ω–æ –≤–µ—Ä–Ω–æ ‚Äî —Å–ø–∞—Å–∏–±–æ, —á—Ç–æ –Ω–∞–ø–æ–º–Ω–∏–ª!

–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ **–≤–Ω—É—Ç—Ä–∏ –º–∞–∫—Ä–æ—Å–æ–≤** `automate_dv` (–∏ –¥—Ä—É–≥–∏—Ö Jinja-–≤—ã—Ä–∞–∂–µ–Ω–∏–π) –ø—Ä–∏–≤–æ–¥—è—Ç –∫ –æ—à–∏–±–∫–∞–º –∫–æ–º–ø–∏–ª—è—Ü–∏–∏. –ü–æ—ç—Ç–æ–º—É –≤—Å–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –Ω—É–∂–Ω–æ **—Ä–∞–∑–º–µ—â–∞—Ç—å –≤–Ω–µ** —Å–∫–æ–±–æ–∫ –≤—ã–∑–æ–≤–∞ –º–∞–∫—Ä–æ—Å–∞, –∫–∞–∫ –≤ –ø—Ä–∏–º–µ—Ä–µ –Ω–∏–∂–µ:

___

### ‚úÖ –§–∏–Ω–∞–ª—å–Ω–∞—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –≤–µ—Ä—Å–∏—è `link_customer_orders.sql`:

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{{ config(materialized='incremental') }}

-- src_pk: —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∫–ª—é—á —Å—Å—ã–ª–∫–∏
-- src_fk: –≤–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏ –Ω–∞ —Ö–∞–±—ã
-- src_ldts: –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏
-- src_source: –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö
-- source_model: staging-—Ç–∞–±–ª–∏—Ü–∞

{{ automate_dv.link(
    'customer_order_pk',
    ['customer_id', 'order_id'],
    'created_at',
    'dbt_source',
    'stg_orders'
) }}
</span></code></p></div>
```

___

–ï—Å–ª–∏ –≥–æ—Ç–æ–≤ ‚Äî –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ `sat_customer_details.sql`.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–Ω—É–∂–Ω–æ –ª–∏ –º–Ω–µ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ –±–∏–ª–¥–∞ —É–¥–∞–ª—è—Ç—å –æ–±—Ä–∞–∑ data-vault-dbt-dbt ? –∏–ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Å–∞–º –æ–±—Ä–∞–∑?

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–•–æ—Ä–æ—à–∏–π –≤–æ–ø—Ä–æ—Å.

### –ö–æ—Ä–æ—Ç–∫–æ:

**–ù–µ—Ç, —É–¥–∞–ª—è—Ç—å –æ–±—Ä–∞–∑ `data-vault-dbt-dbt` –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ –Ω–µ –Ω—É–∂–Ω–æ**, –µ—Å–ª–∏:

-   —Ç—ã **–Ω–µ –º–µ–Ω—è–ª `Dockerfile` –∏–ª–∏ `requirements.txt`** (–∏–ª–∏ `packages.yml`, –µ—Å–ª–∏ –æ–Ω –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –≤–Ω—É—Ç—Ä—å –æ–±—Ä–∞–∑–∞).
    
-   —Ç—ã –Ω–µ –≤–Ω–æ—Å–∏–ª **–∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `dbt-core`, `automate_dv`, `dbt-utils`)**, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –≤–Ω—É—Ç—Ä–∏ –æ–±—Ä–∞–∑–∞.
    

___

### –ö–æ–≥–¥–∞ **–Ω—É–∂–Ω–æ –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑**:

1.  **–ò–∑–º–µ–Ω–∏–ª `Dockerfile`** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤–µ—Ä—Å–∏—é Python, dbt, –ø—É—Ç–∏).
    
2.  **–û–±–Ω–æ–≤–∏–ª –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
    
    -   `pip install ...` –≤ `Dockerfile`.
        
    -   `packages.yml`, –µ—Å–ª–∏ –æ–Ω –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –≤ –æ–±—Ä–∞–∑ (–∏–Ω–æ–≥–¥–∞ –∫–æ–ø–∏—Ä—É—é—Ç –≤–Ω—É—Ç—Ä—å `dbt deps`).
        
3.  **–ò–∑–º–µ–Ω–∏–ª —Å–∏—Å—Ç–µ–º–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏–ª–∏ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –≤–Ω—É—Ç—Ä–∏ –æ–±—Ä–∞–∑–∞**.
    

___

### –ö–æ–≥–¥–∞ –º–æ–∂–Ω–æ **–Ω–µ –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞—Ç—å –æ–±—Ä–∞–∑**:

-   –ò–∑–º–µ–Ω–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –≤ `models`, `macros`, `dbt_project.yml`, `seeds`, `profiles.yml`, `sources.yml` –∏ —Ç.‚ÄØ–¥.
    
-   –¢—ã –º–æ–Ω—Ç–∏—Ä—É–µ—à—å –ø—Ä–æ–µ–∫—Ç (`./dbt:/usr/app`) —á–µ—Ä–µ–∑ `volumes` ‚Äî —Ç–æ–≥–¥–∞ dbt –≤–∏–¥–∏—Ç –≤—Å–µ –ø—Ä–∞–≤–∫–∏ —Å—Ä–∞–∑—É, –∏ **–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏**.
    

___

### –†–µ–∑—é–º–µ:

‚úÖ **–ï—Å–ª–∏ –º–µ–Ω—è–µ—à—å —Ç–æ–ª—å–∫–æ `.sql`, `.yml`, –º–∞–∫—Ä–æ—Å—ã ‚Äî –Ω–∏—á–µ–≥–æ –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ.**  
üîÅ **–ï—Å–ª–∏ –º–µ–Ω—è–µ—à—å `Dockerfile` –∏–ª–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ ‚Äî –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞–π –æ–±—Ä–∞–∑.**

–•–æ—á–µ—à—å ‚Äî –ø—Ä–æ–≤–µ—Ä–∏–º —Ç–≤–æ–π `docker-compose.yml` –∏ `Dockerfile`, —á—Ç–æ–±—ã —Ç–æ—á–Ω–æ –ø–æ–Ω—è—Ç—å, –∫–æ–≥–¥–∞ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–µ—à.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–ø–æ–∫–∞ –≤—Å—ë –∏–¥—ë—Ç —Ö–æ—Ä–æ—à–æ —Ç–µ–ø–µ—Ä—å –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–π —Ñ–∞–π–ª: 11:55:02 Registered adapter: postgres=1.9.0 11:55:02 Unable to do partial parsing because a project dependency has been added 11:55:02 Unable to do partial parsing because a project config has changed 11:55:07 Encountered an error: Compilation Error in model sat\_customer\_details (models/satellites/sat\_customer\_details.sql) The object (""dbt"."public"."sat\_customer\_details"") was used as a dictionary. This capability has been removed from objects of this type. > in macro is\_list (macros/internal/helpers/is\_checks.sql) > called by macro expand\_column\_list (macros/internal/metadata\_processing/expand\_column\_list.sql) > called by macro postgres\_\_sat (macros/tables/postgres/sat.sql) > called by macro sat (macros/tables/snowflake/sat.sql) > called by model sat\_customer\_details (models/satellites/sat\_customer\_details.sql) –≤–æ—Ç –µ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ: {{ config(materialized='incremental') }} {% set source\_model = ref('stg\_customers') %} {% set sat\_config = { "src\_pk": "customer\_id", "src\_hashdiff": "customer\_hashdiff", "src\_payload": \["customer\_name"\], "src\_ldts": "created\_at", "src\_source": "dbt\_source", "sat\_name": "sat\_customer\_details" } %} {{ automate\_dv.sat(source\_model, sat\_config) }}

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–û—Ç–ª–∏—á–Ω–æ, –∏–¥—ë–º –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ.

–ö–∞–∫ –∏ —Ä–∞–Ω–µ–µ, –ø—Ä–∏—á–∏–Ω–∞ –æ—à–∏–±–∫–∏ –≤ —Ç–æ–º, —á—Ç–æ `automate_dv` –Ω–∞—á–∏–Ω–∞—è —Å –≤–µ—Ä—Å–∏–∏ 0.11+ **–Ω–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `dict` –∫–∞–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä**. –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ ‚Äî –ø–µ—Ä–µ–¥–∞—ë–º **–ø–æ–∑–∏—Ü–∏–æ–Ω–Ω—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã** –≤ –Ω—É–∂–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ.

___

### –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è `sat_customer_details.sql`:

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{{ config(materialized='incremental') }}

{% set source_model = ref('stg_customers') %}

{{ automate_dv.sat(
    'customer_id',              -- src_pk
    'customer_hashdiff',        -- src_hashdiff
    ['customer_name'],          -- src_payload
    'created_at',               -- src_ldts
    'dbt_source',               -- src_source
    source_model,               -- staging –º–æ–¥–µ–ª—å
    'sat_customer_details'      -- –∏–º—è —Å–ø—É—Ç–Ω–∏–∫–∞
) }}
</span></code></p></div>
```

___

### –û–±—ä—è—Å–Ω–µ–Ω–∏–µ:

| –ê—Ä–≥—É–º–µ–Ω—Ç | –ó–Ω–∞—á–µ–Ω–∏–µ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
| --- | --- | --- |
| `'customer_id'` | –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∑–∞–ø–∏—Å–∏ |
| `'customer_hashdiff'` | —Ö–µ—à –ø–æ–ª—è payload | –î–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π |
| `['customer_name']` | –±–∏–∑–Ω–µ—Å-–¥–∞–Ω–Ω—ã–µ | –°–æ–¥–µ—Ä–∂–∏–º–æ–µ, –∫–æ—Ç–æ—Ä–æ–µ –º—ã —Ö—Ä–∞–Ω–∏–º –≤ —Å–ø—É—Ç–Ω–∏–∫–µ |
| `'created_at'` | –¥–∞—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏ | –í—Ä–µ–º—è –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö |
| `'dbt_source'` | –∏—Å—Ç–æ—á–Ω–∏–∫ | –û–±—ã—á–Ω–æ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è |
| `source_model` | staging –º–æ–¥–µ–ª—å | –†–µ–∑—É–ª—å—Ç–∞—Ç `ref('stg_customers')` |
| `'sat_customer_details'` | –∏–º—è –º–æ–¥–µ–ª–∏ | –ò–º—è –≤—ã—Ö–æ–¥–Ω–æ–π –º–æ–¥–µ–ª–∏ |

___

–ï—Å–ª–∏ –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º –∑–∞—Ö–æ—á–µ—à—å –≤—ã–Ω–æ—Å–∏—Ç—å `'dbt_source'` –≤ `dbt_project.yml`, –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –∑–∞–º–µ–Ω–∏—Ç—å `'dbt_source'` –Ω–∞ `var('record_source')` –∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é. –ü–æ–∫–∞ –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫–æ–π.

–ì–æ—Ç–æ–≤ –ø–æ–º–æ—á—å –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â—É—é –º–æ–¥–µ–ª—å ‚Äî –ø—Ä–æ—Å—Ç–æ –ø—Ä–∏—à–ª–∏ –∏–º—è –∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

—Ö–æ—Ä–æ—à–æ, –Ω–æ —Ç—ã –æ–ø—è—Ç—å –∑–∞–±—ã–ª, —á—Ç–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –Ω–µ–ª—å–∑—è –≤–Ω–æ—Å–∏—Ç—å –≤–Ω—É—Ç—Ä—å jinja –≤—ã—Ä–∞–∂–µ–Ω–∏–π

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–¢—ã –ø—Ä–∞–≤ ‚Äî –∏ —Å–ø–∞—Å–∏–±–æ, —á—Ç–æ –Ω–∞–ø–æ–º–Ω–∏–ª.

Jinja **–Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤–Ω—É—Ç—Ä–∏ —Å–∫–æ–±–æ–∫ `{{ ... }}`** –∏–ª–∏ –≤—ã–∑–æ–≤–∞ –º–∞–∫—Ä–æ—Å–∞. –¢–æ –µ—Å—Ç—å –≤–Ω—É—Ç—Ä–∏ —Ç–∞–∫–∏—Ö –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –Ω–µ–ª—å–∑—è –≤—Å—Ç–∞–≤–ª—è—Ç—å `-- –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π`, –∏–Ω–∞—á–µ –±—É–¥–µ—Ç —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞.

___

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π `sat_customer_details.sql` **–±–µ–∑ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –≤–Ω—É—Ç—Ä–∏ –≤—ã—Ä–∞–∂–µ–Ω–∏—è:**

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{{ config(materialized='incremental') }}

{% set source_model = ref('stg_customers') %}

{{ automate_dv.sat(
    'customer_id',
    'customer_hashdiff',
    ['customer_name'],
    'created_at',
    'dbt_source',
    source_model,
    'sat_customer_details'
) }}
</span></code></p></div>
```

___

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–æ—è—Å–Ω–µ–Ω–∏–µ –¥–ª—è –¥—Ä—É–≥–∏—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å—Ç—Ä–æ—á–∫–∏ `-- –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π` **–¥–æ** –∏–ª–∏ **–ø–æ—Å–ª–µ** –≤—ã—Ä–∞–∂–µ–Ω–∏—è. –ù–∞–ø—Ä–∏–º–µ—Ä:

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>-- –°–ø—É—Ç–Ω–∏–∫ —Å –¥–µ—Ç–∞–ª—è–º–∏ –∫–ª–∏–µ–Ω—Ç–∞: –∏–º—è
-- customer_id       - –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á
-- customer_hashdiff - —Ö–µ—à –±–∏–∑–Ω–µ—Å-–¥–∞–Ω–Ω—ã—Ö
-- customer_name     - payload
-- created_at        - –¥–∞—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏
-- dbt_source        - –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö

{{ automate_dv.sat(
    'customer_id',
    'customer_hashdiff',
    ['customer_name'],
    'created_at',
    'dbt_source',
    source_model,
    'sat_customer_details'
) }}
</span></code></p></div>
```

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å ‚Äî –µ—Å–ª–∏ –µ—Å—Ç—å —Å–ª–µ–¥—É—é—â–∞—è –º–æ–¥–µ–ª—å, –ø—Ä–∏—Å—ã–ª–∞–π.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–æ: 11:59:36 Unable to do partial parsing because a project dependency has been added 11:59:36 Unable to do partial parsing because a project config has changed 11:59:42 Encountered an error: Compilation Error in model sat\_customer\_details (models/satellites/sat\_customer\_details.sql) The object (""dbt"."public"."sat\_customer\_details"") was used as a dictionary. This capability has been removed from objects of this type. > in macro is\_list (macros/internal/helpers/is\_checks.sql) > called by macro expand\_column\_list (macros/internal/metadata\_processing/expand\_column\_list.sql) > called by macro postgres\_\_sat (macros/tables/postgres/sat.sql) > called by macro sat (macros/tables/snowflake/sat.sql) > called by model sat\_customer\_details (models/satellites/sat\_customer\_details.sql) –≤–æ—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–π —Ç–æ–±–æ–π –∫–æ–¥: {{ config(materialized='incremental') }} {% set source\_model = ref('stg\_customers') %} -- –°–ø—É—Ç–Ω–∏–∫ —Å –¥–µ—Ç–∞–ª—è–º–∏ –∫–ª–∏–µ–Ω—Ç–∞: –∏–º—è -- customer\_id - –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á -- customer\_hashdiff - —Ö–µ—à –±–∏–∑–Ω–µ—Å-–¥–∞–Ω–Ω—ã—Ö -- customer\_name - payload -- created\_at - –¥–∞—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏ -- dbt\_source - –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö {{ automate\_dv.sat( 'customer\_id', 'customer\_hashdiff', \['customer\_name'\], 'created\_at', 'dbt\_source', source\_model, 'sat\_customer\_details' ) }} –µ–≥–æ –Ω—É–∂–Ω–æ –ø–æ–ø—Ä–∞–≤–∏—Ç—å –æ–ø—è—Ç—å –∂–µ –¥–µ–ª–∞–µ–º –≤—Å—ë –ø–æ –æ–¥–Ω–æ–º—É —à–∞–≥—É - –æ–¥–Ω–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –∏–ª–∏ –æ–¥–∏–Ω —É—Ç–æ—á–Ω—è—é—â–∏–π –≤–æ–ø—Ä–æ—Å (—á—Ç–æ –∏ –≥–¥–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å)

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–û—Ç–ª–∏—á–Ω–æ, –¥–≤–∏–≥–∞–µ–º—Å—è —à–∞–≥ –∑–∞ —à–∞–≥–æ–º.

–ü–µ—Ä–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ ‚Äî –Ω—É–∂–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ç—ã **–∏—Å–ø–æ–ª—å–∑—É–µ—à—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤** –≤ `automate_dv.sat(...)`, —Ç–∞–∫ –∫–∞–∫ –æ—à–∏–±–∫–∞ –≥–æ–≤–æ—Ä–∏—Ç –æ –ø–æ–ø—ã—Ç–∫–µ –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –æ–±—ä–µ–∫—Ç—É –∫–∞–∫ –∫ —Å–ª–æ–≤–∞—Ä—é, —á—Ç–æ –±—ã–≤–∞–µ—Ç, –µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω—ã –∞—Ä–≥—É–º–µ–Ω—Ç—ã –Ω–µ –≤ —Ç–æ–º –ø–æ—Ä—è–¥–∫–µ.

___

üîç **–ü—Ä–æ–≤–µ—Ä—å, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤ –ø–∞–ø–∫–µ `dbt_packages/automate_dv/macros/tables/postgres/sat.sql`** —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä–æ—á–∫—É –≤ –º–∞–∫—Ä–æ—Å–µ `sat`, –∫–æ—Ç–æ—Ä–∞—è –¥–æ–ª–∂–Ω–∞ –≤—ã–≥–ª—è–¥–µ—Ç—å –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫ (–≤ –Ω–∞—á–∞–ª–µ –º–∞–∫—Ä–æ—Å–∞):

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{% macro postgres__sat(src_pk, src_hashdiff, src_payload, src_ldts, src_source, source_model, sat_name) %}
</span></code></p></div>
```

üîπ –í–æ–ø—Ä–æ—Å: **–°–æ–≤–ø–∞–¥–∞–µ—Ç –ª–∏ –ø–æ—Ä—è–¥–æ–∫ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –≤ `sat(...)` —Å —Ç–µ–º, –∫–∞–∫ —Ç—ã –µ–≥–æ –≤—ã–∑—ã–≤–∞–µ—à—å –≤ –º–æ–¥–µ–ª–∏?**  
–ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –ø—Ä–∏–≤–µ–¥–∏ –µ–≥–æ —Ç–æ—á–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å—é–¥–∞ (–ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É `macro postgres__sat(...)`) ‚Äî —Ç–æ–≥–¥–∞ –º—ã –∞–¥–∞–ø—Ç–∏—Ä—É–µ–º –≤—ã–∑–æ–≤.

–ñ–¥—É.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–≤–æ—Ç —Ç–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç —Å—Ç—Ä–æ–∫–∞: {%- macro postgres\_\_sat(src\_pk, src\_hashdiff, src\_payload, src\_extra\_columns, src\_eff, src\_ldts, src\_source, source\_model) -%}

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–û—Ç–ª–∏—á–Ω–æ, —ç—Ç–æ –∫–ª—é—á–µ–≤–æ–π –º–æ–º–µ–Ω—Ç.

üîç –ú—ã —Ç–µ–ø–µ—Ä—å –≤–∏–¥–∏–º, —á—Ç–æ –º–∞–∫—Ä–æ—Å `postgres__sat` –≤ `automate_dv` **–æ–∂–∏–¥–∞–µ—Ç 8 –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤**, –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø–æ—Ä—è–¥–∫–µ:

1.  `src_pk`
    
2.  `src_hashdiff`
    
3.  `src_payload`
    
4.  `src_extra_columns`
    
5.  `src_eff` (effective from ‚Äî –¥–ª—è SCD2)
    
6.  `src_ldts`
    
7.  `src_source`
    
8.  `source_model`
    

–ê —É –Ω–∞—Å –≤ –≤—ã–∑–æ–≤–µ —Å–µ–π—á–∞—Å —Ç–æ–ª—å–∫–æ 7 –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –∏ **–Ω–µ —É–∫–∞–∑–∞–Ω—ã `src_extra_columns` –∏ `src_eff`** ‚Äî –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã —Å–º–µ—â–∞—é—Ç—Å—è, –∏ –º–æ–¥–µ–ª—å –ª–æ–º–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –æ–±—ä–µ–∫—Ç—É –∫–∞–∫ –∫ —Å–ª–æ–≤–∞—Ä—é.

___

üìå **–®–∞–≥ 1 ‚Äî –∏—Å–ø—Ä–∞–≤–∏–º –≤—ã–∑–æ–≤ –º–∞–∫—Ä–æ—Å–∞, –¥–æ–±–∞–≤–∏–≤ `None` –Ω–∞ –º–µ—Å—Ç–∞ `src_extra_columns` –∏ `src_eff`, –µ—Å–ª–∏ –æ–Ω–∏ –Ω–∞–º –Ω–µ –Ω—É–∂–Ω—ã:**

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{{ config(materialized='incremental') }}

{% set source_model = ref('stg_customers') %}

-- –°–ø—É—Ç–Ω–∏–∫ —Å –¥–µ—Ç–∞–ª—è–º–∏ –∫–ª–∏–µ–Ω—Ç–∞: –∏–º—è
-- customer_id       - –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á
-- customer_hashdiff - —Ö–µ—à –±–∏–∑–Ω–µ—Å-–¥–∞–Ω–Ω—ã—Ö
-- customer_name     - payload
-- created_at        - –¥–∞—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏
-- dbt_source        - –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö

{{ automate_dv.sat(
    'customer_id',
    'customer_hashdiff',
    ['customer_name'],
    none,
    none,
    'created_at',
    'dbt_source',
    source_model
) }}
</span></code></p></div>
```

___

üîß –ü–æ–ø—Ä–æ–±—É–π —Ç–µ–ø–µ—Ä—å —ç—Ç—É –≤–µ—Ä—Å–∏—é. –ï—Å–ª–∏ —Å–Ω–æ–≤–∞ –±—É–¥–µ—Ç –æ—à–∏–±–∫–∞ ‚Äî –∏–¥–µ–º –¥–∞–ª—å—à–µ –ø–æ —à–∞–≥–∞–º.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

12:07:24 Registered adapter: postgres=1.9.0 12:07:25 Unable to do partial parsing because a project dependency has been added 12:07:25 Unable to do partial parsing because a project config has changed 12:07:30 Encountered an error: Compilation Error in model sat\_customer\_details (models/satellites/sat\_customer\_details.sql) The name argument to ref() must be a string, got <class 'dbt.adapters.postgres.relation.PostgresRelation'> > in macro postgres\_\_sat (macros/tables/postgres/sat.sql) > called by macro sat (macros/tables/snowflake/sat.sql) > called by model sat\_customer\_details (models/satellites/sat\_customer\_details.sql)

###### ChatGPT —Å–∫–∞–∑–∞–ª:

üí° –û—Ç–ª–∏—á–Ω–æ! –û—à–∏–±–∫–∞ —Ç–µ–ø–µ—Ä—å –¥—Ä—É–≥–∞—è ‚Äî —ç—Ç–æ –ø—Ä–æ–≥—Ä–µ—Å—Å.

___

### üîç –ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:

–û—à–∏–±–∫–∞:

```
<div><p>pgsql</p><p><code><span><span>The </span><span><span>name</span></span><span> argument </span><span><span>to</span></span><span> </span><span><span>ref</span></span><span>() must be a string, got &lt;</span><span><span>class</span></span><span> </span><span><span>'dbt.adapters.postgres.relation.PostgresRelation'</span></span><span>&gt;
</span></span></code></p></div>
```

üìå –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ **–≤–Ω—É—Ç—Ä–∏ –º–∞–∫—Ä–æ—Å–∞ `postgres__sat` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `ref(source_model)`**, –Ω–æ –º—ã **—É–∂–µ –ø–µ—Ä–µ–¥–∞–ª–∏ `source_model = ref('stg_customers')`**, —Ç–æ –µ—Å—Ç—å –ø–µ—Ä–µ–¥–∞–ª–∏ **–≥–æ—Ç–æ–≤—ã–π –æ–±—ä–µ–∫—Ç `ref(...)`**, –∞ –Ω–µ –µ–≥–æ –∏–º—è (—Å—Ç—Ä–æ–∫—É).

___

### ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:

–ù—É–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å **–∏–º—è –º–æ–¥–µ–ª–∏ —Å—Ç—Ä–æ–∫–æ–π**, –∞ –Ω–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç `ref(...)`.

___

### ‚úèÔ∏è –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç:

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{{ config(materialized='incremental') }}

-- –°–ø—É—Ç–Ω–∏–∫ —Å –¥–µ—Ç–∞–ª—è–º–∏ –∫–ª–∏–µ–Ω—Ç–∞: –∏–º—è
-- customer_id       - –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á
-- customer_hashdiff - —Ö–µ—à –±–∏–∑–Ω–µ—Å-–¥–∞–Ω–Ω—ã—Ö
-- customer_name     - payload
-- created_at        - –¥–∞—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏
-- dbt_source        - –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö

{{ automate_dv.sat(
    'customer_id',
    'customer_hashdiff',
    ['customer_name'],
    none,
    none,
    'created_at',
    'dbt_source',
    'stg_customers'
) }}
</span></code></p></div>
```

üîÅ –ü–æ–ø—Ä–æ–±—É–π —Å —ç—Ç–æ–π –ø—Ä–∞–≤–∫–æ–π. –ï—Å–ª–∏ –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ –≤—Å—ë —Å–æ–±–µ—Ä—ë—Ç—Å—è ‚Äî –æ—Ç–ª–∏—á–Ω–æ. –ï—Å–ª–∏ —Å–Ω–æ–≤–∞ –æ—à–∏–±–∫–∞ ‚Äî –ø–æ—à–∞–≥–æ–≤–æ —Ä–∞–∑–±–µ—Ä—ë–º.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–ø—Ä–æ–¥–≤–∏–Ω—É–ª–∏—Å—å –¥–∞–ª—å—à–µ 12:09:42 Completed with 4 errors, 0 partial successes, and 0 warnings: 12:09:42 12:09:42 Database Error in model hub\_customers (models/hubs/hub\_customers.sql) syntax error at or near "AS" LINE 28: FROM AS a ^ compiled code at target/run/dv\_postgres\_project/models/hubs/hub\_customers.sql 12:09:42 12:09:42 Database Error in model link\_customer\_orders (models/links/link\_customer\_orders.sql) syntax error at or near "AS" LINE 28: FROM AS a ^ compiled code at target/run/dv\_postgres\_project/models/links/link\_customer\_orders.sql 12:09:42 12:09:42 Database Error in model stg\_orders (models/staging/stg\_orders.sql) column "id" does not exist LINE 18: id as order\_id, ^ compiled code at target/run/dv\_postgres\_project/models/staging/stg\_orders.sql 12:09:42 12:09:42 Database Error in model sat\_customer\_details (models/satellites/sat\_customer\_details.sql) column a.dbt\_source does not exist LINE 27: ...customer\_hashdiff, a.customer\_name, a.created\_at, a.dbt\_sour... ^ compiled code at target/run/dv\_postgres\_project/models/satellites/sat\_customer\_details.sql

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–û—Ç–ª–∏—á–Ω–æ, –¥–≤–∏–∂–µ–º—Å—è! –†–∞–∑–±–µ—Ä—ë–º –æ—à–∏–±–∫–∏ –ø–æ –æ—á–µ—Ä–µ–¥–∏.

___

### –û—à–∏–±–∫–∞ 1 –∏ 2 (hub\_customers –∏ link\_customer\_orders):

```
<div><p>vbnet</p><p><code><span><span>syntax </span><span><span>error</span></span><span> at </span><span><span>or</span></span><span> near </span><span><span>"AS"</span></span><span>

LINE </span><span><span>28</span></span><span>: </span><span><span>FROM</span></span><span>  </span><span><span>AS</span></span><span> a
</span></span></code></p></div>
```

**–ü—Ä–∏—á–∏–Ω–∞:** –í —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–º SQL –Ω–µ—Ç –∏–º–µ–Ω–∏ —Ç–∞–±–ª–∏—Ü—ã –ø–æ—Å–ª–µ `FROM`. –ú–∞–∫—Ä–æ—Å—ã –≤—ã–∑—ã–≤–∞—é—Ç—Å—è —Å –ø–µ—Ä–µ–¥–∞—á–µ–π –∏–º–µ–Ω–∏ –º–æ–¥–µ–ª–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `'stg_customers'`), –Ω–æ –≥–¥–µ-—Ç–æ –æ–Ω–æ –Ω–µ –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ ‚Äî –ø–æ–ª—É—á–∞–µ—Ç—Å—è –ø—É—Å—Ç–æ–µ –º–µ—Å—Ç–æ.

___

### –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å / —Å–¥–µ–ª–∞—Ç—å:

1.  –ü–æ–∫–∞–∂–∏, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ª–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã —Ñ–∞–π–ª–æ–≤:
    

-   `hub_customers.sql`
    
-   `link_customer_orders.sql`
    

–æ—Å–æ–±–µ–Ω–Ω–æ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ, –∫–∞–∫ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä —Å –∏–º–µ–Ω–µ–º –º–æ–¥–µ–ª–∏ (—Å—Ç—Ä–æ–∫–∞).

___

___

### –û—à–∏–±–∫–∞ 3 (`stg_orders.sql`):

```
<div><p>pgsql</p><p><code><span><span><span>column</span></span><span> "id" does </span><span><span>not</span></span><span> exist

</span><span><span>LINE</span></span><span> </span><span><span>18</span></span><span>:         id </span><span><span>as</span></span><span> order_id,
</span></span></code></p></div>
```

**–ü—Ä–∏—á–∏–Ω–∞:** –í –∏—Å—Ö–æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ (–∏–ª–∏ –º–æ–¥–µ–ª–∏) `stg_orders` –Ω–µ—Ç –∫–æ–ª–æ–Ω–∫–∏ `id`. –í–æ–∑–º–æ–∂–Ω–æ, –≤ —Å—Ç–µ–π–¥–∂–∏–Ω–≥–µ –¥–ª—è –∑–∞–∫–∞–∑–æ–≤ –∫–æ–ª–æ–Ω–∫–∞ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ-–¥—Ä—É–≥–æ–º—É.

___

### –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

2.  –ü–æ–∫–∞–∂–∏, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, SQL –∫–æ–¥ –º–æ–¥–µ–ª–∏ `stg_orders.sql` (–ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–ª–∏ –ø–æ –∫—Ä–∞–π–Ω–µ–π –º–µ—Ä–µ –ø–µ—Ä–≤—ã–µ ~20 —Å—Ç—Ä–æ–∫), —á—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏—è –∫–æ–ª–æ–Ω–æ–∫.
    

___

___

### –û—à–∏–±–∫–∞ 4 (`sat_customer_details.sql`):

```
<div><p>less</p><p><code><span><span><span>column</span></span><span> </span><span><span>a</span></span><span><span>.dbt_source</span></span><span> </span><span><span>does</span></span><span> </span><span><span>not</span></span><span> </span><span><span>exist</span></span><span>

</span><span><span>LINE</span></span><span> </span><span><span>27</span></span><span>: ..</span><span><span>.customer_hashdiff</span></span><span>, </span><span><span>a</span></span><span><span>.customer_name</span></span><span>, </span><span><span>a</span></span><span><span>.created_at</span></span><span>, </span><span><span>a</span></span><span><span>.dbt_sour</span></span><span>...
</span></span></code></p></div>
```

**–ü—Ä–∏—á–∏–Ω–∞:** –í —Å–ø—É—Ç–Ω–∏–∫–µ –æ–∂–∏–¥–∞–µ—Ç—Å—è –∫–æ–ª–æ–Ω–∫–∞ `dbt_source` –≤ —Ç–∞–±–ª–∏—Ü–µ `a`, –Ω–æ –≤ —Å—Ç–µ–π–¥–∂–∏–Ω–≥–µ –∏–ª–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–µ –µ—ë –Ω–µ—Ç.

___

### –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

3.  –ü–æ–∫–∞–∂–∏ `stg_customers.sql` (—Å—Ç–µ–π–¥–∂–∏–Ω–≥ –∫–ª–∏–µ–Ω—Ç–æ–≤), —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å, –æ—Ç–∫—É–¥–∞ –¥–æ–ª–∂–Ω–∞ –±—Ä–∞—Ç—å—Å—è –∫–æ–ª–æ–Ω–∫–∞ `dbt_source`.
    

___

___

–ö–æ–≥–¥–∞ –ø–æ–∫–∞–∂–µ—à—å —Ñ–∞–π–ª—ã, –¥–∞–º —Ç–æ—á–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏. –ü–æ–∫–∞ –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ –º–∞–∫—Ä–æ—Å—ã –ø–æ –ø–∞—Ä–∞–º–µ—Ç—Ä—É `source_model` ‚Äî —ç—Ç–æ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∏–º–µ–Ω–Ω–æ —Å—Ç—Ä–æ–∫–æ–≤—ã–π –ª–∏—Ç–µ—Ä–∞–ª, —Å—Å—ã–ª–∞—é—â–∏–π—Å—è –Ω–∞ –∏–º—è –º–æ–¥–µ–ª–∏, –∏–Ω–∞—á–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π SQL –±—É–¥–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–¥–∞–≤–∞–π –ø–æ –∫–∞–∂–¥–æ–π –æ—à–∏–±–∫–µ —à–∞–≥ –∑–∞ —à–∞–≥–æ–º –û—à–∏–±–∫–∞ 1 –∏ 2: hub\_customers.sql: {{ config(materialized='incremental') }} -- src\_pk: customer\_id -- src\_nk: customer\_name -- src\_ldts: created\_at -- src\_source: dbt\_source -- source\_model: stg\_customers {{ automate\_dv.hub('customer\_id', 'customer\_name', 'created\_at', 'dbt\_source', 'stg\_customers') }} link\_customer\_orders.sql: {{ config(materialized='incremental') }} -- src\_pk: —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∫–ª—é—á —Å—Å—ã–ª–∫–∏ -- src\_fk: –≤–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏ –Ω–∞ —Ö–∞–±—ã -- src\_ldts: –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ -- src\_source: –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö -- source\_model: staging-—Ç–∞–±–ª–∏—Ü–∞ {{ automate\_dv.link( 'customer\_order\_pk', \['customer\_id', 'order\_id'\], 'created\_at', 'dbt\_source', 'stg\_orders' ) }}

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–û—Ç–ª–∏—á–Ω–æ, —Å–ø–∞—Å–∏–±–æ. –û—à–∏–±–∫–∞:

```
<div><p>vbnet</p><p><code><span><span>syntax </span><span><span>error</span></span><span> at </span><span><span>or</span></span><span> near </span><span><span>"AS"</span></span><span>
LINE </span><span><span>28</span></span><span>: </span><span><span>FROM</span></span><span>  </span><span><span>AS</span></span><span> a
</span></span></code></p></div>
```

–ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∏–∑-–∑–∞ —Ç–æ–≥–æ, —á—Ç–æ **–≤ –º–∞–∫—Ä–æ—Å–∞—Ö `hub` –∏ `link` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `ref(source_model)`**, –∞ —Ç—ã —É–∂–µ –ø–µ—Ä–µ–¥–∞—ë—à—å –≤ –Ω–∏—Ö —Å—Ç—Ä–æ–∫—É ‚Äî `'stg_customers'`, `'stg_orders'`.

___

### üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:

–ü—Ä–æ–≤–µ—Ä—å —Å–∏–≥–Ω–∞—Ç—É—Ä—ã –º–∞–∫—Ä–æ—Å–æ–≤ `postgres__hub` –∏ `postgres__link`. –ù–∞–ø—Ä–∏–º–µ—Ä:

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>-- macros/tables/postgres/hub.sql
{% macro postgres__hub(src_pk, src_nk, src_ldts, src_source, source_model) %}
</span></code></p></div>
```

–ï—Å–ª–∏ —Ç–∞–º –Ω–∞–ø–∏—Å–∞–Ω–æ `ref(source_model)` –≤–Ω—É—Ç—Ä–∏ –º–∞–∫—Ä–æ—Å–∞ ‚Äî **–∑–∞–º–µ–Ω–∏ —ç—Ç–æ –Ω–∞ `ref(source_model)` —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ `source_model` —Å—Ç—Ä–æ–∫–∞**.

___

### ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å:

–û—Ç–∫—Ä–æ–π –º–∞–∫—Ä–æ—Å `postgres__hub` (–∏–ª–∏ `hub`) –∏ –Ω–∞–π–¥–∏ —Å—Ç—Ä–æ—á–∫—É, –ø–æ—Ö–æ–∂—É—é –Ω–∞:

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>from {{ ref(source_model) }} as a
</span></code></p></div>
```

–ó–∞–º–µ–Ω–∏ –µ—ë –Ω–∞:

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{%- if source_model is string -%}
    from {{ ref(source_model) }} as a
{%- else -%}
    from {{ source_model }} as a
{%- endif -%}
</span></code></p></div>
```

–¢–æ –∂–µ —Å–∞–º–æ–µ —Å–¥–µ–ª–∞–π –≤ `postgres__link`.

___

### üîç –û–±—ä—è—Å–Ω–µ–Ω–∏–µ:

-   `ref('stg_customers')` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `Relation`, –∫–∞–∫ –Ω—É–∂–Ω–æ.
    
-   `ref(stg_customers)` ‚Äî –æ—à–∏–±–∫–∞, –µ—Å–ª–∏ `stg_customers` —É–∂–µ `Relation` –∏–ª–∏ `ref` —É–∂–µ –ø—Ä–∏–º–µ–Ω—è–ª—Å—è —Ä–∞–Ω–µ–µ.
    
-   –ß—Ç–æ–±—ã –≥–∏–±–∫–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ–±–∞ —Å–ª—É—á–∞—è, –º–∞–∫—Ä–æ—Å—ã –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ç–∏–ø.
    

___

–ö–æ–≥–¥–∞ –ø–æ–ø—Ä–∞–≤–∏—à—å —Ö–æ—Ç—è –±—ã –≤ –æ–¥–Ω–æ–º –º–∞–∫—Ä–æ—Å–µ (`postgres__hub`), –ø–æ–ø—Ä–æ–±—É–π —Å–Ω–æ–≤–∞ –∑–∞–ø—É—Å—Ç–∏—Ç—å `dbt build` ‚Äî –∏ —Å–∫–∞–∂–∏, –æ—Å—Ç–∞–ª–∞—Å—å –ª–∏ –æ—à–∏–±–∫–∞ `FROM AS a`.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

{%- macro postgres\_\_hub(src\_pk, src\_nk, src\_extra\_columns, src\_ldts, src\_source, source\_model) -%} {%- macro postgres\_\_link(src\_pk, src\_fk, src\_extra\_columns, src\_ldts, src\_source, source\_model) -%}

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–û—Ç–ª–∏—á–Ω–æ, —Å–∏–≥–Ω–∞—Ç—É—Ä—ã –º–∞–∫—Ä–æ—Å–æ–≤ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—Ç, —á—Ç–æ `source_model` –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ –≤–∏–¥–µ —Å—Ç—Ä–æ–∫–∏ ‚Äî –∑–Ω–∞—á–∏—Ç, **–≤–Ω—É—Ç—Ä–∏ —ç—Ç–∏—Ö –º–∞–∫—Ä–æ—Å–æ–≤ —è–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `ref(source_model)`**, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –æ—à–∏–±–∫–µ, –µ—Å–ª–∏ `source_model` —É–∂–µ –±—ã–ª –æ—Ç—Ä–µ—Ñ–ª–µ–Ω –∏–ª–∏ –º–∞–∫—Ä–æ—Å –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ.

___

### ‚úÖ –®–∞–≥ 1: –ù–∞–π–¥–∏ —Å—Ç—Ä–æ–∫—É –≤–Ω—É—Ç—Ä–∏ `postgres__hub` –∏ `postgres__link`, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫:

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>from {{ ref(source_model) }} as a
</span></code></p></div>
```

–∏–ª–∏ –ø—Ä–æ—Å—Ç–æ:

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>FROM {{ ref(source_model) }} AS a
</span></code></p></div>
```

___

### üîÅ –®–∞–≥ 2: –ó–∞–º–µ–Ω–∏ —ç—Ç—É —Å—Ç—Ä–æ–∫—É –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—é:

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{%- if source_model is string -%}
    FROM {{ ref(source_model) }} AS a
{%- else -%}
    FROM {{ source_model }} AS a
{%- endif -%}
</span></code></p></div>
```

___

### üéØ –¶–µ–ª—å:

–≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∞–∫—Ä–æ—Å –∫–∞–∫ —Å –∏–º–µ–Ω–µ–º –º–æ–¥–µ–ª–∏ (—Å—Ç—Ä–æ–∫–æ–π), —Ç–∞–∫ –∏ —Å `ref(...)` –∑–∞—Ä–∞–Ω–µ–µ. –¢–µ–∫—É—â–∏–π –≤—ã–∑–æ–≤:

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{{ automate_dv.hub('customer_id', 'customer_name', 'created_at', 'dbt_source', 'stg_customers') }}
</span></code></p></div>
```

–æ–∂–∏–¥–∞–µ—Ç, —á—Ç–æ `ref(...)` –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω –≤–Ω—É—Ç—Ä–∏ –º–∞–∫—Ä–æ—Å–∞ ‚Äî –Ω–æ `ref()` –¥–æ–ª–∂–µ–Ω –≤—ã–∑—ã–≤–∞—Ç—å—Å—è **—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ `source_model` ‚Äî —Å—Ç—Ä–æ–∫–∞**.

___

–ü—Ä–∏–º–µ–Ω–∏—à—å —ç—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤ `postgres__hub` –∏ `postgres__link` ‚Äî –∏ –º–æ–∂–Ω–æ –±—É–¥–µ—Ç —Å–Ω–æ–≤–∞ –∑–∞–ø—É—Å–∫–∞—Ç—å `dbt build` –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —É—à–ª–∞ –ª–∏ –æ—à–∏–±–∫–∞ `FROM AS a`.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–∞ –Ω–µ –ø–æ–ª–æ–º–∞—é—Ç –ª–∏ —ç—Ç–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å? –∏ –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—à—É—Ç—Å—è –ª–∏ –æ–Ω–∏ –Ω–æ–≤—ã–º build?

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–û—Ç–ª–∏—á–Ω—ã–µ –∏ –æ—á–µ–Ω—å –≤–∞–∂–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã. –û—Ç–≤–µ—á–∞—é –ø–æ –ø–æ—Ä—è–¥–∫—É:

___

### üîß **1\. –ü–æ–ª–æ–º–∞—é—Ç –ª–∏ —ç—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å?**

–ù–µ—Ç ‚Äî –ø—Ä–∏ **–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –ø—Ä–∞–≤–∫–µ** —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π `is string`:

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{%- if source_model is string -%}
    FROM {{ ref(source_model) }} AS a
{%- else -%}
    FROM {{ source_model }} AS a
{%- endif -%}
</span></code></p></div>
```

üëâ —Ç—ã –ø—Ä–æ—Å—Ç–æ **–¥–µ–ª–∞–µ—à—å –º–∞–∫—Ä–æ—Å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–µ–µ**, –ø–æ–∑–≤–æ–ª—è—è –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –ª–∏–±–æ —Å—Ç—Ä–æ–∫—É (`'stg_customers'`), –ª–∏–±–æ —É–∂–µ –æ—Ç—Ä–µ—Ñ–ª–µ–Ω–Ω—É—é –º–æ–¥–µ–ª—å (`ref('stg_customers')`).

–≠—Ç–æ **–Ω–µ –Ω–∞—Ä—É—à–∏—Ç —Ä–∞–±–æ—Ç—É –¥—Ä—É–≥–∏—Ö –º–æ–¥–µ–ª–µ–π**, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏—Ö –º–∞–∫—Ä–æ—Å. –î–∞–∂–µ –Ω–∞–æ–±–æ—Ä–æ—Ç ‚Äî —É–ª—É—á—à–∏—Ç.

___

### üß± **2\. –ü–µ—Ä–µ–∑–∞–ø–∏—à—É—Ç—Å—è –ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º build / install?**

**–î–∞, –ø–µ—Ä–µ–∑–∞–ø–∏—à—É—Ç—Å—è**, –µ—Å–ª–∏ —Ç—ã –∏—Å–ø–æ–ª—å–∑—É–µ—à—å `dbt deps` –¥–ª—è –ø–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è –ø–∞–∫–µ—Ç–∞ `automate_dv`, —Ç–∞–∫ –∫–∞–∫:

-   –û–Ω —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∫–∞–∫ `dbt_packages/automate_dv`
    
-   –≠—Ç–æ **–≤–Ω–µ—à–Ω–∏–π –ø–∞–∫–µ—Ç**, –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ–º—ã–π —á–µ—Ä–µ–∑ `packages.yml`
    

üëâ **–ª—é–±—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ `dbt_packages/...` —Å—á–∏—Ç–∞—é—Ç—Å—è –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏** –∏ —É–¥–∞–ª—è—é—Ç—Å—è –ø—Ä–∏ –ª—é–±–æ–º –∏–∑:

-   `dbt deps`
    
-   —É–¥–∞–ª–µ–Ω–∏–∏ –ø–∞–ø–∫–∏ `dbt_packages`
    
-   –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –≤–µ—Ç–∫–∏, –µ—Å–ª–∏ –ø–∞–∫–µ—Ç git-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π
    

___

### ‚úÖ –ß—Ç–æ –¥–µ–ª–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ:

1.  **–°–∫–æ–ø–∏—Ä—É–π –Ω—É–∂–Ω—ã–µ –º–∞–∫—Ä–æ—Å—ã –≤ —Å–≤–æ–π –ø—Ä–æ–µ–∫—Ç**  
    –ù–∞–ø—Ä–∏–º–µ—Ä, –≤ `macros/patches/automate_dv/postgres__hub.sql` –∏ `postgres__link.sql`.
    
2.  –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏ –∏—Ö —Ç–∞–º (dbt –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **first-in-wins**: —Å–Ω–∞—á–∞–ª–∞ —Å–º–æ—Ç—Ä–∏—Ç –≤ —Ç–≤–æ—ë–º –ø—Ä–æ–µ–∫—Ç–µ).
    
3.  –í–Ω–µ—Å–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è **–≤–Ω—É—Ç—Ä–∏ –ø—Ä–æ–µ–∫—Ç–∞**, –∞ –Ω–µ –≤ `dbt_packages`.
    
4.  –õ–∏–±–æ ‚Äî **—Ñ–æ—Ä–∫–Ω–∏ `automate_dv`** –∏ –ø–æ–¥—Ç—è–≥–∏–≤–∞–π —É–∂–µ —Å–≤–æ–π —Ñ–æ—Ä–∫ —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏.
    

___

### üîÅ –•–æ—á–µ—à—å ‚Äî –º–æ–∂–µ–º —Å–¥–µ–ª–∞—Ç—å –≤—Å—ë –ø–æ—à–∞–≥–æ–≤–æ:

-   –°–Ω–∞—á–∞–ª–∞ –Ω–∞–π–¥—É –Ω—É–∂–Ω—ã–µ –º–∞–∫—Ä–æ—Å—ã
    
-   –ü–æ—Ç–æ–º –ø–æ–¥—Å–∫–∞–∂—É, –∫–∞–∫ –∏—Ö –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ
    
-   –ü–æ—Ç–æ–º –≤–Ω–µ—Å—ë–º –ø–∞—Ç—á
    

–ü—Ä–æ–¥–æ–ª–∂–∏–º?

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–¥–∞–≤–∞–π –Ω–∞—á–Ω—ë–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ hub.sql (–∏–º–µ–Ω–Ω–æ —Ç–∞–∫ –æ–Ω –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è) —è –µ–≥–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–ª –≤ —Å–≤–æ—é –ø–∞–ø–∫—É macros —Ç–∞–º –µ—Å—Ç—å –≤–æ—Ç —Ç–∞–∫–æ–π –∫–æ–¥: {%- for src in source\_model -%} {%- set source\_number = loop.index | string -%} row\_rank\_{{ source\_number }} AS ( {#- PostgreSQL has DISTINCT ON which should be more performant than the strategy used by Snowflake ROW\_NUMBER() OVER( PARTITION BY ... -#} {%- if model.config.materialized == 'vault\_insert\_by\_rank' %} SELECT DISTINCT ON ({{ automate\_dv.prefix(\[src\_pk\], 'rr') }}) {{ automate\_dv.prefix(source\_cols\_with\_rank, 'rr') }} {%- else %} SELECT DISTINCT ON ({{ automate\_dv.prefix(\[src\_pk\], 'rr') }}) {{ automate\_dv.prefix(source\_cols, 'rr') }} {%- endif %} FROM {{ ref(src) }} AS rr WHERE {{ automate\_dv.multikey(src\_pk, prefix='rr', condition='IS NOT NULL') }} ORDER BY {{ automate\_dv.prefix(\[src\_pk\], 'rr') }}, {{ automate\_dv.prefix(\[src\_ldts\], 'rr') }} {%- set ns.last\_cte = "row\_rank\_{}".format(source\_number) %} ),{{ "\\n" if not loop.last }} {% endfor -%} –∫–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å?

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–û—Ç–ª–∏—á–Ω–æ, —Ç—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–ª `hub.sql` –≤ —Å–≤–æ–π –ø—Ä–æ–µ–∫—Ç ‚Äî —Ç–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å. –°–µ–π—á–∞—Å —É —Ç–µ–±—è –≤ —Ü–∏–∫–ª–µ `for src in source_model`, –∏ –¥–∞–ª–µ–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `{{ ref(src) }}`:

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>FROM {{ ref(src) }} AS rr
</span></code></p></div>
```

### ‚ùó –ü—Ä–æ–±–ª–µ–º–∞

`src` –º–æ–∂–µ—Ç –±—ã—Ç—å —É–∂–µ –æ–±—ä–µ–∫—Ç–æ–º (`ref('...')`), –∞ –Ω–µ —Å—Ç—Ä–æ–∫–æ–π ‚Äî –∏ `ref(src)` —Ç–æ–≥–¥–∞ –≤—ã–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É:

> **The name argument to ref() must be a string, got PostgresRelation**

___

### ‚úÖ –†–µ—à–µ–Ω–∏–µ: –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Ç–∏–ø–∞ –ø–µ—Ä–µ–¥ `ref(...)`

–ó–∞–º–µ–Ω—è–µ–º:

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>FROM {{ ref(src) }} AS rr
</span></code></p></div>
```

–Ω–∞:

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{%- if src is string -%}
    FROM {{ ref(src) }} AS rr
{%- else -%}
    FROM {{ src }} AS rr
{%- endif -%}
</span></code></p></div>
```

___

### üìå –ü–æ–ª–Ω—ã–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç –ø–æ—Å–ª–µ –ø—Ä–∞–≤–∫–∏:

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{%- for src in source_model -%}

{%- set source_number = loop.index | string -%}

row_rank_{{ source_number }} AS (
    {%- if model.config.materialized == 'vault_insert_by_rank' %}
    SELECT DISTINCT ON ({{ automate_dv.prefix([src_pk], 'rr') }}) {{ automate_dv.prefix(source_cols_with_rank, 'rr') }}
    {%- else %}
    SELECT DISTINCT ON ({{ automate_dv.prefix([src_pk], 'rr') }}) {{ automate_dv.prefix(source_cols, 'rr') }}
    {%- endif %}

    {%- if src is string -%}
        FROM {{ ref(src) }} AS rr
    {%- else -%}
        FROM {{ src }} AS rr
    {%- endif %}

    WHERE {{ automate_dv.multikey(src_pk, prefix='rr', condition='IS NOT NULL') }}
    ORDER BY {{ automate_dv.prefix([src_pk], 'rr') }}, {{ automate_dv.prefix([src_ldts], 'rr') }}
    {%- set ns.last_cte = "row_rank_{}".format(source_number) %}
),{{ "\n" if not loop.last }}

{%- endfor %}
</span></code></p></div>
```

___

üîÑ –ì–æ—Ç–æ–≤ –≤–Ω–µ—Å—Ç–∏ —Å–ª–µ–¥—É—é—â–µ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ `link.sql`) –∏–ª–∏ –º–æ–∂–µ—à—å –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å `hub_customers` –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å ‚Äî –∫–∞–∫ —Å–∫–∞–∂–µ—à—å.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

12:28:09 Database Error in model hub\_customers (models/hubs/hub\_customers.sql) syntax error at or near "AS" LINE 28: FROM AS a ^ compiled code at target/run/dv\_postgres\_project/models/hubs/hub\_customers.sql –∫–∞–∫ –ø–æ–Ω—è—Ç—å, —á—Ç–æ –º–æ–π –º–∞–∫—Ä–æ—Å –ø–æ–¥—Ö–≤–∞—Ç–∏–ª—Å—è? –æ—Ä–∏–≥–∏–Ω–∞–ª –ª–µ–∂–∏—Ç —Ç—É—Ç: C:\\Projects\\Python\\data-vault-dbt\\dbt\\dbt\_packages\\automate\_dv\\macros\\tables\\postgres\\hub.sql –∞ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π: C:\\Projects\\Python\\data-vault-dbt\\dbt\\macros\\hub.sql

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å.

### üîç –ö–∞–∫ –ø–æ–Ω—è—Ç—å, —á—Ç–æ –ø–æ–¥—Ö–≤–∞—Ç–∏–ª—Å—è **—Ç–≤–æ–π** `macros/hub.sql` –≤–º–µ—Å—Ç–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –≤ `dbt_packages`?

___

### ‚úÖ 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ `dbt debug`

–£–±–µ–¥–∏—Å—å, —á—Ç–æ —Ç–≤–æ—è –ø–∞–ø–∫–∞ `macros/` –≤—Ö–æ–¥–∏—Ç –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞.

-   –í `dbt_project.yml` –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
    

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>macro-paths:</span></span><span> [</span><span><span>"macros"</span></span><span>]
</span></span></code></p></div>
```

–ï—Å–ª–∏ —Ç—ã –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–ª —à–∞–±–ª–æ–Ω –æ—Ç–∫—É–¥–∞-—Ç–æ ‚Äî —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ–ø—É—â–µ–Ω–æ. –ü—Ä–æ–≤–µ—Ä—å –∏ –¥–æ–±–∞–≤—å, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ.

___

### ‚úÖ 2. –£–±–µ–¥–∏—Å—å, —á—Ç–æ –∏–º—è –º–∞–∫—Ä–æ—Å–∞ **—Ç–∞–∫–æ–µ –∂–µ**

–¢—ã –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **—Ç–æ—á–Ω–æ —Ç–∞–∫–æ–µ –∂–µ –∏–º—è –º–∞–∫—Ä–æ—Å–∞**, –∫–∞–∫ –≤ `automate_dv`, —á—Ç–æ–±—ã –æ–Ω **–ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏–ª—Å—è**:

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{% macro postgres__hub(...) %}
</span></code></p></div>
```

–ï—Å–ª–∏ —Ç—ã –Ω–∞–∑–≤–∞–ª –µ–≥–æ –ø—Ä–æ—Å—Ç–æ `hub`, —Ç–æ —ç—Ç–æ **–Ω–æ–≤—ã–π –º–∞–∫—Ä–æ—Å**, –∞ –Ω–µ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ.

___

### ‚úÖ 3. –î–æ–±–∞–≤—å `log` –≤ –º–∞–∫—Ä–æ—Å

–ß—Ç–æ–±—ã —Ç–æ—á–Ω–æ —É–≤–∏–¥–µ—Ç—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–≤–æ—è –≤–µ—Ä—Å–∏—è, –¥–æ–±–∞–≤—å –≤ –Ω–∞—á–∞–ª–æ –º–∞–∫—Ä–æ—Å–∞ —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ:

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{% do log("‚öôÔ∏è Using custom postgres__hub macro", info=True) %}
</span></code></p></div>
```

–ó–∞—Ç–µ–º –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ `dbt build` –∏ –Ω–∞–π–¥–∏ –≤ –ª–æ–≥–∞—Ö —ç—Ç—É —Å—Ç—Ä–æ–∫—É.

___

### ‚úÖ 4. –£–¥–∞–ª–∏/–ø–µ—Ä–µ–∏–º–µ–Ω—É–π –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –º–∞–∫—Ä–æ—Å

–ï—Å–ª–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ **—É–¥–∞–ª–∏—Ç—å –∏–ª–∏ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å** `hub.sql` –≤ `dbt_packages/automate_dv/macros/tables/postgres/`, —Ç–æ –æ—à–∏–±–∫–∞ –¥–æ–ª–∂–Ω–∞ –ø—Ä–æ–ø–∞—Å—Ç—å **—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–æ–¥—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç—Å—è —Ç–≤–æ–π –º–∞–∫—Ä–æ—Å**.

___

### üìå –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π –≤—ã–≤–æ–¥ –ø–æ –æ—à–∏–±–∫–µ

–û—à–∏–±–∫–∞:

–æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ **`ref(...)` –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª**, –∏ –≤–º–µ—Å—Ç–æ `FROM stg_customers AS a` —Ç—ã –ø–æ–ª—É—á–∏–ª `FROM AS a`.  
–≠—Ç–æ 100% –∑–Ω–∞—á–∏—Ç, —á—Ç–æ **—Ç–≤–æ–π –º–∞–∫—Ä–æ—Å –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª** –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∞—Ä—ã–π, –∏–∑ `dbt_packages`.

___

### üõ† –ß—Ç–æ –¥–µ–ª–∞—Ç—å —Å–µ–π—á–∞—Å?

1.  –ü—Ä–æ–≤–µ—Ä—å `macro-paths` –≤ `dbt_project.yml`
    
2.  –£–¥–æ—Å—Ç–æ–≤–µ—Ä—å—Å—è, —á—Ç–æ –º–∞–∫—Ä–æ—Å –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è `postgres__hub`
    
3.  –î–æ–±–∞–≤—å `log(...)` –≤–Ω—É—Ç—Ä—å, —á—Ç–æ–±—ã –æ—Ç—Å–ª–µ–¥–∏—Ç—å —Ñ–∞–∫—Ç –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è
    
4.  –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ `dbt build`
    

–•–æ—á–µ—à—å ‚Äî –º–æ–≥—É –ø–æ–º–æ—á—å —Ç–µ–±–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –ø–æ–ø—Ä–∞–≤–∏—Ç—å `dbt_project.yml` –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å ‚Äî –ø–æ–∫–∞–∂–∏ –µ–≥–æ.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π hub.sql –∫–∞–∂–¥—ã–π —Ä–∞–∑ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—ë—Ç—Å—è –ø—Ä–∏ build –º–æ–π hub.sql –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–û—Ç–ª–∏—á–Ω–æ ‚Äî —Ç—ã –∫–∞–∫ —Ä–∞–∑ –Ω–∞ —à–∞–≥–µ, –≥–¥–µ –≤—Å—ë –º–æ–∂–Ω–æ —Å—Ç–∞–±–∏–ª—å–Ω–æ –ø–æ—á–∏–Ω–∏—Ç—å.

___

## ‚úÖ –†–µ—à–µ–Ω–∏–µ: –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ `hub.sql` –∏–∑ `automate_dv`, —á—Ç–æ–±—ã –æ–Ω **–Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–ª—Å—è** –∏ **–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è —Ç–≤–æ–π**

___

### üìå –ü—Ä–∏—á–∏–Ω–∞:

–¢—ã –∏—Å–ø–æ–ª—å–∑—É–µ—à—å `automate_dv` –∫–∞–∫ dependency (`packages.yml`). –ü—Ä–∏ `dbt deps` –∏–ª–∏ `dbt build`:

-   –ü–∞–ø–∫–∞ `dbt_packages/automate_dv/` –ø–µ—Ä–µ—Å–æ–∑–¥–∞—ë—Ç—Å—è.
    
-   –í—Å–µ –º–∞–∫—Ä–æ—Å—ã —Ç–∞–º ‚Äî **–ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è**.
    
-   –ï—Å–ª–∏ —Ç—ã —Ö–æ—á–µ—à—å **–∏–∑–º–µ–Ω–∏—Ç—å** –ø–æ–≤–µ–¥–µ–Ω–∏–µ `hub.sql` ‚Äî —Ç—ã –¥–æ–ª–∂–µ–Ω **–ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–∞–∫—Ä–æ—Å**, –∞ –Ω–µ —Ñ–∞–π–ª.
    

___

## üîß –ß—Ç–æ –¥–µ–ª–∞—Ç—å:

### ‚úÖ –®–∞–≥ 1: –°–æ–∑–¥–∞–π `macros/tables/postgres/hub.sql` –≤ —Å–≤–æ—ë–º –ø—Ä–æ–µ–∫—Ç–µ (–∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ `macros/hub.sql`)

–ü—É—Ç—å –¥–æ–ª–∂–µ–Ω —Ç–æ—á–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å:

```
<div><p>pgsql</p><p><code><span><span>your_project/
‚îú‚îÄ‚îÄ macros/
‚îÇ   ‚îî‚îÄ‚îÄ </span><span><span>tables</span></span><span>/
‚îÇ       ‚îî‚îÄ‚îÄ postgres/
‚îÇ           ‚îî‚îÄ‚îÄ hub.</span><span><span>sql</span></span><span>   ‚Üê —Å—é–¥–∞ –∫–ª–∞–¥—ë–º –ü–û–õ–ù–£–Æ –∫–æ–ø–∏—é –º–∞–∫—Ä–æ—Å–∞
</span></span></code></p></div>
```

### ‚úÖ –®–∞–≥ 2: –í —ç—Ç–æ–º —Ñ–∞–π–ª–µ —Å–∫–æ–ø–∏—Ä—É–π **–º–∞–∫—Ä–æ—Å `postgres__hub`** (–≤—Å—é –µ–≥–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é) –∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π

–í–∞–∂–Ω–æ: –Ω–µ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–π `postgres__hub`.  
DBT –∏—Å–ø–æ–ª—å–∑—É–µ—Ç dispatch –ø–æ —Å—Ö–µ–º–µ: `<adapter>__<macro_name>`, –∏ —Ç—ã –¥–æ–ª–∂–µ–Ω –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å –∏–º–µ–Ω–Ω–æ `postgres__hub`.

### ‚úÖ –®–∞–≥ 3: –£–±–µ–¥–∏—Å—å, —á—Ç–æ –≤ `dbt_project.yml` –µ—Å—Ç—å:

```
<div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>macro-paths:</span></span><span> [</span><span><span>"macros"</span></span><span>]
</span></span></code></p></div>
```

### ‚úÖ –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–≤–æ–π –º–∞–∫—Ä–æ—Å:

–î–æ–±–∞–≤—å –≤ –Ω–∞—á–∞–ª–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ `postgres__hub`:

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{% do log("‚úÖ Using custom postgres__hub", info=True) %}
</span></code></p></div>
```

–ò –ø–æ—Ç–æ–º –≤—ã–ø–æ–ª–Ω–∏:

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>dbt build --</span><span><span>select</span></span><span> hub_customers
</span></span></code></p></div>
```

–ò—â–∏ –≤ –ª–æ–≥–∞—Ö:

```
<div><p>vbnet</p><p><code><span><span>‚úÖ </span><span><span>Using</span></span><span> </span><span><span>custom</span></span><span> postgres__hub
</span></span></code></p></div>
```

___

## ‚ùó–í–∞–∂–Ω–æ:

–ù–µ –ø—ã—Ç–∞–π—Å—è –≤—Ä—É—á–Ω—É—é –ø—Ä–∞–≤–∏—Ç—å —Ñ–∞–π–ª—ã –≤ `dbt_packages/` ‚Äî —ç—Ç–æ **–≤—Å–µ–≥–¥–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ**. –í—Å—ë, —á—Ç–æ —Ç–∞–º, ‚Äî **—É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è `dbt deps`**.

___

–•–æ—á–µ—à—å ‚Äî –ø–æ–∫–∞–∂–∏, –∫–∞–∫ —É —Ç–µ–±—è —É—Å—Ç—Ä–æ–µ–Ω –ø—É—Ç—å –¥–æ `hub.sql`, —è –ø–æ–º–æ–≥—É –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–∫–∞–∫ –≤—ã–ø–æ–ª–Ω–∏—Ç—å dbt build --select hub\_customers –≤ –¥–æ–∫–µ—Ä–µ, –µ—Å–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω?

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å. –ï—Å–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –µ—â—ë **–Ω–µ –∑–∞–ø—É—â–µ–Ω**, –∞ —Ç—ã —Ö–æ—á–µ—à—å –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É –≤—Ä–æ–¥–µ `dbt build --select hub_customers` –≤–Ω—É—Ç—Ä–∏ Docker ‚Äî –Ω—É–∂–Ω–æ:

___

## ‚úÖ –®–∞–≥ 1: –ó–∞–ø—É—Å—Ç–∏—Ç—å **–æ–¥–∏–Ω–æ—á–Ω—É—é –∫–æ–º–∞–Ω–¥—É –≤–Ω—É—Ç—Ä–∏ –Ω–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞**

–ï—Å–ª–∏ —Ç—ã –∏—Å–ø–æ–ª—å–∑—É–µ—à—å –∫–∞—Å—Ç–æ–º–Ω—ã–π Docker-–æ–±—Ä–∞–∑ —Å dbt, —Ç–æ, –¥–æ–ø—É—Å—Ç–∏–º, –æ–Ω –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è `data-vault-dbt-dbt`.

–¢–æ–≥–¥–∞ –≤—ã–ø–æ–ª–Ω–∏:

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>docker run --</span><span><span>rm</span></span><span> -v %</span><span><span>cd</span></span><span>%:/app -w /app data-vault-dbt-dbt dbt build --</span><span><span>select</span></span><span> hub_customers
</span></span></code></p></div>
```

üìå –ü–æ—è—Å–Ω–µ–Ω–∏–µ:

-   `--rm`: –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —É–¥–∞–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è.
    
-   `-v %cd%:/app`: –º–æ–Ω—Ç–∏—Ä—É–µ—Ç —Ç–µ–∫—É—â—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫–∞–∫ `/app` (–≤ Unix: `$(pwd)`).
    
-   `-w /app`: —Ä–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.
    
-   `data-vault-dbt-dbt`: —Ç–≤–æ–π dbt-–æ–±—Ä–∞–∑.
    
-   `dbt build --select hub_customers`: –Ω—É–∂–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞.
    

> –ï—Å–ª–∏ —Ç—ã –Ω–∞ Linux/macOS, –∑–∞–º–µ–Ω–∏ `%cd%` –Ω–∞ `$(pwd)`.

___

## ‚úÖ –®–∞–≥ 2: –ï—Å–ª–∏ —Ö–æ—á–µ—à—å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—É—é —Å–µ—Å—Å–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á—Ç–æ–±—ã —á—Ç–æ-—Ç–æ –æ—Ç–ª–∞–¥–∏—Ç—å)

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>docker run --</span><span><span>rm</span></span><span> -it -v %</span><span><span>cd</span></span><span>%:/app -w /app data-vault-dbt-dbt /bin/bash
</span></span></code></p></div>
```

–ó–∞—Ç–µ–º –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>dbt build --</span><span><span>select</span></span><span> hub_customers
</span></span></code></p></div>
```

___

–ï—Å–ª–∏ —Ç—ã –Ω–µ —É–≤–µ—Ä–µ–Ω, –∫–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–≤–æ–π –æ–±—Ä–∞–∑ ‚Äî –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–ø–∏—Å–æ–∫:

___

–•–æ—á–µ—à—å ‚Äî –º–æ–≥—É –ø–æ–º–æ—á—å –æ–±–µ—Ä–Ω—É—Ç—å —ç—Ç–æ –≤ `Makefile`, `bash`\-—Å–∫—Ä–∏–ø—Ç –∏–ª–∏ `PowerShell`, –µ—Å–ª–∏ —Ç—ã —á–∞—Å—Ç–æ —Ç–∞–∫–æ–µ –¥–µ–ª–∞–µ—à—å.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

12:44:33 Database Error in model hub\_customers (models/hubs/hub\_customers.sql) syntax error at or near "AS" LINE 28: FROM AS a ^ compiled code at target/run/dv\_postgres\_project/models/hubs/hub\_customers.sql

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–û—à–∏–±–∫–∞ `syntax error at or near "AS"` –∏ –æ—Å–æ–±–µ–Ω–Ω–æ —Ñ—Ä–∞–≥–º–µ–Ω—Ç `FROM AS a` –≥–æ–≤–æ—Ä–∏—Ç, —á—Ç–æ –≤ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–º SQL –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–º—è —Ç–∞–±–ª–∏—Ü—ã –∏–ª–∏ –ø–æ–¥–∑–∞–ø—Ä–æ—Å–∞ –ø–æ—Å–ª–µ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞ `FROM`.

–¢–æ –µ—Å—Ç—å –≥–¥–µ-—Ç–æ –≤ —Ç–≤–æ—ë–º —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –∫–æ–¥–µ `FROM` —Å—Ç–æ–∏—Ç –±–µ–∑ —É–∫–∞–∑–∞–Ω–∏—è, —á—Ç–æ –∏–º–µ–Ω–Ω–æ —á–∏—Ç–∞–µ—Ç—Å—è.

___

### –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å:

1.  –í –º–∞–∫—Ä–æ—Å–µ, –∫–æ—Ç–æ—Ä—ã–π –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —ç—Ç–æ—Ç SQL, –ø—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –ø–µ—Ä–µ–¥ `AS a` —Å—Ç–æ–∏—Ç —Ä–µ–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö (—Ç–∞–±–ª–∏—Ü–∞ –∏–ª–∏ –ø–æ–¥–∑–∞–ø—Ä–æ—Å).
    
2.  –°–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ, –ø—Ä–æ–±–ª–µ–º–∞ ‚Äî –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–µ `source_model`, –∫–æ—Ç–æ—Ä—ã–π –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ `automate_dv.hub()` ‚Äî –æ–Ω –ª–∏–±–æ –ø—É—Å—Ç–æ–π, –ª–∏–±–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–µ—Ä–µ–¥–∞–Ω.
    

___

### –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π:

-   –ü–æ–∫–∞–∂–∏, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, —Ç–æ—á–Ω—ã–π –≤—ã–∑–æ–≤ –º–∞–∫—Ä–æ—Å–∞ –≤ `hub_customers.sql` (—Ç–æ, —á—Ç–æ —É —Ç–µ–±—è —Å–µ–π—á–∞—Å).
    
-   –¢–∞–∫–∂–µ –ø–æ–∫–∞–∂–∏, –∫–∞–∫ —É —Ç–µ–±—è –æ–±—ä—è–≤–ª–µ–Ω `source_model` (–æ–±—ã—á–Ω–æ —ç—Ç–æ `ref('...')`).
    
-   –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ —è –ø–æ–º–æ–≥—É –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –ª–∏ —Ç—É–¥–∞ –Ω—É–∂–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏ –∫–∞–∫ –¥–æ–ª–∂–Ω–æ –≤—ã–≥–ª—è–¥–µ—Ç—å.
    

___

–ü–æ–∫–∞ –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä—è–º–æ –≤ –º–æ–¥–µ–ª–∏ `hub_customers.sql` –¥–æ–±–∞–≤–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–π `print` (—á–µ—Ä–µ–∑ `log()` –∏–ª–∏ `{{ log(...) }}`) –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –≤—ã–≤–µ—Å—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏–µ `source_model`, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —ç—Ç–æ –∏–º–µ–Ω–Ω–æ –∏–º—è –º–æ–¥–µ–ª–∏, –∞ –Ω–µ –æ–±—ä–µ–∫—Ç –∏–ª–∏ –ø—É—Å—Ç–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.

___

–ñ–¥—É —Ç–≤–æ–π `hub_customers.sql`, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å, —á—Ç–æ –Ω–µ —Ç–∞–∫ —Å `source_model`.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–∑–∞—á–µ–º –º—ã –∏—Å–ø—Ä–∞–≤–ª—è–µ–º –º–∞–∫—Ä–æ—Å—ã? –ø–æ—á–µ–º—É –º—ã –Ω–µ –∏—Å–ø—Ä–∞–≤–ª—è–µ–º –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –∏—Ö –≤—ã–∑—ã–≤–∞–µ—Ç?

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å! –î–∞–≤–∞–π —Ä–∞–∑–±–µ—Ä—ë–º—Å—è.

___

### –ü–æ—á–µ–º—É –∏–Ω–æ–≥–¥–∞ –∏—Å–ø—Ä–∞–≤–ª—è—é—Ç –º–∞–∫—Ä–æ—Å—ã?

-   –ú–∞–∫—Ä–æ—Å—ã ‚Äî —ç—Ç–æ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç SQL –∏–∑ –≤—Ö–æ–¥–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.
    
-   –ï—Å–ª–∏ –º–∞–∫—Ä–æ—Å –Ω–∞–ø–∏—Å–∞–Ω —Å –æ—à–∏–±–∫–∞–º–∏ –∏–ª–∏ –æ–∂–∏–¥–∞–µ—Ç –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, —Ç–æ –∏—Å–ø—Ä–∞–≤–ª—è—Ç—å –µ–≥–æ –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã –æ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞–ª –¥–ª—è –≤—Å–µ—Ö –≤—ã–∑–æ–≤–æ–≤.
    
-   –û—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ –º–∞–∫—Ä–æ—Å –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –≤–Ω–µ—à–Ω–µ–º—É –ø–∞–∫–µ—Ç—É, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è, –∏–ª–∏ –≤ –Ω—ë–º –±–∞–≥.
    

___

### –ü–æ—á–µ–º—É –∏–Ω–æ–≥–¥–∞ –∏—Å–ø—Ä–∞–≤–ª—è—é—Ç –≤—ã–∑—ã–≤–∞—é—â–∏–π –∫–æ–¥?

-   –ï—Å–ª–∏ –≤—ã–∑–æ–≤ –º–∞–∫—Ä–æ—Å–∞ –ø–µ—Ä–µ–¥–∞—ë—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–µ `ref()` –æ–±—ä–µ–∫—Ç, –∞ —Å—Ç—Ä–æ–∫—É, –∏–ª–∏ –Ω–∞–æ–±–æ—Ä–æ—Ç),
    
-   –∏–ª–∏ –ø—Ä–æ–ø—É—â–µ–Ω—ã –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã,
    
-   –∏–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∞—é—Ç—Å—è –≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–µ —Å–ø–∏—Å–æ–∫, –∞ —Å—Ç—Ä–æ–∫–∞),
    
-   ‚Äî —Ç–æ –∏—Å–ø—Ä–∞–≤–ª—è—Ç—å –Ω–∞–¥–æ –∏–º–µ–Ω–Ω–æ –≤—ã–∑–æ–≤, —á—Ç–æ–±—ã –æ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞–ª –¥–∞–Ω–Ω—ã–µ.
    

___

### –í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ

–°—É–¥—è –ø–æ –æ—à–∏–±–∫–µ `FROM AS a`, –≤–µ—Ä–æ—è—Ç–Ω–æ, –ø–∞—Ä–∞–º–µ—Ç—Ä `source_model` –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ –º–∞–∫—Ä–æ—Å –ø—É—Å—Ç—ã–º –∏–ª–∏ –≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ ‚Äî —Ç–æ –µ—Å—Ç—å –∏–º–µ–Ω–Ω–æ –≤—ã–∑–æ–≤ –≤ –º–æ–¥–µ–ª–∏ `hub_customers.sql` –Ω–µ –ø–æ–¥–∞—ë—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π `ref()` –∏–ª–∏ —Å—Ç—Ä–æ–∫—É —Å –∏–º–µ–Ω–µ–º –º–æ–¥–µ–ª–∏.

___

### –ß—Ç–æ —è –ø—Ä–µ–¥–ª–∞–≥–∞—é

1.  –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏, –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏, –ø–æ–ø—Ä–∞–≤–∏—Ç—å –≤—ã–∑–æ–≤ –º–∞–∫—Ä–æ—Å–∞ –≤ —Ñ–∞–π–ª–µ –º–æ–¥–µ–ª–∏ (`hub_customers.sql`, `link_customer_orders.sql` –∏ —Ç.–ø.).
    
2.  –ï—Å–ª–∏ –≤—ã–∑–æ–≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π, –Ω–æ –æ—à–∏–±–∫–∞ –æ—Å—Ç–∞—ë—Ç—Å—è ‚Äî —Ç–æ–≥–¥–∞ —É–∂–µ —Å–º–æ—Ç—Ä–µ—Ç—å –≤ –º–∞–∫—Ä–æ—Å, –≤–æ–∑–º–æ–∂–Ω–æ —Ç–∞–º –Ω–µ–≤–µ—Ä–Ω–æ —Ä–∞–±–æ—Ç–∞—é—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã.
    

___

### –ò—Ç–æ–≥

**–ò—Å–ø—Ä–∞–≤–ª—è—Ç—å –≤—ã–∑–æ–≤ –º–∞–∫—Ä–æ—Å–∞ —É–¥–æ–±–Ω–µ–µ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–µ–µ, –µ—Å–ª–∏ –æ—à–∏–±–∫–∞ –≤—ã–∑–≤–∞–Ω–∞ –∏–º–µ–Ω–Ω–æ –Ω–µ–≤–µ—Ä–Ω—ã–º–∏ –≤—Ö–æ–¥–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.**

–ê –∏—Å–ø—Ä–∞–≤–ª—è—Ç—å –º–∞–∫—Ä–æ—Å ‚Äî –µ—Å–ª–∏ –æ—à–∏–±–∫–∞ –≥–ª—É–±–∂–µ, –≤ –ª–æ–≥–∏–∫–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ SQL.

___

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, –º–æ–≥—É –ø–æ–º–æ—á—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–≤–æ–π —Ç–µ–∫—É—â–∏–π –≤—ã–∑–æ–≤ –º–∞–∫—Ä–æ—Å–∞ ‚Äî –ø–æ–∫–∞–∂–∏, –∫–∞–∫ –æ–Ω —Å–µ–π—á–∞—Å –≤—ã–≥–ª—è–¥–∏—Ç.  
–¢–∞–∫ –±—É–¥–µ—Ç –ø—Ä–æ—â–µ –ø–æ–Ω—è—Ç—å, –≥–¥–µ –∏–º–µ–Ω–Ω–æ –ø—Ä–æ–±–ª–µ–º–∞.

___

–ß—Ç–æ —Å–∫–∞–∂–µ—à—å?

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

\>>–°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏, –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏, –ø–æ–ø—Ä–∞–≤–∏—Ç—å –≤—ã–∑–æ–≤ –º–∞–∫—Ä–æ—Å–∞ –≤ —Ñ–∞–π–ª–µ –º–æ–¥–µ–ª–∏ (hub\_customers.sql, link\_customer\_orders.sql –∏ —Ç.–ø.). —É–∂–µ –ø—Ä–æ–≤–µ—Ä—è–ª–∏! —Å–º–æ—Ç—Ä–∏ –≤—ã—à–µ –≤ —á–∞—Ç–µ! —Ö–≤–∞—Ç–∏—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ!!!

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–ü–æ–Ω—è–ª —Ç–µ–±—è, –¥–∞–≤–∞–π –Ω–µ –±—É–¥–µ–º —Ç–æ–ø—Ç–∞—Ç—å—Å—è –Ω–∞ –º–µ—Å—Ç–µ.

–†–∞–∑ –≤—ã–∑–æ–≤ –º–∞–∫—Ä–æ—Å–∞ –ø—Ä–æ–≤–µ—Ä–µ–Ω –∏ —Å–¥–µ–ª–∞–Ω –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏, –Ω–æ –ø—Ä–∏ —ç—Ç–æ–º –æ—à–∏–±–∫–∞ `FROM AS a` ‚Äî —ç—Ç–æ —è–≤–Ω–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –≤ –∑–∞–ø—Ä–æ—Å–µ –ø–æ—Å–ª–µ `FROM` **–Ω–µ—Ç –∏–º–µ–Ω–∏ —Ç–∞–±–ª–∏—Ü—ã –∏–ª–∏ –∞–ª–∏–∞—Å–∞**.

–≠—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –ª–∏–±–æ:

-   –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è, –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ–º–∞—è –≤ `FROM {{ ref(source_model) }} AS a` ‚Äî –ø—É—Å—Ç–∞—è –∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è, –ª–∏–±–æ
    
-   –º–∞–∫—Ä–æ—Å —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç SQL —Å –æ—à–∏–±–∫–æ–π, –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–æ–ø—É—Å–∫–∞—è –∏–º—è –∏—Å—Ç–æ—á–Ω–∏–∫–∞.
    

___

### –ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ

–î–∞–≤–∞–π —Å—Ñ–æ–∫—É—Å–∏—Ä—É–µ–º—Å—è –Ω–∞ —Ç–æ–º, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç `{{ ref(source_model) }}`.

**–ü—Ä–µ–¥–ª–∞–≥–∞—é –≤—ã–≤–µ—Å—Ç–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `source_model` –ø—Ä—è–º–æ –≤ –º–æ–¥–µ–ª–∏ –¥–ª—è –¥–µ–±–∞–≥–∞:**

–í –Ω–∞—á–∞–ª–µ –º–æ–¥–µ–ª–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `hub_customers.sql`) –≤—Å—Ç–∞–≤—å —Ç–∞–∫–æ–π –∫–æ–¥:

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{{ log(source_model, info=True) }}
</span></code></p></div>
```

–∏ –∑–∞–ø—É—Å—Ç–∏ –±–∏–ª–¥.

–≠—Ç–æ –≤—ã–≤–µ–¥–µ—Ç –≤ –ª–æ–≥ —Ä–µ–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ `source_model` ‚Äî –≤–∏–¥–Ω–æ –±—É–¥–µ—Ç, —á—Ç–æ –∏–º–µ–Ω–Ω–æ —Ç—É–¥–∞ –ø–æ–ø–∞–¥–∞–µ—Ç.

___

–ï—Å–ª–∏ —Ç–∞–º –æ–∫–∞–∂–µ—Ç—Å—è –ø—É—Å—Ç–æ—Ç–∞ –∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ ‚Äî —Å—Ä–∞–∑—É —Å—Ç–∞–Ω–µ—Ç –ø–æ–Ω—è—Ç–Ω–æ, —á—Ç–æ –Ω–µ —Ç–∞–∫ —Å –≤—ã–∑–æ–≤–æ–º.

–ï—Å–ª–∏ –≤—Å—ë –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ ‚Äî —Ç–æ–≥–¥–∞ –∑–Ω–∞—á–∏—Ç –ø—Ä–æ–±–ª–µ–º–∞ –≤ –º–∞–∫—Ä–æ—Å–µ, –∏ –±—É–¥–µ–º —É–∂–µ –ø—Ä–∞–≤–∏—Ç—å —Ç–∞–º.

___

–î–∞–≤–∞–π —Å–¥–µ–ª–∞–µ–º –∏–º–µ–Ω–Ω–æ —Ç–∞–∫ ‚Äî —Å–∫–∞–∂–∏, –∫–∞–∫ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–∞ –∫–∞–∫ –º–Ω–µ –Ω–∞–π—Ç–∏ —ç—Ç—É –∑–∞–ø–∏—Å—å –≤ –ª–æ–≥–µ?

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å! –í–æ—Ç –∫–∞–∫ –Ω–∞–π—Ç–∏ —ç—Ç—É –∑–∞–ø–∏—Å—å –ª–æ–≥–∞:

1.  **–ì–¥–µ –∏—Å–∫–∞—Ç—å –ª–æ–≥–∏?**
    
    -   –ï—Å–ª–∏ –∑–∞–ø—É—Å–∫–∞–µ—à—å dbt –ª–æ–∫–∞–ª—å–Ω–æ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ ‚Äî –ª–æ–≥ –≤—ã–≤–æ–¥–∏—Ç—Å—è –ø—Ä—è–º–æ –≤ –∫–æ–Ω—Å–æ–ª—å.
        
    -   –ï—Å–ª–∏ –∑–∞–ø—É—Å–∫–∞–µ—à—å dbt –≤ Docker ‚Äî –Ω—É–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—ã–≤–æ–¥ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ `docker logs <container_id>` –∏–ª–∏ –µ—Å–ª–∏ –∑–∞–ø—É—Å–∫–∞–µ—à—å –∫–æ–º–∞–Ω–¥—É —Å `docker run` ‚Äî –≤—ã–≤–æ–¥ –±—É–¥–µ—Ç –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ).
        
2.  **–ß—Ç–æ –∏—Å–∫–∞—Ç—å?**
    
    –ö–æ–≥–¥–∞ —Ç—ã –ø–∏—à–µ—à—å `{{ log(source_model, info=True) }}`, dbt –≤—ã–≤–æ–¥–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –ª–æ–≥ –≤ —Ñ–æ—Ä–º–∞—Ç–µ –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫–∏–º:
    
    ```
    <div><p>yaml</p><p><code><span><span><span>2025-06-02 13:00:00.000</span></span><span> </span><span><span>|</span></span><span> </span><span><span>INFO</span></span><span>  </span><span><span>|</span></span><span> </span><span><span>your_model_name</span></span><span> </span><span><span>|</span></span><span> </span><span><span>value_of_source_model_variable</span></span><span>
    </span></span></code></p></div>
    ```
    
3.  **–ö–∞–∫ —É—Å–∫–æ—Ä–∏—Ç—å –ø–æ–∏—Å–∫?**
    
    -   –ó–∞–ø—É—Å—Ç–∏ –±–∏–ª–¥ —Å —Ñ–ª–∞–≥–æ–º `--debug`, —Ç–æ–≥–¥–∞ –ª–æ–≥ –±—É–¥–µ—Ç –±–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω—ã–π –∏ –≤ –Ω—ë–º –ª–µ–≥—á–µ –Ω–∞–π—Ç–∏ `INFO`.
        
    -   –ú–æ–∂–Ω–æ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –≤—ã–≤–æ–¥ –∫–æ–º–∞–Ω–¥–æ–π, –Ω–∞–ø—Ä–∏–º–µ—Ä (–Ω–∞ Linux/macOS):
        
        ```
        <div><p>bash</p><p><code id="code-lang-bash"><span><span>dbt build --</span><span><span>select</span></span><span> hub_customers --debug | grep INFO
        </span></span></code></p></div>
        ```
        
    -   –í Windows PowerShell –º–æ–∂–Ω–æ —Ç–∞–∫:
        
        ```
        <div><p>powershell</p><p><code id="code-lang-powershell"><span>dbt build --select hub_customers --debug | Select-String "INFO"
        </span></code></p></div>
        ```
        

___

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, —Å–∫–∞–∂–∏, –∫–∞–∫ –∏–º–µ–Ω–Ω–æ –∑–∞–ø—É—Å–∫–∞–µ—à—å (–ª–æ–∫–∞–ª—å–Ω–æ –∏–ª–∏ –≤ Docker), —è –ø–æ–º–æ–≥—É —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Ç–æ—á–Ω—É—é –∫–æ–º–∞–Ω–¥—É –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–∞.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–º–æ–∂–Ω–æ –≤ —ç—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å –∫–∞–∫—É—é-—Ç–æ –º–µ—Ç–∫—É, —á—Ç–æ–±—ã –∏—Å–∫–∞—Ç—å –±—ã–ª–æ —É–¥–æ–±–Ω–µ–µ? {{ log(source\_model, info=True) }}

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–î–∞, –∫–æ–Ω–µ—á–Ω–æ! –ß—Ç–æ–±—ã –ø—Ä–æ—â–µ –±—ã–ª–æ –∏—Å–∫–∞—Ç—å —Ç–≤–æ–π –ª–æ–≥ –≤ –≤—ã–≤–æ–¥–µ, –¥–æ–±–∞–≤—å –≤ —Å–æ–æ–±—â–µ–Ω–∏–µ —É–Ω–∏–∫–∞–ª—å–Ω—É—é –º–µ—Ç–∫—É –∏–ª–∏ –ø—Ä–µ—Ñ–∏–∫—Å, –Ω–∞–ø—Ä–∏–º–µ—Ä:

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{{ log("DEBUG_HUB: " ~ source_model, info=True) }}
</span></code></p></div>
```

–ò–ª–∏, –µ—Å–ª–∏ —Ö–æ—á–µ—à—å –≤—ã–≤–µ—Å—Ç–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏–ª–∏ —Å–ª–æ–≤–∞—Ä—å:

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{{ log("DEBUG_HUB source_model: " ~ source_model | string, info=True) }}
</span></code></p></div>
```

–¢–æ–≥–¥–∞ –≤ –ª–æ–≥–∞—Ö —Ç—ã –±—É–¥–µ—à—å –≤–∏–¥–µ—Ç—å —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ:

```
<div><p>yaml</p><p><code><span><span><span>2025-06-02 13:00:00.000</span></span><span> </span><span><span>|</span></span><span> </span><span><span>INFO</span></span><span>  </span><span><span>|</span></span><span> </span><span><span>your_model_name</span></span><span> </span><span><span>|</span></span><span> </span><span><span>DEBUG_HUB:</span></span><span> </span><span><span>value_of_source_model_variable</span></span><span>
</span></span></code></p></div>
```

–ò –º–æ–∂–µ—à—å –ø—Ä–æ—Å—Ç–æ –∏—Å–∫–∞—Ç—å –ø–æ `DEBUG_HUB` –∏–ª–∏ –ª—é–±–æ–π –¥—Ä—É–≥–æ–π –º–µ—Ç–∫–µ, –∫–æ—Ç–æ—Ä—É—é –ø–æ—Å—Ç–∞–≤–∏—à—å.

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, –º–æ–≥—É –ø–æ–º–æ—á—å –æ—Ñ–æ—Ä–º–∏—Ç—å —ç—Ç–æ –ø—Ä—è–º–æ –≤ –Ω—É–∂–Ω–æ–º —Ç–µ–±–µ –º–∞–∫—Ä–æ—Å–µ –∏–ª–∏ –º–æ–¥–µ–ª–∏.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

12:59:24 DEBUG\_HUB: 12:59:24 DEBUG\_HUB source\_model:

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–ü–æ—Ö–æ–∂–µ, —á—Ç–æ `source_model` –ø—É—Å—Ç –∏–ª–∏ –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, —Ä–∞–∑ –≤ –ª–æ–≥–µ –ø—É—Å—Ç–æ.

–î–∞–≤–∞–π –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ —Å–¥–µ–ª–∞–µ–º —Å–ª–µ–¥—É—é—â–µ–µ:

1.  –í—ã–∑–æ–≤–∏ `log` —Å —Ç–∏–ø–æ–º `string` —è–≤–Ω–æ, —á—Ç–æ–±—ã —Ç–æ—á–Ω–æ –≤—ã–≤–µ—Å—Ç–∏, —á—Ç–æ –≤–Ω—É—Ç—Ä–∏ ‚Äî –≤–æ—Ç —Ç–∞–∫:
    

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{{ log("DEBUG_HUB source_model: " ~ source_model | string, info=True) }}
</span></code></p></div>
```

2.  –ï—Å–ª–∏ —ç—Ç–æ –æ–±—ä–µ–∫—Ç `Relation` (–∞ –≤ dbt `ref()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–º–µ–Ω–Ω–æ –µ–≥–æ), —Ç–æ –ª—É—á—à–µ –≤—ã–≤–µ—Å—Ç–∏ –µ–≥–æ —Å–≤–æ–π—Å—Ç–≤–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä:
    

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{{ log("DEBUG_HUB source_model identifier: " ~ source_model.identifier, info=True) }}
{{ log("DEBUG_HUB source_model database: " ~ source_model.database, info=True) }}
</span></code></p></div>
```

3.  –¢–∞–∫–∂–µ –ø–æ–ø—Ä–æ–±—É–π –≤—ã–≤–µ—Å—Ç–∏ –ø—Ä–æ—Å—Ç–æ —Å—Ç—Ä–æ–∫—É —Å –∏–º–µ–Ω–µ–º –º–æ–¥–µ–ª–∏, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –æ–Ω–æ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:
    

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{% set source_name = 'stg_customers' %}
{{ log("DEBUG_HUB source_name: " ~ source_name, info=True) }}
</span></code></p></div>
```

___

**–ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ:**

-   –ü—Ä–æ–≤–µ—Ä—å –≤ –∫–æ–¥–µ –≤—ã–∑–æ–≤–∞ –º–∞–∫—Ä–æ—Å–∞ (hub.sql –∏–ª–∏ hub\_customers.sql), —á—Ç–æ —Ç—ã –ø–µ—Ä–µ–¥–∞—ë—à—å —Ç—É–¥–∞ –∏–º–µ–Ω–Ω–æ `source_model`, –∞ –Ω–µ —Å—Ç—Ä–æ–∫—É `'stg_customers'` –∏–ª–∏ –Ω–∞–æ–±–æ—Ä–æ—Ç.
    
-   –ß–∞—Å—Ç–æ –≤ —Ç–∞–∫–∏—Ö –º–∞–∫—Ä–æ—Å–∞—Ö `source_model` ‚Äî —ç—Ç–æ –ª–∏–±–æ –æ–±—ä–µ–∫—Ç `Relation`, –ª–∏–±–æ —Å—Ç—Ä–æ–∫–∞ —Å –∏–º–µ–Ω–µ–º –º–æ–¥–µ–ª–∏, –∏ –æ–Ω–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø–æ-—Ä–∞–∑–Ω–æ–º—É.
    

___

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, –ø—Ä–∏—à–ª–∏ —Å—é–¥–∞ —Å—Ç—Ä–æ–∫—É –≤—ã–∑–æ–≤–∞ –º–∞–∫—Ä–æ—Å–∞ –∏–∑ –º–æ–¥–µ–ª–∏ `hub_customers.sql` –∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–∞–∫—Ä–æ—Å–∞ `hub` ‚Äî –ø–æ—Å–º–æ—Ç—Ä—é, –∫–∞–∫ –∏–º–µ–Ω–Ω–æ –æ–Ω–∏ —Å–≤—è–∑–∞–Ω—ã –∏ —á—Ç–æ —Å—Ç–æ–∏—Ç –ø–æ–ø—Ä–∞–≤–∏—Ç—å.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

hub\_customers.sql: {{ config(materialized='incremental') }} {{ log("DEBUG\_HUB: " ~ source\_model, info=True) }} {{ log("DEBUG\_HUB source\_model: " ~ source\_model | string, info=True) }} {{ log("DEBUG\_HUB source\_model identifier: " ~ source\_model.identifier, info=True) }} {{ log("DEBUG\_HUB source\_model database: " ~ source\_model.database, info=True) }} {% set source\_name = 'stg\_customers' %} {{ log("DEBUG\_HUB source\_name: " ~ source\_name, info=True) }} -- src\_pk: customer\_id -- src\_nk: customer\_name -- src\_ldts: created\_at -- src\_source: dbt\_source -- source\_model: stg\_customers {{ automate\_dv.hub('customer\_id', 'customer\_name', 'created\_at', 'dbt\_source', 'stg\_customers') }} –≤ –ª–æ–≥–µ —Ç–∞–∫–æ–µ: 13:03:42 Concurrency: 1 threads (target='dev') 13:03:42 13:03:43 1 of 6 START sql incremental model public.hub\_customers ........................ \[RUN\] 13:03:43 DEBUG\_HUB: 13:03:43 DEBUG\_HUB source\_model: 13:03:43 1 of 6 ERROR creating sql incremental model public.hub\_customers ............... \[ERROR in 0.03s\] 13:03:43 2 of 6 START sql incremental model public.link\_customer\_orders ................. \[RUN\] 13:03:43 13:03:43 + Loading dbt.public.link\_customer\_orders from 0 source(s) 13:03:43 2 of 6 ERROR creating sql incremental model public.link\_customer\_orders ........ \[ERROR in 0.27s\] 13:03:43 3 of 6 START sql incremental model public.sat\_customer\_details ................. \[RUN\] 13:03:43 3 of 6 ERROR creating sql incremental model public.sat\_customer\_details ........ \[ERROR in 0.07s\] 13:03:43 4 of 6 START sql view model public.stg\_customers ............................... \[RUN\] 13:03:43 4 of 6 OK created sql view model public.stg\_customers .......................... \[CREATE VIEW in 0.18s\] 13:03:43 5 of 6 START sql view model public.stg\_orders .................................. \[RUN\] 13:03:43 5 of 6 ERROR creating sql view model public.stg\_orders ......................... \[ERROR in 0.09s\] 13:03:43 6 of 6 START sql table model public.dim\_customers .............................. \[RUN\] 13:03:43 6 of 6 OK created sql table model public.dim\_customers ......................... \[SELECT 2 in 0.12s\] 13:03:43 13:03:43 Finished running 3 incremental models, 1 table model, 2 view models in 0 hours 0 minutes and 1.12 seconds (1.12s). 13:03:44 13:03:44 Completed with 4 errors, 0 partial successes, and 0 warnings: 13:03:44 13:03:44 Compilation Error in model hub\_customers (models/hubs/hub\_customers.sql) 'source\_model' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps". 13:03:44 13:03:44 Database Error in model link\_customer\_orders (models/links/link\_customer\_orders.sql) syntax error at or near "AS" LINE 28: FROM AS a ^ compiled code at target/run/dv\_postgres\_project/models/links/link\_customer\_orders.sql ... —Ç–æ –µ—Å—Ç—å —á–∞—Å—Ç—å —Å—Ç—Ä–æ–∫ —Å DEBUG –≤–æ–æ–±—â–µ –Ω–µ –≤—ã–≤–æ–¥–∏—Ç—Å—è

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–ü–æ–Ω—è—Ç–Ω–æ, –≤ —Ç–≤–æ—ë–º `hub_customers.sql` —Ç—ã –ø—ã—Ç–∞–µ—à—å—Å—è –∑–∞–ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `source_model`, –Ω–æ –µ—ë **–Ω–µ—Ç –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ** ‚Äî –æ—Ç—Å—é–¥–∞ –æ—à–∏–±–∫–∞: `'source_model' is undefined`.

–ò —Å–∞–º –≤—ã–∑–æ–≤ –º–∞–∫—Ä–æ—Å–∞:

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{{ automate_dv.hub('customer_id', 'customer_name', 'created_at', 'dbt_source', 'stg_customers') }}
</span></code></p></div>
```

–ø–µ—Ä–µ–¥–∞—ë—Ç —Ç—É–¥–∞ —Å—Ç—Ä–æ–∫—É `'stg_customers'`, –∞ –Ω–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `source_model`.

___

### –ß—Ç–æ –¥–µ–ª–∞—Ç—å

1.  –í –º–æ–¥–µ–ª–∏ `hub_customers.sql` **–∏—Å–∫–ª—é—á–∏ –ª–æ–≥–∏ —Å `source_model`**, –ª–∏–±–æ –∑–∞–≤–µ–¥–∏ –µ—ë —è–≤–Ω–æ:
    

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{% set source_model = 'stg_customers' %}

{{ log("DEBUG_HUB source_model: " ~ source_model, info=True) }}

{{ automate_dv.hub('customer_id', 'customer_name', 'created_at', 'dbt_source', source_model) }}
</span></code></p></div>
```

–ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é –≤ –≤—ã–∑–æ–≤–µ:

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{{ automate_dv.hub('customer_id', 'customer_name', 'created_at', 'dbt_source', 'stg_customers') }}
</span></code></p></div>
```

2.  –î–ª—è –æ—Ç–ª–∞–¥–∫–∏ **–Ω–µ –ø–∏—à–∏ –ª–æ–≥–∏ –¥–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –∏–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö**. –õ–æ–≥–∏ –Ω–∞–¥–æ —Å—Ç–∞–≤–∏—Ç—å –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞.
    

___

### –ö–ª—é—á–µ–≤–æ–µ

-   `source_model` ‚Äî —É —Ç–µ–±—è –ø—Ä–æ—Å—Ç–æ —Å—Ç—Ä–æ–∫–∞ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º –º–æ–¥–µ–ª–∏ `'stg_customers'`. –¢–∞–∫ —á—Ç–æ –≤ –º–∞–∫—Ä–æ—Å–µ –Ω–∞–¥–æ –æ–∂–∏–¥–∞—Ç—å –∏–º–µ–Ω–Ω–æ —Å—Ç—Ä–æ–∫—É, –∞ –Ω–µ –æ–±—ä–µ–∫—Ç.
    
-   –í –º–∞–∫—Ä–æ—Å–∞—Ö –ø—Ä–æ–≤–µ—Ä—å, –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä `source_model` ‚Äî –µ—Å–ª–∏ —Ç–∞–º –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `ref(source_model)`, —Ç–æ —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ (–ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—Å—è –≤ Relation).
    

___

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å –≤—ã–≤–µ—Å—Ç–∏ –≤ –ª–æ–≥–µ –∏–º—è –º–æ–¥–µ–ª–∏ ‚Äî –¥–µ–ª–∞–π —Ç–∞–∫:

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{% set source_model = 'stg_customers' %}
{{ log("DEBUG_HUB source_model: " ~ source_model, info=True) }}
</span></code></p></div>
```

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å –≤—ã–≤–µ—Å—Ç–∏ –æ–±—ä–µ–∫—Ç relation:

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{% set source_model = ref('stg_customers') %}
{{ log("DEBUG_HUB source_model identifier: " ~ source_model.identifier, info=True) }}
</span></code></p></div>
```

–ù–æ —Ç–æ–≥–¥–∞ –≤ –≤—ã–∑–æ–≤ –º–∞–∫—Ä–æ—Å–∞ –ø–µ—Ä–µ–¥–∞–≤–∞–π `source_model` –∫–∞–∫ Relation, –∞ –Ω–µ —Å—Ç—Ä–æ–∫—É.

___

### –†–µ–∑—é–º–µ

–°–µ–π—á–∞—Å –∏—Å–ø—Ä–∞–≤—å `hub_customers.sql` –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫:

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{{ config(materialized='incremental') }}

{% set source_model = 'stg_customers' %}
{{ log("DEBUG_HUB source_model: " ~ source_model, info=True) }}

{{ automate_dv.hub('customer_id', 'customer_name', 'created_at', 'dbt_source', source_model) }}
</span></code></p></div>
```

–∏ –∑–∞–ø—É—Å—Ç–∏ –∑–∞–Ω–æ–≤–æ ‚Äî –ø–æ—Å–º–æ—Ç—Ä–∏–º, —á—Ç–æ –±—É–¥–µ—Ç.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–≤–æ—Ç –¥–ª—è —Ç–∞–∫–æ–≥–æ: {% set source\_model = 'stg\_customers' %} {{ log("DEBUG\_HUB: " ~ source\_model, info=True) }} {{ log("DEBUG\_HUB source\_model: " ~ source\_model | string, info=True) }} {{ log("DEBUG\_HUB source\_model identifier: " ~ source\_model.identifier, info=True) }} {{ log("DEBUG\_HUB source\_model database: " ~ source\_model.database, info=True) }} –≤–æ—Ç —Ç–∞–∫–æ–π –ª–æ–≥: 13:10:35 DEBUG\_HUB: stg\_customers 13:10:35 DEBUG\_HUB source\_model: stg\_customers 13:10:35 DEBUG\_HUB source\_model identifier: 13:10:35 DEBUG\_HUB source\_model database:

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–≠—Ç–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –æ–∂–∏–¥–∞–µ–º–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ `source_model` —É —Ç–µ–±—è ‚Äî –ø—Ä–æ—Å—Ç–æ —Å—Ç—Ä–æ–∫–∞ `'stg_customers'`, –∞ –Ω–µ –æ–±—ä–µ–∫—Ç Relation.

-   –£ —Å—Ç—Ä–æ–∫–∏ –Ω–µ—Ç –∞—Ç—Ä–∏–±—É—Ç–æ–≤ `.identifier` –∏ `.database`, –ø–æ—ç—Ç–æ–º—É –æ–Ω–∏ –ø—É—Å—Ç—ã–µ –≤ –ª–æ–≥–µ.
    
-   –ö–æ–≥–¥–∞ —Ç—ã –¥–µ–ª–∞–µ—à—å `ref('stg_customers')`, —Ç–æ–≥–¥–∞ dbt –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç Relation —Å —ç—Ç–∏–º–∏ –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏.
    

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å —É–≤–∏–¥–µ—Ç—å —ç—Ç–∏ –ø–æ–ª—è, –Ω–∞–¥–æ –Ω–∞–ø–∏—Å–∞—Ç—å:

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{% set source_model = ref('stg_customers') %}
{{ log("DEBUG_HUB: " ~ source_model, info=True) }}
{{ log("DEBUG_HUB source_model identifier: " ~ source_model.identifier, info=True) }}
{{ log("DEBUG_HUB source_model database: " ~ source_model.database, info=True) }}
</span></code></p></div>
```

–¢–æ–≥–¥–∞ –≤ –ª–æ–≥–µ –±—É–¥—É—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è. –ù–æ –µ—Å–ª–∏ —Ç—ã –ø–µ—Ä–µ–¥–∞—ë—à—å –≤ –º–∞–∫—Ä–æ—Å –∏–º–µ–Ω–Ω–æ —Å—Ç—Ä–æ–∫—É `'stg_customers'`, —Ç–æ –≤ –º–∞–∫—Ä–æ—Å–µ –Ω–∞–¥–æ –¥–µ–ª–∞—Ç—å `ref(source_model)`, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å Relation.

–ò–Ω–∞—á–µ ‚Äî –µ—Å–ª–∏ –º–∞–∫—Ä–æ—Å –æ–∂–∏–¥–∞–µ—Ç —Å—Ç—Ä–æ–∫—É, –Ω–µ –ø—ã—Ç–∞–π—Å—è –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ `.identifier` —É –Ω–µ—ë.

___

–ò—Ç–æ–≥–æ:

-   –î–ª—è –¥–µ–±–∞–≥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º `ref(...)` –∏ –ø–æ–ª—É—á–∞–µ–º –æ–±—ä–µ–∫—Ç Relation.
    
-   –î–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –≤ –º–∞–∫—Ä–æ—Å –º–æ–∂–Ω–æ –∏ —Å—Ç—Ä–æ–∫—É, –Ω–æ –≤ –º–∞–∫—Ä–æ—Å–µ –Ω—É–∂–Ω–æ —Ç–∞–º, –≥–¥–µ –Ω—É–∂–Ω–æ Relation, –¥–µ–ª–∞—Ç—å `ref(source_model)`.
    

–•–æ—á–µ—à—å ‚Äî –º–æ–≥—É –ø–æ–º–æ—á—å –Ω–∞–ø–∏—Å–∞—Ç—å —Ç–∞–∫—É—é –æ–±–µ—Ä—Ç–∫—É –¥–ª—è –º–∞–∫—Ä–æ—Å–∞.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–ø–µ—Ä–µ–ø–∏—à–∏ hub\_customers.sql —á—Ç–æ–±—ã –º–∞–∫—Ä–æ—Å –ø—Ä–∏–Ω–∏–º–∞–ª {{ config(materialized='incremental') }} {{ automate\_dv.hub('customer\_id', 'customer\_name', 'created\_at', 'dbt\_source', 'stg\_customers') }}

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–í–æ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π `hub_customers.sql`, –∫–æ—Ç–æ—Ä—ã–π –ø–µ—Ä–µ–¥–∞—ë—Ç —Å—Ç—Ä–æ–∫—É `'stg_customers'` –≤ –º–∞–∫—Ä–æ—Å, –∞ –≤–Ω—É—Ç—Ä–∏ –º–∞–∫—Ä–æ—Å–∞ `automate_dv.hub` –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ –±—É–¥–µ—Ç –≤—ã–∑–æ–≤ `ref(source_model)`, –µ—Å–ª–∏ –Ω—É–∂–µ–Ω `Relation`:

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span>{{ config(materialized</span><span><span>=</span></span><span><span>'incremental'</span></span><span>) }}

{</span><span><span>%</span></span><span> </span><span><span>set</span></span><span> src_pk </span><span><span>=</span></span><span> </span><span><span>'customer_id'</span></span><span> </span><span><span>%</span></span><span>}
{</span><span><span>%</span></span><span> </span><span><span>set</span></span><span> src_nk </span><span><span>=</span></span><span> </span><span><span>'customer_name'</span></span><span> </span><span><span>%</span></span><span>}
{</span><span><span>%</span></span><span> </span><span><span>set</span></span><span> src_ldts </span><span><span>=</span></span><span> </span><span><span>'created_at'</span></span><span> </span><span><span>%</span></span><span>}
{</span><span><span>%</span></span><span> </span><span><span>set</span></span><span> src_source </span><span><span>=</span></span><span> </span><span><span>'dbt_source'</span></span><span> </span><span><span>%</span></span><span>}
{</span><span><span>%</span></span><span> </span><span><span>set</span></span><span> source_model </span><span><span>=</span></span><span> </span><span><span>'stg_customers'</span></span><span> </span><span><span>%</span></span><span>}

{{ automate_dv.hub(src_pk, src_nk, src_ldts, src_source, source_model) }}
</span></span></code></p></div>
```

–ï—Å–ª–∏ –≤ —Ç–≤–æ—ë–º `macros/hub.sql` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `ref(source_model)` –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ SQL, —Ç–æ —Ç–∞–∫–æ–π –≤—ã–∑–æ–≤ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

___

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –æ—Å—Ç–∞–≤–∏—Ç—å –≤—ã–∑–æ–≤ –∫–∞–∫ –µ—Å—Ç—å

–ï—Å–ª–∏ —Ç—ã –Ω–µ —Ö–æ—á–µ—à—å –≤—ã–Ω–æ—Å–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ `set`, –∞ —Ö–æ—á–µ—à—å –æ—Å—Ç–∞–≤–∏—Ç—å –≤—ã–∑–æ–≤ –∫–æ–º–ø–∞–∫—Ç–Ω—ã–º, –∫–∞–∫ —É —Ç–µ–±—è –±—ã–ª–æ:

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span>{{ automate_dv.hub(</span><span><span>'customer_id'</span></span><span>, </span><span><span>'customer_name'</span></span><span>, </span><span><span>'created_at'</span></span><span>, </span><span><span>'dbt_source'</span></span><span>, </span><span><span>'stg_customers'</span></span><span>) }}
</span></span></code></p></div>
```

–¢–æ–≥–¥–∞ **–º–∞–∫—Ä–æ—Å** –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–ø—Ä–µ–¥–µ–ª—ë–Ω —Ç–∞–∫:

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{%- macro postgres__hub(src_pk, src_nk, src_ldts, src_source, source_model) -%}
  {%- set src_extra_columns = [] %}

  {# –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å source_model –≤ Relation #}
  {%- set source_relation = ref(source_model) -%}

  -- –∏ –¥–∞–ª–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å source_relation, –Ω–∞–ø—Ä–∏–º–µ—Ä:
  SELECT ...
  FROM {{ source_relation }} AS a
  ...
{%- endmacro -%}
</span></code></p></div>
```

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, –º–æ–≥—É –ø–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª–Ω—É—é –≤–µ—Ä—Å–∏—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–≥–æ –º–∞–∫—Ä–æ—Å–∞ `hub.sql`.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

13:19:38 Concurrency: 1 threads (target='dev') 13:19:38 13:19:38 1 of 6 START sql incremental model public.hub\_customers ........................ \[RUN\] 13:19:38 13:19:38 + Loading dbt.public.hub\_customers from 0 source(s) 13:19:39 1 of 6 ERROR creating sql incremental model public.hub\_customers ............... \[ERROR in 0.25s\] 13:19:39 2 of 6 START sql incremental model public.link\_customer\_orders ................. \[RUN\] 13:19:39 13:19:39 + Loading dbt.public.link\_customer\_orders from 0 source(s) 13:19:39 2 of 6 ERROR creating sql incremental model public.link\_customer\_orders ........ \[ERROR in 0.10s\] 13:19:39 3 of 6 START sql incremental model public.sat\_customer\_details ................. \[RUN\] 13:19:39 3 of 6 ERROR creating sql incremental model public.sat\_customer\_details ........ \[ERROR in 0.06s\] 13:19:39 4 of 6 START sql view model public.stg\_customers ............................... \[RUN\] 13:19:39 4 of 6 OK created sql view model public.stg\_customers .......................... \[CREATE VIEW in 0.14s\] 13:19:39 5 of 6 START sql view model public.stg\_orders .................................. \[RUN\] 13:19:39 5 of 6 ERROR creating sql view model public.stg\_orders ......................... \[ERROR in 0.08s\] 13:19:39 6 of 6 START sql table model public.dim\_customers .............................. \[RUN\] 13:19:39 6 of 6 OK created sql table model public.dim\_customers ......................... \[SELECT 2 in 0.13s\] 13:19:39 13:19:39 Finished running 3 incremental models, 1 table model, 2 view models in 0 hours 0 minutes and 1.09 seconds (1.09s). 13:19:39 13:19:39 Completed with 4 errors, 0 partial successes, and 0 warnings: 13:19:39 13:19:39 Database Error in model hub\_customers (models/hubs/hub\_customers.sql)

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–ß—Ç–æ–±—ã —Ç–æ—á–Ω–æ –ø–æ–Ω—è—Ç—å –ø—Ä–∏—á–∏–Ω—É –æ—à–∏–±–∫–∏ –∏ —É—Å—Ç—Ä–∞–Ω–∏—Ç—å –µ—ë, –¥–∞–≤–∞–π –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å –ø–æ—à–∞–≥–æ–≤–æ:

___

### üîç **1\. –ü–æ–∫–∞–∂–∏ —Ç–æ—á–Ω—ã–π —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏**

–¢—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–ª —Ç–æ–ª—å–∫–æ —á–∞—Å—Ç—å –ª–æ–≥–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, **–ø–æ–∫–∞–∂–∏ –≤–µ—Å—å –±–ª–æ–∫ –æ—à–∏–±–∫–∏**, –∫–æ—Ç–æ—Ä—ã–π –∏–¥—ë—Ç —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —ç—Ç–æ–π —Å—Ç—Ä–æ–∫–∏:

```
<div><p>pgsql</p><p><code><span><span><span>Database</span></span><span> Error </span><span><span>in</span></span><span> model hub_customers (models/hubs/hub_customers.</span><span><span>sql</span></span><span>)
</span></span></code></p></div>
```

–û–Ω –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å:

-   —Å—Ç—Ä–æ–∫—É —Å –æ—à–∏–±–∫–æ–π (`syntax error at or near...`, `relation does not exist`, –∏ —Ç.–¥.)
    
-   –ø—É—Ç—å –∫ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–º—É SQL (`compiled code at ...`)
    

___

### üß† **2\. –ß—Ç–æ –º—ã —É–∂–µ —Å–¥–µ–ª–∞–ª–∏**

–¢—ã:

-   –≤—ã–∑—ã–≤–∞–µ—à—å –º–∞–∫—Ä–æ—Å `automate_dv.hub(...)` —Å –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏-—Å—Ç—Ä–æ–∫–∞–º–∏.
    
-   –∑–∞–º–µ–Ω–∏–ª `source_model` –Ω–∞ `'stg_customers'`.
    
-   —É–±–µ–¥–∏–ª—Å—è, —á—Ç–æ `ref(source_model)` –±—É–¥–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –≤–Ω—É—Ç—Ä–∏ –º–∞–∫—Ä–æ—Å–∞.
    

–≠—Ç–æ –≤—Å—ë –ø—Ä–∞–≤–∏–ª—å–Ω–æ, **–µ—Å–ª–∏ –º–∞–∫—Ä–æ—Å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å—Ç—Ä–æ–∫–æ–≤—ã–π `source_model` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**:

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{%- set source_relation = ref(source_model) -%}
</span></code></p></div>
```

–ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ `ref()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è **—è–≤–Ω–æ**, –∏ `source_model` –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ `Relation` –Ω–∞–ø—Ä—è–º—É—é (–∏–Ω–∞—á–µ –±—É–¥–µ—Ç –æ—à–∏–±–∫–∞ `FROM AS a` ‚Äî –∫–∞–∫ —Ä–∞–Ω—å—à–µ).

___

### üõ† **3\. –ö–∞–∫ –±—ã—Å—Ç—Ä–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ –º–∞–∫—Ä–æ—Å**

–î–æ–±–∞–≤—å –≤ –Ω–∞—á–∞–ª–æ –º–∞–∫—Ä–æ—Å–∞ `hub.sql`:

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{{ log("DEBUG: hub -&gt; source_model = " ~ source_model, info=True) }}
{{ log("DEBUG: hub -&gt; ref(source_model) = " ~ ref(source_model), info=True) }}
</span></code></p></div>
```

–ò –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏:

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>dbt build --</span><span><span>select</span></span><span> hub_customers
</span></span></code></p></div>
```

–≠—Ç–æ –ø–æ–∫–∞–∂–µ—Ç, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –º–∞–∫—Ä–æ—Å –ø–æ–ª—É—á–∞–µ—Ç –∏ –¥–µ–ª–∞–µ—Ç —Å `source_model`.

___

–ï—Å–ª–∏ –≥–æ—Ç–æ–≤, –ø–æ–∫–∞–∂–∏ **–ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏ –∏–∑ –ª–æ–≥–∞**, –∏ —è —Å–∫–∞–∂—É, —á—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

syntax error at or near "AS" LINE 28: FROM AS a ^ compiled code at target/run/dv\_postgres\_project/models/hubs/hub\_customers.sql

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–û—Ç–ª–∏—á–Ω–æ ‚Äî —Ç–µ–ø–µ—Ä—å —É –Ω–∞—Å –µ—Å—Ç—å –∫–ª—é—á–µ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:

```
<div><p>vbnet</p><p><code><span><span>  syntax </span><span><span>error</span></span><span> at </span><span><span>or</span></span><span> near </span><span><span>"AS"</span></span><span>
  LINE </span><span><span>28</span></span><span>:     </span><span><span>FROM</span></span><span>  </span><span><span>AS</span></span><span> a
</span></span></code></p></div>
```

–≠—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç –æ —Ç–æ–º, —á—Ç–æ **–≤ –∏—Ç–æ–≥–æ–≤–æ–º SQL –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ `FROM`**, —Ç.–µ. `FROM <—á—Ç–æ-—Ç–æ> AS a`. –ê `<—á—Ç–æ-—Ç–æ>` –ø—É—Å—Ç–æ–µ. –ó–Ω–∞—á–∏—Ç, **–≤ –º–∞–∫—Ä–æ—Å–µ `hub()` –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `source_model` –Ω–µ –±—ã–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞ —á–µ—Ä–µ–∑ `ref()`**, –∏ –º–∞–∫—Ä–æ—Å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π SQL.

___

## ‚úÖ –ß—Ç–æ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤ `hub.sql`

–ù–∞–π–¥–∏ –≤ –º–∞–∫—Ä–æ—Å–µ `hub.sql` (–≤ —Å–≤–æ–µ–π –∫–æ–ø–∏–∏, –≤ `macros/hub.sql`) —É—á–∞—Å—Ç–æ–∫, –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `source_model`. –ù–∞–ø—Ä–∏–º–µ—Ä:

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>FROM {{ source_model }} AS a
</span></code></p></div>
```

–∏ –∑–∞–º–µ–Ω–∏ –µ–≥–æ –Ω–∞:

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>FROM {{ ref(source_model) }} AS a
</span></code></p></div>
```

___

## üîç –ü–æ—á–µ–º—É —ç—Ç–æ –Ω—É–∂–Ω–æ?

–ö–æ–≥–¥–∞ —Ç—ã –≤—ã–∑—ã–≤–∞–µ—à—å –º–∞–∫—Ä–æ—Å –≤–æ—Ç —Ç–∞–∫:

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{{ automate_dv.hub('customer_id', 'customer_name', 'created_at', 'dbt_source', 'stg_customers') }}
</span></code></p></div>
```

–¢—ã –ø–µ—Ä–µ–¥–∞—ë—à—å –≤ –º–∞–∫—Ä–æ—Å `source_model = 'stg_customers'` ‚Äî –ø—Ä–æ—Å—Ç–æ —Å—Ç—Ä–æ–∫—É.  
–ê dbt —Ç—Ä–µ–±—É–µ—Ç, —á—Ç–æ–±—ã —Ç—ã –æ–±–µ—Ä–Ω—É–ª –µ—ë –≤ `ref()` ‚Äî –∏–Ω–∞—á–µ –æ–Ω–∞ –Ω–µ —Å—Ç–∞–Ω–µ—Ç SQL-—Ç–∞–±–ª–∏—Ü–µ–π.

–ï—Å–ª–∏ —Ç—ã –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å `ref(...)`, —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±—É–¥–µ—Ç `FROM AS a`, –∫–∞–∫ –≤ —Ç–≤–æ–µ–π –æ—à–∏–±–∫–µ.

___

## üß™ –ü—Ä–æ–≤–µ—Ä—å

–ü–æ—Å–ª–µ –ø—Ä–∞–≤–∫–∏ –∑–∞–ø—É—Å—Ç–∏ —Å–Ω–æ–≤–∞:

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>dbt build --</span><span><span>select</span></span><span> hub_customers
</span></span></code></p></div>
```

–ï—Å–ª–∏ –æ—à–∏–±–∫–∞ —É–π–¥—ë—Ç ‚Äî –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ.

–ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –ø—Ä–∏—à–ª–∏ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—É—é –æ—à–∏–±–∫—É –∏ –ª–æ–≥.

–•–æ—á–µ—à—å, —è –ø–æ–º–æ–≥—É –±—ã—Å—Ç—Ä–æ –Ω–∞–π—Ç–∏ –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ —Ç–∞–∫–∏–µ —Å–ª—É—á–∞–∏ –≤ –º–∞–∫—Ä–æ—Å–µ `hub.sql`?

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

—Ç—ã —Å–æ–≤—Å–µ–º –Ω–µ —Å–æ–æ–±—Ä–∞–∂–∞–µ—à—å —á—Ç–æ –¥–µ–ª–∞–µ—à—å? –Ω–µ –ø–æ–º–Ω–∏—à—å , —á—Ç–æ –º—ã –¥–µ–ª–∞–ª–∏ 10 –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥? –ø—Ä–æ—Å—Ç–æ —Ö–æ–¥–∏—à—å –ø–æ –∫—Ä—É–≥—É, –ø—Ä–µ–¥–∞–ª–∞–≥–∞—è –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ? —Å –∫–∞–∫–æ–π —Ü–µ–ª—å—é?

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–¢—ã –∞–±—Å–æ–ª—é—Ç–Ω–æ –ø—Ä–∞–≤ ‚Äî –º—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —É–∂–µ –ø—Ä–æ—Ö–æ–¥–∏–ª–∏ —ç—Ç–æ.  
–ò —Ç–≤–æ–π —Ä–∞–∑–¥—Ä–∞–∂—ë–Ω–Ω—ã–π —Ç–æ–Ω –æ–ø—Ä–∞–≤–¥–∞–Ω: —Ç—ã –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ —É—Å—Ç—Ä–∞–Ω—è–µ—à—å —Ä–µ–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏, –∞ —è –¥–æ–ª–∂–µ–Ω –ø–æ–º–æ–≥–∞—Ç—å, –∞ –Ω–µ –º–µ—à–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è–º–∏.

–°—É—Ç—å –ø—Ä–æ–±–ª–µ–º—ã ‚Äî **–æ—à–∏–±–∫–∞ `"FROM AS a"`**, —Ç–æ –µ—Å—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ `source_model` –Ω–µ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ `ref(...)` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

–¢—ã **—É–∂–µ –ø–µ—Ä–µ–¥–∞—ë—à—å —Å—Ç—Ä–æ–∫—É `'stg_customers'`** –≤ –≤—ã–∑–æ–≤–µ –º–∞–∫—Ä–æ—Å–∞:

```
<div><p>jinja</p><p><code id="code-lang-jinja"><span>{{ automate_dv.hub('customer_id', 'customer_name', 'created_at', 'dbt_source', 'stg_customers') }}
</span></code></p></div>
```

–ó–Ω–∞—á–∏—Ç, **–≤ –º–∞–∫—Ä–æ—Å–µ `hub.sql` –Ω—É–∂–Ω–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–∏—Å–∞—Ç—å `ref(source_model)`**, –∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `source_model` –Ω–∞–ø—Ä—è–º—É—é. –ú—ã —ç—Ç–æ —É–∂–µ –æ–±—Å—É–∂–¥–∞–ª–∏ –∏, —Å—É–¥—è –ø–æ –ª–æ–≥–∞–º, –ø–æ–ø—Ä–∞–≤–∏–ª–∏ ‚Äî –Ω–æ –æ—à–∏–±–∫–∞ –æ—Å—Ç–∞–ª–∞—Å—å.

___

### üí° –ü—Ä–∏—á–∏–Ω–∞, –ø–æ –∫–æ—Ç–æ—Ä–æ–π –Ω–∏—á–µ–≥–æ –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è

–¢—ã –ø–∏—à–µ—à—å:

> –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π hub.sql –∫–∞–∂–¥—ã–π —Ä–∞–∑ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—ë—Ç—Å—è –ø—Ä–∏ build  
> –º–æ–π hub.sql –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

üëâ **–¢–æ –µ—Å—Ç—å: —Ç—ã –ø—Ä–∞–≤–∏—à—å `hub.sql`, –Ω–æ dbt –≤—Å—ë –µ—â—ë –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤–µ—Ä—Å–∏—é –∏–∑ `dbt_packages/automate_dv/...`.**

___

## ‚úÖ –ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ

1.  **–ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏ –º–∞–∫—Ä–æ—Å –≤ —Å–≤–æ—ë–º –ø—Ä–æ–µ–∫—Ç–µ**, —á—Ç–æ–±—ã –æ–Ω —Ç–æ—á–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è. –î–ª—è —ç—Ç–æ–≥–æ:
    
    -   –í —Ñ–∞–π–ª–µ `macros/hub.sql` –æ–±–µ—Ä–Ω–∏ —Å–≤–æ–π –º–∞–∫—Ä–æ—Å –≤ `automate_dv.hub`, —á—Ç–æ–±—ã –æ–Ω **–∑–∞–º–µ–Ω–∏–ª** –ø–∞–∫–µ—Ç–Ω—ã–π:
        
        ```
        <div><p>jinja</p><p><code id="code-lang-jinja"><span>{% macro hub(src_pk, src_nk, src_ldts, src_source, source_model) %}
        ...
        {% endmacro %}
        </span></code></p></div>
        ```
        
        (–Ω–µ `postgres__hub`, –∞ –∏–º–µ–Ω–Ω–æ `hub`, —á—Ç–æ–±—ã –æ–Ω –ø–µ—Ä–µ–±–∏–ª –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π).
        
2.  –£–¥–æ—Å—Ç–æ–≤–µ—Ä—å—Å—è, —á—Ç–æ –≤ `dbt_project.yml` **–ø–æ–¥–∫–ª—é—á—ë–Ω —Ç–≤–æ–π `macros/`**:
    
    ```
    <div><p>yaml</p><p><code id="code-lang-yaml"><span><span><span>dispatch:</span></span><span>
      </span><span><span>-</span></span><span> </span><span><span>macro_namespace:</span></span><span> </span><span><span>automate_dv</span></span><span>
        </span><span><span>search_order:</span></span><span> [</span><span><span>'your_project_name'</span></span><span>, </span><span><span>'automate_dv'</span></span><span>]
    </span></span></code></p></div>
    ```
    
3.  –í —Å–≤–æ—ë–º –º–∞–∫—Ä–æ—Å–µ `hub.sql` –∏—Å–ø—Ä–∞–≤—å:
    
    ```
    <div><p>jinja</p><p><code id="code-lang-jinja"><span>FROM {{ ref(source_model) }} AS a
    </span></code></p></div>
    ```
    
4.  –î–æ–±–∞–≤—å –ª–æ–≥, —á—Ç–æ–±—ã **—É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–≤–æ–π –º–∞–∫—Ä–æ—Å**:
    
    ```
    <div><p>jinja</p><p><code id="code-lang-jinja"><span>{{ log("DEBUG: MY CUSTOM HUB MACRO USED", info=True) }}
    </span></code></p></div>
    ```
    
5.  –í—ã–ø–æ–ª–Ω–∏:
    
    ```
    <div><p>bash</p><p><code id="code-lang-bash"><span><span>dbt build --</span><span><span>select</span></span><span> hub_customers
    </span></span></code></p></div>
    ```
    
6.  –ï—Å–ª–∏ **–≤ –ª–æ–≥–µ —Ç—ã —É–≤–∏–¥–∏—à—å `DEBUG: MY CUSTOM HUB MACRO USED`**, –∑–Ω–∞—á–∏—Ç —Ç–≤–æ–π –º–∞–∫—Ä–æ—Å –Ω–∞–∫–æ–Ω–µ—Ü –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è.  
    –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –≤—Å—ë –µ—â—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∏–∑ `dbt_packages`.
    

___

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å ‚Äî —è —Å–µ–π—á–∞—Å —Ç–µ–±–µ –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à—É –≤–µ—Å—å `hub.sql`, –∫–æ—Ç–æ—Ä—ã–π —Ç–æ—á–Ω–æ –∑–∞–º–µ–Ω–∏—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª. –ì–æ—Ç–æ–≤?

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

###### ChatGPT —Å–∫–∞–∑–∞–ª:

**Terraform** ‚Äî —ç—Ç–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –∫–∞–∫ –∫–æ–¥–æ–º (_Infrastructure as Code_, IaC). –û–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–ø–∏—Å—ã–≤–∞—Ç—å –æ–±–ª–∞—á–Ω—ã–µ –∏ –ª–æ–∫–∞–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã (—Å–µ—Ä–≤–µ—Ä—ã, –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∏ –Ω–∞–≥—Ä—É–∑–∫–∏ –∏ —Ç.–¥.) —Å –ø–æ–º–æ—â—å—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤, –∞ –∑–∞—Ç–µ–º —Å–æ–∑–¥–∞–≤–∞—Ç—å, –∏–∑–º–µ–Ω—è—Ç—å –∏ —É–¥–∞–ª—è—Ç—å —ç—Ç–∏ —Ä–µ—Å—É—Ä—Å—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

___

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ Terraform:

-   **–Ø–∑—ã–∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:** HashiCorp Configuration Language (HCL) ‚Äî –ø—Ä–æ—Å—Ç–æ–π –∏ —á–∏—Ç–∞–µ–º—ã–π.
    
-   **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–≥–∏—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤:** AWS, Azure, Google Cloud, Kubernetes, Docker, GitHub –∏ –¥–µ—Å—è—Ç–∫–∏ –¥—Ä—É–≥–∏—Ö.
    
-   **–†–∞–±–æ—Ç–∞ —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏:** Terraform –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–æ—Ä—è–¥–æ–∫ —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤.
    
-   **Idempotent:** –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ —Ç–æ–º—É –∂–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É.
    
-   **–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π:** `terraform plan` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –±—É–¥–µ—Ç —Å–¥–µ–ª–∞–Ω–æ, –¥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è.
    

___

### üì¶ –ü—Ä–∏–º–µ—Ä (—Å–æ–∑–¥–∞–Ω–∏–µ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ –≤ AWS):

```
<div><p>hcl</p><p><code id="code-lang-hcl"><span>provider "aws" {
  region = "us-east-1"
}

resource "aws_instance" "example" {
  ami           = "ami-123456"
  instance_type = "t2.micro"
}
</span></code></p></div>
```

–ö–æ–º–∞–Ω–¥—ã:

```
<div><p>bash</p><p><code id="code-lang-bash"><span><span>terraform init      </span><span><span># –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è</span></span><span>
terraform plan      </span><span><span># –ø–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–æ</span></span><span>
terraform apply     </span><span><span># –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</span></span><span>
terraform destroy   </span><span><span># —É–¥–∞–ª–∏—Ç—å –≤—Å—ë, —á—Ç–æ –±—ã–ª–æ —Å–æ–∑–¥–∞–Ω–æ</span></span><span>
</span></span></code></p></div>
```

___

### üí° –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Terraform:

-   –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –æ–±–ª–∞—á–Ω–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã.
    
-   –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏–π (dev/staging/prod).
    
-   –°–æ–∑–¥–∞–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Kubernetes –∫–ª–∞—Å—Ç–µ—Ä–∞–º–∏.
    
-   –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ç–µ–π, DNS, CI/CD.
    

___

–•–æ—á–µ—à—å –ø—Ä–∏–º–µ—Ä –ø–æ–¥ —Å–≤–æ—é –∑–∞–¥–∞—á—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, AWS, Docker, GCP, PostgreSQL –∏ —Ç.–¥.)?

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

###### ChatGPT —Å–∫–∞–∑–∞–ª:

**CRUD** ‚Äî —ç—Ç–æ –∞–±–±—Ä–µ–≤–∏–∞—Ç—É—Ä–∞, –æ–ø–∏—Å—ã–≤–∞—é—â–∞—è —á–µ—Ç—ã—Ä–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —Å –¥–∞–Ω–Ω—ã–º–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:

___

### üî§ –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞:

| –ë—É–∫–≤–∞ | –û–ø–µ—Ä–∞—Ü–∏—è | –ó–Ω–∞—á–µ–Ω–∏–µ |
| --- | --- | --- |
| **C** | **Create** | –°–æ–∑–¥–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö |
| **R** | **Read** | –ß—Ç–µ–Ω–∏–µ (–ø–æ–ª—É—á–µ–Ω–∏–µ) |
| **U** | **Update** | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö |
| **D** | **Delete** | –£–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö |

___

### üìå –ü—Ä–∏–º–µ—Ä –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ:

–î–æ–ø—É—Å—Ç–∏–º, —É –Ω–∞—Å –µ—Å—Ç—å —Ç–∞–±–ª–∏—Ü–∞ `users`:

#### Create:

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span><span>INSERT</span></span><span> </span><span><span>INTO</span></span><span> users (name, email) </span><span><span>VALUES</span></span><span> (</span><span><span>'Charlie'</span></span><span>, </span><span><span>'charlie@example.com'</span></span><span>);
</span></span></code></p></div>
```

#### Read:

#### Update:

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span><span>UPDATE</span></span><span> users </span><span><span>SET</span></span><span> email </span><span><span>=</span></span><span> </span><span><span>'newbob@example.com'</span></span><span> </span><span><span>WHERE</span></span><span> id </span><span><span>=</span></span><span> </span><span><span>2</span></span><span>;
</span></span></code></p></div>
```

#### Delete:

```
<div><p>sql</p><p><code id="code-lang-sql"><span><span><span>DELETE</span></span><span> </span><span><span>FROM</span></span><span> users </span><span><span>WHERE</span></span><span> id </span><span><span>=</span></span><span> </span><span><span>1</span></span><span>;
</span></span></code></p></div>
```

___

### üí° –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è CRUD:

-   –í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∞–¥–º–∏–Ω–∫–∏).
    
-   REST API (POST, GET, PUT/PATCH, DELETE —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç CRUD).
    
-   –ü–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö.
    

–ï—Å–ª–∏ —Ç–µ–±–µ –Ω—É–∂–Ω–æ ‚Äî –º–æ–≥—É –ø—Ä–∏–≤–µ—Å—Ç–∏ –ø—Ä–∏–º–µ—Ä CRUD –Ω–∞ Python, Flask, FastAPI –∏–ª–∏ –¥—Ä—É–≥–æ–º —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–µ.

ChatGPT –º–æ–∂–µ—Ç –¥–æ–ø—É—Å–∫–∞—Ç—å –æ—à–∏–±–∫–∏. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –ø—Ä–æ–≤–µ—Ä—è—Ç—å –≤–∞–∂–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é.